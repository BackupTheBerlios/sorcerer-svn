# Thanks to a hal developer wanting to use libblkid provided by util-linux
# e2fsprogs and util-linux now have circuliar requirements upon each other!!!

    stable 1.41.13 1.41.12 1.41.11
   require gawk init-functions util-linux
     opts --exec-prefix= --with-root-prefix= --enable-elf-shlibs --disable-libblkid --disable-libuuid
  category disk/file-system
 attribute console library
    source $SOURCEFORGE_URL e2fsprogs/e2fsprogs/$VERSION/e2fsprogs-$VERSION.tar.gz
  homepage http://e2fsprogs.sourceforge.net
  estimate 1350
      desc 'required utilities for the EXT2 file system
e2fsprogs - The EXT2 file system utilities and libraries.
EXT2 stands for "Extended Filesystem", version 2.
It is a hard drive filesystem used on GNU Linux boxes.
This package contains programs for creating, checking,
and maintaining EXT2 filesystems, and the generic fsck wrapper.
The ext2fsprogs package contains essential ext2 filesystem utilities
which consists of e2fsck, mke2fs, debugfs, dumpe2fs, tune2fs,
and most of the other core ext2 filesystem utilities.'

# While uClibc is using oldthreads instead of newthreads,
# because gcc would not detect threads when newthreads was enabled
# thread-local-storage must be disabled in order to compile e2fsprogs
case $MACHTYPE in
 *-uclibc) opts --disable-tls ;;
esac

build(){
 if   [[ $CFLAGS =~ -m32 ]]
 then export LDFLAGS+=" -m32"
# OPTS+=" --host=${MACHTYPE/x86_64/i686}"
 fi

 default_build &&
 make install-{strip,libs} "DESTDIR=$DESTDIR"
}

build_old(){

 ./configure \
 --prefix=/usr \
 --with-root-prefix= \
 --enable-elf-shlibs \
 $OPTS &&
 make "LDFLAGS=$LDFLAGS" &&
 make install       "DESTDIR=$DESTDIR" &&
 make install-libs  "DESTDIR=$DESTDIR" &&
 make install-strip "DESTDIR=$DESTDIR" &&
 make install-libs  "DESTDIR=$DESTDIR"
}
