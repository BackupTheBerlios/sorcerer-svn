# PHP 5.3.0 is very new and significantly different from 5.2.* so many
# web applications need to be modified for 5.3.0. Therefore, 5.3.0 
# should probably be kept as unstable for a while. J.M. 2009-11-05

    latest 5.3.0
    stable 5.2.11 5.2.10 5.2.9 5.2.8
    legacy 5.2.11
    secure 5.2.11
   require automake bzip2 libtool libxml2 pcre wget
  optional httpd      '--with-apxs2 --with-mime-magic'   ''               to create a module for apache 2.0.x
  optional aspell     --with-pspell                      ''               for spelling functions
  optional mhash      --with-mhash                       ''               for hash functions support
  optional mcrypt     --with-mcrypt                      ''               for encryption
  optional curl       --with-curl                        ''               for transferring files using URL syntax
  optional gmp        --with-gmp                         ''               GNU math precision library
  optional openssl    --with-openssl                     ''               for encryption
  optional postgresql --with-pgsql=/usr                  ''               for native db support
  optional gdbm       --with-gdbm                        ''               database routines that use extensible hashing
  optional expat      '--with-xml --with-expat-dir=/usr' ''               XML parsing library
  optional libxslt    --with-xsl                         ''               for XSL support
  optional t1lib      --with-t1lib=/usr/share/t1lib      ''               generates bitmaps from Adobe Type 1 fonts
  optional freetype   --with-freetype-dir=/usr/lib       ''               software font engine
  optional mysql      --with-mysql=/usr                  ''               for db support
  optional gd         --with-gd                          --without-gd     for graphing support
  optional pine       --with-imap                        ''               for imap support
  optional sqlite     ''                                 --without-sqlite for sqlite support 
  optional jpeg       --with-jpeg-dir=/usr               ''               for JPEG support 
  optional openldap   --with-ldap                        ''               for LDAP support

  switch --enable-sockets '' for experimental socket support
  switch --enable-pcntl   '' for experimental pcntl fork process support
  switch --enable-soap    '' enable SOAP support

  category development/interpreter
 attribute console x11
  homepage http://www.php.net/
       url 'http://www.php.net/
            http://au.php.net/
            http://at.php.net/
            http://at2.php.net/
            http://php.easynet.be/
            http://php.belnet.be/
            http://br.php.net/
            http://br2.php.net/
            http://bg.php.net/
            http://php.ssi.bg/
            http://ca.php.net/
            http://www.php.ca/
            http://cn.php.net/
            http://cn2.php.net/
            http://cr.php.net/
            http://www.php.cz/
            http://dk.php.net/
            http://ee.php.net/
            http://fi.php.net/
            http://fi2.php.net/
            http://fr.php.net/
            http://php.crihan.fr/
            http://php4.globe.de/
            http://php3.de/
            http://www.php.gr/
            http://hu.php.net/
            http://php.mirror.stop.hu/
            http://www.is.php.net/
            http://php.mweb.co.id/
            http://php.morva.net/
            http://php.mirrors.esat.net/
            http://it.php.net/
            http://it2.php.net/
            http://php.iol.it/
            http://jp.php.net/
            http://jp2.php.net/
            http://www.lv.php.net/
            http://li.php.net/
            http://lt.php.net/
            http://mx.php.net/
            http://nl.php.net/
            http://nl2.php.net/
            http://php.nederland.net/
            http://nz.php.net/
            http://php.inspire.net.nz/
            http://no.php.net/
            http://php.brainpeddlers.com/
            http://ph.php.net/
            http://pl.php.net/
            http://php.polbiznes.pl/
            http://php.ip.pt/
            http://kr.php.net/
            http://kr2.php.net/
            http://php.lasting.ro/
            http://ru.php.net/
            http://php.rinet.ru/
            http://sg.php.net/
            http://si.php.net/
            http://za.php.net/
            http://es.php.net/
            http://php.rediris.es/
            http://se.php.net/
            http://se2.php.net/
            http://ch.php.net/
            http://php.benscom.com/
            http://tw.php.net/
            http://tw2.php.net/
            http://ua.php.net/
            http://ua2.php.net/
            http://uk.php.net/
            http://php.uk.themoes.org/
            http://php.he.net/
            http://php.us.themoes.org/
            http://us4.php.net/'
    source distributions/php-$VERSION.tar.bz2
  estimate 1300
      desc 'personal home page scripting language
php is a scripting language that is especially suited
for Web development and can be embedded into HTML.'

build(){
# --with-pcre-regex=/usr
PHP_CONFIGURE="
--prefix=/usr
--sysconfdir=/etc
--with-config-file-path=/etc
--disable-static
--disable-debug
--disable-rpath
--enable-inline-optimization
--enable-pic
--enable-bcmath
--enable-calendar
--enable-magic-quotes
--enable-track-vars
--enable-safe-mode
--enable-sysvsem
--enable-sysvshm
--enable-force-cgi-redirect
--enable-trans-sid
--enable-yp
--enable-ftp
--enable-wddx
--enable-filepro
--enable-dbase
--with-versioning
--with-gettext
--with-mod_charset
--with-layout=GNU
--with-zlib
--with-bz2
--enable-exif
--with-regex=system
--enable-mbstring=all
--enable-mbregex
$OPTS"
#--with-regex=system
#--with-pcre-regex=/usr

case $VERSION in
 5.2.*) PHPINI=php.ini-dist  ;;
     *) PHPINI=php.ini-production  ;;
esac

./configure $PHP_CONFIGURE &&
make                       &&
prepare_install            &&
make    install            &&
cp "$PHPINI" /etc/php.ini
}

post_install(){
default_post_install
if   [ -f /etc/init.d/httpd ]
then      /etc/init.d/httpd try-restart
fi
true
}

pre_remove(){
 remove_php_module(){
  LPM=lib/apache/libphp5.so
  HTTPD_CONF=/etc/httpd/conf/httpd.conf
  HTTPD_CONF_TMP="/tmp/httpd.conf.$$.$RANDOM"

  if   grep    "$LPM"     $HTTPD_CONF
  then grep -v "$LPM"     $HTTPD_CONF > $HTTPD_CONF_TMP
       cp $HTTPD_CONF_TMP $HTTPD_CONF
  fi
 }

 default_pre_remove
 remove_php_module
 if   [ -f /etc/init.d/httpd ]
 then      /etc/init.d/httpd try-restart
 fi
 true
}

post_remove(){
 modify(){ (
  TEMP="$( cat $1 )"
  echo "$TEMP"                      |
  grep -v  "LoadModule php4_module" |
  grep -v  "AddModule mod_php4.c"   >  $1
  if   [ -x /usr/sbin/apachectl ]
  then      /usr/sbin/apachectl graceful
  fi
 ) }

  default_post_remove
  if   [ -f /etc/httpd/conf/httpd.conf  ]; then modify /etc/httpd/conf/httpd.conf
  elif [ -f /etc/apache/httpd.conf ];      then modify /etc/apache/httpd.conf
  fi
  true
}
