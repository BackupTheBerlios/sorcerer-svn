#  VERSION=( "5.1.0" "5.0.5" "5.0.4" "5.0.3" "5.0.2" "5.0.1" "5.0.0" )
   VERSION=( "5.0.5" "5.0.4" "5.0.3" "5.0.2" "5.0.1" "5.0.0" )
      SAFE=( "5.1.0" "5.0.5" )
# 5.1.0 has compile errors
# and is a security release.  How unfortunate.
  CATEGORY="interpreter"
 ATTRIBUTE="console x11"
    SOURCE="distributions/php-$VERSION.tar.bz2"
  HOMEPAGE="http://www.php.net"
       URL="http://www.php.net
            http://au.php.net
            http://at.php.net
            http://at2.php.net
            http://php.easynet.be
            http://php.belnet.be
            http://br.php.net
            http://br2.php.net
            http://bg.php.net
            http://php.ssi.bg
            http://ca.php.net
            http://www.php.ca
            http://cn.php.net
            http://cn2.php.net
            http://cr.php.net
            http://www.php.cz
            http://dk.php.net
            http://ee.php.net
            http://fi.php.net
            http://fi2.php.net
            http://fr.php.net
            http://php.crihan.fr
            http://php4.globe.de
            http://php3.de
            http://www.php.gr
            http://hu.php.net
            http://php.mirror.stop.hu
            http://www.is.php.net
            http://php.mweb.co.id
            http://php.morva.net
            http://php.mirrors.esat.net
            http://it.php.net
            http://it2.php.net
            http://php.iol.it
            http://jp.php.net
            http://jp2.php.net
            http://www.lv.php.net
            http://li.php.net
            http://lt.php.net
            http://mx.php.net
            http://nl.php.net
            http://nl2.php.net
            http://php.nederland.net
            http://nz.php.net
            http://php.inspire.net.nz
            http://no.php.net
            http://php.brainpeddlers.com
            http://ph.php.net
            http://pl.php.net
            http://php.polbiznes.pl
            http://php.ip.pt
            http://kr.php.net
            http://kr2.php.net
            http://php.lasting.ro
            http://ru.php.net
            http://php.rinet.ru
            http://sg.php.net
            http://si.php.net
            http://za.php.net
            http://es.php.net
            http://php.rediris.es
            http://se.php.net
            http://se2.php.net
            http://ch.php.net
            http://php.benscom.com
            http://tw.php.net
            http://tw2.php.net
            http://ua.php.net
            http://ua2.php.net
            http://uk.php.net
            http://php.uk.themoes.org
            http://php.he.net
            http://php.us.themoes.org
            http://us4.php.net"
       REQ=( "autoconf automake bzip2 libtool libxml2 pcre zlib"
             "httpd:--with-apxs2::to create a module for apache 2.0.x"
             "aspell:--with-pspell::for spelling functions"
             "mhash:--with-mhash::for hash functions support"
             "mcrypt:--with-mcrypt::for encryption"
             "curl:--with-curl::for transferring files using URL syntax"
             "gmp:--with-gmp::GNU math precision library"
             "openssl:--with-openssl::for encryption"
             "postgresql:--with-pgsql=/usr::for native db support"
             "gdbm:--with-gdbm::database routines that use extensible hashing"
             "expat:--with-xml --with-expat-dir=/usr::XML parsing library"
             "t1lib:--with-t1lib=/usr/share/t1lib::generates bitmaps from Adobe Type 1 fonts"
             "freetype:--with-freetype-dir=/usr/lib::software font engine"
             "mysql:--with-mysql=/usr::for db support"
             "gd:--with-gd:--without-gd:for graphing support"
             "pine:--with-imap::for imap support"
             ":--enable-sockets::for experimental socket support"
             ":--enable-pcntl::for experimental pcntl fork process support"
             "sqlite::--without-sqlite:for sqlite support" 
             "jpeg:--with-jpeg-dir=/usr::for JPEG support" 
             "openldap:--with-ldap::for LDAP support" )
  ESTIMATE="378"
      DESC="php is the personal home page scripting language.
php is a scripting language that is especially suited
for Web development and can be embedded into HTML."


case  $VERSION  in
  5.0.5)  REQ="autoconf automake bzip2 gcc-v3.4 libtool libxml2 pcre zlib"  ;;
esac


build()  {

case  $VERSION  in
  5.0.5)  GCC3_VER=$( installed_version gcc-v3.4 )
          export  PATH="${PATH/gcc\/current/gcc/$GCC3_VER}"
          export  CCACHE_PATH="/opt/gcc/$GCC3_VER/bin"  ;;
esac


 # --with-pcre-regex=/usr        \
 PHP_CONFIGURE="\
 --prefix=/usr                 \
 --sysconfdir=/etc             \
 --with-config-file-path=/etc  \
 --disable-static              \
 --disable-debug               \
 --disable-rpath               \
 --enable-inline-optimization  \
 --enable-pic                  \
 --enable-bcmath               \
 --enable-magic-quotes         \
 --enable-track-vars           \
 --enable-safe-mode            \
 --enable-sysvsem              \
 --enable-sysvshm              \
 --enable-force-cgi-redirect   \
 --enable-trans-sid            \
 --enable-yp                   \
 --enable-ftp                  \
 --enable-wddx                 \
 --enable-filepro              \
 --enable-dbase                \
 --with-versioning             \
 --with-gettext                \
 --with-mod_charset            \
 --with-layout=GNU             \
 --with-zlib                   \
 --with-bz2                    \
 --enable-exif                 \
 --with-regex=system           \
 $OPTS"
 #  --with-regex=system           \
 #  --with-pcre-regex=/usr        \


 ./configure  $PHP_CONFIGURE  &&
 make                         &&
 prepare_install              &&
 make    install              &&
 if    !   [  -e         /etc/php.ini  ]
 then  cp  php.ini-dist  /etc/php.ini
 fi
}

post_install() {
  default_post_install
  if    [  -f  /etc/init.d/httpd  ]
  then         /etc/init.d/httpd try-restart
  fi
  true
}

pre_remove() {
  remove_php_module()  {
    LPM="modules/mod_php.so"
    HTTPD_CONF="/etc/httpd/httpd.conf"
    HTTPD_CONF_TMP="/tmp/httpd.conf.$$.$RANDOM"

    if    grep      "mod_php.so"  $HTTPD_CONF
    then  grep  -v  "mod_php.so"  $HTTPD_CONF  >  $HTTPD_CONF_TMP
          cp     $HTTPD_CONF_TMP  $HTTPD_CONF
    fi
  }

  default_pre_remove
  remove_php_module
  if    [  -f  /etc/init.d/httpd  ]
  then         /etc/init.d/httpd try-restart
  fi
  true
}

post_remove() {
  modify()  { (
    TEMP="$(  cat  $1  )"
    echo  "$TEMP"                       |
    grep  -v  "LoadModule php4_module"  |
    grep  -v  "AddModule mod_php4.c"    >  $1
    if    [  -x  /usr/sbin/apachectl  ]
    then         /usr/sbin/apachectl  graceful
    fi
  ) }

  default_post_remove
  if    [  -f  /etc/httpd/httpd.conf   ];  then  modify  /etc/httpd/httpd.conf
  elif  [  -f  /etc/apache/httpd.conf  ];  then  modify  /etc/apache/httpd.conf
  fi
  true
}
