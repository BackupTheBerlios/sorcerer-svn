# does not do an ELF 32-bit compile.
# reason is configure is broke
# would require hours to trace it and find the exact location
# and to fix it.
# Since the source is from 2008 and will likely remain
# without further releases
# this spell will probably be forever broke
# until removed from the grimoire.

   version stable III-10.2.src
  category audio/cd audio/recorder
 attribute library makej multilib-dual setarch
 attribute broke
    source http://downloads.xiph.org/releases/cdparanoia/cdparanoia-$VERSION.tgz
      info last  20080911
      info home  http://www.xiph.org/paranoia/
      info docs  http://www.xiph.org/paranoia/doc.html
      desc 'cd ripper
Cdparanoia is a Compact Disc Digital Audio (CDDA) 
extraction tool, commonly known on the net as a ripper.
Cdparanoia will read correct, rock-solid audio data 
from inexpensive drives prone to misalignment, 
frame jitter and loss of streaming during atomic reads.
Cdparanoia will also read and repair data from CDs that 
have been damaged in some way.'


build(){
 fix_cdda_interface(){
  sed -i '1i#include <scsi/sg.h>
          1i#include <scsi/scsi.h>
          1i#include <time.h>
          1i#include <sys/time.h>
          1i#include <linux/cdrom.h>
          1istruct cdda_private_data {
          1i  struct sg_header *sg_hd;
          1i  unsigned char *sg_buffer; /* points into sg_hd */
          1i  clockid_t clock;
          1i  int last_milliseconds;
          1i};' /usr/include/cdda_interface.h
 }

 case $VERSION in
  III-alpha9.8) sed -i '\,default:,abreak;' interface/utils.h ;;
 esac

 export   CFLAGS+=' -fPIC'
 export CXXFLAGS+=' -fPIC'
            OPTS+=" --prefix=$DESTDIR/$SPELL/usr"

 default_build &&
 if     [[ $HOSTTYPE == x86_64 ]] &&
      ! [[ $CFLAGS   =~ -m32   ]]
 then mv $DESTDIR/$SPELL/usr/lib{,64}
 fi
}
