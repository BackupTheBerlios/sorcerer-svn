# 1.0rc3 segfaults when run with mkv
   version stable 1.0rc4 1.0rc2 1.0rc1

# mplayer 1.0rc2 will not compile with x264 snapshot-20081001-2245
# nor with x264 version snapshot-20081202-2245

   require gtk+ a52dec libXv libXxf86dga giflib lzo popt unzip w32codec
#  require gtk+ a52dec libXv libXxf86dga libdvdread giflib lzo popt unzip w32codec
  optional MPlayer-Skin '' '' to install skins for GUI
  optional MPlayer-font '' '' to install fonts
  optional SDL --enable-sdl --disable-sdl to use SDL audio/video output
  optional XviD '' --disable-xvid for encoding movies to XviD format
  optional alsa-lib '' --disable-alsa for alsa sound support
  optional cdparanoia '' --disable-cdparanoia for playing/reading audio CDs
  optional esound '' --disable-esd for sound output through esound
  optional faac '' --disable-faac for faac codec support
# optional faad2 --enable-faad-external '' for aac decoding support
  optional freetype '' --disable-freetype for anti-aliased osd/subs support
  optional fribidi '' --disable-fribidi for bidirectional unicode text
  optional jackit '' --disable-jack for jackit audio mixer output support
  optional ladspa_sdk '' --disable-ladspa for audio processor plugin
  optional libcdio '' --disable-libcdio for controlling the CD/DVD device
  optional libdv '' --disable-libdv a software codec for digital video camcorders
  optional libmad '' --disable-mad for playing mpeg audio formats
  optional libtheora '' --disable-theora for theora codec support
  optional libvorbis '' --disable-vorbis for ogg vorbis audio codec support
  optional lirc --enable-lirc --disable-lirc to enable LIRC remote control support
  optional musepack '' --disable-musepack for musepack audio encoder
  optional nas '' --disable-nas for nas audio mixer support
  optional openal '' --disable-openal for audio output through openal libraries
  optional samba --enable-smb --disable-smb for samba SMB input support
  optional speex '' --disable-speex for speex audio codec support
  optional x264 '' --disable-x264 for H.264 codec support
# optional xmms --enable-xmms '' to build with XMMS input plugin support
    switch --enable-joystick '' for joystick support

    source $MPLAYER_URL releases/MPlayer-$VERSION.tar.bz2
case $VERSION in
 1.0rc2)
   use_gcc gcc-v4.2          # for 1.0rc2
      opts --disable-ivtv    # for 1.0rc2
      opts --disable-x264
    source http://www.mplayerhq.hu/MPlayer/patches/demux_audio_fix_20080129.diff
    source http://www.mplayerhq.hu/MPlayer/patches/demux_mov_fix_20080129.diff
    source http://www.mplayerhq.hu/MPlayer/patches/url_fix_20080120.diff
    source http://www.mplayerhq.hu/MPlayer/patches/stream_cddb_fix_20080120.diff
    ;;
esac
 freshmeat mplayer

  category video/dvd video/player
 attribute makej x11
      info home  http://www.mplayerhq.hu
      info docs  http://www.mplayerhq.hu/design7/documentation.html
      desc 'movie and animation player
MPlayer is a movie and animation player that supports a wide
range of file formats, including ASF, Quicktime, and Vivo.
It has many MMX/SSE/3Dnow optimized native audio and video
codecs, but allows using XAnim binary codec plugins, and
Win32 codec DLLs.
It has basic VCD/DVD playback functionality, including DVD
subtitles, but supports many text-based subtitle formats too.
For video output, nearly every existing interface is supported.
It is also able to convert any supported files to raw/divx/mpeg4
AVI (pcm/mp3 audio), and even video grabbing from V4L devices.'

build(){
 install_conf(){
  mkdir -p doc
  mv   etc doc
  cd       doc/etc

  sed -i "s:include =:# include =:; s:# vo=:vo=:; s:# ao=:ao=:" example.conf
  mkdir -p $DESTDIR/etc/mplayer

  for FILE in *.conf
  do  install -m 0644 -o root -g root $FILE $DESTDIR/etc/mplayer
  done
 }

  case $VERSION in
   1.0rc2)
    patch -p0 < ${SOURCE[1]}
    patch -p0 < ${SOURCE[2]}
    patch -p0 < ${SOURCE[3]}
    patch -p0 < ${SOURCE[4]} ;;
  esac

  unset CFLAGS CXXFLAGS

#  --win32codecsdir=/usr/lib/win32 \
#  --realcodecsdir=/usr/lib/win32  \
#  --xanimcodecsdir=/usr/lib/win32 \

 if   [[ $HOSTTYPE == x86_64 ]]
 then sed -i 's:${_xmmslibdir}/libxmms.so.1:-lxmms:' configure
 fi

  echo                            |
  ./configure                     \
  --prefix=/usr                   \
  --enable-gui                    \
  --confdir=/etc/mplayer          \
  --enable-menu                   \
  --enable-largefiles             \
  --codecsdir=/usr/lib/win32      \
  $OPTS                           &&
  make    install prefix=/usr "DESTDIR=$DESTDIR" &&
  install_conf
}
