   VERSION=( "3.3.6" "3.3.5" "3.3.4" "3.3.3" )
      SAFE=( "3.3.6" "3.3.5" "3.3.4" "3.3.3" )
    IGNORE="\.0b"
  CATEGORY="graphic"
 ATTRIBUTE="library kde"
    SOURCE="qt-x11-free-$VERSION.tar.bz2"
  HOMEPAGE="http://www.trolltech.com/products/qt/x11.html"
       URL="ftp://ftp.trolltech.com/qt/source/"
# is cups required or optional?
       REQ=( "fontconfig jpeg libmng libpng x11"
             "cups:-cups:-no-cups:for common unix printing support"
             "freetype:-freetype:-no-freetype:quality font engine"
             ":-qt-gif::for gif support" )
# qt-x11-free does not support nas network audio.
 FRESHMEAT="qt"
  ESTIMATE="5586"
      DESC="qt-x11-free simplifies the task of writing and maintaining GUI applications."

FIX_MSG="Fixing the include path in qmake.conf..."

build()  {
  fix_qmake_conf() {
   # This should be used when the qt headers are NOT instaled in 
   # /usr/include, i.e. if they are installed to /usr/include/qt, 
   # /usr/share/qt/include or whatever then this is NEEDED because the
   # qmake.conf sets the QT include directory to $(QTDIR)/include.
   # Some applications need this to be correct in order for them to compile.
   echo   "$FIX_MSG" 
   sed    -i  's:\$(QTDIR)/include$:\$(QTDIR)/include/qt:'		\
              mkspecs/${SPECS}/qmake.conf
   cp     -a  mkspecs/${SPECS}  /usr/share/qt/mkspecs/
  }

  echo  $OPTS           |
  grep  -q  "\-qt-gif"  &&
  sed   -i  "s:READER 0:READER 1:"  src/kernel/qgif.h


  export  QTDIR=$BUILD_DIR
  sed  -i  "s/sub-tutorial sub-examples//"  Makefile
  rm   -rf  examples tutorial

  unset  LD_LIBRARY_PATH

  case  $HOSTTYPE  in
    x86_64)  OPTS="$OPTS -platform linux-g++-64 -L/lib64 -L/usr/lib64"
             SPECS=linux-g++-64
             LIBS=lib64  ;;
         *)  SPECS=linux-g++
             LIBS=lib  ;;
  esac

  prepare_install             &&  # doesn't make right if installed.

  # -R$BUILD_DIR/lib       \  # not required if qt-x11-free is not installed
  # -L$PWD/lib       \

  #  -cups           \

# -headerdir /usr/include/qt  \

  echo  "yes"  |
  ./configure  -v  \
  -release         \
  -shared          \
  -thread          \
  -system-libmng   \
  -system-libpng   \
  -system-libjpeg  \
  -system-zlib     \
  -xinerama        \
  -xft             \
  -R$PWD/lib       \
  -no-g++-exceptions     \
  -prefix /usr/share/qt  \
  -bindir /usr/bin       \
  -libdir /usr/$LIBS     \
  $OPTS                  &&
  make                   &&
  make    install        &&
  cp     -R   doc/man  /usr   &&
  ln     -s   ../share/qt/include  /usr/include/qt    &&
  ln     -s   ../../bin            /usr/share/qt/bin  &&
  ln     -s   ../../$LIBS          /usr/share/qt/lib  &&
  fix_qmake_conf

# QTDIR=/usr/share/qt
# because some sources check for /usr/share/qt/include/qglobal.h

# Leave broken symbolic link in place.
# rm                           /usr/share/qt/mkspecs/${SPECS}/${SPECS}
}

build_old()  {
echo  $OPTS           |
grep  -q  "\-qt-gif"  &&
sed   -i  "s:READER 0:READER 1:"  src/kernel/qgif.h


export  QTDIR=$BUILD_DIR
sed  -i  "s/sub-tutorial sub-examples//"  Makefile
rm   -rf  examples tutorial

unset  LD_LIBRARY_PATH

case  $HOSTTYPE  in
  x86_64)  OPTS="$OPTS -platform linux-g++-64 -L/lib64 -L/usr/lib64"
           SPECS=linux-g++-64
           LIBS=lib64
	   ;;
       *)  SPECS=linux-g++
           LIBS=lib
           ;;
esac

prepare_install             &&  # doesn't make right if installed.

# -R$BUILD_DIR/lib       \  # not required if qt-x11-free is not installed
# -L$PWD/lib       \

#  -cups           \
echo  "yes"  |
./configure  -v  \
-release         \
-shared          \
-thread          \
-system-libmng   \
-system-libpng   \
-system-libjpeg  \
-system-zlib     \
-xinerama        \
-xft             \
-R$PWD/lib       \
-no-g++-exceptions     \
-prefix /usr/share/qt  \
-bindir /usr/bin       \
-libdir /usr/$LIBS     \
-headerdir /usr/include/qt  \
$OPTS                       &&
make                        &&
# prepare_install             &&  # might not make right if installed.
make    install             &&
cp     -R   doc/man  /usr   &&
rm                           /usr/share/qt/mkspecs/${SPECS}/${SPECS}  &&
# The next line should be only used if headerdir is /usr/include/qt because
# the default value of it is /usr/include
sed    -i  's:\$(QTDIR)/include$:\$(QTDIR)/include/qt:'		\
           mkspecs/${SPECS}/qmake.conf
cp     -a  mkspecs/${SPECS}  /usr/share/qt/mkspecs/
}

current() {
 grep  -qx  "$FIX_MSG"  $COMPILE_LOGS/$SPELL	&&  
  [  -h  /usr/include/qt  ]
}
