# 1.30.0 fails compilation
# skipping from 1.30.0 to 1.31.0 due to compile failure with 1.30.0
# 1.31.10 causes many compile errors during GISCAN phase.
# gobject-introspection breaks compilation of too much software
# 1.31.6 1.31.1 1.31.0 1.31.10 causes compilation error in gtk+-3.0 3.2.3

# successful compilation of 0.10.8
# 1.30.0 fails compilation

# Do not increase stable version above 0.10.8
# without doing a re-compile of all trait gnome software
# that is not already expected to be broke

# 1.32.1 failed compilation.

with info    last 20130930
with version   stable 1.38.0 1.36.0
#with version unstable 1.37.6
with base    automake cairo fontconfig freetype glib libffi libxml2
with also    --enable-static=no
with role    development
with trait   gnome library makej
with source    stable $GNOME_URL sources/gobject-introspection/${VERSION:0:4}/gobject-introspection-$VERSION.tar.xz
with source  unstable $GNOME_URL sources/gobject-introspection/${VERSION:0:4}/gobject-introspection-$VERSION.tar.xz
with info    home http://www.gnome.org
with info    cite 'document API'

build(){
 # running g-ir-scanner was creating the /.cache directory
 case $VERSION in 
  1.32.1) sed -i "s:homedir,:'/tmp',:" giscanner/cachestore.py ;;
 esac

 wrappers(){
  install -vm 755 "$SCRIPT_DIR"/g-ir "$DESTDIR"/usr/bin/g-ir-annotation-tool
  install -vm 755 "$SCRIPT_DIR"/g-ir "$DESTDIR"/usr/bin/g-ir-compiler
  install -vm 755 "$SCRIPT_DIR"/g-ir "$DESTDIR"/usr/bin/g-ir-generate
  install -vm 755 "$SCRIPT_DIR"/g-ir "$DESTDIR"/usr/bin/g-ir-scanner
 }

 bit_move(){
  mv -v "$DESTDIR"/usr/bin/g-ir-annotation-tool{,-$1}
  mv -v "$DESTDIR"/usr/bin/g-ir-compiler{,-$1}
  mv -v "$DESTDIR"/usr/bin/g-ir-generate{,-$1}
  mv -v "$DESTDIR"/usr/bin/g-ir-scanner{,-$1}
 }

 default_build &&
 if    [[ $HOSTTYPE == x86_64 ]]; then
  if   [[ $CFLAGS   =~ -m32   ]]; then bit_move 32
  elif [[ -f /lib/libc.so.6   ]]; then bit_move 64; wrappers
  fi
 fi
}
