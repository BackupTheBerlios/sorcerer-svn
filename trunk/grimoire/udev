   VERSION=( 115 113 105 100 )
  CATEGORY='utility'
 ATTRIBUTE='console'
    SOURCE="pub/linux/utils/kernel/hotplug/udev-$VERSION.tar.gz"
       REQ=( '' 'libselinux:USE_SELINUX::for selinux support' )
      OPTS='USE_LOG=true'
       URL="$KERNEL_URL"
  HOMEPAGE='http://www.kernel.org/pub/linux/utils/kernel/hotplug/udev.html'
   EXCLUDE='/dev'
  ESTIMATE='320'
      DESC='udev provides an auto-populating /dev.
Add custom rules for udev nodes to the file:
/etc/udev/rules.d/1st.rules'

build() {
init_install_old()  {
  sed      -i       "s:/sbin/udev_run:/lib/udev/udev_run:"  \
                    etc/udev/gentoo/udev.rules
  install  -m 0700  $SCRIPT_DIR/init.d/udev        /etc/init.d
  mkdir    -p      /etc/udev/rules.d               /etc/udev/examples
  cp       -a       etc/udev/*                     /etc/udev/examples
  chmod    -R og-w                                 /etc/udev/examples
  ln       -sf   ../examples/gentoo/udev.rules     /etc/udev/rules.d
  mkdir    -p                                      /etc/udev/scripts
  install  -m 0755  extras/*.sh                    /etc/udev/scripts
}

init_install()  {
  mkdir    -p      /etc/udev/rules.d               /etc/udev/examples
  cp       -a       etc/udev/*                     /etc/udev/examples
  chmod    -R og-w                                 /etc/udev/examples
  cd                                               /etc/udev/rules.d/
  ln       -sf   ../examples/gentoo/*              /etc/udev/rules.d/
  mkdir    -p                                      /etc/udev/scripts
# install  -m 0755  extras/*.sh                    /etc/udev/scripts
}


symlink_install()  {
  mkdir  -p    -m 0755          /lib/udev/dev/{pts,shm}
  ln     -fns  /proc/self/fd    /lib/udev/dev/fd
  ln     -fns  /proc/self/fd/0  /lib/udev/dev/stdin
  ln     -fns  /proc/self/fd/1  /lib/udev/dev/stdout
  ln     -fns  /proc/self/fd/2  /lib/udev/dev/stderr
  ln     -fns  /proc/kcore      /lib/udev/dev/core
}


install_missing()  {
  case  $VERSION  in
    105)  install  -m 0755  udevstart udevsend  /sbin/  ;;
      *)  install  -m 0755  udevstart           /sbin/  ;;
  esac

  # Default rules script (Gentoo) expects extra binaries in /sbin while udev
  # installation puts them only in /lib/udev - make symlinks to fix this
  for  FILE  in  /lib/udev/*;  do
    if    [   -f   "$FILE"  ]
    then  ln  -fs  "$FILE"  /sbin
    fi
  done
}

adjust_rules()  {
  local  REPLY=/etc/udev/rules.d/50-udev-default.rules
  if    [     -f                                 $REPLY  ]  &&
        grep  -q    'GROUP="kmem"'               $REPLY
  then  sed   -i  's:GROUP="kmem":GROUP="mem":'  $REPLY
  fi
}


  case  $VERSION  in
    105)  EXTRAS="extras/ata_id extras/cdrom_id extras/dasd_id extras/edd_id extras/firmware extras/floppy extras/path_id extras/rule_generator extras/run_directory extras/scsi_id extras/usb_id extras/volume_id"  ;;
    075)  EXTRAS="extras/ata_id extras/cdrom_id extras/dasd_id extras/eed_id extras/firmware extras/floppy extras/run_directory extras/scsi_id extras/usb_id extras/volume_id"  ;;
      *)  EXTRAS="extras/ata_id extras/cdrom_id extras/edd_id extras/firmware extras/floppy extras/path_id extras/rule_generator extras/scsi_id extras/usb_id extras/volume_id"  ;;
  esac

  # sed  -i  "s:/local::
  #           s:^udevdir = .*:udevdir = /dev:
  #           s:killall:true:"  Makefile
  # sed  -i  "s:@udevdir@:/dev:"  etc/udev/udev.conf.in

  make    $OPTS    "EXTRAS=$EXTRAS"  &&
  prepare_install                    &&
  make    install  "EXTRAS=$EXTRAS"  &&
          install_missing            &&
     init_install                    &&
  symlink_install                    &&
   adjust_rules

}

post_install() {
  default_post_install
  pkill  -15  "^udevd$"
  /sbin/udevd --daemon
  true
}

current() {
  case  $VERSION  in
    115)  grep  -q  'udev/dev/'  /etc/init.d/udev  ;;
  esac
}
