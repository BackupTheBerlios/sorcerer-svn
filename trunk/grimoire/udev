    stable 157 154 151 150
   require acl glib gobject-introspection gperf pci.ids sysvinit usbutils
  optional ConsoleKit
  category utility
 attribute console server
    source $KERNEL_URL pub/linux/utils/kernel/hotplug/udev-$VERSION.tar.gz
  homepage http://www.kernel.org/pub/linux/utils/kernel/hotplug/udev.html
   exclude /dev
   exclude /lib/udev/dev/core
  estimate 400
      desc 'daemon for handle coldplug and hotplug events.
When a hardware event happens udev can load modules, load firmware,
and create device nodes in /dev according to what rule files specify.
udev replaces hotplug and pcmcia event handlers
udev should be installed even on boxes that have no hotplug events.'

build(){

# /dev/zero and /dev/mem are needed for uvesafb before udevd starts

nod_sym_install(){
 mkdir -vpm 755                        $DESTDIR/lib/udev/dev/{pts,shm}
 /bin/ln -fns /proc/self/fd            $DESTDIR/lib/udev/dev/fd
 /bin/ln -fns /proc/self/fd/0          $DESTDIR/lib/udev/dev/stdin
 /bin/ln -fns /proc/self/fd/1          $DESTDIR/lib/udev/dev/stdout
 /bin/ln -fns /proc/self/fd/2          $DESTDIR/lib/udev/dev/stderr
 /bin/ln -fns /proc/kcore              $DESTDIR/lib/udev/dev/core
 /bin/ln -fns /proc/asound/oss/sndstat $DESTDIR/lib/udev/dev/sndstat
 rm    -f                              $DESTDIR/lib/udev/dev/{console,mem,null,zero}
 mknod -m 600                          $DESTDIR/lib/udev/dev/console c 5 1
 mknod -m 640                          $DESTDIR/lib/udev/dev/mem     c 1 1
 mknod -m 666                          $DESTDIR/lib/udev/dev/null    c 1 3
 mknod -m 444                          $DESTDIR/lib/udev/dev/zero    c 1 5
 mknod -m 660                          $DESTDIR/lib/udev/dev/kmsg    c 1 11
 true
}

# The extra rules are needed to create frequently needed nodes 
# and symlinks. Also needed to set privileges to nodes like
# /dev/dsp, etc.

 rules_install(){
  mkdir   -vpm 755                      $DESTDIR/lib/udev/rules.d
  install -vm 644 $SCRIPT_DIR/rules.d/* $DESTDIR/lib/udev/rules.d/
 }

 # if   spell_installed libselinux
 # then OPTS+=' --with-selinux'
 # fi

 case $HOSTTYPE in
  x86_64) OPTS+=' --with-libdir-name=lib64' ;;
 esac

 export PKG_CONFIG_PATH=/usr/share/pkgconfig

 case $HOSTTYPE in
  x86_64) LIB=lib64 ;;
       *) LIB=lib ;;
 esac

# --exec-prefix=    \

 ./configure \
  --prefix=/usr \
  --sysconfdir=/etc \
  --sbindir=/sbin \
  --libdir=/usr/$LIB \
  --with-rootlibdir=/$LIB \
  --libexecdir=/lib/udev \
 $OPTS &&
 make &&
 make install DESTDIR=$DESTDIR &&
 nod_sym_install &&
   rules_install
}

post_install(){
if   LC_ALL=C grep -q '^mem:x:'  /etc/group
then sed -i 's/^mem:x:/kmem:x:/' /etc/group
fi
}
