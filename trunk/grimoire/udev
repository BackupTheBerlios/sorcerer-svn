   VERSION=( "090" "085" "084" "079" "075" "074" "073" "072" "071" "070" )
  CATEGORY="utility"
 ATTRIBUTE="console"
    SOURCE="pub/linux/utils/kernel/hotplug/udev-$VERSION.tar.gz"
       REQ="hotplug"
       URL="$KERNEL_URL"
  HOMEPAGE="http://www.kernel.org/pub/linux/utils/kernel/hotplug/udev.html"
   EXCLUDE="/dev"
  ESTIMATE="157"
      DESC="udev provides an auto-populating /dev.

Add custom rules for udev nodes to the file:
/etc/udev/rules.d/1st.rules

Some rules I use for 1st.rules are:
KERNEL=\"adsp\",  NAME=\"sound/%k\",  SYMLINK=\"dsp\",  GROUP=\"audio\"
KERNEL=\"dsp\",	  NAME=\"sound/%k\",  SYMLINK=\"dsp0\", GROUP=\"audio\"
KERNEL=\"psaux\", NAME=\"misc/%k\",   SYMLINK=\"%k mouse\""

build() {
init_install()  {
  sed      -i       "s:/sbin/udev_run:/lib/udev/udev_run:"  \
                    etc/udev/gentoo/udev.rules
  install  -m 0700  $SCRIPT_DIR/init.d/udev        /etc/init.d
  mkdir    -p      /etc/udev/rules.d               /etc/udev/examples
  cp       -a       etc/udev/*                     /etc/udev/examples
  chmod    -R og-w                                 /etc/udev/examples
  ln       -sf   ../examples/gentoo/udev.rules     /etc/udev/rules.d
  mkdir    -p                                      /etc/udev/scripts
  install  -m 0755  extras/*.sh                    /etc/udev/scripts
}


symlink_install()  {
  mkdir  -p  -m 0755            /lib/udev/devices/{pts,shm}
  ln     -fns  /proc/self/fd    /lib/udev/devices/fd
  ln     -fns  /proc/self/fd/0  /lib/udev/devices/stdin
  ln     -fns  /proc/self/fd/1  /lib/udev/devices/stdout
  ln     -fns  /proc/self/fd/2  /lib/udev/devices/stderr
  ln     -fns  /proc/kcore      /lib/udev/devices/core
}


linux_sufficient()  {
  KVER="$(  installed_version  $(  get_provider  linux-kernel  )  )"
  
  if    [  "${KVER:0:3}"  ==  "2.4"  ]
  then  "Linux 2.4 is insufficient for using udev as /dev"
        false
  elif                            [  -f  /usr/src/linux/.config  ]  &&
        !  grep  -q  "CONFIG_HOTPLUG=y"  /usr/src/linux/.config
  then  echo  "Linux must have CONFIG_HOTPLUG enabled when it was built."
        false
  fi
}


install_missing()  {
  install  -m 0755  udevstart udevsend  /sbin/

  # Default rules script (Gentoo) expects extra binaries in /sbin while udev
  # installation puts them only in /lib/udev - make symlinks to fix this
  ln -sf  /lib/udev/ata_id	/sbin
  ln -sf  /lib/udev/cdrom_id	/sbin
  ln -sf  /lib/udev/dasd_id	/sbin
  ln -sf  /lib/udev/path_id	/sbin
  ln -sf  /lib/udev/usb_id	/sbin
  ln -sf  /lib/udev/vol_id	/sbin
}


  case  $VERSION  in
    075)  EXTRAS="extras/ata_id extras/cdrom_id extras/dasd_id extras/eed_id extras/firmware extras/floppy extras/run_directory extras/scsi_id extras/usb_id extras/volume_id"  ;;
      *)  EXTRAS="extras/ata_id extras/cdrom_id extras/dasd_id extras/edd_id extras/firmware extras/floppy extras/path_id extras/run_directory extras/scsi_id extras/usb_id extras/volume_id"  ;;
  esac

  sed  -i  "s:/local::
            s:^udevdir = .*:udevdir = /dev:
            s:killall:true:"  Makefile
  sed  -i  "s:@udevdir@:/dev:"  etc/udev/udev.conf.in

  linux_sufficient                   &&
  make             "EXTRAS=$EXTRAS"  &&
  prepare_install                    &&
  make    install  "EXTRAS=$EXTRAS"  &&
          install_missing            &&
     init_install                    &&
  symlink_install
}

post_install() {
  pkill  -15  "^udevd$"
  /lib/lsb/install_initd /etc/init.d/udev
  /sbin/udevd --daemon
  true
}
