# version 5.8 released on 20110226
# version 5.7 released on 20081103
# version 5.8 causes rtorrent to segfault.
# reason to believe version 5.8 is buggy.

   version stable 5.7 5.6
   version latest 5.8
   require gawk
  category development
 attribute console library makej multilib-dual solo
    source $GNU_URL ncurses/ncurses-$VERSION.tar.gz
  homepage http://www.gnu.org/software/ncurses/ncurses.html
      opts --without-debug
    CFLAGS='-O3'
   LDFLAGS='-Wl,-O1'
   protect /usr/share/terminfo
  estimate 8700
      desc 'displays and updates text on text-only terminals
The ncurses (new curses) library is a free software
emulation of curses in System V Release 4.0 and more.
It uses terminfo format, supports pads and color
and multiple highlights and forms chracters and
function-key mapping, and has all the other
SYSV-curses enhancements over BSD curses.
The distribution includes the library and support
utilities, including a terminfo compiler tic,
a decompiler infocmp, clear, tput, tset,
and a termcap conversion tool captoinfo.'

build(){
# Other sources configure scripts check only for 
# the location of ar libraries.
# Therefore, symbolic links to ELF libraries
# must exist in the same directory as the ar libraries
  move_ar_libs(){
   mv -v        $DESTDIR/$LIBDIR/lib{curses,form,formw,menu,menuw,ncurses++,ncurses++w,ncurses,ncursesw,panel,panelw}.a $DESTDIR/usr$LIBDIR
   for REPLY in $LIBDIR/lib{curses,form,formw,menu,menuw,ncurses,ncursesw,panel,panelw}.so*
   do  ln -fs ../..$LIBDIR/${REPLY##*/} $DESTDIR/usr$LIBDIR
   done
  }

 if    [[ $HOSTTYPE == x86_64 ]] && ! [[ $CFLAGS =~ -m32 ]]
 then  LIBDIR=/lib64
 else  LIBDIR=/lib
 fi

 mkdir -p $DESTDIR/usr/{lib,share/tabset}

# sed -i 's:-L${exec_prefix}/lib::' misc/ncurses-config.in

 ./configure       \
 --prefix=/usr     \
 --libdir=$LIBDIR  \
 --with-normal     \
 --with-shared     \
 --disable-termcap \
 $OPTS &&
 make  &&
 make install DESTDIR=$DESTDIR &&
 make clean &&

 ./configure       \
 --prefix=/usr     \
 --libdir=$LIBDIR  \
 --with-normal     \
 --with-shared     \
 --disable-termcap \
 --enable-widec    \
 $OPTS  &&
 make   &&
 cd c++ &&
 make   &&
 make install DESTDIR=$DESTDIR &&
 cd ..  &&
 make install DESTDIR=$DESTDIR
}
