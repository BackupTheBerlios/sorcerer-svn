# --disable-ffmpeg can be provided when vice becomes too old
# to compile with currently installed ffmpeg
# can have optional on pulseaudio

   version stable 2.3
case $VERSION in
 2.3)
   require giflib-v4
      opts --disable-ffmpeg ;;
esac
   require MesaLib ffmpeg fontconfig font-alias font-cursor-misc font-misc-misc giflib imake jpeg libXrandr libXv libnet libpng xorg-cf-files
#  require audiofile giflib jpeg libXaw libXv lame libpng readline
  optional esound '' --without-esd for audio output through esound
  optional pulseaudio
  category development/emulator game
 attribute x11
    source http://www.zimmers.net/anonftp/pub/cbm/crossplatform/emulators/VICE/vice-$VERSION.tar.gz
      info vurl http://www.viceteam.org/
      info good 20120711
      info last 20110226
      info home http://www.viceteam.org/
      desc 'versatile commdore emulator
vice is a Versatile Commodore Emulator
vice executes programs intended for the old 8-bit computers.
The current version emulates the C64, the C128, the VIC20,
almost all PET models, the PLUS4 and the CBM-II (aka C610).'

build(){
 giflib_fix(){
  if   [[ $HOSTTYPE == x86_64 ]] && ! [[ $CFLAGS =~ -m32 ]]
  then GIFLIBLIBDIR=/opt/giflib/4/usr/lib64
  else GIFLIBLIBDIR=/opt/giflib/4/usr/lib
  fi
  export   CFLAGS+=" -I/opt/giflib/4/usr/include"
  export CXXFLAGS+=" -I/opt/giflib/4/usr/include"
  export  LDFLAGS+=" -L$GIFLIBLIBDIR -Wl,-rpath,$GIFLIBLIBDIR"
  export PKG_CONFIG_PATH="$GIFLIBLIBDIR/pkgconfig:$PKG_CONFIG_PATH"
  echo "LDFLAGS=$LDFLAGS"
  echo "PKG_CONFIG_PATH=$PKG_CONFIG_PATH"
 }

 case $VERSION in
  2.3) giflib_fix ;;
  2.2) sed -i '1i#include <X11/Xproto.h>
               1i#include <X11/extensions/shmproto.h>' src/arch/unix/x11/xaw/x11video.c ;;
 esac
 default_build
}
