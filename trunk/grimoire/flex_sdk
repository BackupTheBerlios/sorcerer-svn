# http://www.adobe.com/support/documentation/en/flex/3/releasenotes_flex3_sdk.html#installation
# Should step 5 be omitted as it is currently not installing
# the debug Flash Playr from install_root/runtimes/player/platform directory

with version stable 3.4.0.9271 3.0.3.2490_mpl
with base    jdk
with role    development/interpreter
with trait   mozilla-plugin x11 x86 hidden
with source  http://flexorg.wip3.adobe.com/flexsdk/${VERSION:0:10}/flex_sdk_$VERSION.zip
with info    home  http://opensource.adobe.com/wiki/display/site/Home
# Requires manual checking since it references no tars nor zips.
#     info vurl "http://opensource.adobe.com/wiki/display/flexsdk/Download+Flex+3"
with info    cite 'software development kit for the actionscript 3 language'

build(){
 fixthen_install(){
  find * -type f | xargs --max-lines=256 chmod 644
  find * -type d | xargs --max-lines=256 chmod 755

  LC_ALL=C find * -type f |
  xargs --max-lines=64 file |
  sed 's/: *POSIX shell script text executable$//p;d' > fixed.txt

  sed -i 's:\r::' $(< fixed.txt )
  chmod 755       $(< fixed.txt )  
  sed 's:^bin/:/opt/flex_sdk/bin/:p;d' fixed.txt |
  while read; do
   echo -e "#!/bin/sh\nexec $REPLY" > /usr/bin/${REPLY##*/}
   echo /usr/bin/${REPLY##*/}
  done |
  xargs --max-lines=64 chmod 755

  mkdir -pvm 755 $DESTDIR/opt/flex_sdk
  cp -av *       $DESTDIR/opt/flex_sdk/
 }

 [[ -f license-mpl.htm ]] &&
 fixthen_install
}
