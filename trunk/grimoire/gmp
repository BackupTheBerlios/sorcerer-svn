# 5.0.1 has an irregularly large so version number change.
# holding off on update until 5.0.2 to see if the change is consistent
# or was some sort of mistake.
# php version 5.2.12 has a compile error with gmp 5.0.1

# case $HOSTTYPE in
#  x86_64)
#    version stable 4.3.0 ;;
#       *)
#    version stable 5.0.0 4.3.1 4.3.0
#     latest 5.0.1 ;;
# esac

# versions 5.0.0 and 5.0.1 appear to be unstable.
# ppl requires gmp < 5.0.0

# will not compile with --enable-nails

   version stable 4.3.2
   require automake libtool
# optional on gcc-g++ creates circuliar requirement loop
# optional gcc-g++
  category mathematics
 attribute library
#attribute makej multilib-dual
    source $GNU_URL gmp/gmp-$VERSION.tar.bz2
      info home http://www.gnu.org/directory/gnump.html
      opts --enable-cxx --enable-mpfr --enable-static=no
#      opts --enable-cxx --enable-mpfr --enable-nails --enable-static=no
      desc 'GNU mathematics precision library
gmp is a library operating on signed integers,
rational numbers, and floating point numbers.
All functions have a standardized interface.
GNUmp is designed to be as fast as possible
by using fullwords as the basic arithmetic type,
by using fast algorithms, by carefully optimizing
assembly code for the most common inner loops for
many CPUs, and by a general emphasis on speed
(as opposed to simplicity or elegance).
GNUmp speed advantage increases with the operand size,
since GNUmp in many cases has asymptomatically faster algorithms.'

build(){
(
 # gmp's 64-bit and 32-bit headers differ
 preserve_ia32_headers(){
   if [[ $HOSTTYPE == x86_64 ]] &&
      echo "$CFLAGS $CXXFLAGS" | grep -q "\-m32"; then
   mkdir -vpm 755 $DESTDIR/usr/include32/
   mv $DESTDIR/usr/include/gmp.h   $DESTDIR/usr/include32/
   mv $DESTDIR/usr/include/gmpxx.h $DESTDIR/usr/include32/
  fi
}

# configure: error: ABI=64 is not among the following valid choices: 32
#   x86_64) export ABI=64 ;;
 case $HOSTTYPE in
  i[5-6]86) export ABI=32 ;;
 esac

 if   [[ $HOSTTYPE == x86_64 ]] &&
      echo "$CFLAGS $CXXFLAGS" | grep -q "\-m32"
 then export ABI=32
 fi

# CPPFLAGS=-fexceptions is required by
# ppl to create a gmp that can do bounded memory capabilities
# offered by ppl

 # to rid the rpath
 aclocal; automake -acf; libtoolize -cf; autoreconf -fi
 sed -i 's:hardcode_into_libs=yes:hardcode_into_libs=no:' configure

 CPPFLAGS=-fexceptions \
 ./configure           \
  --sysconfdir=/etc    \
  --localstatedir=/var \
  --prefix=/usr        \
  --build=$MACHTYPE    \
 $OPTS &&
 make  &&
 make install DESTDIR=$DESTDIR &&
 preserve_ia32_headers
)
}
