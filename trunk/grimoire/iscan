    stable 2.10.0-1 2.8.0-1.c2 2.6.0-0.c2 2.1.0-1.c2
   require libusb-compat sane-backends libpng udev
  optional gimp '' '' to register iscan as gimp plugin
  category graphic/scan
 attribute library x11 x86
    source http://lx1.avasys.jp/iscan/${VERSION:0:6}/iscan_$VERSION.tar.gz
    source http://lx1.avasys.jp/iscan/v1180/iscan-plugin-gt-x750-1.0.0-1.c2.i386.rpm
  homepage http://www.avasys.jp/english/linux_e
      opts --with-pic

# drivers are for IA32 only
case $HOSTTYPE in
 x86_64) attribute broke ;;
esac
  estimate 2800
      desc 'iscan is an EPSON software for their scanners
iscan is also referred to as epkowa backend by the sane project.
iscan (Image Scan! for Linux) contains the following parts:
  iscan                 the program you use to scan your images
  libsane-epkowa        an improved driver for EPSON scanners
  libesmod              a proprietary module used by iscan'

build(){

 install_gimp_plugin(){
  if   [  -x /usr/bin/iscan -a -x /usr/bin/gimptool-2.0 ]
  then ln -s /usr/bin/iscan $(gimptool-2.0 --gimpplugindir)/plug-ins/
  else true
  fi
 }

 install_sane_conf(){
  install -vm 644 backend/epkowa.conf /etc/sane.d/
 }

 install_binaries() {
  mkdir   -pvm 755  /usr/lib/iscan     /usr/share/iscan
  cp      -av        usr/lib/iscan/*   /usr/lib/iscan/
  install  -vm 644   usr/share/iscan/* /usr/share/iscan/
 }

 install_extra_docs(){ mv usr/share/doc/* doc/; }

 case $VERSION in
  2.10.0-1)  patch -p0 < $SCRIPT_DIR/fixes-for-GCC43.patch  ;;
 esac

 default_build       &&
 install_binaries    &&
 install_sane_conf   &&
 install_gimp_plugin &&
 install_extra_docs
}
