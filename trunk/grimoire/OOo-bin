case $HOSTTYPE in
 x86_64)
    stable 3.2.0_LinuxX86-64_install_en-US  3.1.1_LinuxX86-64_install_en-US ;;
      *)
    stable 3.2.0_LinuxIntel_install_en-US  3.1.1_LinuxIntel_install_en-US ;;
esac
   require desktop-file-utils gnome-vfs jdk unzip zip
  optional kdelibs-v3 '' '' for optional kde support
  optional libsndfile '' '' for optional libsndfile support
  category utility/office utility/editor
 attribute archive_off x86 noheal x11 kde3
    source http://mirrors.ibiblio.org/pub/mirrors/openoffice/stable/${VERSION:0:5}/OOo_$VERSION.tar.gz
      vurl http://download.openoffice.org/
  homepage http://www.openoffice.org
  estimate 70
      desc 'pre-compiled Open Source Office Suite
OOo-bin (OpenOffice.org) provides an open source
office suite that runs on all major platforms and
provides access to all functionality and data through
open-component based APIs and an XML-based file format.
It can open M$ Office Documents.'

build(){

 install_rpms(){
  mkdir install
  cd    install
  find $BUILD_DIR/RPMS{,/desktop-integration/*freedesktop-menus*} -maxdepth 1 -name \*.rpm |
  while  read;  do
   echo "---> Unpacking $REPLY"
   rpmunpack < $REPLY  |  gzip -d  |  cpio -idm --no-absolute-filenames
  done

  mkdir -p etc
  ln -sf /opt/openoffice.org etc/openoffice.org

  case $VERSION in
   2.2.1_LinuxIntel_install_en-US) \
    AGAIN=$BUILD_DIR/RPMS/openoffice.org-core04u-2.2.1-9161.i586.rpm
    echo "---> Unpacking $AGAIN"
    # rpmunpack misdetects gzip magic signature on 1st attempt.
    # It can not be directly piped to rpmunpack, unknown why.
    ( dd if=$AGAIN bs=1 count=4; rpmunpack < $AGAIN ) > $AGAIN.rpm
    rpmunpack < $AGAIN.rpm  | gzip -d | cpio -idm --no-absolute-filenames ;;

   2.2.0_LinuxIntel_install_en-US)  \
    AGAIN=$BUILD_DIR/RPMS/desktop-integration/openoffice.org-freedesktop-menus-2.2-9119.noarch.rpm
    echo "---> Unpacking $AGAIN"
    # rpmunpack misdetects gzip magic signature on 1st attempt.
    # It can not be directly piped to rpmunpack, unknown why.
    ( dd if=$AGAIN bs=1 count=4; rpmunpack < $AGAIN ) > $AGAIN.rpm
    rpmunpack < $AGAIN.rpm  | gzip -d | cpio -idm --no-absolute-filenames ;;

   2.1.0_LinuxIntel_install_en-US)  \
    AGAIN=$BUILD_DIR/RPMS/openoffice.org-core05u-2.1.0-6.i586.rpm
    echo "---> Unpacking $AGAIN"
    # rpmunpack misdetects gzip magic signature on 1st attempt.
    # It can not be directly piped to rpmunpack, unknown why.
    ( dd if=$AGAIN bs=1 count=4; rpmunpack < $AGAIN ) > $AGAIN.rpm
    rpmunpack < $AGAIN.rpm  | gzip -d | cpio -idm --no-absolute-filenames ;;
  esac

  chown -R root:root * 
  find               * -type f | xargs --max-lines=64 chmod o-w
  find               * -type d | xargs --max-lines=64 chmod 755
  cp -av * /
 }

 add_mailcap(){
  sed "s:^:application/:
       s:$:; openoffice.org -view %s:" $SCRIPT_DIR/mailcap |
  sort -u > /etc/mailcap.OOo-bin
 }

 [[ -d RPMS ]]   &&
 prepare_install &&
 install_rpms    &&
 add_mailcap
}


post_install(){
 default_post_install
 gtk-update-icon-cache -fqt /usr/share/icons/{gnome,hicolor,locolor}
 update-mime-database       /usr/share/mime
 sed "s/:\*\./ /"           /usr/share/mime/globs > /etc/mime.types
 update-desktop-database -q /usr/share/applications
 cat /etc/mailcap.* >       /etc/mailcap
}

pre_remove(){
 if   [[  -f /etc/mailcap ]]
 then sed -i /openoffice.org/d /etc/mailcap
 fi
 default_pre_remove
}

post_remove(){
 update-mime-database        /usr/share/mime
 sed 's/:\*\./ /'            /usr/share/mime/globs > /etc/mime.types
 update-desktop-database  -q /usr/share/applications
 gtk-update-icon-cache  -fqt /usr/share/icons/{gnome,hicolor,locolor}
 # update-menus
 default_post_remove
}
