   VERSION=( "2.3.0_LinuxIntel_install_en-US" "2.2.1_LinuxIntel_install_en-US" "2.2.0_LinuxIntel_install_en-US" )
      SAFE=( "2.3.0_LinuxIntel_install_en-US" )
    IGNORE="wJRE\|system\|sdk"
  CATEGORY="utility/office utility/editor"
 ATTRIBUTE="archive_off x86 noheal x11"
    SOURCE="${VERSION:0:5}/OOo_$VERSION.tar.gz"
       URL="http://mirrors.ibiblio.org/pub/mirrors/openoffice/stable/"
      VURL="http://download.openoffice.org/"
  HOMEPAGE="http://www.openoffice.org"
       REQ=( "desktop-file-utils gnome-vfs jdk unzip zip"
             "kdelibs:::for optional kde support"
             "libsndfile:::for optional libsndfile support" )
  ESTIMATE="70"
      DESC="OOo-bin provides pre-compiled Open Source Office Suite.
OOo-bin (OpenOffice.org) provides an open source
office suite that runs on all major platforms and
provides access to all functionality and data through
open-component based APIs and an XML-based file format.
It can open M$ Office Documents."

build() {

  install_rpms()  {
    cd  /
    find  $BUILD_DIR/RPMS{,/desktop-integration/*freedesktop-menus*}  \
          -maxdepth 1 -name \*.rpm |
    while  read;  do
      echo "---> Unpacking $REPLY"
      rpmunpack < $REPLY  |  gzip -d  |  cpio -idm 
    done
    ln  -sf  /opt/openoffice.org${VERSION:0:3}  \
             /etc/openoffice.org${VERSION:0:3}

    case  $VERSION  in
      2.2.1_LinuxIntel_install_en-US)  \
        AGAIN=$BUILD_DIR/RPMS/openoffice.org-core04u-2.2.1-9161.i586.rpm
        echo "---> Unpacking $AGAIN"
        # rpmunpack misdetects gzip magic signature on 1st attempt.
        # It can not be directly piped to rpmunpack, unknown why.
        ( dd if=$AGAIN bs=1 count=4; rpmunpack < $AGAIN ) > $AGAIN.rpm
        rpmunpack < $AGAIN.rpm  | gzip -d | cpio -idm  ;;

      2.2.0_LinuxIntel_install_en-US)  \
        AGAIN=$BUILD_DIR/RPMS/desktop-integration/openoffice.org-freedesktop-menus-2.2-9119.noarch.rpm
        echo "---> Unpacking $AGAIN"
        # rpmunpack misdetects gzip magic signature on 1st attempt.
        # It can not be directly piped to rpmunpack, unknown why.
        ( dd if=$AGAIN bs=1 count=4; rpmunpack < $AGAIN ) > $AGAIN.rpm
        rpmunpack < $AGAIN.rpm  | gzip -d | cpio -idm  ;;

      2.1.0_LinuxIntel_install_en-US)  \
        AGAIN=$BUILD_DIR/RPMS/openoffice.org-core05u-2.1.0-6.i586.rpm
        echo "---> Unpacking $AGAIN"
        # rpmunpack misdetects gzip magic signature on 1st attempt.
        # It can not be directly piped to rpmunpack, unknown why.
        ( dd if=$AGAIN bs=1 count=4; rpmunpack < $AGAIN ) > $AGAIN.rpm
        rpmunpack < $AGAIN.rpm  | gzip -d | cpio -idm  ;;
    esac
    cd  - 

    chown  -R  root:root  /opt/openoffice.org${VERSION:0:3}
    find                  /opt/openoffice.org${VERSION:0:3}  -type f  |  xargs  -l64  chmod o-w
    find                  /opt/openoffice.org${VERSION:0:3}  -type d  |  xargs  -l64  chmod 0755
  }

  add_mailcap()  {
    sed  "s:^:application/:
          s:$:; openoffice.org${VERSION:0:3} -view %s:"  \
         $SCRIPT_DIR/mailcap  |
    sort  -u       >  /etc/mailcap.OOo-bin
  }

  [  -d  RPMS  ]   &&
  prepare_install  &&
  install_rpms     &&
  add_mailcap
}


post_install()  {
  default_post_install
  gtk-update-icon-cache  -fqt  /usr/share/icons/{gnome,hicolor,locolor}
  update-mime-database         /usr/share/mime
  sed  "s/:\*\./ /"            /usr/share/mime/globs  >  /etc/mime.types
  update-desktop-database  -q  /usr/share/applications
  cat  /etc/mailcap.*  >       /etc/mailcap
}

pre_remove() {
  if    [    -f  /etc/mailcap ]
  then  sed  -i  "/openoffice.org/d" /etc/mailcap
  fi
  default_pre_remove
}

post_remove()  {
  update-mime-database         /usr/share/mime
  sed  "s/:\*\./ /"            /usr/share/mime/globs  >  /etc/mime.types
  update-desktop-database  -q  /usr/share/applications
  gtk-update-icon-cache  -fqt  /usr/share/icons/{gnome,hicolor,locolor}
  # update-menus
  default_post_remove
}

current()  {
  case  $VERSION  in
    2.1.0_LinuxIntel_install_en-US)  grep  -qx  "107177 blocks"  $COMPILE_LOGS/OOo-bin  ;;
  esac
}
