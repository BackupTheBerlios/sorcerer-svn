# gjs version 0.7.14 can not digest xulrunner 2.0

   version stable 1.9.2.17 2.0 1.9.2.10 1.9.2.9 1.9.2.8
# Using internal mng
   require GConf jdk libIDL libnotify nss sqlite startup-notification zip
#  require GConf-dbus jdk libIDL libnotify nss sqlite startup-notification zip
  optional gnome-vfs '' --disable-gnomevfs for gnomevfs support
  optional libgnomeui '' --disable-gnomeui  for libgnomeui support
#   switch --enable-glitz --disable-glitz 'enable glitz for use with cairo'
  category network/web
 attribute client library makej multilib-dual solo x11
    source http://releases.mozilla.org/pub/mozilla.org/xulrunner/releases/$VERSION/source/xulrunner-$VERSION.source.tar.bz2
      info last  20110320
  homepage http://developer.mozilla.org/en/XULRunner
      vurl http://developer.mozilla.org/en/XULRunner
      opts --with-system-jpeg
      opts --with-system-zlib
      opts --with-system-bz2
      opts --enable-startup-notification
      opts --disable-static
      opts --enable-system-cairo
      opts --enable-system-lcms
      opts --enable-application=xulrunner
      opts --enable-libxul
      opts --with-java-include-path=/opt/jdk/include
      opts --with-java-bin-path=/opt/jdk/bin
      opts --with-system-nspr
      opts --with-system-nss
      opts --enable-strip
      opts --enable-default-toolkit=cairo-gtk2
      opts --disable-mochitest
      opts --disable-tests
#     opts --enable-system-sqlite
# xulrunner version 1.9.2.9 requires ancient version of sqlite
# checking for sqlite3 >= 3.6.22... yes
# checking SQLITE_CFLAGS...  
# checking SQLITE_LIBS... -lsqlite3  
# checking for SQLITE_SECURE_DELETE support in system sqlite... no
# configure: error: System Sqlite library is not compiled with SQLITE_SECURE_DELETE


## --with-system-png requires png with apng support and currently the patch does not apply
#     opts --with-system-png


           #--enable-cpp-rtti
#            'jdk:::for building the javaXPCOM components' )
# compilation with javaXPCOM component support is not working
      desc 'HTML rendering and javascript library'

build(){
 add_symlinks(){
  # symbolic links to libmozjs.so help gnome-shell to compile

  if   [[ -d                            $DESTDIR/usr/lib/xulrunner-$VERSION ]]; then
   ln -s xulrunner-$VERSION             $DESTDIR/usr/lib/xulrunner
   ln -s xulrunner-$VERSION/libmozjs.so $DESTDIR/usr/lib/libmozjs.so
  fi

  if   [[ -d                            $DESTDIR/usr/lib64/xulrunner-$VERSION ]]; then
   ln -s xulrunner-$VERSION             $DESTDIR/usr/lib64/xulrunner
   ln -s xulrunner-$VERSION/libmozjs.so $DESTDIR/usr/lib64/libmozjs.so
  fi

  ln -s xulrunner-$VERSION $DESTDIR/usr/include/xulrunner
 }

 export LDFLAGS+=" -Wl,-rpath,/usr/lib/xulrunner-$VERSION"

 if    [[ $HOSTTYPE == x86_64 ]] && [[ $CFLAGS =~ -m32 ]]
 then opts --host="${MACHTYPE/x86_64/i686}" --disable-crashreporter
 fi

 ./configure \
 --prefix=/usr \
 --sysconfdir=/etc \
 --localstatedir=/var \
 --enable-optimize="$CFLAGS" \
 $OPTS &&
 make &&
 make install DESTDIR=$DESTDIR &&
 add_symlinks
}
