   version stable 8.0b6 3.6.23 1.9.2.17 2.0 1.9.2.10 1.9.2.9 1.9.2.8
# Using internal mng
   require GConf imake jdk libXScrnSaver libIDL libnotify nss pygobject sqlite startup-notification xorg-cf-files yasm zip
  optional gnome-vfs '' --disable-gnomevfs for gnomevfs support
#   switch --enable-glitz --disable-glitz 'enable glitz for use with cairo'
  category network/web
 attribute client library makej multilib-dual solo x11
    source http://releases.mozilla.org/pub/mozilla.org/xulrunner/releases/$VERSION/source/xulrunner-$VERSION.source.tar.bz2
      info last 20111103
      info home http://developer.mozilla.org/en/XULRunner
      vurl http://developer.mozilla.org/en/XULRunner
      opts --with-system-jpeg
      opts --with-system-zlib
      opts --with-system-bz2
      opts --enable-startup-notification
      opts --disable-static
      opts --enable-system-cairo
      opts --enable-system-lcms
      opts --enable-application=xulrunner
      opts --enable-libxul
      opts --with-java-include-path=/opt/jdk/include
      opts --with-java-bin-path=/opt/jdk/bin
#     opts --with-system-nspr
#     opts --with-system-nss
      opts --enable-strip
      opts --enable-default-toolkit=cairo-gtk2
      opts --disable-mochitest
      opts --disable-tests
#     opts --enable-system-sqlite
# xulrunner version 1.9.2.9 requires ancient version of sqlite
# checking for sqlite3 >= 3.6.22... yes
# checking SQLITE_CFLAGS...  
# checking SQLITE_LIBS... -lsqlite3  
# checking for SQLITE_SECURE_DELETE support in system sqlite... no
# configure: error: System Sqlite library is not compiled with SQLITE_SECURE_DELETE


## --with-system-png requires png with apng support and currently the patch does not apply
#     opts --with-system-png


           #--enable-cpp-rtti
#            'jdk:::for building the javaXPCOM components' )
# compilation with javaXPCOM component support is not working
      desc 'HTML rendering and javascript library'

build(){
 add_symlinks(){
  # symbolic links to libmozjs.so help gnome-shell to compile

  if   [[ -d                            $DESTDIR/usr/lib/xulrunner-$VERSION ]]; then
   ln -s xulrunner-$VERSION             $DESTDIR/usr/lib/xulrunner
   ln -s xulrunner-$VERSION/libmozjs.so $DESTDIR/usr/lib/libmozjs.so
  fi

  if   [[ -d                            $DESTDIR/usr/lib64/xulrunner-$VERSION ]]; then
   ln -s xulrunner-$VERSION             $DESTDIR/usr/lib64/xulrunner
   ln -s xulrunner-$VERSION/libmozjs.so $DESTDIR/usr/lib64/libmozjs.so
  fi

  ln -s xulrunner-$VERSION $DESTDIR/usr/include/xulrunner
 }

 export LDFLAGS+=" -Wl,-rpath,/usr/lib/xulrunner-$VERSION"

 if    [[ $HOSTTYPE == x86_64 ]] && [[ $CFLAGS =~ -m32 ]]
 then opts --host="${MACHTYPE/x86_64/i686}" --disable-crashreporter
 fi

 case $VERSION in
      8.0*) grep -rl "curl/types\.h" * |
            xargs -r --max-lines=256 sed -i '\,curl/types\.h,d'
            cp security/coreconf/Linux{2.6,3.1}.mk
            cp security/coreconf/Linux{2.6,3.0}.mk ;;
     7.0.1) grep -rl "curl/types\.h" * |
            xargs -r --max-lines=256 sed -i '\,curl/types\.h,d'
            cp security/coreconf/Linux{2.6,3.1}.mk
            cp security/coreconf/Linux{2.6,3.0}.mk ;;
       7.0) grep -rl "curl/types\.h" * |
            xargs -r --max-lines=256 sed -i '\,curl/types\.h,d'
            cp security/coreconf/Linux{2.6,3.1}.mk
            cp security/coreconf/Linux{2.6,3.0}.mk ;;
     6.0.2) grep -rl "curl/types\.h" * |
            xargs -r --max-lines=256 sed -i '\,curl/types\.h,d'
            cp security/coreconf/Linux{2.6,3.1}.mk
            cp security/coreconf/Linux{2.6,3.0}.mk ;;
    3.6.23) grep -rl "curl/types\.h" * |
            xargs -r --max-lines=256 sed -i '\,curl/types\.h,d'
            cp security/coreconf/Linux{2.6,3.1}.mk
            cp security/coreconf/Linux{2.6,3.0}.mk ;;
    3.6.21) grep -rl "curl/types\.h" * |
            xargs -r --max-lines=256 sed -i '\,curl/types\.h,d'
            cp security/coreconf/Linux{2.6,3.1}.mk
            cp security/coreconf/Linux{2.6,3.0}.mk ;;
  1.9.1.19) grep -rl "curl/types\.h" * |
            xargs -r --max-lines=256 sed -i '\,curl/types\.h,d'
            cp security/coreconf/Linux{2.6,3.1}.mk
            cp security/coreconf/Linux{2.6,3.0}.mk
            opts --disable-crashreporter ;;
 esac

 export   CFLAGS="${CFLAGS//-flto/}"
 export CXXFLAGS="${CXXFLAGS//-flto/}"
 export  LDFLAGS="$( echo "$LDFLAGS" | sed "s:-flto=[^ ]::" )"

 ./configure \
 --prefix=/usr \
 --sysconfdir=/etc \
 --localstatedir=/var \
 --enable-optimize="$CFLAGS" \
 $OPTS &&
 make &&
 make install DESTDIR=$DESTDIR &&
 add_symlinks
}
