#!/bin/bash

### BEGIN INIT INFO
# Provides: btsco
# Required-Start: bluetooth run
# Should-Start: 
# Required-Stop: bluetooth 
# Should-Stop: 
# Default-Start:  2 3 4 5
# Default-Stop: 0 1 6
# Short-Description: btsco sends stereo audio to bluetooth headsets
# Description: btsco sends stereo audio to bluetooth headsets
### END INIT INFO

# This init script may be incorrect.
# btsco might not write a PID file.
# btsco never starts since I do not own the hardware.
# Consequently, I am unable to test and fix this init script.
# Please email fixes if you use it.


. /lib/lsb/init-functions

PIDF="/var/run/btsco.pid"
SERV="/usr/bin/btsco"
OPTS="-r -f"
NAME="btsco"

status()  {
  PIDS="$( pidofproc -p $PIDF $SERV )"
  if   [ -n "$PIDS" ]; then log_warning_msg "$NAME is running ($PIDS)"; return 0
  elif [ -f "$PIDF" ]; then log_warning_msg "$NAME is dead and $PIDF exists"; return 1
                       else log_warning_msg "$NAME is not running"; return 3
  fi
}

start()  {
  if   log_warning_msg "$NAME starting"; start_daemon -p $PIDF $SERV $OPTS
  then log_success_msg "$NAME started"
  else log_failure_msg "$NAME not started"; status
  fi
}

stop()  {
  if   log_warning_msg "$NAME stopping"; killproc -p $PIDF -s 15 $SERV
  then log_success_msg "$NAME stopped"
  else log_failure_msg "$NAME not stopped"; status
  fi
}

    restart() { stop   && sleep 1; start; }
try_restart() { status && restart; }
help()        { echo "Usage: $0 {restart|try-restart|start|status|stop}" 1>&2; }

case  $1  in
       restart)      restart  ;;
   try-restart)  try_restart  ;;
         start)  start        ;;
        status)  status       ;;
          stop)  stop         ;;
             *)  help         ;;
esac
