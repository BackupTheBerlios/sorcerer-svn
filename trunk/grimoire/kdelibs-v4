# polkit-qt-1 is actually optional and currently not compiling

# recursive requirement with kde-runtime according to domain log?

   inherit kde-v4
   require alsa-lib attica automoc4 avahi-qt-x11-opensource bzip2 docbook-xml-4.2 docbook-xsl e2fsprogs giflib grantlee heimdal jasper libXpm libXScrnSaver libXtst libdbusmenu-qt lua media-player-info openexr pcre phonon phonon-backend qca shared-mime-info shared-desktop-ontologies soprano strigi udev udisks upower xz
#  require alsa-lib attica automoc4 avahi-qt-x11-opensource bzip2 docbook-xml-4.2 docbook-xsl e2fsprogs giflib grantlee heimdal jasper libXpm libXScrnSaver libXtst libdbusmenu-qt lua media-player-info openexr pcre phonon phonon-backend polkit-qt-1 qca shared-mime-info shared-desktop-ontologies soprano strigi udev udisks upower xz
# herqq is an odd source probably not intended for compilatio non POSIX
# therefore kdelibs-v4 must do without it.
  optional aspell  '' '' for spell checking 
  optional enchant '' '' for spell checking
  optional openssl '' '' for secure socket layer support
  category development
 attribute library makej multilib-concurrent
      desc 'Base applications that form the core of KDE
kdelibs contains the base applications that form the core of
the K Desktop Environment like the window manager, the terminal
emulator, the control center, the file manager, and the panel.'

case $VERSION in
 4.9.0)
   require giflib-v4 ;;
 4.8.4)
   require giflib-v4 ;;
esac

build(){
 giflib_fix(){
  if   [[ $HOSTTYPE == x86_64 ]] && ! [[ $CFLAGS =~ -m32 ]]
  then GIFLIBLIBDIR=/opt/giflib/4/usr/lib64
  else GIFLIBLIBDIR=/opt/giflib/4/usr/lib
  fi
  export   CFLAGS+=" -I/opt/giflib/4/usr/include"
  export CXXFLAGS+=" -I/opt/giflib/4/usr/include"
  export  LDFLAGS+=" -L$GIFLIBLIBDIR -Wl,-rpath,$GIFLIBLIBDIR"
  export PKG_CONFIG_PATH="$GIFLIBLIBDIR/pkgconfig:$PKG_CONFIG_PATH"
  echo "LDFLAGS=$LDFLAGS"
  echo "PKG_CONFIG_PATH=$PKG_CONFIG_PATH"
 }

 case $VERSION in
  4.9.0) giflib_fix ;;
  4.8.4) giflib_fix ;;
 esac

 sed -i 's:-Werror=return-type::'                   cmake/modules/FindKDE4Internal.cmake
 sed -i 's:-Werror-implicit-function-declaration::' cmake/modules/FindKDE4Internal.cmake kjsembed/qtonly/FindQJSInternal.cmake
 kde_build
}
