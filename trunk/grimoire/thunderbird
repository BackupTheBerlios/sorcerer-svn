   VERSION=( "2.0.0.0" "1.5.0.10" "1.5.0.9" "1.5.0.8" "1.5.0.7" "1.5.0.5" "1.5.0.4" "1.5.0.2" "1.5" )
      SAFE=( "2.0.0.0" "1.5.0.10" "1.5.0.9" "1.5.0.8" "1.5.0.7" )
  CATEGORY="network/email"
 ATTRIBUTE="client solo x11"
# 1.5.0.9 fails compilation
    SOURCE="thunderbird-${VERSION}-source.tar.bz2"
      VURL="http://www.mozilla.com/en-US/thunderbird/"
       URL="ftp://ftp.mozilla.org/pub/mozilla.org/thunderbird/releases/$VERSION/source/"
  HOMEPAGE="http://www.mozilla.org/products/thunderbird/"
       REQ=( "gss gtk+ heimdal jpeg libIDL libpng libmng perl zip zlib"
             "libgnome:::may use libgnome if you have it installed" )
  ESTIMATE="36040"
      DESC="thunderbird is a new UI to gecko the mozilla mail client engine."

build() {
check_space()  {
  KILOBYTES=$(
    df    -Pkm  $SOURCE_DIR  |
    tr    -s ' '             |
    tail  -n 1               |
    cut   -d ' '  -f4
  )
  if    ((  KILOBYTES < 1152  ));  then
    echo  "Insufficient disk space available for compiling mozilla."
    false
  fi
}


export    CFLAGS="${CFLAGS/-ffast-math/}"
export  CXXFLAGS="${CXXFLAGS/-ffast-math/}"
export    CFLAGS="${CFLAGS/-fomit-frame-pointer/}"
export  CXXFLAGS="${CXXFLAGS/-fomit-frame-pointer/}"
export   LDFLAGS=""

export MOZILLA_OFFICIAL=1
export BUILD_OFFICIAL=1
export MOZ_THUNDERBIRD=1

cat  <<  EOF  >  .mozconfig
. ./mail/config/mozconfig
#mk_add_options MOZ_CO_PROJECT=mail

#ac_add_options --with-pthreads
#ac_add_options --enable-default-toolkit=gtk2
#ac_add_options --enable-application=mail
#ac_add_options --disable-native-uconv
#ac_add_options --enable-elf-dynstr-gc
ac_add_options --prefix=/opt/thunderbird
#ac_add_options --with-default-mozilla-five-home=/opt/thunderbird
#ac_add_options --enable-shared
#ac_add_options --disable-static
#ac_add_options --with-system-jpeg
#ac_add_options --with-system-zlib
#ac_add_options --with-system-png
#ac_add_options --with-system-mng
#ac_add_options --enable-crypto
#ac_add_options --disable-tests
#ac_add_options --disable-debug
#ac_add_options --enable-optimize="$CFLAGS"
#ac_add_options --enable-xft
#ac_add_options --disable-freetype2
#ac_add_options --disable-profilesharing
#ac_add_options --enable-single-profile
#ac_add_options --disable-logging
#ac_add_options --disable-debug
#ac_add_options --enable-extensions="cookie,xml-rpc,xmlextras,pref,transformiix,universalchardet,webservices,inspector,p3p"
EOF

  export  LDFLAGS="-Wl,-rpath,/opt/thunderbird/lib/thunderbird-$VERSION  $LDFLAGS"
  grep   -rl             "\-Wl,-soname" * |
  xargs  -l64  sed  -i  "s:-Wl,-soname:-Wl,-rpath,/opt/thunderbird/lib/thunderbird-$VERSION -Wl,-soname:"


check_space                    &&
./configure  $OPTS             &&
make                           &&
prepare_install                &&
make                  install  &&
ln     -s   /opt/thunderbird/bin/thunderbird /usr/bin/thunderbird  &&
rm     -rf  /opt/thunderbird/lib/thunderbird-$VERSION/install
}
