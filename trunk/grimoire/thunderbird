  stable 2.0.0.14 2.0.0.12 2.0.0.9
  secure 2.0.0.14 2.0.0.12 2.0.0.9
  CATEGORY='network/email'
 ATTRIBUTE='client solo x11'
    SOURCE="$VERSION/source/thunderbird-${VERSION}-source.tar.bz2"
      VURL='http://www.mozilla.com/en-US/thunderbird/'
       URL='ftp://ftp.mozilla.org/pub/mozilla.org/thunderbird/releases/'
  HOMEPAGE='http://www.mozilla.org/products/thunderbird/'
       REQ=( 'gss gtk+ heimdal libIDL libmng zip'
             'libgnomeui:::may use libgnome if you have it installed' )
  ESTIMATE='80000'
      DESC='thunderbird is a new UI to gecko the mozilla mail client engine.'

build(){
 check_space(){
  KILOBYTES=$(
    df   -Pkm $SOURCE_DIR |
    tr   -s ' '           |
    tail -n 1             |
    cut  -d ' ' -f4
  )
  if (( KILOBYTES < 768 )); then
   echo 'Insufficient disk space available for compiling mozilla.'
   false
  fi
 }


 export   CFLAGS="${CFLAGS/-ffast-math/}"
 export CXXFLAGS="${CXXFLAGS/-ffast-math/}"
 export   CFLAGS="${CFLAGS/-fomit-frame-pointer/}"
 export CXXFLAGS="${CXXFLAGS/-fomit-frame-pointer/}"
 export  LDFLAGS=""

 export MOZILLA_OFFICIAL=1
 export BUILD_OFFICIAL=1
 export MOZ_THUNDERBIRD=1

cat << EOF > .mozconfig
. ./mail/config/mozconfig
#mk_add_options MOZ_CO_PROJECT=mail

#ac_add_options --with-pthreads
#ac_add_options --enable-default-toolkit=gtk2
#ac_add_options --enable-application=mail
#ac_add_options --disable-native-uconv
#ac_add_options --enable-elf-dynstr-gc
ac_add_options --prefix=/opt/thunderbird
#ac_add_options --with-default-mozilla-five-home=/opt/thunderbird
#ac_add_options --enable-shared
#ac_add_options --disable-static
#ac_add_options --with-system-jpeg
#ac_add_options --with-system-zlib
#ac_add_options --with-system-png
#ac_add_options --with-system-mng
#ac_add_options --enable-crypto
#ac_add_options --disable-tests
#ac_add_options --disable-debug
#ac_add_options --enable-optimize="$CFLAGS"
#ac_add_options --enable-xft
#ac_add_options --disable-freetype2
#ac_add_options --disable-profilesharing
#ac_add_options --enable-single-profile
#ac_add_options --disable-logging
#ac_add_options --disable-debug
#ac_add_options --enable-extensions="cookie,xml-rpc,xmlextras,pref,transformiix,universalchardet,webservices,inspector,p3p"
EOF

  export LDFLAGS+=" -Wl,-rpath,/opt/thunderbird/lib/thunderbird-$VERSION"
  grep   -rl             "\-Wl,-soname" * |
  xargs  --max-lines=64 sed -i "s:-Wl,-soname:-Wl,-rpath,/opt/thunderbird/lib/thunderbird-$VERSION -Wl,-soname:"


 case $VERSION in
  2.0.0.14) mkdir -p include/pango-1.0/pango
           cp  /usr/include/pango-1.0/pango/pangocairo.h \
                    include/pango-1.0/pango/
           sed -i "/cairo_font_type_t/d"  include/pango-1.0/pango/pangocairo.h
           export   CFLAGS+=" -I$BUILD_DIR/include/pango-1.0"
           export CXXFLAGS+=" -I$BUILD_DIR/include/pango-1.0" ;;
 esac

 check_space       &&
 ./configure $OPTS &&
 make              &&
 prepare_install   &&
 make    install   &&
 ln -s  /opt/thunderbird/bin/thunderbird /usr/bin/thunderbird &&
 rm -rf /opt/thunderbird/lib/thunderbird-$VERSION/install
}
