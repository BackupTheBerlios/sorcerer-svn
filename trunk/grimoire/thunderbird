    stable 3.0.4 3.0.1 3.0.2 2.0.0.18
#  require gss gtk+ heimdal libmng zip
# optional libgnomeui '' '' may use libgnome if you have it installed
      opts --enable-application=mail
      opts --enable-static --disable-libxul
  category network/email
 attribute client solo x11
    source ftp://ftp.mozilla.org/pub/mozilla.org/thunderbird/releases/$VERSION/source/thunderbird-${VERSION}.source.tar.bz2
      vurl http://www.mozilla.com/en-US/thunderbird/
  homepage http://www.mozilla.org/products/thunderbird/
  estimate 80000
      desc 'new UI to gecko the mozilla mail client engine'

build_old(){
 check_space(){
  KILOBYTES=$(
    df   -Pkm $SOURCE_DIR |
    tr   -s ' '           |
    tail -n 1             |
    cut  -d ' ' -f4
  )
  if (( KILOBYTES < 768 )); then
   echo 'Insufficient disk space available for compiling thunderbird.'
   false
  fi
 }


 export   CFLAGS="${CFLAGS/-ffast-math/}"
 export CXXFLAGS="${CXXFLAGS/-ffast-math/}"
 export   CFLAGS="${CFLAGS/-fomit-frame-pointer/}"
 export CXXFLAGS="${CXXFLAGS/-fomit-frame-pointer/}"
 export  LDFLAGS=""

 export MOZILLA_OFFICIAL=1
 export BUILD_OFFICIAL=1
 export MOZ_THUNDERBIRD=1

cat << EOF > .mozconfig
. ./mail/config/mozconfig
#mk_add_options MOZ_CO_PROJECT=mail

#ac_add_options --with-pthreads
#ac_add_options --enable-default-toolkit=gtk2
#ac_add_options --enable-application=mail
#ac_add_options --disable-native-uconv
#ac_add_options --enable-elf-dynstr-gc
ac_add_options --prefix=/opt/thunderbird
#ac_add_options --with-default-mozilla-five-home=/opt/thunderbird
#ac_add_options --enable-shared
#ac_add_options --disable-static
#ac_add_options --with-system-jpeg
#ac_add_options --with-system-zlib
#ac_add_options --with-system-png
#ac_add_options --with-system-mng
#ac_add_options --enable-crypto
#ac_add_options --disable-tests
#ac_add_options --disable-debug
#ac_add_options --enable-optimize="$CFLAGS"
#ac_add_options --enable-xft
#ac_add_options --disable-freetype2
#ac_add_options --disable-profilesharing
#ac_add_options --enable-single-profile
#ac_add_options --disable-logging
#ac_add_options --disable-debug
#ac_add_options --enable-extensions="cookie,xml-rpc,xmlextras,pref,transformiix,universalchardet,webservices,inspector,p3p"
EOF

 export LDFLAGS+=" -Wl,-rpath,/opt/thunderbird/lib/thunderbird-$VERSION"
 grep   -rl             "\-Wl,-soname" * |
 xargs  --max-lines=64 sed -i "s:-Wl,-soname:-Wl,-rpath,/opt/thunderbird/lib/thunderbird-$VERSION -Wl,-soname:"

 check_space       &&
 ./configure $OPTS &&
 make              &&
 prepare_install   &&
 make    install   &&
 ln -s  /opt/thunderbird/bin/thunderbird /usr/bin/thunderbird &&
 rm -rf /opt/thunderbird/lib/thunderbird-$VERSION/install
}
