# 9.8.1 refuses to start
# Aug 31 22:49:05 [named] initializing DST: openssl failure
# Aug 31 22:49:05 [named] exiting (due to fatal error)
# 9.8.0 might refuse to start

   version stable 9.8.1 9.7.3 9.7.2-P3
   version secure 9.7.2-P3
   version unstable 9.8.1 9.8.0-P4 9.8.0-P2 9.8.0
   require init-functions libcap libxml2 openssl
      opts --enable-static=no
  sys_user bind bind /var/chroot/bind
case $MACHTYPE in
 *-uclibc)
      opts --disable-linux-caps ;;
esac
  category network/dns
 attribute console client makej server
    source ftp://ftp.isc.org/isc/bind9/$VERSION/bind-$VERSION.tar.gz
      info last 20110831
      info home http://www.isc.org/software/bind
      info docs http://www.isc.org/software/bind/documentation
      vurl http://www.isc.org/downloads/all/
   protect /etc/bind
   protect /var/chroot/bind
    CFLAGS='-O2'
   LDFLAGS='-Wl,-O1'
      desc 'named DNS server and dig DNS client
bind (Berkeley Internet Name Domain) is an implementation
of the Domain Name System (DNS) protocols and provides an
openly redistributable reference implementation of the
major components of the Domain Name System, including:

* a Domain Name System server (named)
* a Domain Name System resolver library
* tools for verifying the proper operation of the DNS server

The named server will start during boot when /etc/bind/named.conf exists.'


build(){
#local JAIL=$DESTDIR/var/chroot/bind
 local JAIL=$DESTDIR
 conf_install(){
  SNC="$SCRIPT_DIR/named.conf"
  SNR="$SCRIPT_DIR/named.root"
  RES="$SCRIPT_DIR/resolv.conf"

  install -dvm 755 -o bind -g bind      $JAIL/var/run
  install -dvm 755 -o bind -g bind      $JAIL/etc/bind
  install  -vm 644 -o bind -g bind $SNR $JAIL/etc/bind
  install  -vm 644 -o bind -g bind $SNC $JAIL/etc/bind
  install  -vm 644 -o bind -g bind $SNC      /etc/bind

  rndc-confgen -a -u bind -t $JAIL
  true
 }

 ./configure            \
 --prefix=/usr          \
 --sysconfdir=/etc/bind \
 --localstatedir=/var   \
 $OPTS &&
 make  &&
 make install "DESTDIR=$DESTDIR" &&
 conf_install
}
