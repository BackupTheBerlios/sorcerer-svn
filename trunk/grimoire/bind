   VERSION=( 9.4.2 9.4.1-P1 9.4.1 )
      SAFE=( 9.4.2 9.4.1-P1 )
  CATEGORY='network/dns'
 ATTRIBUTE='console client server'
    SOURCE="bind9/$VERSION/bind-$VERSION.tar.gz"
       URL='ftp://ftp.isc.org/isc/'
      VURL='http://www.isc.org/index.pl?/sw/bind/'
#      URL='$ISC_URL'
  HOMEPAGE='http://www.isc.org/products/BIND'
       REQ='init-functions openssl'
      OPTS='--enable-static=no'
#     OPTS='--disable-static'
# --disable-static does not work with bind
   PROTECT='/etc/bind
            /var/chroot/bind'
#   PROTECT='                /etc/bind/rndc.key
#            /var/chroot/bind/etc/bind/rndc.key'
  ESTIMATE='2200'
      DESC='bind contains a DNS server and dig
bind (Berkeley Internet Name Domain) is an implementation
of the Domain Name System (DNS) protocols and provides an
openly redistributable reference implementation of the
major components of the Domain Name System, including:

* a Domain Name System server (named)
* a Domain Name System resolver library
* tools for verifying the proper operation of the DNS server'


build(){
 conf_install(){
  SNC="$SCRIPT_DIR/named.conf"
  SNR="$SCRIPT_DIR/named.root"
  RES="$SCRIPT_DIR/resolv.conf"

  install -dvm 0755 -o bind -g bind      $JAIL/var/run
  install -dvm 0755 -o bind -g bind      $JAIL/etc/bind
  install  -vm 0644 -o bind -g bind $SNR $JAIL/etc/bind

  [ -f $JAIL/etc/bind/named.conf ] ||
  install -vm 0644 -o bind -g bind $SNC $JAIL/etc/bind
  [ -f $JAIL/etc/bind/rndc.key ] ||
  rndc-confgen -a -u bind -t $JAIL
  true
 }

                     JAIL="/var/chroot/bind"
mkdir    -p -m 0755 $JAIL
groupadd -K GID_MIN=256 -K GID_MAX=511    bind               2>/dev/null
useradd  -K UID_MIN=256 -K UID_MAX=511 -g bind -d $JAIL bind 2>/dev/null
chown    -R  bind:bind  $JAIL

 ./configure            \
 --prefix=/usr          \
 --sysconfdir=/etc/bind \
 --localstatedir=/var   \
 $OPTS                  &&
 make                   &&
 prepare_install        &&
 make    install        &&
    conf_install
}
