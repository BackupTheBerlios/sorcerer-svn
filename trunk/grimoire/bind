    stable 9.7.0-P1 9.7.0 9.6.1-P3 9.6.1-P2 9.6.1-P1 9.6.1 9.6.0-P1 9.6.0
    secure 9.6.1-P2 9.5.0-P2
   require init-functions libcap libxml2 openssl
  category network/dns
 attribute console client server
    source ftp://ftp.isc.org/isc/bind9/$VERSION/bind-$VERSION.tar.gz
      vurl http://www.isc.org/index.pl?/sw/bind/
  homepage http://www.isc.org/products/BIND
      opts --enable-static=no
   protect /etc/bind
   protect /var/chroot/bind
  estimate 2000
      desc 'named DNS server and dig DNS client
bind (Berkeley Internet Name Domain) is an implementation
of the Domain Name System (DNS) protocols and provides an
openly redistributable reference implementation of the
major components of the Domain Name System, including:

* a Domain Name System server (named)
* a Domain Name System resolver library
* tools for verifying the proper operation of the DNS server

The named server will start during boot when /etc/bind/named.conf exists.'


build(){
 conf_install(){
  SNC="$SCRIPT_DIR/named.conf"
  SNR="$SCRIPT_DIR/named.root"
  RES="$SCRIPT_DIR/resolv.conf"

  install -dvm 755 -o bind -g bind      $JAIL/var/run
  install -dvm 755 -o bind -g bind      $JAIL/etc/bind
  install  -vm 644 -o bind -g bind $SNR $JAIL/etc/bind

  [ -f $JAIL/etc/bind/named.conf ] ||
  install -vm 644 -o bind -g bind $SNC $JAIL/etc/bind
  [ -f $JAIL/etc/bind/rndc.key ] ||
  rndc-confgen -a -u bind -t $JAIL
  true
 }

                    JAIL=/var/chroot/bind
mkdir    -p -m 755 $JAIL
groupadd -K GID_MIN=256 -K GID_MAX=511    bind               2>/dev/null
useradd  -K UID_MIN=256 -K UID_MAX=511 -g bind -d $JAIL bind 2>/dev/null
chown    -R  bind:bind  $JAIL

 ./configure            \
 --prefix=/usr          \
 --sysconfdir=/etc/bind \
 --localstatedir=/var   \
 $OPTS                  &&
 make                   &&
 prepare_install        &&
 make    install        &&
    conf_install
}
