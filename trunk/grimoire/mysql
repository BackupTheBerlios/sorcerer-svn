   VERSION=( 5.0.51a 5.0.51 5.0.45 )
      SAFE=( 5.0.51a 5.0.51 5.0.45 )
    IGNORE='\-apple-\|-dec-\|-hp-\|-ibm-\|-sgi-\|-unknown-\|-x86\|^5\.0\.\|debug\|win'
  CATEGORY='db'
 ATTRIBUTE='console'
    SOURCE="MySQL-${VERSION:0:3}/mysql-$VERSION.tar.gz"
      VURL='http://dev.mysql.com/downloads/mysql/5.0.html'
       URL="$MYSQL_URL"
  HOMEPAGE='http://www.mysql.com'
       REQ=( 'db ncurses openssl readline zlib'
             ':--enable-assembler::to use assembler version of some string functions if available'
             ':--with-pthread::for thread support'
             ':--with-archive-storage-engine:--without-archive-storage-engine:to enable the archive storage engine'
             ':--with-blackhole-storage-engine:--without-blackhole-storage-engine:to enable blackhole storage engine'
             ':--with-csv-storage-engine:--without-csv-storage-engine:to enable the csv storage engine'
             ':--with-embedded-server:--without-embedded-server:to build embedded server libmysqld'
             ':--with-innodb:--without-innodb:to include the InnoDB table handler'
             ':--with-ndbcluster:--without-ndbcluster:to include the NDB cluster table handler'
             ':--with-server:--without-server:to build mysql server'
             ':--with-vio:--without-vio:to include virtual IO support' )
#            'openssl:--with-openssl:--without-openssl:for SSL support'
# Raid support seems to be broken
#            ':--with-raid::to enable RAID support'
   EXCLUDE='/var/lib/mysql'
  ESTIMATE='7000'
      DESC='mysql is a widely used and fast SQL database server.
mysql is a widely used and fast SQL database server.
It is a client/server implementation that consists
of a server daemon (mysqld) and many different
client programs/libraries.'

build() {
mkdir    -p -m 0755 /var/lib/mysql
groupadd -K GID_MIN=256 -K GID_MAX=512    mysql                         2>/dev/null
useradd  -K UID_MIN=256 -K UID_MAX=512 -g mysql -d /var/lib/mysql mysql 2>/dev/null
chown    -R mysql:mysql /var/lib/mysql

./configure                     \
--prefix=/usr                   \
--without-bench                 \
--enable-assembler              \
--enable-thread-safe-client     \
--localstatedir=/var/lib/mysql  \
--enable-shared                 \
--with-mysqld-user=mysql        \
--with-berkeley-db              \
--with-mysqld-user=mysql        \
--with-extra-charsets=complex   \
--exec-prefix=/usr              \
--libexecdir=/usr/sbin          \
--sysconfdir=/etc               \
--datadir=/usr/share            \
--infodir=/usr/info             \
--includedir=/usr/include       \
--mandir=/usr/man               \
--with-server-suffix='-Max'     \
--with-comment="MySQL-MAX-$VERSION "  \
--with-unix-socket-path=/var/lib/mysql/mysql.sock  \
$OPTS                                &&
make             pkglibdir=/usr/lib  &&
prepare_install                      &&
make    install  pkglibdir=/usr/lib  &&

if  !  echo  "$OPTS"  |  grep  -q  'without-server';  then
  mysql_install_db
  chown    -R mysql:mysql                        /var/lib/mysql
  install  -m 0700  support-files/mysql.server   /etc/init.d/mysql
  install  -m 0700  support-files/my-medium.cnf  /etc/my.cnf
fi

}

post_install() {
  default_post_install
  if  [  -f                 /etc/init.d/mysql  ];  then
    /lib/lsb/install_initd  /etc/init.d/mysql
      /etc/init.d/mysql restart
#     if    locked  /var/run/mysql.pid mysqld
#     then  /etc/init.d/mysql  restart
#     fi
  fi
}

pre_remove() {
  default_pre_remove
  if      [  -x  /etc/init.d/mysql  ];  then
    if    [  -z  "$UPGRADING"  ]
    then  /etc/init.d/mysql stop
    fi
    /lib/lsb/remove_initd  /etc/init.d/mysql
  fi
}
