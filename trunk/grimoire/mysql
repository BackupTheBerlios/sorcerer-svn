   VERSION=( "4.1.14" "4.1.13a" "4.1.13" "4.1.12" "4.1.11" "4.1.10a" "4.1.10" "4.1.8" "4.1.7" "4.0.22" )
      SAFE=( "4.1.14" "4.1.13a" "4.1.13" "4.1.12" "4.1.11" "4.1.10a" )
    IGNORE="\-apple-\|-dec-\|-hp-\|-ibm-\|-sgi-\|-unknown-\|-x86\|^5\.0\."
# 5.0.x versions are developmental
  CATEGORY="db"
 ATTRIBUTE="console"
    SOURCE="MySQL-${VERSION:0:3}/mysql-$VERSION.tar.gz"
       URL="$MYSQL_URL"
  HOMEPAGE="http://www.mysql.com"
# Raid support seems to be broken
#            ":--with-raid::to enable RAID support"

       REQ=( "ncurses openssl perl zlib"
             "db:--with-berkeley-db:--without-berkeley-db:for berkeley sleepycat database support"
             "openssl:--with-openssl:--wihout-openssl:for SSL support"
             "readline:--without-readline::to use system installed instead of included readline"
             ":--with-server:--without-server:to build mysql server"
             ":--enable-thread-safe-client --with-pthread::for thread support"
             ":--with-vio:--without-vio:to include virtual IO support"
             ":--with-innodb:--without-innodb:to include the InnoDB table handler"
             ":--with-archive-storage-engine:--without-archive-storage-engine:to enable the archive storage engine"
             ":--with-csv-storage-engine:--without-csv-storage-engine:to enable the csv storage engine"
             ":--with-blackhole-storage-engine:--without-blackhole-storage-engine:to enable blackhole storage engine"
             ":--with-ndbcluster:--without-ndbcluster:to include the NDB cluster table handler"
             ":--with-embedded-server:--without-embedded-server:to build embedded server libmysqld"
             ":--enable-assembler::Use assembler version of some string functions if available" )
   EXCLUDE="/var/lib/mysql"
  ESTIMATE="4589"
      DESC="mysql is a widely used and fast SQL database server.
mysql is a widely used and fast SQL database server.
It is a client/server implementation that consists
of a server daemon (mysqld) and many different
client programs/libraries."

build() {
# sed  -i  "/	cd libmysqld\/examples; \$(MAKE) link_sources/d"  Makefile.in
# sed  -i  "s:examples::"                                 libmysqld/Makefile.in

# export  CXXFLAGS="$CXXFLAGS  -O3 -felide-constructors -fno-exceptions -fno-rtti -DHAVE_ERRNO_AS_DEFINE=1"
# export    CFLAGS="$CFLAGS  -DHAVE_ERRNO_AS_DEFINE=1"

groupadd  mysql             2>/dev/null
useradd   mysql  -g  mysql  2>/dev/null

# sed  -i  "s:/libssl.a:/libssl.so:"  configure
# sed  -i  "s:Linuxthreads:pthread:"  configure

	case  $VERSION  in
		4.1.1[0-2])  mkdir  -p                     system/asm
		sed  "s/new/nneww/"     /usr/include/asm/system.h  >  \
		system/asm/system.h
		export    CFLAGS="-isystem $PWD/system $CFLAGS"
		export  CXXFLAGS="-isystem $PWD/system $CXXFLAGS"
		sed  -i  "/#define _global_h/a #define CONFIG_NR_CPUS 1\n"  \
		./include/my_global.h
		;;
	esac

./configure                     \
--prefix=/usr                   \
--without-bench                 \
--enable-assembler              \
--localstatedir=/var/lib/mysql  \
--enable-shared                 \
--with-mysqld-user=mysql        \
--with-berkeley-db              \
--with-mysqld-user=mysql        \
--with-extra-charsets=complex   \
--exec-prefix=/usr              \
--libexecdir=/usr/sbin          \
--sysconfdir=/etc               \
--datadir=/usr/share            \
--infodir=/usr/info             \
--includedir=/usr/include       \
--mandir=/usr/man               \
--with-server-suffix='-Max'     \
--with-comment="MySQL-MAX-$VERSION "  \
--with-unix-socket-path=/var/lib/mysql/mysql.sock  \
$OPTS                                &&
make             pkglibdir=/usr/lib  &&
prepare_install                      &&
make    install  pkglibdir=/usr/lib  &&

if  !  echo  "$OPTS"  |  grep  -q  "without-server";  then
  mysql_install_db
  chown    -R mysql.mysql                        /var/lib/mysql
  install  -m 0700  support-files/mysql.server   /etc/init.d/mysql
  install  -m 0700  support-files/my-medium.cnf  /etc/my.cnf
fi

}

post_install() {
  default_post_install
  if  [  -f                 /etc/init.d/mysql  ];  then
    /lib/lsb/install_initd  /etc/init.d/mysql
      /etc/init.d/mysql restart
#     if    locked  /var/run/mysql.pid mysqld
#     then  /etc/init.d/mysql  restart
#     fi
  fi
}

pre_remove() {
  default_pre_remove
  if      [  -x  /etc/init.d/mysql  ];  then
    if    [  -z  "$UPGRADING"  ]
    then  /etc/init.d/mysql stop
    fi
    /lib/lsb/remove_initd  /etc/init.d/mysql
  fi
}
