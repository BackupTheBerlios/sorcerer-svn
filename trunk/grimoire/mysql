   VERSION=( "5.0.27" "5.0.26" "5.0.24a" )
      SAFE=( "5.0.27" "5.0.26" "5.0.24a" )
    IGNORE="\-apple-\|-dec-\|-hp-\|-ibm-\|-sgi-\|-unknown-\|-x86\|^5\.0\."
  CATEGORY="db"
 ATTRIBUTE="console"
    SOURCE=( "MySQL-${VERSION:0:3}/mysql-$VERSION.tar.gz" )
#            "linux-libc-headers-2.6.12.0.tar.bz2" )
       URL=( "$MYSQL_URL" )
#            "http://ep09.pld-linux.org/~mmazur/linux-libc-headers/" )
  HOMEPAGE="http://www.mysql.com"
# Raid support seems to be broken
#            ":--with-raid::to enable RAID support"

# mysql not compatibile with current system installed berkely db.
#            "db:--with-berkeley-db=/usr:--without-berkeley-db:for berkeley sleepycat database support"
       REQ=( "ncurses openssl perl zlib"
             "db:--with-berkeley-db:--without-berkeley-db:for berkeley sleepycat database support"
             "readline:--without-readline::to use system installed instead of included readline"
             ":--with-server:--without-server:to build mysql server"
             ":--enable-thread-safe-client --with-pthread::for thread support"
             ":--with-vio:--without-vio:to include virtual IO support"
             ":--with-innodb:--without-innodb:to include the InnoDB table handler"
             ":--with-archive-storage-engine:--without-archive-storage-engine:to enable the archive storage engine"
             ":--with-csv-storage-engine:--without-csv-storage-engine:to enable the csv storage engine"
             ":--with-blackhole-storage-engine:--without-blackhole-storage-engine:to enable blackhole storage engine"
             ":--with-ndbcluster:--without-ndbcluster:to include the NDB cluster table handler"
             ":--with-embedded-server:--without-embedded-server:to build embedded server libmysqld"
             ":--enable-assembler::Use assembler version of some string functions if available" )
#            "openssl:--with-openssl:--without-openssl:for SSL support"
   EXCLUDE="/var/lib/mysql"
  ESTIMATE="6700"
      DESC="mysql is a widely used and fast SQL database server.
mysql is a widely used and fast SQL database server.
It is a client/server implementation that consists
of a server daemon (mysqld) and many different
client programs/libraries."

build() {
if    [  -n  "${SOURCE[1]}"  ];  then
  case  $HOSTTYPE  in
    i*86)  ln  -s  asm-i386      linux-libc-headers-2.6.12.0/include/asm  ;;
    x*86*) ln  -s  asm-x86_64    linux-libc-headers-2.6.12.0/include/asm  ;;
  esac
  export    CFLAGS="-I$BUILD_DIR/linux-libc-headers-2.6.12.0/include   $CFLAGS"
  export  CXXFLAGS="-I$BUILD_DIR/linux-libc-headers-2.6.12.0/include $CXXFLAGS"
fi


# sed  -i  "/	cd libmysqld\/examples; \$(MAKE) link_sources/d"  Makefile.in
# sed  -i  "s:examples::"                                 libmysqld/Makefile.in

# export  CXXFLAGS="$CXXFLAGS  -O3 -felide-constructors -fno-exceptions -fno-rtti -DHAVE_ERRNO_AS_DEFINE=1"
# export    CFLAGS="$CFLAGS  -DHAVE_ERRNO_AS_DEFINE=1"

mkdir    -p -m 0755 /var/lib/mysql
groupadd -K GID_MIN=256 -K GID_MAX=512    mysql                         2>/dev/null
useradd  -K UID_MIN=256 -K UID_MAX=512 -g mysql -d /var/lib/mysql mysql 2>/dev/null
chown    -R mysql:mysql /var/lib/mysql

# sed  -i  "s:/libssl.a:/libssl.so:"  configure
# sed  -i  "s:Linuxthreads:pthread:"  configure

	case  $VERSION  in
		4.1.1[0-2])  mkdir  -p                     system/asm
		sed  "s/new/nneww/"     /usr/include/asm/system.h  >  \
		system/asm/system.h
		export    CFLAGS="-isystem $PWD/system $CFLAGS"
		export  CXXFLAGS="-isystem $PWD/system $CXXFLAGS"
		sed  -i  "/#define _global_h/a #define CONFIG_NR_CPUS 1\n"  \
		./include/my_global.h
		;;
	esac

./configure                     \
--prefix=/usr                   \
--without-bench                 \
--enable-assembler              \
--localstatedir=/var/lib/mysql  \
--enable-shared                 \
--with-mysqld-user=mysql        \
--with-berkeley-db              \
--with-mysqld-user=mysql        \
--with-extra-charsets=complex   \
--exec-prefix=/usr              \
--libexecdir=/usr/sbin          \
--sysconfdir=/etc               \
--datadir=/usr/share            \
--infodir=/usr/info             \
--includedir=/usr/include       \
--mandir=/usr/man               \
--with-server-suffix='-Max'     \
--with-comment="MySQL-MAX-$VERSION "  \
--with-unix-socket-path=/var/lib/mysql/mysql.sock  \
$OPTS                                &&
make             pkglibdir=/usr/lib  &&
prepare_install                      &&
make    install  pkglibdir=/usr/lib  &&

if  !  echo  "$OPTS"  |  grep  -q  "without-server";  then
  mysql_install_db
  chown    -R mysql:mysql                        /var/lib/mysql
  install  -m 0700  support-files/mysql.server   /etc/init.d/mysql
  install  -m 0700  support-files/my-medium.cnf  /etc/my.cnf
fi

}

post_install() {
  default_post_install
  if  [  -f                 /etc/init.d/mysql  ];  then
    /lib/lsb/install_initd  /etc/init.d/mysql
      /etc/init.d/mysql restart
#     if    locked  /var/run/mysql.pid mysqld
#     then  /etc/init.d/mysql  restart
#     fi
  fi
}

pre_remove() {
  default_pre_remove
  if      [  -x  /etc/init.d/mysql  ];  then
    if    [  -z  "$UPGRADING"  ]
    then  /etc/init.d/mysql stop
    fi
    /lib/lsb/remove_initd  /etc/init.d/mysql
  fi
}
