# If vsftpd is supposed to be run from xinetd
# Then how come no vsftpd.d/xinetd.d/vsftpd
# file exists in the grimoire?
#
# because it also can be run standalone
#
# warning there is an install hack!

    stable 2.0.6 2.0.5
  optional Linux-PAM    PAM        '' for pluggable authnetication
  optional openssl      SSL        '' for encryption support
  optional libcap       ''         '' for linux capabilities support
  optional tcp_wrappers TCPWRAPPER '' for controlling access to ftpd daemon through tcp_wrappers
  optional xinetd       ''         '' for running server
    ignore 'snap'
  category network/ftp
 attribute server 
    source ftp://vsftpd.beasts.org/users/cevans/vsftpd-$VERSION.tar.gz
  homepage http://vsftpd.beasts.org/
  eprovide ftpd
  estimate 60
      desc 'vsftpd is a FTP server.
It is secure, stable and extremely fast.
Despite being small for purposes of speed and security,
many more complicated FTP setups are achievable with vsftpd!
By no means an exclusive list, vsftpd will handle:

    * Virtual IP configurations
    * Virtual users
    * Standalone or inetd operation
    * Powerful per-user configurability
    * Bandwidth throttling
    * Per-source-IP configurability
    * Per-source-IP limits
    * IPv6
    * Encryption support through SSL integration
    * etc...'


build() {

configure() {
echo '#ifndef VSF_BUILDDEFS_H'
echo '#define VSF_BUILDDEFS_H'

if grep -qx Linux-PAM $OPT_ON_LOGS/vsftpd; then
echo "#define VSF_BUILD_PAM"
else
echo "#undef VSF_BUILD_PAM"
fi

if grep -qx openssl $OPT_ON_LOGS/vsftpd; then
echo "#define VSF_BUILD_SSL"
else
echo "#undef VSF_BUILD_SSL"
fi

if grep -qx tcp_wrappers $OPT_ON_LOGS/vsftpd; then
echo "#define VSF_BUILD_TCPWRAPPERS"
else
echo "#undef VSF_BUILD_TCPWRAPPERS" 
fi

echo "#endif /* VSF_BUILDDEFS_H */"
}

patch -p1  <  $SCRIPT_DIR/vsftpd-2.0.6.patch
 rm           builddefs.h
 configure >> builddefs.h
 cat          builddefs.h
 make             &&
 prepare_install  &&
 #warning hack
 mkdir -p /usr/local/man/man5/ &&
 make    install            &&
 mkdir -p /usr/share/empty/ &&
 cp vsftpd.conf /etc
}
