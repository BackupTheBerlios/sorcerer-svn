# URLs about a potential runtime problem involving calibre

# http://forums.funtoo.org/viewtopic.php?id=674
# http://bugs.python.org/issue12326
# http://forums.gentoo.org/viewtopic-p-6753566.html

   version   stable 0.8.50 0.8.49 0.8.48 0.8.47 0.8.46 0.8.45 0.8.44
   require BeautifulSoup ImageMagick Imaging PyQt4 chmlib cssutils dbus-python lxml mechanize nautilus podofo poppler-qt-x11-opensource python-dateutil pygobject setuptools shared-mime-info xdg-utils
  optional icu4c
  optional unrar '' '' to support rar archives
  category documentation
 attribute python-module
    source $SOURCEFORGE_URL calibre/$VERSION/calibre-$VERSION.tar.xz
#   source $SOURCEFORGE_URL calibre/$VERSION/calibre-$VERSION.tar.gz
      info last 20120428
      info home http://calibre-ebook.com/
      desc 'a one stop solution for e-book processing.
Calibre is meant to be a complete e-library solution and thus
includes library management, format conversion, news feeds to
ebook conversion, as well as e-book reader sync features and
an integrated e-book viewer.'

build(){ (
 if   [[ $HOSTTYPE == x86_64 ]] && [[ $CFLAGS =~ -m32 ]]
 then export QTDIR=/opt/32bit/usr; export PATH="/opt/32bit/usr/bin:$PATH"
 else export QTDIR=/usr
 fi

 export PKG_CONFIG_PATH=$QTDIR/lib/pkgconfig
 export POPPLER_INC_DIR=$QTDIR/include/poppler:$QTDIR/include
 export POPPLER_LIB_DIR=$QTDIR/lib

 if   [[ $HOSTTYPE == x86_64 ]] &&
    ! [[ $CFLAGS   =~ -m32   ]]
 then mkdir -pm 755 $DESTDIR/usr/lib64/python2.7/site-packages
 else mkdir -pm 755 $DESTDIR/usr/lib/python2.7/site-packages
 fi

 sed -i 's:/usr/bin/env python2:/usr/bin/python:' setup/install.py
 python setup.py build   $OPTS &&
 python setup.py install $OPTS "--root=$DESTDIR/usr"
) }
