# requirements listed at http://calibre-ebook.com/download_linux

# 0.9.12 failed compilation
# 0.9.13 failed compilation
# 0.9.14 failed compilation
# 0.9.15 failed compilation
# 0.9.16 failed compilation
# 0.9.18 failed compilation
# 0.9.20 failed compilation
# 0.9.23 failed to compile
# 0.9.21 failed to compile
# 0.9.26 failed to compile
# no versions are known to compile at the moment

with version   stable 0.9.27 0.9.26 0.9.25
with version unstable 0.9.27
with info    last 20130417
with trait   broke
with base    BeautifulSoup ImageMagick Imaging PyQt4 chmlib cssutils dbus-python distribute libmtp lxml mechanize poppler-qt-x11-opensource python-dateutil pygobject shared-mime-info xdg-utils
with elect   icu4c
with elect   podofo
with elect   pykde4
with elect   unrar '' '' to support rar archives
with role    documentation
with trait   python-module
with source    stable $SOURCEFORGE_URL calibre/$VERSION/calibre-$VERSION.tar.xz
with source  unstable $SOURCEFORGE_URL calibre/$VERSION/calibre-$VERSION.tar.xz
with info    home http://calibre-ebook.com/
with info    cite 'solution for e-book processing
Calibre is meant to be a complete e-library solution and thus
includes library management, format conversion, news feeds to
ebook conversion, as well as e-book reader sync features and
an integrated e-book viewer.'

build(){ (
 if   [[ $HOSTTYPE == x86_64 ]] && [[ $CFLAGS =~ -m32 ]]
 then export QTDIR=/opt/32bit/usr; export PATH="/opt/32bit/usr/bin:$PATH"
 else export QTDIR=/usr
 fi

 export PKG_CONFIG_PATH=$QTDIR/lib/pkgconfig
 export POPPLER_INC_DIR=$QTDIR/include/poppler:$QTDIR/include
 export POPPLER_LIB_DIR=$QTDIR/lib

 if   [[ $HOSTTYPE == x86_64 ]] &&
    ! [[ $CFLAGS   =~ -m32   ]]
 then mkdir -pm 755 $DESTDIR/usr/lib64/python2.7/site-packages
 else mkdir -pm 755 $DESTDIR/usr/lib/python2.7/site-packages
 fi

 sed -i 's:/usr/bin/env python2:/usr/bin/python:' setup/install.py
 python setup.py build   $OPTS &&
 python setup.py install $OPTS "--root=$DESTDIR/usr"
) }
