# requirement list may be incomplete?
# 0.8.38 failed to compile
# 0.8.37 started failing to compile
# 0.8.39 fails compilation

   version   stable 0.8.37 0.8.35 0.8.34
   version unstable 0.8.39 0.3.38
   require BeautifulSoup ImageMagick Imaging PyQt4 chmlib cssutils dbus-python lxml mechanize nautilus podofo poppler-qt-x11-opensource python-dateutil pygobject setuptools shared-mime-info xdg-utils
  optional icu4c
  optional unrar '' '' to support rar archives
  category documentation
 attribute python-module
 attribute broke
    source $SOURCEFORGE_URL calibre/$VERSION/calibre-$VERSION.tar.xz
#   source $SOURCEFORGE_URL calibre/$VERSION/calibre-$VERSION.tar.gz
      info last 20120211
      info home http://calibre-ebook.com/
      desc 'a one stop solution for e-book processing.
Calibre is meant to be a complete e-library solution and thus
includes library management, format conversion, news feeds to
ebook conversion, as well as e-book reader sync features and
an integrated e-book viewer.'

build(){ (
 if   [[ $HOSTTYPE == x86_64 ]] && [[ $CFLAGS =~ -m32 ]]
 then export QTDIR=/opt/32bit/usr; export PATH="/opt/32bit/usr/bin:$PATH"
 else export QTDIR=/usr
 fi

 export PKG_CONFIG_PATH=$QTDIR/lib/pkgconfig
 export POPPLER_INC_DIR=$QTDIR/include/poppler:$QTDIR/include
 export POPPLER_LIB_DIR=$QTDIR/lib

 if   [[ $HOSTTYPE == x86_64 ]] &&
    ! [[ $CFLAGS   =~ -m32   ]]
 then mkdir -pm 755 $DESTDIR/usr/lib64/python2.7/site-packages
 else mkdir -pm 755 $DESTDIR/usr/lib/python2.7/site-packages
 fi

#default_build &&
 python setup.py build   $OPTS &&
 python setup.py install $OPTS "--root=$DESTDIR/usr"
# &&
# calibre_postinstall
) }
