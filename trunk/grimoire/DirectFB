# DirectFB Does have an optional on LibVNCServer
# However, thanks to qt-everywhere-opensource 4.4.1 requiring gstplugins
# for photon support which is required for KDE 4.1.0
# Having DirectFB require LibVNCServer creates
# a recursive requirement loop.

# optional LibVNCServer '' '' for vnc support
# 1.6.0 does not compile because the source tree
# was not properly prepared before being rolled into a source tarball.

   version   stable 1.5.3 1.5.2 1.5.1 1.5.0 1.4.13
   version unstable 1.6.0
case $VERSION in
 1.6.0)
   require automake libtool ;;
 1.5.3)
   require libpng-v1.4 ;;
esac
   require freetype gcc-g++ jpeg libdrm libpng sysfsutils
#  require freetype gcc-g++ jpeg libdrm libmng libpng sysfsutils
  optional libXext --enable-x11 --disable-x11 for X11 support
  optional LibVNCServer
  optional MesaLib
      opts --disable-sdl
#     opts --disable-avifile --disable-sdl
  category graphic
 attribute library makej multilib-concurrent setarch x11
    source http://www.directfb.org/downloads/Core/DirectFB-${VERSION:0:3}/DirectFB-$VERSION.tar.gz
      info vurl "http://www.directfb.org/index.php?path=Main%2FDownloads"
      info last 20120622
      info home http://www.directfb.org
      info docs http://www.directfb.org/wiki/index.php/Main_Page
 freshmeat directfb
      desc 'graphics library for use on top of the Linux framebuffer device
DirectFB is a thin library that provides
developers with hardware graphics acceleration,
input device handling and abstraction,
an integrated windowing system with support for
translucent windows and multiple display layers
on top of the Linux framebuffer device.
It is a complete hardware abstraction layer
with software fallbacks for every graphics operation
that is not supported by the underlying hardware.'

build(){
 libpng_fix(){
  if   [[ $HOSTTYPE == x86_64 ]] && ! [[ $CFLAGS =~ -m32 ]]
  then LIBPNGLIBDIR=/opt/libpng/1.4.x/lib64
  else LIBPNGLIBDIR=/opt/libpng/1.4.x/lib
  fi
  export   CFLAGS+=" -I/opt/libpng/1.4.x/include"
  export CXXFLAGS+=" -I/opt/libpng/1.4.x/include"
  export  LDFLAGS+=" -L$LIBPNGLIBDIR -Wl,-rpath,$LIBPNGLIBDIR"
  export PKG_CONFIG_PATH="$LIBPNGLIBDIR/pkgconfig:$PKG_CONFIG_PATH"
  echo "LDFLAGS=$LDFLAGS"
  echo "PKG_CONFIG_PATH=$PKG_CONFIG_PATH"
 }

 case $VERSION in
  1.6.0) aclocal; automake -acf; libtoolize -cf ;;
  1.5.3) libpng_fix ;;
 esac

 # sed -i '/@libdir@/d' directfb-config.in
 default_build
}
