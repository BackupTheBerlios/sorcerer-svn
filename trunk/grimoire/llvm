# Always check MesaLib when updating llvm

# must check for new releases manually
# Only installs ar libraries and not ELF.
# Very odd.
# OpenGTL refuses to compile with llvm when llvm has assertions enabled
# -DCMAKE_BUILD_TYPE=RELEASE release builds turn off assertions support

# llvm's ocaml bindings breaks compilation however
# --enable-bindings=none circumvents the break
# by not compiling the ocaml bindings

   version   stable 3.0 2.9 2.8 2.7 2.6
   version unstable 3.1
   require gcc-g++
#  require gcc-g++ perl--Pod-Simple
      opts --enable-shared --disable-docs
      opts --enable-bindings=none
      opts --disable-assertions
#     opts -DCMAKE_BUILD_TYPE=RELEASE -DBUILD_SHARED_LIBS:BOOL=TRUE
  category development/emulator
# lto compilation requires too much RAM
 attribute console library lto_off multilib-concurrent
#attribute console library lto_off makej multilib-concurrent
case $VERSION in
 3.0)
    source http://www.llvm.org/releases/$VERSION/llvm-$VERSION.tar.gz ;;
   *)
    source http://www.llvm.org/releases/$VERSION/llvm-$VERSION.src.tar.gz ;;
esac
      info last 20120522
      info home http://www.llvm.org
      info vurl http://www.llvm.org/releases/
#conflicts ocaml
      desc 'low level virtual machine'

build(){
# if     [[ $HOSTTYPE == x86_64 ]] &&
#      ! [[ $CFLAGS   =~ -m32   ]]
# then opts -DLLVM_LIBDIR_SUFFIX=64
# fi

# Did not work.
 if     [[ $HOSTTYPE == x86_64 ]] &&
      ! [[ $CFLAGS   =~ -m32   ]]
 then opts --libdir=/usr/lib64
 fi

 rm -f CMakeLists.txt
 default_build &&
 if     [[ $HOSTTYPE == x86_64 ]] &&
      ! [[ $CFLAGS   =~ -m32   ]]
 then mv -v $DESTDIR/usr/lib{,64}
 fi
}
