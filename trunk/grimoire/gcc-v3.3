   VERSION=( 3.3.6 )
    IGNORE='ada\|core\|g++\|g77\|java\|objc\|testsuite\|fortran\|^3\.4\.\|^4\.\|200[0-9]'
  CATEGORY='development/compiler'
 ATTRIBUTE='console library'
    SOURCE="gcc/gcc-$VERSION/gcc-$VERSION.tar.bz2"
       URL="$GNU_URL"
       REQ='coreutils'
  HOMEPAGE='http://gcc.gnu.org'
  ESTIMATE='4261'
      DESC='gcc-v3.3 provides gcc version 3.3.x'
   
build(){
 finish_install(){

  ln -sf gcc /opt/gcc/$VERSION/bin/cc

           SEDIT="s:-L/usr/src/sorcery[^ ]*::g"
  sed -i "$SEDIT" /opt/gcc/$VERSION/lib/lib*.la 2>/dev/null

  STRSTREAM=/opt/gcc/$VERSION/include/c++/$VERSION/backward/strstream

  if   [  -f           ${STRSTREAM}   ] &&
     ! [  -f           ${STRSTREAM}.h ]
  then ln -s strstream ${STRSTREAM}.h
  fi

  true
}


 ENABLE_LANGS="--enable-languages=c,c++"

 export   CFLAGS="${CFLAGS/-fomit-frame-pointer/}"
 export CXXFLAGS="${CXXFLAGS/-fomit-frame-pointer/}"
 export CCACHE_DISABLE=1
 export  LDFLAGS+=' -Wl,-R/opt/gcc/$VERSION/lib'
 case $HOSTTYPE in
  x86_64) LDFLAGS+='64' ;;
 esac

 LCF="LIBCFLAGS=$CFLAGS"
 LCXF="LIBCXXFLAGS=$CXXFLAGS"
 BF="BOOT_CFLAGS=$CFLAGS"
 LJCF="LIBGCJ_CFLAGS=$CFLAGS"
 LJCXF="LIBGCJ_CXXFLAGS=$CXXFLAGS"
 LJJF="LIBGCJ_JAVAFLAGS=$CFLAGS"
 LDF="LDFLAGS=$LDFLAGS"

 patch -p1 < $SCRIPT_DIR/gcc-3.3.2.patch

 find . -name configure |
 xargs --max-lines=64 sed -i 's:/bin/sh:/bin/bash:g'
 export CONFIG_SHELL=/bin/bash

 ./configure                \
 --host=$BUILD              \
 --prefix=/opt/gcc/$VERSION \
 --enable-threads=posix     \
 --enable-__cxa_atexit      \
 --enable-clocale=gnu       \
 --enable-shared            \
 "$ENABLE_LANGS"            &&
 make  bootstrap-lean       \
 "$BF"  "$LCF"  "$LCXF"     \
 "$LDF" "$LJCF" "$LJCXF"    &&
 prepare_install            &&
 make    install            &&
 finish_install
}
