# Once someone writes spells for
# http://www.southern-storm.com.au/portable_net.html
# we can do the --disable-csharp as no on an optional requirement

# segementation faults during compilation if emacs installed
# and --without-emacs not passed to configure

    stable 0.17 0.16.1 0.16 0.15
   require acl libcroco m4
  category development
 attribute library solo
       url $GNU_URL
    source gettext/gettext-$VERSION.tar.gz
  homepage http://www.gnu.org/software/gettext
      opts --disable-csharp --without-emacs --disable-static
  estimate 5000
      desc 'gettext is the GNU internationalisation library.
Many programs that have translated messages depend upon this
library and tools.'

build(){

 x86_64-pc-linux-gnu-build(){
  ./configure          \
  --prefix=/usr        \
  --sysconfdir=/etc    \
  --localstatedir=/var \
  $OPTS                &&
  sed -i 's@^\(archive_cmds.*-shared \)\(.*predep_objects.*\)@\1 -nostartfiles -nostdlib \2 @ g' gettext-runtime/libasprintf/libtool  &&
  make            &&
  prepare_install &&
  make    install
 }

 # gettext 0.14.5 compilation chokes on SMP during parallel builds
 echo '.NOTPARALLEL:' >> gettext-tools/misc/Makefile.in

 case $HOSTTYPE in
  x86_64) x86_64-pc-linux-gnu-build ;;
       *) default_build ;;
 esac &&

for REPLY in /usr/lib/libintl.so*; do
 mv $REPLY /lib/ &&
 ln -sv ../../lib/${REPLY##*/} $REPLY
done
}
