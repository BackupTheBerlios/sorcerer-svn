[ -z "$VERSION" ] &&
   VERSION=( 3.5.8 )
  CATEGORY='profile'
 ATTRIBUTE='kde3'
  HOMEPAGE='http://www.kde.org'
       URL="$KDE_URL"
       REQ=( 'kdeaddons-v3'
             'kdebindings-v3:::for DCOP and kdejava bindings'
             'kdevelop-v3:::for creating and development of software projects'
             'kde-path-v3:::for including /opt/kde3/bin in the PATH'
             'kdesdk-v3:::for applications and tools used by KDE developers'
             'kdewebdev-v3:::for web page/site development tools'
             'scim-bridge-qt3:::to input in Japanese, Chineese, Korean' )
     OPTS+=' --prefix=/opt/kde3 --with-qt-dir=/opt/kde3 --disable-debug --enable-final'
  ESTIMATE='5'
      DESC='kde-v3 provides the KDE version 3.x desktop environment.'

kde_build(){
 SCX=1
 while [     -n                                 "${SOURCE[$SCX]}"  ]
 do    patch -p0 < $SOURCE_CACHE/$SPELL/$VERSION/${SOURCE[$SCX]##*/}
       (( SCX++ ))
 done

 # ppanula: tested with kde 3.5.1, OK
 sed -i "s:CFLAGS=\"-O2 \$CFLAGS\":CFLAGS=\"${CFLAGS}\":
         s:CXXFLAGS=\"-O2 \$CXXFLAGS\":CXXFLAGS=\"${CXXFLAGS}\":" configure

#--prefix=/opt/kde3   \

# case $HOSTTYPE in
#  x86_64) OPTS+=' --with-qt-libraries=/opt/kde3/lib64'; LDFLAGS+=' -L/opt/kde3/lib64';;
#       *) OPTS+=' --with-qt-libraries=/opt/kde3/lib';   LDFLAGS+=' -L/opt/kde3/lib' ;;
# esac
# qt-x11-free installs libraries in /opt/kde3/lib
# on both x86_64 and ia32 architectures.

# --with-qt-includes=/opt/kde3/include \
# --with-qt-libraries=/opt/kde3/lib \

# LDFLAGS -L/opt/kde3/lib is required
 export LDFLAGS+=' -L/opt/kde3/lib'
 ./configure     \
 --enable-pch    \
 --with-xinerama \
 --disable-debug \
 --enable-final  \
 $OPTS           &&
 make            &&
 prepare_install && mkdir -p /opt/kde3 &&
 make    install
}

bindings_build(){
 cd       dcoppython/lib
 unexpand pydcop.py  >  pydcop.py.new
 mv       pydcop.py.new pydcop.py
 cd -
 kde_build
}

build(){
 case $SPELL in
  kdebindings) bindings_build ;;
       kde-v3) default_build ;;
            *) kde_build ;;
 esac
}

case $SPELL in
    kde-v3) : ;;
 kde-i18n*) unset REQ
            CATEGORY='documentation/i18n'
              SOURCE="stable/${VERSION}/src/kde-i18n/$SPELL-$VERSION.tar.bz2"
                DESC="$SPELL provides translated KDE messages." ;;
         *) unset  REQ
            SOURCE="stable/${VERSION}/src/${SPELL%-v3}-$VERSION.tar.bz2" ;;
esac
