# fdutils no longer compiles

   version stable 5.5 5.4
#  require e2fsprogs teTeX
   require e2fsprogs texlive
  optional texinfo '' '' for documentation
  category disk
 attribute console
 attribute broke
    source http://fdutils.linux.lu/fdutils-$VERSION.tar.gz
      vurl http://fdutils.linux.lu/download.html
      info home  http://fdutils.linux.lu/
      info mail  http://fdutils.linux.lu/mailing.html
      info docs  http://fdutils.linux.lu/Fdutils.html
      desc 'floppy disk formatting utilities

superformat	formats high capacity disks of (up to 1992k for high
		density disks or up to 3984k for extra density disks)
fdmount		automatically mounts/unmounts disks when they
		are inserted/removed.
xdfcopy		formats, reads and writes OS/2 XDF disks.
MAKEFLOPPIES	creates the floppy devices in /dev
getfdprm	prints the current disk geometry (number of sectors,
		track and heads etc)
setfdprm	sets the current disk geometry
fdrawcmd	sends raw commands to the floppy driver
floppycontrol	configure the floppy driver'


build(){
 sed_source(){
  grep  -rl '#include <linux/fd.h>' * |
  while read
  do    sed -i '\,#include <linux/fd.h>,i#include <linux/compiler.h>' $REPLY
  done
  sed -i 's:#include <linux/ext2_fs.h>:#include <ext2fs/ext2fs.h>:' src/fdmount.c
 }

 header_patch(){
  case $VERSION in
   5.[4-5]) sed_source ;;
  esac
 }


 header_patch

 if ! spell_installed texinfo; then
  sed -i 's/comp-doc//'    Makefile.in
  sed -i 's/install-doc//' Makefile.in
 fi

 OPTS+=" --prefix=$DESTDIR/usr"
 default_build
}
