# Template for ethernet statically configured network connection.

INTERFACE=eth0			# Required
IP=				# Required in the format ip/netmask (ex 192.168.0.1/24 
GATEWAY=			# Good idea
BROADCAST=			# Optional
MODULE=				# Optional


IPV6=     # Optional
IPV6_GATEWAY=     # Optional

verify_connection()  {
  carrier()  {
    local  REPLY
    read < /sys/class/net/$INTERFACE/carrier 2>/dev/null
    (( REPLY == 1 ))
  }

  local     TIMEOUT=$SECONDS
         (( TIMEOUT += 10 ))
  while  (( TIMEOUT > SECONDS ))  &&
         !  carrier
  do     sleep 0.1
  done

  carrier  
}

start()  {


  [  -n  "$MODULE"     ]  &&  modprobe  "$MODULE"

  IP_CMD="ip addr replace $IP "
  [  -n  "$BROADCAST"  ]  &&  IP_CMD="$IP_CMD broadcast $BROADCAST "
  IP_CMD="$IP_CMD dev $INTERFACE"

  $IP_CMD

  [  -n  "$GATEWAY"    ]  &&  ip route add to default via $GATEWAY

  [ -n "$IPV6" ]  && ip -6 addr replace $IPV6 dev $INTERFACE
  [ -n "$IPV6_GATEWAY" ] && ip -6 route add to default via $IPV6_GATEWAY
  
  ip link set $INTERFACE  up
  verify_connection
}

stop()  {  ip link set $INTERFACE  down;  }

$1
