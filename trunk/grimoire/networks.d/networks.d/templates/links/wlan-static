# Template for wireless statically configured network connection.


INTERFACE="wlan0"		# Required, might also be wifi0, eth1, ra0, ...
KEY=				# Optional
MODE="Managed"			# Required
ESSID="any"			# Required
AP=				# Optional address of the Access Point

IP=				# Required in format ip/netmask for example 192.168.0.1/24
IPV6=     # Optional
IPV6_GATEWAY=  # Optional
GATEWAY=			# Good idea
BROADCAST=			# Optional
MODULE=				# Optional

verify_connection()  {
  carrier()  {
    local  REPLY
    read < /sys/class/net/$INTERFACE/carrier 2>/dev/null
    (( REPLY == 1 ))
  }

  local     TIMEOUT=$SECONDS
         (( TIMEOUT += 10 ))
  while  (( TIMEOUT > SECONDS ))  &&
         !  carrier
  do     sleep 0.1
  done

  carrier  
}

start()  {
  [  -n  "$MODULE"     ]  &&  modprobe  "$MODULE"

                              iwconfig $INTERFACE mode  "$MODE"
  [  -n  "$KEY"        ]  &&  iwconfig $INTERFACE key   "$KEY"	\
                          ||  iwconfig $INTERFACE key   off
  [  -n  "$ESSID"      ]  &&  iwconfig $INTERFACE essid "$ESSID"  \
                          ||  iwconfig $INTERFACE essid any
  [  -n  "$AP"         ]  &&  iwconfig $INTERFACE ap    "$AP"	\
                          ||  iwconfig $INTERFACE ap    off

  IP_CMD="ip addr replace $IP "
  [  -n  "$BROADCAST"  ]  &&  IP_CMD="$IP_CMD broadcast $BROADCAST "
  IP_CMD="$IP_CMD dev $INTERFACE"

  $IP_CMD
 
  [  -n  "$GATEWAY"    ]  &&  ip route add to default via $GATEWAY

  [ -n "$IPV6" ] && ip -6 addr replace $IP dev $INTERFACE
  [  -n  "$IPV6_GATEWAY"    ]  &&  ip -6 route add to default via $IPV6_GATEWAY

  ip link set $INTERFACE  up
  verify_connection
}

stop()  {  ip link set $INTERFACE  down;  }

$1
