# Template for ethernet PPPoE configured network connection.
# PPPoE is also used for ADSL in somme places.

INTERFACE=eth0			# Required
MODULE=				# Optional

verify_connection()  {
  carrier()  {
    local  REPLY
    read < /sys/class/net/$INTERFACE/carrier 2>/dev/null
    (( REPLY == 1 ))
  }

  local     TIMEOUT=$SECONDS
         (( TIMEOUT += 10 ))
  while  (( TIMEOUT > SECONDS ))  &&
         !  carrier
  do     sleep 0.1
  done

  carrier     
}

start()  {
  [  -n  "$MODULE"  ]  &&  modprobe  "$MODULE"

  if    [  -f  /usr/sbin/pppoe-start  ]
  then         /usr/sbin/pppoe-start
  else  false
  fi  &&

  verify_connection
}

stop()  {
  if    [  -f  /usr/sbin/pppoe-stop  ]
  then         /usr/sbin/pppoe-stop
  fi
}

$1
