# Template for dial up PPP configured network connection.

# No variables or telephone numbers are stored here.
# Please configure either wvdial or dial2net.
# To configure wvdial    execute: wvdialconf then edit /etc/wvdial.conf
# To configure dial2net  execute: dial2net -s


restore_resolv_conf()  {
  if    [    -f  /etc/resolv.conf.${0##*/}  ]
  then  cmp  -s  /etc/resolv.conf.${0##*/}  /etc/resolv.conf  ||
        cp       /etc/resolv.conf.${0##*/}  /etc/resolv.conf
  fi
}

test_dns() {
  local  NS=$(  grep   "nameserver"  /etc/resolv.conf  |
                sed  "s/nameserver//"  )
  if    [  -n  "$NS"  ]  &&
        which  nmap  &>/dev/null
  then         nmap  -n  -p 53  $NS  |  grep  -q  "open.*domain"
  fi
}

verify_connection()  {
  if    [  -d  /sys/class/net/$INTERFACE  ]
  then  restore_resolv_conf
        test_dns
  else  false
  fi
}

start()  {
  if    [  -x  /usr/bin/wvdial    ];  then  /usr/bin/wvdial &
  elif  [  -x  /usr/bin/dial2net  ];  then  /usr/bin/dial2net -a &
  else  false
  fi
  # unlike other network connections
  # network connectivity verification is not done for ppp
}

stop()  {
  if    [  -x  /usr/bin/wvdial    ];  then  pkill -15  "^wvdial$"
  elif  [  -x  /usr/bin/dial2net  ];  then  /usr/bin/dial2net -d
  else  false
  fi
}

$1
