   VERSION=( "0.53.2" "0.53.1" "0.53.0" "0.52.2" "0.52.1" "0.52.0" "0.51.0" )
      SAFE=( "0.53.2" )
    IGNORE="imap\|2002\|admin\|authlib"
  CATEGORY="network/email"
 ATTRIBUTE="client console server"
    SOURCE="courier/courier-$VERSION.tar.bz2"
       URL="$SOURCEFORGE_URL"
# May require client daemon support pop3 pop3s imap imaps, etc...
# added to courier.d/courier it's startup script.
       REQ=( "autoconf automake courier-authlib db docbook-dtd fam gettext openjade pcre perl"
             "ispell::--without-ispell:for spell checking"
             "openldap:::for ldap address book"
             "openssl:::for pop3s and imaps servers" )
  EPROVIDE="mail-transport-agent"
   PROVIDE="email-client pop3 pop3s imap imaps"
  HOMEPAGE="http://www.courier-mta.org"
  ESTIMATE="1400"
      DESC="courier contains SMTP, IMAP, POP3, IMAPS, and POP3S servers.
courier mail transfer agent (MTA) is an integrated
mail/groupware server based on open commodity protocols
such as ESMTP, IMAP, POP3, LDAP, SSL, and HTTP.
Courier provides ESMTP, IMAP, POP3, Webmail, and mailing
list services within a single consistent framework.
Individual components can be enabled or disabled at will.
Courier implements basic Web-based calendaring and scheduling
services integrated in the Webmail module."

build() {
   sed  -i  's:rootcheck="$withval":rootcheck="$enableval":'  configure

   ./configure                         \
   --prefix=/usr                       \
   --localstatedir=/var/state/courier  \
   --sysconfdir=/etc/courier           \
   --disable-root-check                \
   $OPTS                               &&
  make                                 &&
  prepare_install                      &&
  make    install                      &&
  make    install-configure
}

post_install() {
  default_post_install
  makealiases
  makesmtpaccess
  makesmtpaccess-msa

  if     !  [  -d     /etc/skel/Maildir  ]
  then   maildirmake  /etc/skel/Maildir
  fi

 ( cd  /home  &&
   for  WHO  in  *;  do
     if    !  [   -d        $WHO/Maildir  ]
     then  maildirmake      $WHO/Maildir
           chown  -R  $WHO  $WHO/Maildir
     fi
   done )

  if    !  [  -f       /etc/courier/hosteddomains  ];  then
    cp  /etc/hostname  /etc/courier/hosteddomains
                                makehosteddomains
  fi

  if  [  -x  /usr/bin/openssl  ];  then
    if  !  [  -f  /usr/share/esmtpd.pem  ];  then  mkesmtpdcert;  fi
    if  !  [  -f  /usr/share/pop3d.pem   ];  then  mkpop3dcert;   fi
    if  !  [  -f  /usr/share/imapd.pem   ];  then  mkimapdcert;   fi
  fi
}
