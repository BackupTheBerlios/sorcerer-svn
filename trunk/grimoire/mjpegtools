# has some annoying not easily disabled rpath support.


# With version 1.8.0
# /bin/sh ../libtool --tag=CXX --mode=link g++  -march=pentium3 -mno-sse2 -mtune=pentium3  -march=native -O -pthread   -Wl,-s -o mplex  main.o ../mplex/libmplex2.la -lm   -lm
# g++ -march=pentium3 -mno-sse2 -mtune=pentium3 -march=native -O -pthread -Wl,-s -o .libs/mplex main.o  ../mplex/.libs/libmplex2.so /usr/src/sorcery/mjpegtools/mjpegtools-1.8.0/utils/.libs/libmjpegutils.so /usr/lib/libstdc++.so -lm
# ../mplex/.libs/libmplex2.so: undefined reference to `PS_Stream::PS_Stream(unsigned int, unsigned int, OutputStream&, long)'
# collect2: ld returned 1 exit status
# make[2]: *** [mplex] Error 1
# make[2]: Leaving directory `/usr/src/sorcery/mjpegtools/mjpegtools-1.8.0/mplex'

# where is the 2.12.0 version comming from?

# Neither 1.9.0rc3 nor 1.8.0 are compiling at the moment.
# stable 1.9.0rc3 1.8.0 1.6.2 1.6.1

# 1.8.0 does not compile
# Therefore, switching to 1.9.0rc4

# lpcmstrm_in.cpp:56: error: invalid conversion from ‘const char*’ to ‘char*’
# has deprecated syntax in source and does not compile


   version stable 1.9.0 1.9.0rc4
   version unstable 2.0.0rc1
   require SDL_gfx gtk+-v1.2 libdv libquicktime
      opts --enable-static=no
  category video
 attribute library x11
 attribute broke
    source $SOURCEFORGE_URL mjpeg/mjpegtools/$VERSION/mjpegtools-$VERSION.tar.gz
  homepage http://mjpeg.sourceforge.net
##      opts --without-quicktime
# Selecting no to optional requirements breaks compilation of 
# mjpegtools 1.6.1
#   'libdv::--without-dv:for Quasar video codec'
  estimate 1400
      desc 'video record and playback tools and library
The mjpeg programs are a set of tools that can do
recording of videos and playback, simple cut-and-paste
editing and the MPEG compression of audio and video under Linux.

Recording is supported for the Zoran based cards
like the Buz (Iomega), DC10 (MIRO, Pinnacle),
Matrox Marvel cards and the LML33 (Linux Media Labs).
The recorded videos can be converted to MPEG streams.
The software playback of MPEG streams works
with almost every player and every OS.
You can produce special forms of MPEG streams
like VCD (Video CD) and SVCD for hardware playback.'

build(){
 case $VERSION in
 1.9.0rc3)
         sed -i '1i#include <climits>' mpeg2enc/macroblock.cc 
         sed -i '1i#include <stdlib.h>' mpeg2enc/encodertypes.h
         sed -i '1i#include <climits>' mpeg2enc/picturereader.cc
         sed -i '1i#include <climits>' mplex/inputstrm.cpp
         sed -i '1i#include <cstring>' mplex/multiplexor.cpp
         sed -i '1i#include <cstring>' mplex/padstrm.cpp
         sed -i '1i#include <cstring>' mplex/main.cpp
         ;;
 esac
 if   [[ $HOSTTYPE == x86_64 ]] && ! [[ $CFLAGS =~ -m32 ]]
 then opts --x-libraries=/usr/lib64
 else opts --x-libraries=/usr/lib
 fi
 default_build
}
