# libgnutls-config removed used pkg-config instead to check for gnutls
# 3.0.0 failed compilation
# 3.x series is xz compressed
# info page generation can fail when multilib-concurrent
# 3.0.7 is alo a security fix for when 3.0.x becomes usable

# 3.0.12 failed compilation

   version   stable 3.0.11 3.0.10 3.0.9 3.0.8
   version unstable 3.0.12
   version   secure 3.0.8
case $VERSION in
 2.12.*)
      opts --disable-guile ;;
 2.10.*)
      opts --disable-guile ;;
esac
   require guile libcfg+ libgcrypt libtasn1 ncurses nettle p11-kit pkgconfig readline zlib
  optional gcc-g++
  optional lzo2 --with-lzo
      opts --enable-static=no --disable-rpath
  category security/encryption
 attribute library makej multilib-dual setarch
#attribute multilib-concurrent
    source $GNU_URL gnutls/gnutls-$VERSION.tar.xz
      info last 20120131
      info home http://www.gnu.org/software/gnutls/
      info docs http://www.gnu.org/software/gnutls/documentation.html
      info mail http://www.gnu.org/software/gnutls/lists.html
      desc 'library for SSL
gnutls is the GNU Transport Layer Security Library
is a library which implements a secure layer over
a reliable transport layer such as TCP/IP.
It implements the TLS 1.0 and SSL 3.0 protocols'

build(){
 sed -i 's:hardcode_into_libs=yes:hardcode_into_libs=no:' configure
 default_build &&
 sed -i 's:, zlib::; s:-lgmp:-lgmp -lz:' $DESTDIR/usr/lib*/pkgconfig/gnutls.pc
}

current(){
 case $VERSION in
  2.12.7)
   if             [ -f /usr/lib64/pkgconfig/gnutls.pc ]
   then ! grep -q zlib /usr/lib64/pkgconfig/gnutls.pc
   elif           [ -f   /usr/lib/pkgconfig/gnutls.pc ]
   then ! grep -q zlib   /usr/lib/pkgconfig/gnutls.pc
   fi ;;
 esac
}
