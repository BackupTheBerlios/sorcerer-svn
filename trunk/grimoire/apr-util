# This really weird spell strips -m32 somehow.
# this also defies the instruction to install into lib64 directories

# httpd requires apr-util with openldap support
# might link with sqlite-v2.8 if it installed

   version stable 1.3.11 1.3.10 1.3.9
   require apr db expat openldap
  optional unixODBC   --with-odbc
  optional postgresql --with-pgsql
  optional mysql      --with-mysql
  optional sqlite     --with-sqlite3
      opts --with-berkeley-db --with-ldap
#     opts --with-berkeley-db --with-expat --with-ldap
#     opts --with-apr=/usr/bin --with-berkeley-db --with-expat=/usr --with-ldap

# 1.3.9 does not recognize --enable-static=no
#     opts --enable-static=no --with-apr=/usr/bin --with-berkeley-db --with-expat=/usr --with-ldap
  category network/web
 attribute console library makej server
 attribute multilib-fail
# it strips off the -m32
    source $APACHE_URL apr/apr-util-$VERSION.tar.bz2
      info last  20110508
      info home  http://apr.apache.org/
  estimate 300
      desc 'helpful abstractions on top of apache portable runtime'

build(){
 if   [[ $HOSTTYPE == x86_64 ]]; then
  if  [[ $CFLAGS =~ -m32 ]]
  then opts --with-apr=/usr/bin32/apr-1-config
  else opts --with-apr=/usr/bin/apr-1-config
  fi
 else  opts --with-apr=/usr/bin/apr-1-config
 fi

 # oddly it must explicitly be told this instead of using /usr/share/config.site
 if   [[ $HOSTTYPE == x86_64 ]] && ! [[ $CFLAGS =~ -m32 ]]
 then opts --libdir=/usr/lib64
 else opts --libdir=/usr/lib
 fi

 sed -i 's:DB_VER 3:DB_VER 4:
         s:DB_VER 2:DB_VER 4:
         s:DB_VER 1:DB_VER 4:' dbm/apr_dbm_berkeleydb.c
 default_build
}
