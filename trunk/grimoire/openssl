# openssl 1.0.0a is a security release.
# Problems compiling heimdal version 1.3.2 and 1.2.1 with openssl version 1.0.0
   version stable 1.0.0d 1.0.0c
   version secure 1.0.0d 1.0.0c
   require perl pkgconfig
  category security/encryption
 attribute library multilib-dual
#attribute makej
    source http://www.openssl.org/source/\
            ftp://ftp.openssl.org/source/ \
            ftp://sunsite.cnlab-switch.ch/mirror/openssl/source/ \
            ftp://ftp.funet.fi/pub/crypt/cryptography/libs/openssl/source/ \
            ftp://ftp.pca.dfn.de/pub/tools/net/openssl/source/ \
            ftp://ftp.webmonster.de/pub/openssl/source/ \
            ftp://opensores.thebunker.net/pub/mirrors/openssl/source/ \
            ftp://ftp.net.lut.ac.uk/openssl/source/ \
            ftp://ftp.mirror.ac.uk/sites/ftp.openssl.org/source/ \
            ftp://sunsite.uio.no/pub/security/openssl/source/ \
            ftp://ftp.sunet.se/pub/security/tools/net/openssl/source/ \
            ftp://ftp.chl.chalmers.se/pub/unix/security/openssl/source/ \
            ftp://ftp.psy.uq.edu.au/pub/Crypto/OpenSSL/ \
            ftp://gd.tuwien.ac.at/infosys/security/openssl/source/ \
            ftp://guest.kuria.katowice.pl/pub/openssl/source/ \
            ftp://ftp.infoscience.co.jp/pub/Crypto/SSL/openssl/source/ \
            ftp://ftp.happysize.co.jp/mirror/openssl/source/ \
            ftp://ftp.elab.co.za/support/openssl/source/ \
            ftp://ftp.directnet.ru/pub/openssl/source/ \
            ftp://ftp.linux.hr/pub/openssl/source/ \
            ftp://ftp.openssl.uli.it/source/ \
            ftp://ftp.grmbl.com/pub/openssl/source/ \
            ftp://ftp.gin.cz/pub/MIRRORS/ftp.openssl.org/source/ \
            ftp://ftp.calyx.nl/pub/openssl/source/ \
            ftp://ftp.duth.gr/pub/OpenSSL/source/ \
            ftp://ftp.si.uniovi.es/mirror/OpenSSL/source/ \
            openssl-$VERSION.tar.gz
  homepage http://www.openssl.org/
   protect /etc/ssl/certs/
  estimate 6200
      desc 'library for providing encrypted transport layers
The OpenSSL Project is a collaborative effort to develop
a robust, commercial-grade, full-featured, and Open Source
toolkit implementing the Secure Sockets Layer (SSL v2/v3)
and Transport Layer Security (TLS v1) protocols as well
as a full-strength general purpose cryptography library.'

build(){
 remove_ar(){ rm -f $DESTDIR/usr/lib{,64}/lib{crypto,ssl}.a; }

 local OS=linux-elf

 grep  -rl                       '\-O3 -Wall' * |
 xargs -r --max-lines=64 sed -i "s:-O3 -Wall:$CFLAGS:"
 grep  -rl                       '\-O3 -fomit-frame-pointer -Wall' * |
 xargs -r --max-lines=64 sed -i "s:-O3 -fomit-frame-pointer -Wall:$CFLAGS:"

 sed -i 's:-Wl,-rpath,$(LIBRPATH)::' Makefile.shared

 if   [[ $HOSTTYPE == x86_64 ]]; then
  if  [[ $CFLAGS   =~ -m32   ]];
  then OS="linux-generic32"
  else OS="linux-x86_64"
  fi
 else  OS="linux-elf"
 fi

 ./Configure --prefix=/usr --openssldir=/etc/ssl shared $OPTS $OS &&
 make &&
 rm -f $DESTDIR/usr/man/man3/EVP_BytesToKey.3 &&
 make install MANDIR=/usr/man INSTALL_PREFIX=$DESTDIR &&
 remove_ar
}


post_install(){
          get_provider ntp     |
 pipe     get_provider openssh |
 pipe     show_installed       |
 LC_ALL=C sort                 |
          uniq -d              |
          pipe_queue $CAST_QUEUE com
}
