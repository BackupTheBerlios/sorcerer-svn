   VERSION=( "1.1.3" "1.1.2" "1.1.1" "1.1.0" "1.01" "1.00" )
    IGNORE="pre\|rc\|1\.0"
  CATEGORY="utility/shell"
 ATTRIBUTE="console"
    SOURCE="busybox-$VERSION.tar.bz2"
       URL="http://www.busybox.net/downloads/"
  HOMEPAGE="http://www.busybox.net"
 FRESHMEAT="busybox"
  ESTIMATE="775"
      DESC="busybox is a tiny rescue shell.
busybox combines tiny versions of many common
UNIX utilities into a single small executable.
It provides minimalist replacements for most
of the utilities you usually find in GNU
fileutils, shellutils, etc."


configure()  {
  local  CUR="$CONFIG_LOGS/$SPELL/busybox-config"
  local  OLD="$CONFIG_LOGS/$SPELL/busybox-config.old"

  if      !  [  -f  $CUR  ];  then
    if    !  sources_cached;  then
      echo  "Sources must be download before configuration."
      leech  -w  $SPELL
    fi
    pre_build                    &&
    optimize                     &&
    copy       "$OLD"   .config  &&
    make       menuconfig        &&
    cp         .config  $CUR
    if    [   -n   "$BUILD_DIR"  ]  &&
          [   -d   "$BUILD_DIR"  ]
    then  rm  -fr  "$BUILD_DIR"
    fi
  fi
}


build()  {

  restore_busybox_configs()  {
    local  CUR="$CONFIG_LOGS/$SPELL/busybox-config"
    local  OLD="$CONFIG_LOGS/$SPELL/busybox-config.old"

    if    [  -f   $CUR  ];  then  cp  $CUR  .config
    elif  [  -f   $OLD  ];  then  cp  $OLD  .config
    fi
  }


  store_config()  {  cp  .config  $CONFIG_LOGS/$SPELL/busybox-config;  }


  compile_and_install()  {
    yes   ""  |  make  oldconfig
    store_config     &&
    make             &&
    prepare_install  &&
    install  -m 0755  busybox  /bin   &&
    mkdir    -p                /bbin  &&
    cd                         /bbin  &&
    busybox  --help    |
    tail  -n  +12      |
    tr    -d  ' \t\n'  |
    tr        ',' '\n' |
    while  read
    do     [  -e               "$REPLY"  ]  ||
           ln     /bin/busybox "$REPLY"
    done
  }

  restore_busybox_configs
  compile_and_install
}
