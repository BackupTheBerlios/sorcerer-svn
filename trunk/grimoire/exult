    stable 1.2 1.1.10rc2 1.1.9rc1 1.1beta3 1.1beta2 1.1Beta1 1.00
   require SDL_mixer flex unzip
  category game development/emulator
 attribute x11
       url $SOURCEFORGE_URL
    source exult/exult-$VERSION.tar.gz
    source exult/jmsfx.zip
    source exult/jmsfxsi.zip
    source exult/U7MusicOGG_1of2.zip
    source exult/U7MusicOGG_2of2.zip
  homepage http://exult.sourceforge.net
case $VERSION in
 1.2) use_gcc gcc-v3.4 ;;
esac
  estimate 700
      desc 'exult is an open-source game engine for playing Ultima7
If you do not own Ultima 7 this engine will be of no use to you.
For sound & midi to work
shutdown all other sound servers
and run esd before starting exult.'

build(){
sed  -i  's:"playmidi","-v","-v","-e":"playmus","playmus","-r","48000":'  \
     audio/midi_drivers/forked_player.cc

# sed  -i  's:"playmidi","-v","-v","-e":"playmus","playmus","-r","44100":'  \
#      audio/midi_drivers/forked_player.cc

export  LDFLAGS="$LDFLAGS -lX11"

./configure           \
--prefix=/usr         \
--sysconfdir=/etc     \
--localstatedir=/var  \
--disable-timidity    \
$OPTS                 &&
make                  &&
prepare_install       &&
make    install       &&
cp      $SCRIPT_DIR/exult.cfg  /usr/share/exult  &&
cp      sfx/jmsfx.flx          /usr/share/exult  &&
cp      sfx/jmsisfx.flx        /usr/share/exult  &&
cp  -a  music                  /usr/share/exult
}

pre_build() {
 default_pre_build
 unpack  ${SOURCE[0]}    &&
 mkdir   $BUILD_DIR/sfx  &&
 cd      $BUILD_DIR/sfx  &&
 unpack  ${SOURCE[1]}    &&
 unpack  ${SOURCE[2]}    &&
 cd      ..              &&
 mkdir   music           &&
 cd      music           &&
 unpack  ${SOURCE[3]}    &&
 unpack  ${SOURCE[4]}
 cd      ..
}

post_install() {
cat  <<  EOF
When you are ready to play, copy /usr/share/exult.cfg to ~/.exult.cfg.
Make appropriate modifications and install the gamedata files and enjoy.
Note:  You may also have to start esd, enlightenment sound daemon, in
order to get sound and music.  And if you don't own Ultima 7, then exult
will be of no use to you.
EOF
}
