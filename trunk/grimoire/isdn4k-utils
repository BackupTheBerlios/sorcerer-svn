# This spell might be of no use since
# the kernel is compiled without ISDN support.

# Does anyone use this?
# isdn4k-utils.v3.2p1.tar.bz2  	5116 KB  	08/01/2002  	12:00:00 AM
# No new source releases since 2002
# Probably does not compile with current versions of gcc.
# Is isdn4k-utils even usable anymore?


# capi20 has libtool created fork bomb.
# capifax  has compile error
# capiinfo has compile error
# capiinit has compile error
# act2000  has compile error
# eicon    has compile error
# ipppd    has compile error
# isdnlog  has compile error
# isdnlog/client has compile error
# now assuming all of isdnlog/* fails or would be useless alone
# rcapid   has compile error
# hisax    has install error
# vbox     installs improperly

with info    omit 20140101
with info    good 20130827
with info    last 20020801
with version stable v3.2p1 v3.1pre1
#with elect   linuxdoc-tools --with-FAQ  '' frequently asked questions about isdn4linux
#with elect   tcl            --with-vbox '' answering machine/voice mailbox

# with switch    --with-act2000 '' setup utility for the act2000 driver
with switch    --with-avmb1 '' setup utility for the avmb1 driver
# with switch    --with-capi20 '' needed by rcapid
# with switch    --with-capifax ''  faxing via capi
# with switch    --with-capiinfo '' needed by rcapid
# with switch    --with-capiinit '' needed by avmb1
with switch    --with-divertctrl '' setup utility for dss1 diversion services
# with switch    --with-doc '' documentation for isdn4linux
# with switch    --with-eicon '' setup utility for the eicon driver
with switch    --with-eurofile '' implementation of eurofile transfer protocol
# with switch    --with-hisax '' setup utility for the HiSax driver
with switch    --with-icn '' setup utility for the icn driver
with switch    --with-imon '' ncurses based utility for monitoring ISDN-activities
# with switch    --with-ipppd '' daemon need for syncPPP and MPP
with switch    --with-ipppstats '' utility for showing syncPPP statistics
with switch    --with-iprofd '' "daemon for realizing AT&W0 on ttyI"
with switch    --with-isdnctrl '' general link-level setup utility
# with switch    --with-isdnlog '' set of utilities for connection logging
# with switch    --with-isdnlog/client '' for use with isdnlog
# with switch    --with-isdnlog/tools/cdb '' for use with isdnlog
# with switch    --with-isdnlog/tools/dest '' for use with isdnlog
# with switch    --with-isdnlog/tools/telrate '' for use with isdnlog
# with switch    --with-isdnlog/tools/zone '' for use with isdnlog
with switch    --with-loop '' tools for the loopback isdn device
with switch    --with-pcbit '' setup utility for the pcbit driver
# with switch    --with-rcapid '' remote CAPI server for use with avmb1 cards

with role    network
with trait   console
with source  stable \
             ftp://ftp.isdn4linux.de/pub/isdn4linux/ \
             ftp://ftp.gwdg.de/pub/linux/isdn/isdn4linux/ \
             ftp://ftp.cs.tu-berlin.de/pub/net/isdn/isdn4linux/ \
             ftp://ftp.leo.org/pub/comp/os/unix/linux/isdn/isdn4linux/ \
             ftp://linux.mathematik.tu-darmstadt.de/pub/linux/mirrors/misc/isdn4linux/ \
             utils/isdn4k-utils.$VERSION.tar.bz2
with info    home http://www.melware.org/Isdn4Linux/
# with info    home http://www.isdn4linux.org/
with info    mail http://listserv.isdn4linux.de/pipermail/isdn4linux/
with info    cite 'utilitiles to make use of ISDN specific features
isdn4linux is a set of kernel modules which are part of the Linux kernel.
It consists of the main module isdn and the actual hardware driver that
control some specific card.In addition, the package isdn4k-utils
contains utilities to make use of ISDN specific features.

The source is so old and broke it might not be of any use.'


configure_old(){
 local CUR="$CONFIG_LOGS/$SPELL/isdn4k-utils-config"
 local OLD="$CONFIG_LOGS/$SPELL/isdn4k-utils-config.old"

 copy(){ if [[ -f $1 ]]; then cp "$1" "$2"; fi; }

 if  ! [ -f $CUR ]; then
  if ! sources_cached "$SPELL"; then
   echo "Sources must be download before configuration."
   leech -w $SPELL
  fi
  pre_build &&
  optimize  &&
  copy "$OLD" .config &&
  make     menuconfig &&
  cp          .config  $CUR
  if   [  -n  "$BUILD_DIR" ] &&
       [  -d  "$BUILD_DIR" ]
  then rm -fr "$BUILD_DIR"
  fi
  clear
  echo "isdn4k-utils configuration complete."
  cd /tmp
 fi
}

build_old(){
 restore_linux_configs(){
  local CUR="$CONFIG_LOGS/$SPELL/isdn4k-utils-config"
  local OLD="$CONFIG_LOGS/$SPELL/isdn4k-utils-config.old"

  if   [ -f $CUR ]; then cp $CUR .config
  elif [ -f $OLD ]; then cp $OLD .config
  fi
 }

 make_install(){
  yes  "" |
  make subconfig &&
  make           &&
  make install DESTDIR="$DESTDIR"
 }

 restore_linux_configs
 make_install
}


build(){
 ind(){ echo "Entering directory: $PWD/$1"; }

 configure_in(){ ind $1; cd $1; sh ./configure --prefix=/usr    && cd $OLDPWD; }
 make_in(){      ind $1; cd $1; make                            && cd $OLDPWD; }
 install_in(){   ind $1; cd $1; make install DESTDIR="$DESTDIR" && cd $OLDPWD; }


 if   spell_installed $( get_provider tcl ); then
  TCL_VERSION=$( installed_version $( get_provider tcl ) )
  TCL_VERSION="${TCL_VERSION:0:3}"
  sed -i "s:tcl8\.0:tcl$TCL_VERSION:" vbox/configure
 fi

 local DIRS="doc"
 spell_installed linuxdoc-tools && DIRS+=" FAQ"

 for DIR in $OPTS; do DIRS+=" ${DIR/--with-/}";       done
 for DIR in $DIRS; do configure_in $DIR || return 1 ; done &&
 for DIR in $DIRS; do make_in      $DIR || return 1 ; done &&
 install -dvm 755 "$DESTDIR"/{bin,etc,lib,sbin,usr/{bin,lib,sbin}} &&
 for DIR in $DIRS; do install_in   $DIR || return 1 ; done
}
