Sorcerer News for 20030702

Subject:  1. /tmp/sorcery is no longer used.  *Important Must Read*
          2. New Sorcerer Mirror.
          3. Cast remembers what you want.
          4. Wizard gains the ability to abort casts.
          5. RAM and Swap tips.


Data previously stored on /tmp/sorcery are moving to /dev/shm/sorcery

Please edit /etc/fstab and change the line which starts with

shm     /dev/shm

so that it reads:

shm     /dev/shm        shm     defaults,size=256M,nr_inodes=128k 0 0

It seems that POSIX shared memory 
is mostly unused on sorcerer boxes.
However it is a perfectly good tmpfs 
even though it is called shm.

Because there is a bit of confusion surrounding
whether /tmp should be mounted as tmpfs or
whether /tmp/sorcery should be mounted as tmpfs
I have decided that /tmp/sorcery should be moved
to /dev/shm/sorcery

This is how it will appear after the next
sorcery update and how it will appear in 
the next Sorcerer Install/Rescue ISO9660 release.

This change could be made distribution wide automatically.
However I like many other senior level SAs 
prefer to edit /etc/fstab to my liking rather
than have someone else automatically edit it.
Please do this change now instead of waiting for 
strange sorcery related problems to appear.


2. 

David Winchester has contacted pair Networks 
and together have set up another
mirror for sorcerer.  Thanks guys.

Leech uses mirrors automatically and randomly.
Nothing for you to do here but enjoy.
However, if you determine that pair offers 
a faster transfer to your box then you can 
select it as a first try download server 
using the augur prefer command.


3.

Have any spells that should always be selected
as on or off when offered as an optional requirement?
Answer an optional requirement question with 
an upper case letter and cast will remember and 
use that selection automatically in the future
for any optional requirements on that spell.

My always.on optional spell selections are:
jpeg libpng openssl and tiff.

And my always.off optional spell selections are:
gpm and svgalib.

Therefore, I will not receive questions about
using jpeg, libpng, openssl, tiff, gpm, and 
svgalib as optional requirements.
Cast already knows whether I want them or not.

An always off selection is similar to an exiled spell, 
except that if the spell is a mandatory requirement 
instead of an optional requirement then it will be installed.
This ensures that the spell being cast will 
not fail due to an un-installed requirement.
Augur can undo previous selections for 
spells that are always on and always off.


4.

Most SAs know that casts can be aborted 
using ctrl-c, however timing is important.
Aborting cast at an untimely moment
can lead to untracked files and directories, 
partially installed spells, partially 
un-installed spells, core executables
and or libraries missing, and a box that 
may refuse logins or fail to boot.

Due to the above considerations new commands 
have been added to the wizard menu.
W commands wizard to tell all waiting spells to abort.
A commands wizard to tell all waiting and casting spells to abort.

Spells aborted in this manner may leave open source trees
in /usr/src/sorcery which should be removed by the SA.
It is similar to pressing ctrl-c except that it ensures 
that cast is not aborted when it could cause a problem.
Therefore, use it instead of ctrl-c to abort cast.

A better option than aborting casts is usually to 
reduce the cast rate to 1 to free more system resources.
Reducing the cast rate to 0 will stop new spell from
beginning to cast when the spells currently being 
cast finish.  This is about as close as we come to
being able to pause compilation on a sorcerer box.


5.

Here are some tips for managing resources while casting.
Having a cast rate too high will degrade performance.
Casting a single spell  uses 25 or more processes and plenty  of memory.
Casting multiple spells uses 50 or more processes and additional memory.
A cast rate of 3 is good on single processor systems with adequate RAM.
A cast rate of 1 or 2 is recommended on older boxes or low RAM systems.
For each additional box in the compile cluster add +2 to the cast rate.
For each additional CPU in a box add +1 to the cast rate.

Running a box out of memory may cause a lockup.
Have sufficient SWAP space to cover mounted tmpfs partitions.
From the wizard menu pressing m twice will give a 
nice easy to read display of the memory situation.
If Swap is nearly used up with few free megabytes
then reduce the cast rate and add additional swap space.
To avoid lockups caused by insufficient RAM+SWAP many
Sorcerer SAs cast swapd for dynamic swap file creation
and allocation daemon.
