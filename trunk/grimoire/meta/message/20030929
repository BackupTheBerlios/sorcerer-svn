Sorcerer News for 20030929

Subject:  Approaching the limits!

These new rate limiters have been long on my to do list.
However they are now on my done list.
I hope you enjoy them.

Concurrent casting can now be limited in 3 additional
ways in conjunction with the CAST_RATE variable.

If any of the following three conditions are met then 
wizard will hold off starting the next cast even 
if the amount of spells casting has not yet reached 
CAST_LIMIT.

1.  If the available memory including 
    available swap is less than LOW_MEMORY

2.  If the maximum percentage of space 
    in use on /usr/src/sorcery
    exceeds MAXIMUM_DU 

3.  If the system load average exceeds MAXIMUM_LOAD

If any of the above 3 conditions happen then wizard
will delay beginning the next cast until the 
condition is no longer met or no spells are casting.

The default values for those variables are:

LOW_MEMORY=67108864
MAXIMUM_DU=50
MAXIMUM_LOAD=5

To help avert some questions I have provided a small Q&A FAQ below.

Q: I do not mount tmpfs on /usr/src/sorcery.
   Do I need to set MAXIMUM_DU higher?

A: If nothing is mounted on /usr/src/sorcery 
   then MAXIMUM_DU does not apply.
   wizard does not monitor available disk 
   space on / or any other partitions.
   Run them out of space at your own risk.


Q: Wizard appear to be displaying percentage of 
   used disk space for / instead of /usr/src/sorcery?

A: Since nothing is mounted on /usr/src/sorcery 
   wizard displays percentage of used disk space 
   for whatever partition that holds /usr/src/sorcery
   However it does not limit casts even if available


Q: Maximum DU is 50% of what?

A: 50% of 2 Gigabytes if the tmpfs on /usr/src/sorcery is 2GB.
   Therefore, when 1 GB is exceeded no new spells will begin
   casting concurrently, because memory and or swap space may
   become insufficient.


Q: How many bytes is 67108864?  Is it enough?

A: It is about 64M.  Yes that may be too small.
   It is set low in respect to minimal system requirements
   such as those SAs running sorcerer on 64M systems.
   Some where between 1/2 and 1/4 of installed RAM on 
   sufficiently equipped boxes is recommended.


Q:  Will I still be able to cast large spells like mozilla?

A:  Yes, but as memory and or swap becomes scarce no new
    casts will be started concurrently with running casts.
    By request, because mozilla source tree and ccache use
    up so much space, mozilla was made a solo spell.
    Nothing else should cast concurrently with a solo spell.


Q:  Why all these different and complex methods 
    for limiting concurrent casts?

A:  Some SAs like to run their box right on the edge of
    it's available resource limits especially when the
    box has generous RAM and SWAP and multi-processors.
    These additional limiters will help keep SAs from
    tipping their tweaked out power-monging boxes over
    the edge.


Q:  I use distcc.  What effect will these limiters have?

A:  You may not reach maximum load or low  memory constraints.
    Even though compilation happens on other boxes producing
    load over there, source trees and ccaches are kept in the
    /usr/src/sorcery of the box casting the spell, and therefore
    in most respects these additional limiters do apply.


Q:  I do updates nightly on cronjobs.
    How will this effect nightly updates?

A:  Updates done by cronjob, at job, or in 
    any detached manner do not use wizard.
    Casting of spells will proceed in 
    proper order sequentially.


Q:  How do I change these values?

A:  /usr/sbin/sorcery
    Option -> Rates
    Features that set a size, rate, value, limiter and so forth
    are available for setting on the Rate menu.
    Features that are toggled on or off available on the feature menu.


Q:  Are rates features?

A:  No.  But they are functional, so do tune them on your box.
    The better you tune them the better sorcery, cast, leech, 
    heal, and dispel will work on your box.
    The default configuration helps preserve disk space,
    but not maximally.
    Tuning the rates and features can enable better performance
    at the cost of increased disk space and resource consumption,
    or lesser performance at a reduced cost of disk space and
    resources.


Q:  I am bewildered by the vast amount of features 
    and rates that are available for configuration.
    Is there not some automatic profile to choose?

A:  Definitely not.
    Almost any variable that can be 
    adjustable is adjustable by the SA.
    Reading the wiki, documentation, and fan
    sites may help provide you with clues as
    to how other sorcerers are maximizing
    performance and minimizing disk space.
    If you do not have a clear idea of what
    a variable controls then I recommend 
    that you not deviate far from the default
    value specified in /etc/sorcery/config
    Good luck.
