Sorcerer News for 20030411

Subject:  Compile faster,
          use less memory, and
          use less disk space.

It is now possible to enjoy the benefits of ccache
without having /root/.ccache grow like it is on steroids.
It's the next best modification to being able to 
eat buckets of candy without gaining a tummy ache.

/root/.ccache is no longer used for storing cached object files.
Individual directories like /tmp/sorcery/cast/spell-name/ccache
replace the huge mixing pot of /root/.ccache

After a successful build useful cached object files
are compressed into a tight .tar.bz2 file that is 
placed into /var/cache/ccache until it is required again.
When the spell is cast again cached object files 
are decompressed and made available for compilation.

Previously with everything dumped into /root/.ccache we
could not tell where what came from, or whether it would
ever be required again.  The benefit of the speed increase
was incommensurate with the cost in disk space on systems
with small drives.  And the speed increased diminished 
over time because of the huge build up of files in 
directories beneath /root/.ccache.  Therefore, the more
spells that had object files cached the slower ccache
worked.

This change enhances both speed 
and efficient use of disk space.
Space is saved in two ways.
First, old unused cached object files are discarded.
Second, caches not in use are stored in small .tar.bz2 files.
When a ccache is active it contains files only from 
the same or previous versions of the spell being cast 
which increases speed by eliminating searches through
directories packed with cached files that are of no 
use to the spell being compiled.

Finally, this change minimizes the theoretical possibility
that two separate preprocessed sources from different spells
would have the same md4, but not the same object file,
causing ccache to give back a wrong object file.


/tmp/sorcery must be atime enabled 
so that the unused portions of ccaches can be discarded 
while only the used portions saved for future compilations.
Since most of us use no atime on our file systems, to
avoid unnecessary wear and tear on our hard drives
and improve performance, either /tmp or /tmp/sorcery 
be atime enabled.

If you don't have or want /tmp as a tmpfs then you
should at the very least make /tmp/sorcery tmpfs by
removing the the line:

tmpfs /tmp            tmpfs   defaults,size=1g,nr_inodes=1m   0 0

and adding the line

tmpfs   /tmp/sorcery    tmpfs   defaults,mode=0700,size=512m,nr_inodes=1m 0 0

in /etc/fstab

Additionally that line will secure /tmp/sorcery 
for root only reading and writing.

Now that /tmp is not tmpfs your compilation speed will
take a hit and wear and tear on drives increase unless
you add the parameter "-pipe" to CFLAGS and CXXFLAGS 
in your /etc/sorcery/cpref files.

-pipe uses pipes rather than temporary files for 
communication between the various stages of compilation.
Or more simply put compilation is faster when gcc is
not writing files to /tmp

The next Sorcerer Install/Rescue disk 
will have these changes made on it.
Additionally, ccache feature will be
enabled in the default configuration.
