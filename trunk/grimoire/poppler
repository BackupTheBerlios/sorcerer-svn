# 0.11.0 links with lcms, but why?
# 0.11.0 failed to install poppler-layer.h
# 0.11.x is the unstable development branch that will become stable as 0.12.x
# The cmake of poppler version 0.12.0 does not install correctly
# and omits the installation of important headers such as poppler-layer.h

# -DENABLE_XPDF_HEADERS:BOOL=TRUE installs unsupported xpdf headers (needed by texlive )

# 0.12.3 cmake method does not install all headers nor properly link 
# /usr/lib/libpoppler-glib.so.4.0.0       /usr/lib/libgdk-x11-2.0.so.0    gtk+
# therefore, using configure method to compile and install poppler 0.12.3

# 0.12.3 configure method does not install important header files
# such as PDFDoc.h

# poppler install methods are partially broke
# probably due to poppler software authors errors?

# poppler version 0.18.0 prevents compilation of gimp version 2.6.11

   version   stable 0.18.4 0.16.7 0.16.6 0.16.4
   version unstable 0.19.4 0.19.3 0.19.2 0.19.1 0.18.4
   version   latest 0.19.4 0.19.3 0.19.2 0.19.1 0.18.4
   require cmake gtk+ lcms openjpeg poppler-data
      opts --enable-static=no
if [[ $SPELL = poppler ]]
then  opts --disable-poppler-qt4 --disable-poppler-qt
fi
#     opts -DCMAKE_INSTALL_PREFIX:PATH=/usr -DENABLE_XPDF_HEADERS:BOOL=TRUE
  category documentation
 attribute library makej x11
#attribute library multilib-concurrent x11
    source http://poppler.freedesktop.org/poppler-$VERSION.tar.gz
      info last 20120215
      info home http://poppler.freedesktop.org/
      desc 'PDF rendering library'

build(){
 missing_install(){
  mkdir -vpm 755 $DESTDIR/usr/include/poppler
  mkdir -vpm 755 $DESTDIR/usr/include/poppler/goo
  mkdir -vpm 755 $DESTDIR/usr/include/poppler/splash
  find poppler -type f -name \*.h | xargs --max-lines=256 cp -t $DESTDIR/usr/include/poppler
  find splash  -type f -name \*.h | xargs --max-lines=256 cp -t $DESTDIR/usr/include/poppler/splash
  find goo     -type f -name \*.h | xargs --max-lines=256 cp -t $DESTDIR/usr/include/poppler/goo
  true
 }

 sed -i 's:hardcode_into_libs=yes:hardcode_into_libs=no:' configure
 ./configure \
  --sysconfdir=/etc \
  --localstatedir=/var \
  --prefix=/usr \
 $OPTS &&
 make  &&
 make install DESTDIR=$DESTDIR &&
#default_build &&
 missing_install
}

current(){
case $VERSION in
 0.12.3) [ -f /usr/include/poppler/PDFDoc.h ] ;;
 0.10.7) [ -f /usr/include/poppler/goo/gtypes.h ] ;;
esac
}
