# 0.11.0 links with lcms, but why?
# 0.11.0 failed to install poppler-layer.h
# 0.11.x is the unstable development branch that will become stable as 0.12.x
# The cmake of poppler version 0.12.0 does not install correctly
# and omits the installation of important headers such as poppler-layer.h

# -DENABLE_XPDF_HEADERS:BOOL=TRUE installs unsupported xpdf headers (needed by texlive )

# 0.12.3 cmake method does not install all headers nor properly link 
# /usr/lib/libpoppler-glib.so.4.0.0       /usr/lib/libgdk-x11-2.0.so.0    gtk+
# therefore, using configure method to compile and install poppler 0.12.3

# 0.12.3 configure method does not install important header files
# such as PDFDoc.h

# poppler install methods are partially broke
# probably due to poppler software authors errors?

    stable 0.14.1 0.14.0 0.12.4 0.12.3
   require cmake gtk+ lcms poppler-data
  category documentation
 attribute library x11
    source http://poppler.freedesktop.org/poppler-$VERSION.tar.gz
  homepage http://poppler.freedesktop.org/
#     opts -DCMAKE_INSTALL_PREFIX:PATH=/usr -DENABLE_XPDF_HEADERS:BOOL=TRUE
      opts --enable-static=no
  estimate 600
      desc 'PDF rendering library'

build(){
 missing_install(){
  mkdir -vpm 755 $DESTDIR/usr/include/poppler
  mkdir -vpm 755 $DESTDIR/usr/include/poppler/goo
  mkdir -vpm 755 $DESTDIR/usr/include/poppler/splash
  find poppler -type f -name \*.h | xargs --max-lines=256 cp -t $DESTDIR/usr/include/poppler
  find splash  -type f -name \*.h | xargs --max-lines=256 cp -t $DESTDIR/usr/include/poppler/splash
  find goo     -type f -name \*.h | xargs --max-lines=256 cp -t $DESTDIR/usr/include/poppler/goo
  true
 }

 ./configure \
  --sysconfdir=/etc \
  --localstatedir=/var \
  --prefix=/usr \
 $OPTS &&
 make  &&
 make install DESTDIR=$DESTDIR &&
#default_build &&
 missing_install
}

current(){
case $VERSION in
 0.12.3) [ -f /usr/include/poppler/PDFDoc.h ] ;;
 0.10.7) [ -f /usr/include/poppler/goo/gtypes.h ] ;;
esac
}
