# allegro version 4.2.2 installs /usr/lib/liballeg-4.2.2.so
# but lazily allows ldconfig to create liballeg.so.4.2 -> liballeg-4.2.2.so
# And unfortunately /usr/lib/liballeg-4.2.2.so
# is untracked.
# Therefore, spells that have an ELF requirement on allegro
# probably will not show it in lddof.
# Who knows if /usr/lib/liballeg-4.2.2.so
# when allegro is updated or removed?
# Very sloppy allegro authors!

   VERSION=( 4.2.2 4.2.1 4.2.0 4.1.18 4.1.17 4.1.16 4.0.3 )
    IGNORE='^4\.9\."
# 4.9.x is a WIP or dev version.

# Yes 4.1.x are work in progress rather than stable releases.
# however 4.0.3 quit compiling:
# gcc -DHAVE_CONFIG_H -Iinclude -Iinclude/allegro -I./include -I./include/allegro -I.  -I/usr/X11R6/include  -DALLEGRO_LIB_BUILD -mcpu=pentium -Os -pipe -march=athlon-xp -funroll-loops -ffast-math -fomit-frame-pointer -Wall -Wno-unused -fPIC -DALLEGRO_SHARED -c ./src/linux/lmemory.c -o obj/unix/shared/alleg/lmemory.o`-mcpu=' is deprecated. Use `-mtune=' or '-march=' instead.
# ./src/linux/lmemory.c:27:2: #error "Sorry, mapped files are required for Linux console Allegro to work!
# --enable-fbcon=no gets around the problem.
# Still I will go ahead with 4.1.16 assuming no compatibility problems
# because the allegro homepage advertises backward compatibility with 
# allegro 4.0 and bug fixes.
    IGNORE='enduser\|msvc\|rc\|beta\|4\.3\.'
# 4.3.x is the new WIP branch
  CATEGORY='game'
 ATTRIBUTE='library x11'
    SOURCE="alleg/allegro-$VERSION.tar.gz"
  HOMEPAGE='http://alleg.sourceforge.net'
       URL="$SOURCEFORGE_URL"
#            'arts::--disable-artsdigi:to output through arts sound mixer'
       REQ=( ''
             'alsa-lib::--disable-alsadigi --disable-alsamidi:for sound output through alsa'
             'esound::--disable-esddigi:to work output through enlightenment sound mixer'
             'libXpm::-without-x:for x11 graphics output'
             'libXxf86dga:::for DGA support with x11 graphics'
             'svgalib::--disable-svgalib:for svgalib graphics output' )
      OPTS='--enable-fbcon=no'
  ESTIMATE='900'
      DESC='allegro is a cross-platform game library.
allegro is a multi-platform game library that
provides many functions for graphics, sounds,
player input (keyboard, mouse, and joystick), and timers.
It also provides fixed and floating point mathematical
functions, 3D functions, file management functions,
compressed datafile, and a GUI.'


build()  {
  sed  -i  "s/-O2/$CFLAGS/"  configure
  default_build
}
