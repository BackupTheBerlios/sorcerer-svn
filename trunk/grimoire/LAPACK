   version stable 3.4.0 3.3.1 3.3.0
   require gcc-fortran
  category mathematics
 attribute console makej
    source http://www.netlib.org/lapack/lapack-$VERSION.tgz
      info last 20111123
      info home http://www.netlib.org/lapack
      desc 'a Fortran77 program that provides routines for solving systems
of simultaneous linear equations, least-squares solutions of linear
systems of equations, eigenvalue problems, and singular value problems.'


# make tests takes a day to complete

build(){
 usr_lib_install(){
  local DEST=$DESTDIR/usr/lib
  mkdir -pvm 755 $DEST/pkgconfig &&
  find * -type f -name \*.a |
  while read
  do    install -vm 644 $REPLY $DEST
  done
  find * -type f -name \*.pc |
  while read; do
   sed -i 's:/usr/local:/usr:' $REPLY
   install -vm 644 $REPLY $DEST/pkgconfig
  done
 }

 usr_lib64_install(){
  local DEST=$DESTDIR/usr/lib64
  mkdir -pvm 755 $DEST/pkgconfig &&
  find * -type f -name \*.a |
  while read
  do    install -vm 644 $REPLY $DEST
  done
  find * -type f -name \*.pc |
  while read; do
   sed -i 's:/usr/local:/usr:'     $REPLY
   sed -i 's:/usr/lib:/usr/lib64:' $REPLY
   install -vm 644 $REPLY $DEST/pkgconfig
  done
 }

 mkdir build &&
 cd    build &&
 cmake -DCMAKE_Fortran_FLAGS='-O0 -fPIC' ..  &&
 make      &&
 if   [[ $HOSTTYPE == x86_64 ]] && ! [[ $CFLAGS =~ -m32 ]]
 then usr_lib64_install
 else usr_lib_install
 fi
}
