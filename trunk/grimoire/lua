    stable 5.1.4 5.1.3 5.0.3
   require ncurses readline
  category development/interpreter
 attribute console library
#attribute multilib-fail
    source http://www.lua.org/ftp/lua-$VERSION.tar.gz
  homepage http://www.lua.org/
      desc 'programming langauge
lua is a programming language originally designed
for extending applications, but also frequently
used as a general-purpose, stand-alone language.
Lua combines simple procedural syntax (similar to Pascal)
with powerful data description constructs based
on associative arrays and extensible semantics.
Lua is dynamically typed, interpreted from bytecodes,
and has automatic memory management, making it ideal
for configuration, scripting, and rapid prototyping.
Lua is implemented as a small library of C functions,
written in ANSI C, and compiles unmodified in all known platforms.
The implementation goals are simplicity,
efficiency, portability, and low embedding cost.
It has been used on games such as Grim Fandango,
Escape from Monkey Island, and MDK2.'

build(){
 local FORMAT

 if   [[ $HOSTTYPE == x86_64 ]] && [[ $CFLAGS =~ -m32 ]]
 then FORMAT="-m elf_i386"
 fi

 LC_ALL=C grep -rl "\-O2 -Wall" * |
 xargs -r --max-lines=256 sed -i "s:-O2 -Wall:$CFLAGS -fPIC:"
 sed -i 's:/usr/local:/usr:' etc/lua.pc

 make  linux   MYLDFLAGS="$LDFLAGS"          &&
 make  install INSTALL_TOP=$DESTDIR/usr      &&
 ld   $FORMAT --whole-archive -share -ldl    \
       -soname            liblua.so.$VERSION \
      -o $DESTDIR/usr/lib/liblua.so.$VERSION \
         $DESTDIR/usr/lib/liblua.a           &&
 ln -vs liblua.so.$VERSION  $DESTDIR/usr/lib/liblua.so.${VERSION:0:3} &&
 ln -vs liblua.so.$VERSION  $DESTDIR/usr/lib/liblua.so.${VERSION:0:1} &&
 ln -vs liblua.so.$VERSION  $DESTDIR/usr/lib/liblua.so &&
 mkdir  -pvm 755            $DESTDIR/usr/lib/pkgconfig &&
 install -vm 644 etc/lua.pc $DESTDIR/usr/lib/pkgconfig &&
 if    [[ $HOSTTYPE == x86_64 ]]; then
  if   [[ $CFLAGS   =~ -m32   ]]
  then mv $DESTDIR/usr/lib{,32}
  else mv $DESTDIR/usr/lib{,64}
       mv $DESTDIR/usr/lib{32,}
       sed -i 's:libdir=${exec_prefix}/lib:libdir=${exec_prefix}/lib64:' $DESTDIR/usr/lib64/pkgconfig/lua.pc
  fi
 fi
}
