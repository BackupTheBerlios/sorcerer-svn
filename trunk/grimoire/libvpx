# must be multilib-dual
# 0.9.7-p1 was a repository snapshot
# However 0.9.6 was removed from the download list
# http://www.linuxfromscratch.org/blfs/view/svn/multimedia/libvpx.html
# The above URL provides a libvpx-v1.3.0.tar.xz
# without citing where it was downloaded
# and states "The libvpx tarballs are no longer generated by the maintainers."
# That seems curious.

with info    good 20140109
with info    last 20130909
with version stable 1.2.0 1.1.0
with base    yasm
with also    --disable-install-docs --enable-pic --enable-vp8
with also    --enable-runtime-cpu-detect --enable-shared
with also    --disable-examples
with role    video video/codec
with trait   library lto makej multilib-dual optimize
with source  stable http://webm.googlecode.com/files/libvpx-v$VERSION.tar.bz2
#with source  stable libvpx-$VERSION.tar $VERSION http://git.chromium.org/webm/libvpx.git
with info    home http://code.google.com/p/webm/
with info    vurl http://code.google.com/p/webm/downloads/list
with info    cite 'library for the VP8 Codec'

build(){
 export PATH="${PATH//\/usr\/bin.a:/}"
 export CCACHE_PATH=/usr/bin

 if   [[ $HOSTTYPE == x86_64 ]] &&
      [[ $CFLAGS   =~ -m32   ]]
 then OPTS+=" --target=x86-linux-gcc"
 fi

 mkdir -pvm 755 build
 cd build
 ../configure $OPTS &&
 make &&
 make install DIST_DIR="$DESTDIR"/usr &&
 rm -f "$DESTDIR"/usr/lib{,64}/libvpx.a &&
 if     [[ $HOSTTYPE == x86_64 ]] &&
      ! [[ $CFLAGS   =~ -m32   ]]
 then mv "$DESTDIR"/usr/lib{,64}
 fi &&
 sed -i 's: -L${libdir}::' "$DESTDIR"/usr/lib*/pkgconfig/vpx.pc
}
