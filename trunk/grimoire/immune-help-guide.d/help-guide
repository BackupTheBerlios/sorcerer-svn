# Copyright Kyle Sallee 2011
# All rights reserved.
# For use with the distribution sorcerer only!

ON_KEEP="
This directory is included on the initramfs
and therefore can be accessed during sysinit
and when logged onto the Sorcerer's keep.
The Sorcerer's keep can be accessed by
logging in on virtual console #7 or by
executing ssh -p 30 127.0.0.1"

declare -A CDL LIL

CDL[/etc/init.d]="
/etc/init.d/ contains init-scripts.
/etc/init.d/README provides a verbose description of Sorcerer's init system.
Execute   ./README to be provided an automatic view

Init-scripts are not configuration files.
Only the mode of an init-script can be modified.
Content modification is lost.
Configuration files for init-scripts are stored in /etc/init.d/conf.d/
Configuration files for init-scripts are intended for modification.
Rather than read the documentation SAs may prefer to execute
# ./Menu configure
in order to enjoy a menu driven interface to Sorcerer Init scripts."

CDL[/etc/init.d/conf.d]="
/etc/init.d/conf.d/ contains configuration files for init-scripts.
A configuration file for an init-script
will have the same name as the init-script.
Modified configuration files become customized.
Customized files persist across updates."

CDL[/root/.sorcery]="
/root/.sorcery/ is a tmpfs file system provided for storing
the generated data used by the sorcery tools when invoked by root.
tmpfs provides faster generation and access to the files
while the content remains swappable in order to free RAM
when competition for RAM becomes intense.
Files on tmpfs do not survive reboot,
however none of /root/.sorcery/ contents
is intended to survive reboot."

CDL[/root/.sorcery/grimoire]="
/root/.sorcery/grimoire/ is the merged grimoire.
grimoire is fancy for for book written in Latin.
After a sorcery provided tool is invoked
with instructions that require spells
then the merged grimoire fills with spell files and directories.
Spells provide a terse human readable format that the tools
use in order to discover how to
download, compile, and install software projects.
If sorcery was a junior SA then spells would provide
a succinct method for explaining a task."

CDL[/root/.sorcery/queue]="
/root/.sorcery/queue/ provides queues for processing spells.
The queues directories are like todo lists.
The \"augur queue\" command is used to fill the queues.
And \"augur begin\" instructs the tools to begin processing the queues.
When a spell is queued for processing then an empty file
with the same name as the spell
is created in the appropriate processing queue."

CDL[/root/.sorcery/queue/cast]="
/root/.sorcery/queue/cast/
Files in this directory indicate software projects to install."

CDL[/root/.sorcery/queue/dispel]="
/root/.sorcery/queue/dispel/
Files in this directory indicate software projects to uninstall."

CDL[/root/.sorcery/queue/leech]="
/root/.sorcery/queue/leech/
Files in this directory indicate software project sources to download."

CDL[/root/.sorcery/queue/fail]="
/root/.sorcery/queue/fail/
Files in this directory indicate software that either
failed to compile or software that the tools expect
will fail compilation because
required software is not yet installed."

CDL[/root/.sorcery/dispel]="
/root/.sorcery/dispel/
This is a temporary directory used by dispel"

CDL[/root/.sorcery/cache]="
/root/.srocery/cache/
This is a temporary directory used by sorcery"

CDL[/root/.sorcery/index.d]="
/root/.sorcery/index.d/
This directory holds indexes that are easier to generate
or access when not combined into /root/.sorcery/index"

CDL[/usr/libexec/sorcery]="
/usr/libexec/sorcery/
This is the directory where the sorcery tools actually exist.
They are sourced in by tiny wrappers provided in /usr/sbin/
This is a necessary precaution to avoiding a bug in BASH.
None of the files in these directories should be modified by the SA.
SA modifications can be made in /etc/sorcery/local.config
to override functions defined in the sorcery tools.
Variables that effect sorcery tools are also stored in
/etc/sorcery/local.config"

CDL[/usr/share/sorcery]="
/usr/share/sorcery/ is a directory that holds installed grimoires.
grimoires may also be merged from /usr/local/share/sorcery/
Prior to merging grimoires may be in tarbal or directory format.
After merging spells appear in /root/.sorcery/grimoire/"

CDL[/etc/sorcery]="
/etc/sorcery/
This is the main sorcery configuration directory.
/etc/sorcery/config should not be modified.
Instead variables to modify should be written to
/etc/sorcery/local.config"

CDL[/etc/sorcery/log]="
/etc/sorcery/log/
This directory provides additional directories that
contain information that is generated and determined
at the time of software configuration and installation.
The \"augur\" utility provides a standard interface
for viewing and modifying the contents of files in this directory.
Do not modify files in this directory unless very certain of the change.
Files in /etc/sorcery/log/ can not be replaced nor regenerated if lost.
Individual sub directory descriptions are not provided.
Invoke \"augur\" instead."

CDL=[/usr/src/sorcery]="
/usr/src/sorcery/ is a tmpfs on boxes with more than 1G of RAM.
This directory and sub-directories provide the oven space
for sorcery to bake source into delicious optimized compiled software.
The process of translating human readable source
into machine readable instructions is called compilation.
This directory and sub-directories should be ignored.
Individual sub directory descriptions are not provided."

CDL[/usr/src/linux]="
/usr/src/linux/ is the directory that contains
a configured and compiled linux kernel source.
All sources are discarded after compilation, except linux.
That is because software projects that provide modules
may also require a configured compiled linux source tree
in order to generate the module.
The linux source is interesting reading,
however the human readable documentation is mostly contained in
/usr/src/linux/Documentation/
/usr/src/linux/Documentation/ is definitely worth a visit."

CDL[/usr/src/linux/Documentation]="
kernel configuration for Sorcerer is provided by Kyle Sallee.
However, gaining the most from the linux kernel also requires
reading and understanding some of the documentation provided
here and within sub-directories.
The two most frequently accessed files are
kernel-parameters.txt and devices.txt
However, almost all files contain potentially useful lore.
Individual sub directory descriptions are not provided."

CDL[/sbin]="
/sbin/ contains executable files
that are most frequently invoked
by the system or the SA.
/sbin/ is included only in root's PATH
Therefore, root can invoke files in /sbin/
by merely typing their name
instead of prefixing a relative or absolute path name.
$ON_KEEP"

CDL[/usr/sbin]="
/usr/sbin/ contains executable files
that are most frequently invoked
by the system or the SA.
/usr/sbin/ is included only in root's PATH
Therefore, root can invoke files in /usr/sbin/
by merely typing their name
instead of prefixing a relative or absolute path name."

CDL[/bin]="
/bin/ contains executable files that are invoked by everyone.
/bin/ is always included in the PATH
Therefore, anyone can invoke files in /bin/
by merely typing their name
instead of prefixing a relative or absolute path name.
$ON_KEEP"

CDL[/usr/bin]="
/usr/bin/ contains executable files that are invoked by everyone.
/usr/bin/ is always included in the PATH
Therefore, anyone can invoke files in /usr/bin/
by merely typing their name
instead of prefixing a relative or absolute path name."

CDL[/usr/bin32]="
/usr/bin32/ appears on x86_64 multilib architecture.
This directory holds files that may be used
during 32-bit compilation."

CDL[/lib64]="
/lib64 is the 64-bit library directory.
$ON_KEEP"

CDL[/lib]="
/lib is the 32-bit library directory.
Additional directory descriptions are provided only for
/lib/firmware/ and /lib/modules/
$ON_KEEP"

CDL[/lib/modules]="
/lib/modules/ contains linux kernel modules
$ON_KEEP"

CDL[/lib/firmware]="
/lib/firmware/ contains firmware for devices that is loaded
when required by a linux kernel module.
$ON_KEEP"

LIL[keep]="
Welcome to the Sorcerer's keep.
The keep is the first structure erected and final structure surrendered.
The keep is accessible by virtual console #7 or by ssh to port 30.
The real root file system is mounted as /media/root/"

LIL[root]="
Welcome Sorcerer System Administrator.
Sorcery power is wielded primarily through two tools.
/usr/sbin/sorcery provides a menu driven interface.
/usr/sbin/augur provides a command line interface."

LIL[IR]="
Welcome to Sorcerer.
/sbin/sinstall
begins a menu driven installation.

If unfamiliar with dialog please execute
/sbin/dt
to begin the dialog tutorial."


cd(){
 builtin cd "$@"
 if   [ -n "${CDL[$PWD]}" ]
 then echo "${CDL[$PWD]}"
              CDL[$PWD]=
 fi
}

if   read < /proc/cmdline; [[ $REPLY =~ boot=IR ]]
then echo "${LIL[IR]}"
elif [[ -f /media/root/sbin/init ]]
then echo "${LIL[keep]}"
else echo "${LIL[root]}"
fi
