   VERSION=( 20080121-0 )
  CATEGORY='utility'
 ATTRIBUTE='archive_off library solo'
  HOMEPAGE='http://sorcerer.silverice.org/'
   PROTECT='/usr/libexec/sorcery/sentinel'
  ESTIMATE='10'
      DESC='sorcery-sentinel provides a file modification detection preloadable library

Casting spells installs and modifies previously installed files.
cast learns what files should belong to a spell
by looking at a log of the files installed and modified.
The raw install log for a spell is created by a preloadable
ELF library called sentinel.'

build(){
 unset LD_PRELOAD
 gcc $CFLAGS -D_GNU_SOURCE -DPIC -fPIC -D_REENTRANT \
     $LDFLAGS -lc -ldl -shared -nostartfiles \
     -o sentinel $SCRIPT_DIR/sentinel.c &&
 prepare_install  &&  export    LD_PRELOAD=$PWD/sentinel &&
 mkdir  -pvm 0755          /usr/libexec/sorcery &&
 install -vm 0755 sentinel /usr/libexec/sorcery/sentinel-$HOSTTYPE
}

post_install(){
 default_post_install &&
 cd /usr/libexec/sorcery &&
 if ! cmp -s sentinel{-$HOSTTYPE,}; then
  rm      -f sentinel
  cp      -v sentinel{-$HOSTTYPE,}
 fi
}
