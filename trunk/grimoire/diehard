    stable 1.1 1.0.2 1.0.1 1.0
    ignore 'windows'
  category security
 attribute console
    source diehard-$VERSION.tar.gz
       url http://www.cs.umass.edu/~emery/diehard/download/$VERSION/
      vurl http://prisms.cs.umass.edu/emery/index.php?page=download-diehard
  homepage http://prisms.cs.umass.edu/emery/index.php?page=diehard
case $VERSION in
 1.1) use_gcc gcc-v4.0 ;;
esac
  estimate 10
      desc 'diehard hardens software against exploits aimed at bugs.
Bugs such as memory errors, often end up as serious security
vulnerabilities, cause crashes, or lead to unpredictable behavior.
DieHard either eliminates these bugs altogether,
or avoids them with high probability.


Below copied from the http://www.cs.umass.edu/~emery/diehard/

DieHard works in two modes: standalone and replicated.
The standalone version replaces the memory manager
with the DieHard randomized memory manager.
This randomization increases the odds that buffer overflows
will have no effect, and reduces the risk of dangling pointers.
The replicated version provides greater protection against
errors by running several instances of the application
simultaneously and voting on their output.
Because each replica is randomized differently,
each replica will likely have a different output
if it has an error, and some replicas are likely
to run correctly despite the error.
Extra protection comes at the cost
of increased memory and CPU usage.


To start in standalone export the diehard library
to the LD_PRELOAD environment variable:

export  LD_PRELOAD  /usr/lib/libdiehard.so

To use replicated version invoke the program through diehard.

diehard 3 /usr/lib/libdiehard_r.so program

This would create 3 replicas of the program.
If the program does not read from standard input
then add < /dev/null to the command line.'


build(){
 install_diehard(){
  mkdir   -vm 755 -p      $DESTDIR/usr/bin $DESTDIR/usr/lib
  install -vm 755 diehard $DESTDIR/usr/bin
  cd ..
  install -vm 755 libdiehard{,_r}.so       $DESTDIR/usr/lib
 }

 sed -i "s: -march=pentiumpro -march=pentiumpro -O3:$CFLAGS:" src/Makefile
 cd   src        &&
 make linux      &&
 cd   replicated &&
 make            &&
 install_diehard
}
