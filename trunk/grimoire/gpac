# how to make this multilib compile?
# 0.5.0 failed compilation

with version   stable 0.4.5
with version unstable 0.5.0
with base    gsm faac faad2 lame libtheora libxml2
with elect   firefox --mozdir=/usr/lib/mozilla '' to install GPAC plugin for Mozilla-based browsers
with elect   wxWidgets '' --disable-wx for Osmo4 player
case $VERSION in
 0.4.5)
with also    --use-xvid=no ;;
esac
with role    video
with trait   library
with trait   multilib-fail
with trait   broke
with source    stable $SOURCEFORGE_URL gpac/GPAC/GPAC%20$VERSION/gpac-$VERSION.tar.gz
with source    stable $SOURCEFORGE_URL libpng/libpng12/1.2.44/libpng-1.2.44.tar.xz
with source  unstable $SOURCEFORGE_URL gpac/GPAC/GPAC%20$VERSION/gpac-$VERSION.tar.gz
with source  unstable $SOURCEFORGE_URL libpng/libpng12/1.2.44/libpng-1.2.44.tar.xz
with info    last 20120527
with info    home http://gpac.sourceforge.net/
# circular requirement: ffmpeg - x264 - gpac - ffmpeg, removed ffmpeg req
    CFLAGS='-O2 -ffast-math'
   LDFLAGS='-Wl,-O1'
with info    freecode gpac
with info    cite 'multimedia framework based on the MPEG4 systems standard
GPAC supports many multimedia formats, avi, mpeg, mpeg-4, mov, SVG, etc.
It currently supports local playback, http download and
play and RTP/RTSP streaming over UDP (unicast or multicast) or TCP.
GPAC also features MP4Box, a multimedia swiss-army knife for the prompt.'

build(){
 local LDEMULATION

 unset LDFLAGS

 if   [[ $CFLAGS =~ -m32 ]]
 then export LDEMULATION=elf_i386
 fi

 install_headers(){
  mkdir -p            $DESTDIR/usr/include/gpac
  cp -av include/gpac $DESTDIR/usr/include/gpac
 }

 export CFLAGS+=' -fPIC'

 sed -i "s:-lGL -lGLU:-lGL -GLU -L /usr/X11R6/lib:
         s:-O3 \$CFLAGS:$CFLAGS \$CFLAGS:" configure
 chmod 755 configure

#  --extra-cflags=ECFLAGS   add ECFLAGS to CFLAGS []
#  --extra-ldflags=ELDFLAGS add ELDFLAGS to LDFLAGS [ -Wl --warn-common]
#  --extra-libs=ELIBS       add ELIBS []

 case $VERSION in
  0.4.5) sed -i 's:--warn-common::' configure ;;
 esac

 cd libpng-1.2.44 &&
 ./configure --prefix=$PWD/install --enable-static=yes --enable-shared=no &&
 make install &&
 OPTS+=" --extra-ldflags=-L$PWD/install/lib" &&
 OPTS+=" --extra-cflags=-I$PWD/install/include" &&
 cd .. &&

 ./configure \
 --prefix=/usr \
 $OPTS &&
 make &&
 make install DESTDIR=$DESTDIR &&
 install_headers 
}
