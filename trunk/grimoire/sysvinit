   VERSION=( 2.86 )
  CATEGORY='utility'
 ATTRIBUTE='console'
    SOURCE="sysvinit-$VERSION.tar.gz"
       URL='ftp://ftp.cistron.nl/pub/people/miquels/sysvinit/'
  HOMEPAGE='ftp://ftp.cistron.nl/pub/people/miquels/sysvinit/'
       REQ='init-functions'
   PROTECT='/etc/inittab
            /etc/init.d/bootmisc'
   EXCLUDE='/etc/init.d/dev.d
            /etc/rc.d'
  ESTIMATE='35'
      DESC='sysvinit is the parent process of all process.
sysvinit starts processes from the information specified in file /etc/inittab.
sysvinit also contains the following utilities:
reboot, shutdown, killall, poweroff, tellinit, sulogin, wall

The sysinit  logfile is /etc/init.d/log.d/sysinit.log
The runlevel logfile is /etc/init.d/log.d/runlevel.?.log
The dmesg    logfile is /etc/init.d/log.d/dmesg.log

# Sorcerer runlevels differ slightly from LSB specified runlevels.
# Runlevels
# 0: halt
# 1: sequential init
# 2: parallel   init + multi-user + networking
# 3: sequential init + multi-user + networking
# 4: parallel   init + multi-user + networking + GUI login
# 5: sequential init + multi-user + networking + GUI login
# 6: reboot

Parallel runlevels 2 and 4 execute faster.
If problems occur during execution of init-scripts
then the init-script owning the problem
is easier to identify when using
sequential runlevels 3 or 5

Edit /etc/inittab to adjust
the default runlevel used during booting.
The current runlevel does not change when updating.
Runlevels 2 3 4 5 can be used while updating.

More information about sysvinit is available at:
http://www.linux-foundation.org/spec/refspecs/LSB_3.1.0/LSB-Core-generic/LSB-Core-generic/iniscrptfunc.html'


configure(){

 char_dev_menu(){ find /dev -type c | sed 'acharacter device'; }

 select_char_dev(){
  BACKTITLE='sysvinit Configuration'
      TITLE='Character Device Selection Menu'

  dialog --backtitle  "$BACKTITLE"  \
         --title      "$TITLE"      \
         --stdout                   \
         --timeout   "$PROMPT_DELAY"\
         --default-item "$2"        \
         --no-cancel                \
         --menu  "$1"               \
         0 0 0                      \
         $(  char_dev_menu  )
 }

 if ! grep -qs SI_DEV= $SPELL_CONFIG ||
    ! grep -qs RL_DEV= $SPELL_CONFIG
 then
  ( FOR='Please select the device to display the scroll from programs started during'
    export  IFS=$'	\n'
    SI_DEV="$( select_char_dev "$FOR sysinit."   '/dev/tty9'  )"
    RL_DEV="$( select_char_dev "$FOR runlevels." '/dev/tty10' )"
    if  [ -n "$SI_DEV"  ]; then echo "SI_DEV=$SI_DEV" >  $SPELL_CONFIG; fi
    if  [ -n "$RL_DEV"  ]; then echo "RL_DEV=$RL_DEV" >> $SPELL_CONFIG; fi
  )
 fi
}


build(){
 install_init(){
  mkdir   -vp                              /etc/init.d
  install -vm 0600 $SCRIPT_DIR/inittab     /etc
  install -vm 0700 $SCRIPT_DIR/0_No_Modification \
                                           /etc/init.d
  install -vm 0700 $SCRIPT_DIR/prc         /etc/init.d
  install -vm 0700 $SCRIPT_DIR/rcS         /etc/init.d
  sed     -i       "s:ulimit :# ulimit :" \
                   src/initscript.sample
  install -vm 0700 src/initscript.sample   /etc
  install -vm 0755 -d                      /etc/init.d/log.d
  install -vm 0755 -d                      /etc/init.d/dev.d
  rm      -f                               /etc/init.d/dev.d/{si,rl}
  cp      -afv     ${SI_DEV:-/dev/console} /etc/init.d/dev.d/si
  cp      -afv     ${RL_DEV:-/dev/console} /etc/init.d/dev.d/rl
  if   [  -d  /etc/init.d/log ]
  then umount /etc/init.d/log
       rm -rf /etc/init.d/log
  fi
  if   [  -d  /etc/init.d/dev ]
  then rm -rf /etc/init.d/dev
  fi
  return
 }

 case $HOSTTYPE in
  x86_64) sed -i 's:/usr/lib/libcrypt.a:/usr/lib64/libcrypt.a:' src/Makefile ;;
 esac

 sed   -i "s:-O2 -fomit-frame-pointer:${CFLAGS}:" src/Makefile

 case $VERSION in
  2.86) patch -p1 < $SCRIPT_DIR/sysvinit-2.86-selinux.patch ;;
 esac

 if   spell_installed libselinux
 then export CFLAGS+=' -DWITH_SELINUX' SEL='-DWITH_SELINUX'
 fi

 make -C src $SEL &&
 prepare_install  &&
 make -C src $SEL install &&
 install_init
}

post_install(){
 default_post_install
 if   ! [ -x /usr/sbin/sorcerer.install ]
 then /sbin/init u; sleep 2
 fi
}


current(){
 case $VERSION in
  2.86) grep -q 100 /etc/init.d/prc ;;
 esac
#  2.86) [ -d /etc/init.d/dev.d ] ;;
}
