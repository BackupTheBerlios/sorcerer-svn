# libpng upgrade broke inkscape version 0.48.3.1

# 0.46 contains forward declarations causing compile errors.

# Python perl--XML-Parser perl--XML-XQL
# The above 3 requirements are for extention dependencies.

# This might be fixable if a legacy version of poppler is installed in /opt/poppler
# and this source can be instructed to use it instead of the /usr installed poppler.
# However, discussion about supporting the current version of poppler
# appears to be ugly and unwilling on the inkscape list.
# Therefore, I also feel unwilling to make an exception to help inkscape compile
# when the software author author refuses to to fix the source.
# Therefore, any problems about inkscape not compiling can be directed as usual
# to the inkscape development list.

# 0.48.1 does not exists?

with version stable 0.48.3.1
with base    ImageMagick Python boost gc gsl gtkmm-2.4 perl--XML-XQL poppler popt
with elect   aspell
with elect   gtkspell
with elect   lcms      --enable-lcms    --disable-lcms      for light weight color management library
with role    graphic/editor
with trait   broke
with trait   x11
with source  $SOURCEFORGE_URL inkscape/inkscape/$VERSION/inkscape-$VERSION.tar.bz2
#   source $SOURCEFORGE_URL inkscape/inkscape/${VERSION:0:4}/inkscape-$VERSION.tar.bz2
case $VERSION in
 0.48.3*)
   use_gcc gcc-v4.5
#with base    libpng14 ;;
with source  $SOURCEFORGE_URL libpng/libpng12/1.2.50/libpng-1.2.50.tar.xz ;;
esac
with info    last 20120219
with info    home http://www.inkscape.org/
with info    docs http://inkscape.org/doc/
with info    cite 'vector graphics editor
Inkscape capabilities are similar to
Illustrator, Freehand, CorelDraw, or Xara X
using the W3C standard Scalable Vector Graphics (SVG) file format.
Supported SVG features include shapes, paths, text, markers, clones,
alpha blending, transforms, gradients, patterns, and grouping.
Inkscape also supports Creative Commons meta-data, node editing,
layers, complex path operations, bitmap tracing, text-on-path,
flowed text, direct XML editing, and more.
It imports formats such as JPEG, PNG, TIFF, and others and
exports PNG as well as multiple vector-based formats.

Inkscape main goal is to create a powerful and convenient
drawing tool fully compliant with XML, SVG, and CSS standards.
We also aim to maintain a thriving user and developer community
by using open, community-oriented development.

The above description is from http://www.inkscape.org/'

build(){
 obsolete_libpng(){
  cd libpng-1.2.50 &&
  ./configure --prefix=$PWD/install --enable-static=yes --enable-shared=no &&
  make install &&
  export  LDFLAGS+=" -L$PWD/install/lib" &&
  export   CFLAGS+=" -I$PWD/install/include" &&
  export CXXFLAGS+=" -I$PWD/install/include" &&
  cd ..
 }

 libpng_fix(){
  if   [[ $HOSTTYPE == x86_64 ]] && ! [[ $CFLAGS =~ -m32 ]]
  then LIBPNGLIBDIR=/opt/libpng/1.4.x/lib64
  else LIBPNGLIBDIR=/opt/libpng/1.4.x/lib
  fi
  export LDFLAGS+=" -L$LIBPNGLIBDIR -Wl,-rpath,$LIBPNGLIBDIR"
  export PKG_CONFIG_PATH="$LIBPNGLIBDIR/pkgconfig:$PKG_CONFIG_PATH"
 }

 case $VERSION in
  0.48.3.1) obsolete_libpng ;;
# 0.48.3.1) libpng_fix ;;
 esac

 default_build
}
