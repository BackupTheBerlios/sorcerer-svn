# cryptsetup dynamically links with libgcrypt
# cryptsetup runs from sysinit
# sysinit may run on an initramfs image
# Therefore, libgcrypt must have libraries installed in /lib or /lib64

# version of autotools that comes with libgcrypt version 1.4.5 and 1.4.6
# is buggy and does not choose correct libgpg-error library when linking.

with version stable 1.5.0 1.4.6
with base    libgpg-error
with also    --exec-prefix= --enable-static=no
with role    security/encryption
with trait   library lto makej
#trait multilib-dual
with source  ftp://ftp.gnupg.org/gcrypt/libgcrypt/libgcrypt-$VERSION.tar.bz2
with info    good 20120716
with info    last 20110629
with info    home http://directory.fsf.org/security/libgcrypt.html
with info    cite 'general purpose crypto library
libgcrypt is a general purpose crypto
library based on the code used in GnuPG.'

case $VERSION in
 1.4.6)
with base    automake libtool ;;
esac

build(){ (
 case $VERSION in
  1.4.6) aclocal -I .
         autoheader
         libtoolize --automake
         automake   --add-missing
         autoconf ;;
 esac

 if   [[ $HOSTTYPE == x86_64 ]] && [[ $CFLAGS =~ -m32 ]]
 then OPTS+=" --host=${MACHTYPE/x86_64/i686}"
 fi

# sed -i '/x$libdir/,+2d' src/libgcrypt-config.in
 default_build
) }
