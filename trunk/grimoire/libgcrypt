# cryptsetup dynamically links with libgcrypt
# cryptsetup runs from sysinit
# sysinit may run on an initramfs image
# Therefore, libgcrypt must have libraries installed in /lib or /lib64

    stable 1.4.5 1.4.1 1.4.0
   require libgpg-error
  category security/encryption
 attribute library
    source ftp://ftp.gnupg.org/gcrypt/libgcrypt/libgcrypt-$VERSION.tar.bz2
  homepage http://directory.fsf.org/security/libgcrypt.html
      opts --enable-static=no --libdir=/lib
  estimate 600
      desc 'general purpose crypto library
libgcrypt is a general purpose crypto
library based on the code used in GnuPG.'

build(){
 default_build &&
 mkdir -p $DESTDIR/usr/lib &&
 for REPLY in $DESTDIR/lib/*
 do ln -s ../../lib/${REPLY##*/} $DESTDIR/usr/lib/${REPLY##*/}
 done &&
 rm -f $DESTDIR/usr/lib/libgcrypt.la &&
 mv        $DESTDIR/lib/libgcrypt.la $DESTDIR/usr/lib
}

post_install(){
# for version 1.7
# libtool makes a mess out of everything
# if a single .la file is moved!

 LC_ALL=C grep /lib/libgcrypt.la {,/usr}/lib{,64}/*.la 2>/dev/null |
 grep -v /usr/lib/libgcrypt.la |
 cut -d : -f1 |
 while read
 do show_from "$REPLY"
 done |
 cut -d : -f1 | sort -u |
 pipe_queue $CAST_QUEUE com
 default_post_install
}
