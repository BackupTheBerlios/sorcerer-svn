#!/bin/bash

### BEGIN INIT INFO
# Provides: snmpd
# Required-Start: $network run
# Required-Stop: $network
# Default-Start: 3 4 5
# Default-Stop: 0 1 2 6
# Short-Description: snmpd starts and stops the net-snmp SNMP daemon
### END INIT INFO
#

# Source function library.
. /lib/lsb/init-functions

NAME="snmpd"
PROG="/usr/sbin/snmpd"
PIDF="/var/run/snmpd.pid"

#[ -x $PROG -a -f /etc/snmp/snmpd.conf ] || exit 0

status()  {
# PIDS="$( pidofproc -p $PIDF $SERV )"
  PIDS="$( pidofproc -p $PIDF $PROG )"
  if   [ -n "$PIDS" ]; then log_warning_msg "$NAME is running ($PIDS)"; return 0
  elif [ -f "$PIDF" ]; then log_warning_msg "$NAME is dead and $PIDF exists"; return 1                 
                       else log_warning_msg "$NAME is not running"; return 3
  fi
}
						       
start() {
  log_warning_msg  "Starting $NAME"
  if	start_daemon	 $PROG -p $PIDF -r -u nobody
  then	log_success_msg	 "$NAME started"
  else	log_failure_msg  "$NAME not started"
	status
  fi 
}

stop() {
  log_warning_msg  "Stopping $NAME"
  if	killproc  -p $PIDF -s 15 $PROG
  then	log_success_msg "$NAME stopped"
  else	log_failure_msg "$NAME not stopped"
	status
	return 0
  fi
}

restart() {  stop  &&  sleep 1;  start;  }

try_restart() {
  status  &&  restart
  return  0
}

help() {
  echo $"Usage: $0 {start|stop|restart|status|try-restart}" 1>&2
}
  
# See how we were called.
case "$1" in
      start)	start	;;
       stop)	stop	;;
     status)	status	;;
    restart)	restart	;;
try-restart)	try_restart	;;
          *)	help	;;
esac

