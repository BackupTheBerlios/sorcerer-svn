   VERSION=( 20080121-0 )
  CATEGORY='utility'
 ATTRIBUTE='console'
  HOMEPAGE='http://sorcerer.silverice.org/'
       REQ=( 'init-functions util-linux'
             'gzip:::for fast but inefficient compression'
             'bzip2:::for slower but more efficient compression'
             'p7zip:::for slowest but most efficient compression' )
  ESTIMATE='10'
      DESC='sorcery-bgz provides background compression of tarballs

Boxes with limited space for /var/cache
may benefit from compressing tarballs within
/var/cache/{archive,ccache,sources}
with a more efficient compression method
Background recompression may happen at nice level 19
while the load average is less than 2.'

build(){
 chk(){ grep -qx $1 $OPT_ON_LOGS/sorcery-bgz && Z=$2; }
 chk p7zip 7za   ||
 chk bzip2 bzip2 ||
 chk gzip  gzip

 sed -i "s:OPTS=.*:OPTS=$Z:" $SCRIPT_DIR/init.d.on/bgz
 prepare_install
 mkdir  -pvm 0755 /usr/{/libexec/sorcery,sbin}
 install -vm 0700 $SCRIPT_DIR/bgz.wrap /usr/sbin/bgz
 install -vm 0600 $SCRIPT_DIR/bgz      /usr/libexec/sorcery
}
