#!/bin/bash

# Copyright Kyle Sallee 2011
# All rights reserved.
# For use with the distribution sorcerer only!

help(){
 if [ -z "$1" ]; then
  echo "fast runs a process with minimal CPU and IO consumption."
  echo "The parameter can be a PID."
  echo "Otherwise specific a program to execute."
  echo "Additional parameters can be specified as the program's parameters."
  return 1
 fi 1>&2
}

user_fast(){
 if   ! cgroup_find;  then echo "Error: Unable to locate cgroup filesystem." 1>&2; return 1
 elif [ -z "$USER" ]; then echo "Error: Unknown user." 1>&2; return 1; fi
 echo $$     > $CG/fast/user/$USER/tasks
}

execute(){
 if   grep -qx "$1"   $CG/*/user/$USER/tasks
 then echo     "$1" > $CG/fast/user/$USER/tasks
 else RUN=$1; shift 1; exec $RUN "$@"
 fi
}

cgroup_load(){
 if   [ -f /lib/cgroup/functions ]
 then .    /lib/cgroup/functions
 fi
}

help "$1" &&
cgroup_load &&
user_fast &&
execute "$@"
