# Version 20120526 causes /bin/login from shadow to segfault
# Version 20111218 causes a segfault in glibc
# Version 20111218 probably has bugs that manifest
# on a glibc system but not a BSD C based system.
# While I want to transition from Linux-PAM to openpam;
# openpam seems too buggy for that just yet.
# openpam version 20111218 is unusable both with
# glibc version 2.13 and 2.15

with trait   broke
with info    omit 20140101
with info    last 20120526
with version stable 20120526
#with elect   cracklib   ''             --disable-cracklib for password checking library
#with elect   db         --enable-db=db --enable-db=no     for userdb support
#with elect   libxcrypt '' '' for blowfish encrypted passwords
#      with also --enable-read-both-confs
#      with also --disable-nis
with sys_user auth
with role    security/authentication
with trait   library makej multilib-dual
#trait multilib-concurrent
with source  $SOURCEFORGE_URL openpam/openpam/Micrampelis/openpam-$VERSION.tar.gz
#   source $SOURCEFORGE_URL openpam/openpam/Lycopsida/openpam-$VERSION.tar.gz
with info    home http://www.openpam.org/

# /lib and /lib64 reserved for ELFs required for booting box
# not necessarily ELFs required for login and authentication.
# However, if the root filesystem can not be mounted
# login must be possible from the initramfs

with protect /etc/security/
with hold    PAM
with info    cite 'implementation of pluggable authentication method
that attempts to maintain compatibility
with Solaris PAM, Linux-PAM and XSSO'

build(){
 adjust_unix_chkpwd(){
  chown root:auth $DESTDIR/sbin/unix_chkpwd
  chmod 2755      $DESTDIR/sbin/unix_chkpwd
 }

 if   [[ $HOSTTYPE == x86_64 ]] && ! [[ $CFLAGS =~ -m32 ]]
 then with also --libdir=/lib64
 else with also --libdir=/lib
 fi

 export HAVE_SGML2LATEX=no
 sed -i 's: doc examples::g' Makefile.in

 default_build
# &&
# adjust_unix_chkpwd
}

post_install(){
 default_post_install
          get_provider pam_ldap |
 pipe     show_installed        |
 LC_ALL=C sort | uniq -d        |
          pipe_queue $MOIL_QUEUE
}

current(){
 if   ! [ -f         $PROVIDE_LOGS/PAM ]
 then echo openpam > $PROVIDE_LOGS/PAM
 fi
}
