   VERSION=( "3.0.2" )
  CATEGORY="utility"
 ATTRIBUTE="console x11 broken old_init"
# has old init and compile errors.
    SOURCE="apmd-$VERSION.tar.gz"
  HOMEPAGE="http://www.worldvisions.ca/~apenwarr/apmd"
       URL="http://www.worldvisions.ca/~apenwarr/apmd"
       REQ=( "" "x11::--without-x11:for xapm x11 graphical battery power indicator" )
      DESC="apmd contains user-level programs for Advanced Power Management."

build() {
 case  $VERSION  in
  3.0.2)  patch  -p0  <  $SCRIPT_DIR/apmd-3.0.2.patch
 esac

 if    echo  "$OPTS"  |  grep  -q  "\--without-x11"
 then  patch  -p1  <  $SCRIPT_DIR/apmd.Makefile.nox11.diff
 fi

 sed  -i  "s:CFLAGS=-O -g:CFLAGS=$CFLAGS:"   Makefile

 make           &&
 make  install  &&
 cp  $SCRIPT_DIR/apmd.sh  /etc/init.d
}

pre_remove() {
 default_pre_remove
 /etc/init.d/apmd.sh  stop
}
