# The apng patch does not cleanly apply.
# All 1.2.x releases after 1.2.40 are security fixes.
# 1.2.41 failed compilation

# 1.4.3 was a security release?
# 1.4.6 branch only receives security updates now.
# 1.5.10, 1.5.9 and 1.5.8 were security releases.

with version   stable 1.5.13 1.5.12 1.5.11
   version   secure 1.5.13 1.5.12
with version unstable 1.6.0beta29
with base    zlib
with also    --enable-static=no
with role    graphic
with trait   library lto makej multilib-concurrent
with source    stable $SOURCEFORGE_URL libpng/libpng${VERSION:0:1}${VERSION:2:1}/$VERSION/libpng-$VERSION.tar.xz
with source  unstable $SOURCEFORGE_URL libpng/libpng${VERSION:0:1}${VERSION:2:1}/$VERSION/libpng-$VERSION.tar.xz
with source    secure $SOURCEFORGE_URL libpng/libpng${VERSION:0:1}${VERSION:2:1}/$VERSION/libpng-$VERSION.tar.xz
with info    last 20120927
with info    home http://www.libpng.org/pub/png/libpng.html
with info    cite 'library that supports the PNG graphics format
libpng is the PNG library is a collection of routines
used to create and manipulate PNG format graphics files.
The PNG format was designed as a replacement for GIF
and to a lesser extent, TIFF, with many improvements and extensions.'

build(){
# Default method chooses cmake.
# libpng's cmake files can not do lib64 install directories.

 rm -f CMakeLists.txt
 default_build

# OPTS="--sysconfdir=/etc --localstatedir=/var --prefix=/usr $OPTS"
# ./configure $OPTS &&
# make &&
# make install "DESTDIR=$DESTDIR"
}

post_install(){
 local CVER=${VERSION:0:1}${VERSION:2:1}
 local PVER=${VERSION:0:1}${VERSION:2:1}; (( PVER-- ))

 LC_ALL=C grep -l "libpng$PVER\.la" /usr/lib{,64}/*.la |
 xargs -r --max-lines=64 \
 sed -i "s:libpng$PVER\.la:libpng$CVER.la:"
 default_post_install
}
