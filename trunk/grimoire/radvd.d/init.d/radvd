#! /bin/bash

### BEGIN INIT INFO
# Provides: sshd
# Required-Start: $network
# Required-Stop:  $network
# Default-Start: 3 4 5
# Default-Stop: 0 1 2 6
# Short-Description: radvd ipv6 statless advertisement deamon
# Description: radvd ipv6 statless advertisement deamon
### END INIT INFO


NAME=radvd
SERV="/usr/sbin/${NAME}"
DESC="ipv6 statless advertisement deamon"
PIDF="/var/run/radvd.pid"
CONF=/etc/radvd.conf
ENABLE_FORWARD=true

# Options
OPTIONS=""

. /lib/lsb/init-functions

verify() {
    # Verify that the configuration file exists
    if [ ! -f /etc/radvd.conf ]; then
    	echo "RADVD Configuration file /etc/radvd.conf doesn't exist"
    	exit 1;
    fi
		if $ENABLE_FORWARD; then
			echo 1 > /proc/sys/net/ipv6/conf/all/forwarding
			echo 1 > /proc/sys/net/ipv6/conf/default/forwarding
		fi
}

start() {
  log_warning_msg  "$NAME about to start"
  if    start_daemon     -p $PIDF $SERV -C ${CONF}
  then  log_success_msg  "$NAME started"
  else  log_failure_msg  "$NAME not started"
        status
  fi
}

stop() {
  log_warning_msg "$NAME about to stop"
  if     killproc        -p $PIDF -s 15  $SERV
  then  log_success_msg "$NAME stopped"
  else  log_failure_msg "$NAME not stopped"
        status
        return 0
  fi
}

case "$1" in
  start)  verify && start   ;;
  stop)    stop    ;;
  restart|reload|force-reload)   stop && sleep1 && start ;;
  *)
	echo "Usage: /etc/init.d/$NAME {start|stop|reload|force-reload|restart}" >&2
	exit 1
esac

exit 0
