# This spell still requires an init-script to run resume
# from the initramfs.
# I am still thinking about it.

   version stable 1.0
   require libx86 pciutils
# it was unable to locate installed libgcrypt
# optional libgcrypt --enable-encrypt
      opts --with-initramfsdir=/sbin --disable-resume-static
  category utility
 attribute console x86
    source $SOURCEFORGE_URL suspend/suspend/suspend-$VERSION/suspend-utils-$VERSION.tar.bz2
      info last  20110306
      info home  http://suspend.sourceforge.net
      desc 'tools that concurrently suspend to RAM and disk.'

build(){
 modify_config(){
  local OFFSET
  local DEVICE="$( tr -s ' ' < /proc/swaps | grep -v zram | cut -f1 | cut -d ' ' -f1 | sed "2p;d" )"
  local   TYPE="$( tr -s ' ' < /proc/swaps | grep -v zram | cut -f1 | cut -d ' ' -f2 | sed "2p;d" )"
  if [ -z "$TYPE" ]; then return; fi
  if [ "$TYPE" == file ]; then
   OFFSET=$( swap-offset $DEV )
#  DEVICE=   How to discover this?
   sed -i "1iresume offset = $OFFSET" $DESTDIR/etc/suspend.conf
  else
   sed -i "s:<path_to_resume_device_file>:$DEVICE:" $DESTDIR/etc/suspend.conf
  fi
 } 

 default_build &&
 modify_config
}

current(){
 case $VERSION in
  1.0) grep -q "only start" /etc/init.d/resume ;;
 esac
}
