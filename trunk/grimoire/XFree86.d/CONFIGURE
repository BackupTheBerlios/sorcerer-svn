build_checklist()  {

  STATUS=$1
  LABEL=$2
  shift  2

  for  ITEM  in  $@;  do
    echo  $ITEM  $LABEL  $STATUS
  done

}


select_card_drivers()  {

  TITLE="Graphics Card Driver Selection Menu"
  HELP="Key:  [X] = on, [ ] = off"

  CHECKLIST="`build_checklist ON   Graphics   $ON_CARD_DRIVERS`
             `build_checklist OFF  Grahpics  $OFF_CARD_DRIVERS`"

  if  XF86CardDrivers=`dialog  --backtitle  "$BACKTITLE"  \
                               --title      "$TITLE"      \
                               --stdout                   \
                               --separate-output          \
                               --checklist  "$HELP"       \
                               18 55 10                   \
                               $CHECKLIST`
  then
     ON_CARD_DRIVERS=$XF86CardDrivers
    OFF_CARD_DRIVERS=$CARD_DRIVERS

    for  ITEM  in  $ON_CARD_DRIVERS;  do
      OFF_CARD_DRIVERS=`echo  $OFF_CARD_DRIVERS  |  sed  s/$ITEM//`
    done
  fi

}


select_dridrivers()  {

  TITLE="DRI Driver Selection Menu"
  HELP="Not all XFree86 supported graphics cards have DRI.
Key:  [X] = on, [ ] = off"

    CHECKLIST="`build_checklist  ON   DRI   $ON_DRI`
               `build_checklist  OFF  DRI  $OFF_DRI`"

  if  DriDrivers=`dialog  --backtitle  "$BACKTITLE"  \
                          --title      "$TITLE"      \
                          --stdout                   \
                          --separate-output          \
                          --checklist  "$HELP"       \
                          18 55 10                   \
                          $CHECKLIST`
  then
     ON_DRI=$DriDrivers
    OFF_DRI=$DRI

    for  ITEM  in  $ON_DRI;  do
      OFF_DRI=`echo  $OFF_DRI  |  sed  s/$ITEM//`
    done
  fi

}


select_input_drivers()  {

  TITLE="Input Driver Selection Menu"
  HELP="Key:  [X] = on, [ ] = off"

  CHECKLIST="`build_checklist  ON   Input   $ON_INPUT_DRIVERS`
             `build_checklist  OFF  Input  $OFF_INPUT_DRIVERS`"

  if  XInputDrivers=`dialog  --backtitle  "$BACKTITLE"  \
                             --title      "$TITLE"      \
                             --stdout                   \
                             --separate-output          \
                             --checklist  "$HELP"       \
                             18 55 10                   \
                             $CHECKLIST`
  then
     ON_INPUT_DRIVERS=$XInputDrivers
    OFF_INPUT_DRIVERS=$INPUT_DRIVERS

    for  ITEM  in  $ON_INPUT_DRIVERS;  do
      OFF_INPUT_DRIVERS=`echo  $OFF_INPUT_DRIVERS  |  sed  s/$ITEM//`
    done
  fi

}


initialize()  {

  BACKTITLE="Sorcery XFree86 host.def Configuration Menu"

   ON_CARD_DRIVERS="vga vesa v4l"
  OFF_CARD_DRIVERS="mga glint nv tga s3 s3virge sis rendition 
                    neomagic i740 tdfx savage 
                    cirrus vmware tseng trident chips apm
                    GlideDriver i128 NscDriver
                    ati i810 ark 
                    cyrix siliconmotion via 
                    fbdev dummy imstt newport"
      CARD_DRIVERS="$ON_CARD_DRIVERS  $OFF_CARD_DRIVERS"


   ON_DRI=""
  OFF_DRI="gamma i810 i830 mga r128 radeon r200 sis tdfx ffb"
      DRI="$ON_DRI  $OFF_DRI"


   ON_INPUT_DRIVERS="mouse keyboard"
  OFF_INPUT_DRIVERS="acecad calcomp citron 
                     digitaledge dmc dynapro elographics tek4957 
                     microtouch mutouch penmount spaceorb summa 
                     wacom void magellan hyperpen 
                     jamstudio fpit palmax"
      INPUT_DRIVERS="$ON_INPUT_DRIVERS  $OFF_INPUT_DRIVERS"


  YES_MISC_OPTIONS="BuildXF86DRI BuildGLULibrary BuildGLXLibrary BuildGlxExt BuildLBX BuildXCSecurity ForceNormalLib HasAgpGart HasCplusplus HasShm XnestServer XprtServer"
   NO_MISC_OPTIONS="BuildFontServer   InstallFSConfig
                    BuildServersOnly  BuildPexExt  BuildXF86DRM
                    BuildXF86RushExt  LinuxFBDevSupport 
                    XVirtualFramebufferServer"
      MISC_OPTIONS="$YES_MISC_OPTIONS  $NO_MISC_OPTIONS"
# BuildXAudio BuildXAServer 

  TARGET_CONFIG="$CONFIG_LOGS/$SPELL/host.def"

}


generate_host_def()  {

  if  [  -z  "$XF86CardDrivers"  ];  then
  XF86CardDrivers="$ON_CARD_DRIVERS"
  fi

  echo  "#define XF86CardDrivers $XF86CardDrivers"  |  tr  '\n' ' '
  echo

  if  [  -z  "$DriDrivers"  ]
  then  echo  "#define DriDrivers /**/"
  else  echo  "#define DriDrivers $DriDrivers"  |  tr  '\n' ' '
        echo
  fi

  if  [  -z  "$XInputDrivers"  ]
  then  echo  "#define XInputDrivers mouse"
  else  echo  "#define XInputDrivers $XInputDrivers"  |  tr  '\n' ' '
        echo
  fi

  for  ITEM  in  $YES_MISC_OPTIONS;  do  echo  "#define $ITEM YES";  done
  for  ITEM  in   $NO_MISC_OPTIONS;  do  echo  "#define $ITEM  NO";  done

}


save_host_def()  {


  dialog  --backtitle  "$BACKTITLE"  \
          --msgbox     "Saving Configuration to $TARGET_CONFIG"  \
          8 60

  generate_host_def  >  $TARGET_CONFIG

}


select_misc_options() {

  TITLE="Select Misc Options"
  CHECKLIST="`build_checklist  ON   Option  $YES_MISC_OPTIONS`
             `build_checklist  OFF  Option   $NO_MISC_OPTIONS`"
  HELP="Key:  [X] = on, [ ] = off"

  if  ON_MISC_OPTIONS=`dialog  --backtitle  "$BACKTITLE"  \
                               --title      "$TITLE"      \
                               --stdout                   \
                               --separate-output          \
                               --checklist  "$HELP"       \
                               18 55 10                   \
                               $CHECKLIST`
  then
    YES_MISC_OPTIONS=$ON_MISC_OPTIONS
     NO_MISC_OPTIONS=$MISC_OPTIONS

    for  ITEM  in  $YES_MISC_OPTIONS;  do
      NO_MISC_OPTIONS=`echo  $NO_MISC_OPTIONS  |  sed  s/$ITEM//`
    done
  fi

}


configure_host_def()  {

  initialize

  while  

    COMMAND=`dialog  --backtitle  "$BACKTITLE"                        \
                     --stdout                                         \
                     --title  "Main Menu"                             \
                     --default-item  $COMMAND                         \
                     --nocancel                                       \
                     --menu                                           \
                     ""                                               \
                     18 55 10                                         \
                     "XF86CardDrivers"  "Select Video Card Drivers"   \
                     "DriDrivers"       "Select Direct DRI Drivers"   \
                     "XInputDrivers"    "Select Input Drivers"        \
                     "Misc"             "Set other Options"           \
                     "Save"             "Save current configuration"  \
                     "Edit"             "Edit host.def"               \
                     "Exit"             "Done here.  Start building"`
  do

    case  $COMMAND  in
                 Exit)  break  ;;
                 Save)  save_host_def  ;;
                 Edit)  [  -n   "$EDITOR"  ]                   &&
                        $EDITOR  $CONFIG_LOGS/$SPELL/host.def  ||
                        nano     $CONFIG_LOGS/$SPELL/host.def  ;;
      XF86CardDrivers)  select_card_drivers   ;;
           DriDrivers)  select_dridrivers     ;;
        XInputDrivers)  select_input_drivers  ;;
                 Misc)  select_misc_options   ;;
    esac
  done

}

if    !  [  -f  $CONFIG_LOGS/$SPELL/host.def  ]
then  configure_host_def
fi
