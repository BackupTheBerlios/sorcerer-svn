   VERSION=( 4.0.0 )
  CATEGORY='administration'
 ATTRIBUTE='kde4 archive_off solo'
  HOMEPAGE='http://sorcerer.silverice.org/'
  ESTIMATE='5'
 CONFLICTS='kde-symlinks'
      DESC='kde-symlinks-v4 ensures kde configuration files go into /etc'

build(){
 move(){
  if ! [ -d $2 ]; then mkdir -p $2; fi
  if   [ -h $1 ]; then return; fi
  if   [ -d $1 ]; then
   mkdir -vp      $2
   cp    -av $1/* $2
   rm    -fr $1
  fi
 }

 link(){ rm -f $1; ln -sv $2 $1; }

 move /opt/kde4/share/config      /etc/kde4.config
 move /opt/kde4/share/config.kcfg /etc/kde4.config.kcfg
 move /opt/kde4/etc               /etc
 move /opt/kde4/lib/pkgconfig     /usr/lib/pkgconfig
 prepare_install
 link /opt/kde4/share/config      /etc/kde4.config
 link /opt/kde4/share/config.kcfg /etc/kde4.config.kcfg
 link /opt/kde4/etc               /etc
 link /opt/kde4/lib/pkgconfig     /usr/lib/pkgconfig
}

current(){
 find /var/tmp -maxdepth 0 -perm 1777 | grep -q . || chmod 1777 /var/tmp
 [ -h /opt/kde4/lib/pkgconfig ] &&
 [ -h /opt/kde4/share/config ] &&
 [ -h /opt/kde4/share/config.kcfg ] &&
 [ -d /etc/kde4.config ] &&
 [ -d /etc/kde4.config.kcfg ]
}
