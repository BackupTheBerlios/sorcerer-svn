# SimGear version 2.0.0 and FlightGear version 2.0.0
# are not compatible with OpenSceneGraph version 3.0.0
# FlightGear 2.4.0 is not compatible with OpenSceneGraph version 3.0.0

# FlightGear 2.4.0 brainless attempts to open
# /usr/lib/osgPlugins-2.8.5/osgdb_png.so
# instead of the ELF 64-bit libraries
# when multilib OpenSceneGraph is installed.

# Version 3.0.1 has an unimportant optional on qt-everywhere-opensource

   version   stable 3.0.1 2.8.5 2.8.4 2.8.3 2.8.2 2.8.1
#  version   latest 3.0.1 3.0.0
#  version unstable 3.0.1 3.0.0
case $VERSION in
 3.0.1)
   require ffmpeg-v0.7 ;;
esac
   require LibVNCServer curl ffmpeg giflib librsvg openexr poppler xine-lib
  category graphic
 attribute library makej multilib-fail optimize x11
    source http://www.openscenegraph.org/downloads/stable_releases/OpenSceneGraph-$VERSION/source/OpenSceneGraph-$VERSION.zip
#   source http://www.openscenegraph.org/downloads/stable_releases/OpenSceneGraph-${VERSION:0:3}/source/OpenSceneGraph-$VERSION.zip
#   source http://www.openscenegraph.org/downloads/stable_releases/OpenSceneGraph-$VERSION/source/OpenSceneGraph-$VERSION.zip
      info vurl http://www.openscenegraph.org/projects/osg/wiki/Downloads
      info last 20110630
      info home http://www.openscenegraph.org/projects/osg
      info docs http://www.openscenegraph.org/projects/osg/wiki/Support
      desc '3D graphics toolkit'

build(){
 ffmpeg_legacy(){
  local SUFFIX

  if   [[ $HOSTTYPE == x86_64 ]] && ! [[ $CFLAGS =~ -m32 ]]
  then SUFFIX=64
  else SUFFIX=
  fi

  export   CFLAGS+=' -I/opt/ffmpeg/0.7/usr/include'
  export CXXFLAGS+=' -I/opt/ffmpeg/0.7/usr/include'
  export      PKG_CONFIG_PATH="/opt/ffmpeg/0.7/usr/lib$SUFFIX:$PKG_CONFIG_PATH"
  export LDFLAGS+=" -Wl,-rpath,/opt/ffmpeg/0.7/usr/lib$SUFFIX"

    opts -DFFMPEG_ROOT:PATH=/opt/ffmpeg/0.7/usr

    opts -DFFMPEG_LIBAVCODEC_INCLUDE_DIRS:PATH=/opt/ffmpeg/0.7/usr/include
    opts -DFFMPEG_LIBAVDEVICE_INCLUDE_DIRS:PATH=/opt/ffmpeg/0.7/usr/include
    opts -DFFMPEG_LIBAVFORMAT_INCLUDE_DIRS:PATH=/opt/ffmpeg/0.7/usr/include
    opts -DFFMPEG_LIBAVUTIL_INCLUDE_DIRS:PATH=/opt/ffmpeg/0.7/usr/include
    opts -DFFMPEG_LIBSWSCALE_INCLUDE_DIRS:PATH=/opt/ffmpeg/0.7/usr/include

    opts -DFFMPEG_LIBAVCODEC_LIBRARIES:FILEPATH=/opt/ffmpeg/0.7/usr/lib$SUFFIX
    opts -DFFMPEG_LIBAVDEVICE_LIBRARIES:FILEPATH=/opt/ffmpeg/0.7/usr/lib$SUFFIX
    opts -DFFMPEG_LIBAVFORMAT_LIBRARIES:FILEPATH=/opt/ffmpeg/0.7/usr/lib$SUFFIX
    opts -DFFMPEG_LIBAVUTIL_LIBRARIES:FILEPATH=/opt/ffmpeg/0.7/usr/lib$SUFFIX
    opts -DFFMPEG_LIBSWSCALE_LIBRARIES:FILEPATH=/opt/ffmpeg/0.7/usr/lib$SUFFIX
 }

 case $VERSION in
  3.0.1) ffmpeg_legacy ;;
  2.8.5) sed -i '\,curl/types.h,d' src/osgPlugins/curl/ReaderWriterCURL.cpp ;;
 esac

 export CXXFLAGS+=' -D__STDC_CONSTANT_MACROS'
 default_build
}
