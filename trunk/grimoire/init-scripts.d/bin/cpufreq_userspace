#!/bin/bash
# Set all CPU cores to specified frequency

if   (( UID == 0 )) && ! lsmod | grep -q cpufreq_userspace
then modprobe cpufreq_userspace
fi

for CPU in /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor
do [ -f "$CPU" ] && echo userspace > $CPU
done

C=/sys/devices/system/cpu

if   grep -qw "$1" $C/cpu0/cpufreq/scaling_available_frequencies
then for CPU in    $C/cpu*/cpufreq/scaling_setspeed; do [ -f "$CPU" ] && echo "$1" > $CPU; done
elif [ -f          $C/cpu0/cpufreq/scaling_available_frequencies ]
then cat           $C/cpu0/cpufreq/scaling_available_frequencies
fi
