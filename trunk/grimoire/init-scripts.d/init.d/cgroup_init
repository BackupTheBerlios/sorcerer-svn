#!/bin/bash

# Copyright 2011 by Kyle Sallee,
# All rights reserved.
# For use with the Sorcerer distribution only.

### BEGIN INIT INFO
# Default-Mode: 500
# Required-Start: cgroup_daemon
# Default-Start: S
# Short-Description: joins init to a cgroup
### END INIT INFO

. /lib/lsb/init-functions

only start
deny control

start(){
 join(){
  find_cgroup &&
  mkdir -p $CG/{blkio,cpu,cpuset,freezer,memory}/daemon/init &&
  echo 1 > $CG/blkio/daemon/init/tasks &&
  echo 1 > $CG/cpu/daemon/init/tasks &&
  echo 1 > $CG/cpuset/daemon/init/tasks &&
  echo 1 > $CG/freezer/daemon/init/tasks &&
  echo 1 > $CG/memory/daemon/init/tasks
 }

 if   log_warning_msg "init joining cgroup"; join
 then log_success_msg "init joined  cgroup"
 else log_failure_msg "init failed to join cgroup"
 fi
}
