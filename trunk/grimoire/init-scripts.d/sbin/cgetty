#!/bin/bash

if   [ -f   /domain/user ]
then DOMAIN=/domain/user
else DOMAIN=
fi

if   read < /proc/cmdline;
     [[ $REPLY =~ boot=IR ]] &&
     ! grep -q /media/root/real /etc/fstab
then
 if   [[ $@ =~ tty1 ]] && [ -f /bin/login_root ]
 then exec  /sbin/agetty -n -l /bin/login_root "$@"
 else exec  /sbin/agetty "$@"
 fi
elif [ -x /media/root/real/etc/init.d/boot-sentient ] &&
     [ -f /media/root/real/bin/login_root ] &&
     [ -f /media/root/real/sbin/agetty ] &&
     [[ $@ =~ tty1 ]]
then exec /bin/chroot /media/root/real /sbin/agetty -n -l /bin/login_root "$@"
elif [ -f /media/root/real/sbin/agetty ]
then exec /bin/chroot /media/root/real $DOMAIN /sbin/agetty "$@"
else exec                              $DOMAIN /sbin/agetty "$@"
fi
