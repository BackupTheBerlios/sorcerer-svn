#!/bin/bash

### BEGIN INIT INFO
# Provides: fsck
# Required-Start: fstab
# Should-Start: cryptsetup dmsetup hwclock loadkeys localtime mapper mdadm udev
# Default-Start: S
# Short-Description: fsck checks local filesystems during boot
### END INIT INFO

. /lib/lsb/init-functions

start(){
 fsc(){
  if [ -f /fastboot      ]; then return; fi
  if [ -f /forcefsck     ]; then FORCE='-f'; fi
  if [ "$FSCKFIX" == yes ]; then FIX='-y';
                            else FIX='-a'; fi

  fsck -C -A $FIX $FORCE &>/dev/console 0</dev/console
  if [ $? -gt 1 ]; then
   log_failure_msg 'fsck failed' &>/dev/console
   log_failure_msg 'Repair file systems by running /sbin/fsck' &>/dev/console
   sulogin -t 120 &>/dev/console 0</dev/console
  fi
 }

 log_warning_msg 'Local file systems checking'; fsc
 log_success_msg 'Local file systems checked'
}
       stop(){ :; }
    restart(){ :; }
try_restart(){ :; }
parse "$@"
