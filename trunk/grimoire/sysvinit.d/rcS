#!/bin/bash
trap : INT QUIT TSTP
export PATH=/usr/local/bin:/usr/local/sbin:/usr/bin:/usr/sbin:/bin:/sbin
umask 022

box(){
 if   [ -f  "/media/root/$1" ]
 then chroot /media/root $1 start
 else                    $1 start
 fi
}

run(){
 for SCRIPT in /etc/rc.d/rcS.d/S*; do
  if   [ -x "$SCRIPT" ]
  then box  "$SCRIPT"
  fi
 done
 echo End sysinit
}

md(){ [ -d $1 ] || mkdir -p $1; }
mn(){ [ -c $1 ] || mknod $1 c 5 1; }

[ -f /proc/version ] || exit

I=/etc/init.d
L=$I/log.d
D=$I/dev.d

md $L
md $D
mn $D/si
mn $D/rl
mount -o size=1m,nr_inodes=8 -t tmpfs tmpfs $L
run 2>&1 | tee $L/sysinit > $D/si
