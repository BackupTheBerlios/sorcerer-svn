# make: *** No rule to make target ../../nsprpub/configure.  Stop.
# 3.12.8 failed to compile

    stable 3.12.8 3.12.7 3.12.6
   require nspr sqlite zlib
# NSPR_VER='4.8'
  category network/web
 attribute library
    source ftp://ftp.mozilla.org/pub/mozilla.org/security/nss/releases/NSS_${VERSION//\./_}_RTM/src/nss-$VERSION.tar.gz
#   source ftp://ftp.mozilla.org/pub/mozilla.org/security/nss/releases/NSS_${VERSION//\./_}_RTM/src/nss-$VERSION-with-nspr-$NSPR_VER.tar.gz
case $VERSION in
 3.12.8) source http://www.linuxfromscratch.org/patches/blfs/svn/nss-3.12.8-standalone-1.patch ;;
 3.12.7) source http://www.linuxfromscratch.org/patches/blfs/svn/nss-3.12.5-standalone-1.patch ;;
 3.12.6) source http://www.linuxfromscratch.org/patches/blfs/svn/nss-3.12.5-standalone-1.patch ;;
esac
  homepage http://www.mozilla.org/projects/security/pki/nss/
  estimate 2000
      desc 'mozilla network security service libraries'

build(){
make_install(){
 mkdir -p $DESTDIR/usr/{bin,include/nss,lib/pkgconfig}
#install -vm755 -d /usr/include/nss /usr/lib/pkgconfig
 cd mozilla/dist
 chmod 644 {public,private}/nss/*
 cp -vRL   {public,private}/nss/* $DESTDIR/usr/include/nss
 cd Linux*
 install -vm755 lib/*.so              $DESTDIR/usr/lib
 install -vm644 lib/{*.chk,libcrmf.a} $DESTDIR/usr/lib
 install -vm755 bin/nss-config        $DESTDIR/usr/bin
 install -vm644 lib/pkgconfig/nss.pc  $DESTDIR/usr/lib/pkgconfig
}

(

case $HOSTTYPE in
x86_64) export USE_64=1 ;;
esac

patch -p1 < ${SOURCE[1]}
export BUILD_OPT=1
export NSS_USE_SYSTEM_SQLITE=1
export NSPR_INCLUDE_DIR=/usr/include/nspr
#export NSS_INCLUDE_DIR=/usr/include/nss
export USE_SYSTEM_ZLIB=1
export ZLIB_LIBS=-lz
make -C mozilla/security/nss nss_build_all &&
make_install
)
}
