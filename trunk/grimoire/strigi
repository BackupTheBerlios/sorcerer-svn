# Strigi versions 0.7.7 and 0.7.5 no longer compile
# following the upgrade to gcc version 4.7.1
# Disabling QT4 and DBUs support fixes compilation issues.

   version stable 0.7.7 0.7.5 0.7.2 0.6.4 0.6.3 0.5.10
   version legacy 0.7.5 0.7.2 0.6.4 0.6.3 0.5.10
case $VERSION in
 0.7.7)
      opts -DENABLE_FFMPEG:BOOL=OFF -DENABLE_QT4:BOOL=OFF -DENABLE_DBUS:BOOL=OFF ;;
 0.7.5)
      opts -DENABLE_FFMPEG:BOOL=OFF -DENABLE_QT4:BOOL=OFF -DENABLE_DBUS:BOOL=OFF ;;
esac
   inherit kde-v4

   require bzip2 clucene-core cmake dbus exiv2 libxml2 zlib
  optional qt-everywhere-opensource '' '' for a graphical interface
  category utility/search
 attribute kde4 library makej multilib-dual setarch
    source stable http://ftp.debian.org/debian/pool/main/s/strigi/strigi_$VERSION.orig.tar.bz2
    source legacy $SOURCEFORGE_URL strigi/strigi/strigi-$VERSION.tar.bz2
#   source http://www.vandenoever.info/software/strigi/strigi-$VERSION.tar.bz2
#     info good 20120612
      info last 20111231
      info home http://strigi.sourceforge.net/
      info home http://www.vandenoever.info/software/strigi/

#            'dbus:-DENABLE_DBUS:BOOL=ON:-DENABLE_DBUS:BOOL=OFF:for dbus support'
# No tarball for log4cxx available as of 20080114
      desc 'search engine'

build(){
# if   [[ $HOSTTYPE == x86_64 ]] && [[ $CFLAGS =~ -m32 ]]
# then export PATH=/opt/32bit/usr/bin:$PATH
# fi
 case $VERSION in
  0.7.7) sed -i '1i#include <unistd.h>' strigidaemon/bin/daemon/eventlistener/eventlistenerqueue.cpp ;;
  0.7.5) sed -i '1i#include <unistd.h>' strigidaemon/bin/daemon/eventlistener/eventlistenerqueue.cpp ;;
 esac
 default_build
}
