# 2.4.17 gained an optional on icu4c although I am not entirely certain why
# since openldap is not c++

# groff is requiered as the spell create soelim tool
# however groff is normally installed on a Sorcerer box
# Adding groff as a requirement to openldap creates a recursive requirement loop
# according to the info vurl the stable release is 2.4.16 on Wed Oct  7 18:34:46 UTC 2009


   version stable 2.4.23 2.4.21
   version release 2.4.31 2.4.30 2.4.28 2.4.26 2.4.25 2.4.24 2.4.23
   require db icu4c libtool
#  require cyrus-sasl db icu4c libtool
  optional cyrus-sasl '--enable-ldapdb --without-ldap' '' 'for saslauthd and LDAPDB plugin'
  optional heimdal --with-kerberos --without-kerberos for kerberos support
      opts --enable-shell --enable-dynamic --enable-modules=yes --enable-static=no
  category utility
 attribute console library makej multilib-concurrent
      info vurl http://www.openldap.org/software/download/
    source  ftp://ftp.openldap.org/pub/OpenLDAP/ \
            ftp://gd.tuwien.ac.at/infosys/network/OpenLDAP/ \
            ftp://ftp.ucr.ac.cr/pub/Unix/openldap/ \
            ftp://ftp.ntua.gr/mirror/OpenLDAP/ \
            ftp://ftp.dti.ad.jp/pub/net/OpenLDAP/ \
            ftp://ftp.u-aizu.ac.jp/pub/net/openldap/ \
            ftp://ftp.nl.uu.net/pub/unix/db/openldap/ \
            ftp://ftp.plug.pt/pub/OpenLDAP/ \
            ftp://ftp.si.uniovi.es/mirror/OpenLDAP/ \
            ftp://sunsite.cnlab-switch.ch/mirror/OpenLDAP/ \
            ftp://ftp.net.lut.ac.uk/openldap/ \
            ftp://ftp.plig.org/pub/OpenLDAP/ \
            http://www.openldap.org/software/download/OpenLDAP/ \
            openldap-release/openldap-$VERSION.tgz
      info last 20110214
      info home http://www.openldap.org/
      desc 'fully featured open source LDAP software suite
openldap is a fully featured open source LDAP software suite.
OpenLDAP Software provides a complete LDAP implementation including
server, clients, C SDK, and associated tools.'

#             --enable-bdb          \
#             --with-bdb-module=dynamic  \
#             --enable-dnssrv       \
#             --with-dnssrv-module=dynamic
# can build dynamic modules advantageous
# for binary based distros, but probably not sorcerer.

build(){
 case $VERSION in
  2.4.21) sed -i 's:ol_DB_LIB=$:ol_DB_LIB=-ldb-5:'        configure
          sed -i 's:ol_cv_lib_db=no:ol_cv_lib_db=-ldb-5:' configure ;;
  2.4.23) sed -i 's:ol_DB_LIB=$:ol_DB_LIB=-ldb-5:'        configure
          sed -i 's:ol_cv_lib_db=no:ol_cv_lib_db=-ldb-5:' configure ;;
 esac
 # ol_cv_db_none=yes \
 ol_cv_berkeley_db_version=yes \

 if   [[ $HOSTTYPE == x86_64 ]] && [[ $CFLAGS =~ -m32 ]]
 then CC="gcc -m32" default_build
 else               default_build
 fi
}


post_install(){
 default_post_install
          get_provider  pam_ldap |
 pipe     get_provider  nss_ldap |
 pipe     show_installed         |
 LC_ALL=C sort                   |
          uniq  -d               |
          pipe_queue $CAST_QUEUE
}
