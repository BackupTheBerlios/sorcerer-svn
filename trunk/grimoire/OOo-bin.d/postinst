#!/bin/sh

if [ "$1" = "configure" ] ; then  # first install
  # update shared mime-info database
  if [ -x /usr/bin/update-mime-database ]; then
    update-mime-database /usr/share/mime
  fi
  # update desktop database
  #if [ -x /usr/bin/update-desktop-database ]; then
  #  update-desktop-database -q /usr/share/applications
  #fi
  # update debian style menus
  #if [ -x /usr/bin/update-menus ]; then
  #  update-menus
  #fi
  # update icon-cache if already present
  for theme in gnome hicolor locolor; do
    if [ -e /usr/share/icons/$theme/icon-theme.cache ] ; then
      # touch it, just in case we cannot find the binary...
      touch /usr/share/icons/$theme
      if (which gtk-update-icon-cache); then
        gtk-update-icon-cache /usr/share/icons/$theme
      fi
      # ignore errors (e.g. when there is a cache, but no index.theme)
      true
    fi
  done
fi

# update /etc/mime.types
# backing out existing entries to avoid duplicates
sed '
/application\/vnd\.oasis\.opendocument/d
/application\/vnd\.sun/d
/application\/vnd\.stardivision/d
' /etc/mime.types 2>/dev/null >> /etc/mime.types.tmp$$

# now append our stuff to the temporary file
cat >> /etc/mime.types.tmp$$ << END
application/vnd.oasis.opendocument.text	odt
application/vnd.oasis.opendocument.text-template ott
application/vnd.oasis.opendocument.text-web oth
application/vnd.oasis.opendocument.text-master odm
application/vnd.oasis.opendocument.graphics odg
application/vnd.oasis.opendocument.graphics-template otg
application/vnd.oasis.opendocument.presentation odp
application/vnd.oasis.opendocument.presentation-template otp
application/vnd.oasis.opendocument.spreadsheet ods
application/vnd.oasis.opendocument.spreadsheet-template ots
application/vnd.oasis.opendocument.chart odc
application/vnd.oasis.opendocument.formula odf
application/vnd.oasis.opendocument.image odi
application/vnd.sun.xml.writer sxw
application/vnd.sun.xml.writer.template stw
application/vnd.sun.xml.writer.global sxg
application/vnd.stardivision.writer sdw vor
application/vnd.stardivision.writer-global sgl
application/vnd.sun.xml.calc sxc
application/vnd.sun.xml.calc.template stc
application/vnd.stardivision.calc sdc
application/vnd.stardivision.chart sds
application/vnd.sun.xml.impress sxi
application/vnd.sun.xml.impress.template sti
application/vnd.stardivision.impress sdd sdp
application/vnd.sun.xml.draw sxd
application/vnd.sun.xml.draw.template std
application/vnd.stardivision.draw sda
application/vnd.sun.xml.math sxm
application/vnd.stardivision.math smf
application/vnd.sun.xml.base odb
END

# and replace the original file
mv -f /etc/mime.types.tmp$$ /etc/mime.types 2>/dev/null

# update /etc/mailcap only at initial install
if [ "$1" = "configure" ]
then
  # backing out existing entries to avoid duplicates
  sed '
/^# OpenOffice.org/d
/^application\/vnd\.oasis\.opendocument/d
/^application\/vnd\.sun/d
/^application\/vnd\.stardivision/d
/^application\/vnd\.ms-word/d
/^application\/vnd\.ms-excel/d
/^application\/vnd\.ms-powerpoint/d
/^application\/x-star/d
/excel/d
/ms[-]*word/d
/powerpoint/d
' /etc/mailcap 2>/dev/null >> /etc/mailcap.tmp$$

  # now append our stuff to the temporary file
  cat >> /etc/mailcap.tmp$$ << END
# OpenOffice.org
application/vnd.oasis.opendocument.text; openoffice.org-2.0 -view %s
application/vnd.oasis.opendocument.text-template; openoffice.org-2.0 -view %s
application/vnd.oasis.opendocument.text-web; openoffice.org-2.0 -view %s
application/vnd.oasis.opendocument.text-master; openoffice.org-2.0 -view %s
application/vnd.sun.xml.writer; openoffice.org-2.0 -view %s
application/vnd.sun.xml.writer.template; openoffice.org-2.0 -view %s
application/vnd.sun.xml.writer.global; openoffice.org-2.0 -view %s
application/vnd.stardivision.writer; openoffice.org-2.0 -view %s
application/vnd.stardivision.writer-global; openoffice.org-2.0 -view %s
application/x-starwriter; openoffice.org-2.0 -view %s
application/vnd.oasis.opendocument.formula; openoffice.org-2.0 -view %s
application/vnd.sun.xml.math; openoffice.org-2.0 -view %s
application/vnd.stardivision.math; openoffice.org-2.0 -view %s
application/x-starmath; openoffice.org-2.0 -view %s
application/msword; openoffice.org-2.0 -view %s
application/vnd.oasis.opendocument.spreadsheet; openoffice.org-2.0 -view %s
application/vnd.oasis.opendocument.spreadsheet-template; openoffice.org-2.0 -view %s
application/vnd.sun.xml.calc; openoffice.org-2.0 -view %s
application/vnd.sun.xml.calc.template; openoffice.org-2.0 -view %s
application/vnd.stardivision.calc; openoffice.org-2.0 -view %s
application/x-starcalc; openoffice.org-2.0 -view %s
application/vnd.stardivision.chart; openoffice.org-2.0 -view %s
application/x-starchart; openoffice.org-2.0 -view %s
application/excel; openoffice.org-2.0 -view %s
application/msexcel; openoffice.org-2.0 -view %s
application/vnd.ms-excel; openoffice.org-2.0 -view %s
application/x-msexcel; openoffice.org-2.0 -view %s
application/vnd.oasis.opendocument.presentation; openoffice.org-2.0 -view %s
application/vnd.oasis.opendocument.presentation-template; openoffice.org-2.0 -view %s
application/vnd.sun.xml.impress; openoffice.org-2.0 -view %s
application/vnd.sun.xml.impress.template; openoffice.org-2.0 -view %s
application/vnd.stardivision.impress; openoffice.org-2.0 -view %s
application/x-starimpress; openoffice.org-2.0 -view %s
application/powerpoint; openoffice.org-2.0 -view %s
application/mspowerpoint; openoffice.org-2.0 -view %s
application/vnd.ms-powerpoint; openoffice.org-2.0 -view %s
application/x-mspowerpoint; openoffice.org-2.0 -view %s
application/vnd.oasis.opendocument.graphics; openoffice.org-2.0 -view %s
application/vnd.oasis.opendocument.graphics-template; openoffice.org-2.0 -view %s
application/vnd.sun.xml.draw; openoffice.org-2.0 -view %s
application/vnd.sun.xml.draw.template; openoffice.org-2.0 -view %s
application/vnd.stardivision.draw; openoffice.org-2.0 -view %s
application/x-stardraw; openoffice.org-2.0 -view %s
application/vnd.oasis.opendocument.database; openoffice.org-2.0 -view %s
application/vnd.sun.xml.base; openoffice.org-2.0 -view %s
END

  # and replace the original file
  mv -f /etc/mailcap.tmp$$ /etc/mailcap
fi

exit 0
