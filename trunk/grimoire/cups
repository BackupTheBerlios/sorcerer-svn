# espgs is needed but can't be placed as a requirement or
# it causes a circuliar requirement loop
#            'openssl:--enable-ssl:--disable-ssl:for secure socket connections' )

# I wonder why cups 1.3.9 gained a requirement on popt
# since popt is such an old library?

    stable 1.4.4 1.4.3 1.4.2 1.4.1 1.4.0
    secure 1.4.4 1.4.2
#  require acl libcap libpng openslp popt tiff
   require acl libpng openslp popt tiff
  optional Linux-PAM --enable-pam  --disable-pam  for pluggable authentication support
  optional dbus      --enable-dbus --disable-dbus for dbus support
  optional heimdal   ''            ''             for kerberos 5 support
  optional openldap  --enable-ldap --disable-ldap for ldap support
  category printer
 attribute console
  homepage http://www.cups.org
      vurl http://www.cups.org/software.php
    source http://ftp.easysw.com/pub/ \
            ftp://ftp.funet.fi/pub/mirrors/ftp.easysw.com/pub/ \
            ftp://ftp.mpg.goe.ni.schule.de/pub/internet/printing/ \
            ftp://ftp.ntua.gr/pub/gnu/ \
            cups/${VERSION/*svn*/snapshots}/cups-$VERSION-source.tar.bz2
    source $SOURCEFORGE_URL cups/cups-drivers/0.3.6/cups-drivers-all-0.3.6.tar.gz
      opts --without-rcdir
   exclude /etc/cups/certs
   protect /etc/printcap
  eprovide lpr
  estimate 1600
      desc 'portable printing layer'
   
build(){

 check_for_smb_backend(){
  if spell_installed samba; then  
   echo "Setting smb backend for cups"
   if   ! [ -e                   /usr/lib/cups/backend/smb ]
   then ln  -s /usr/bin/smbspool /usr/lib/cups/backend/smb
   fi
  fi
 }

 if spell_installed Linux-PAM; then OPTS+=' --enable-pam'; fi
 if spell_installed openssl;   then OPTS+=' --enable-ssl'; fi

 OPTS+=' --libdir=/usr/lib'
 case $HOSTTYPE in
  x86_64) sed -i 's:/lib/security/pam:/lib64/security/pam:' configure
          OPTS+=64  ;;
 esac

 default_build            &&
 cp    -vR  usr/* /usr    &&
 cp    -vR  var/* /var    &&
 cd         var/cups/conf &&
 mkdir -p   /etc/cups     &&
 cp    -v * /etc/cups     &&
 check_for_smb_backend
}
