# espgs is needed but can't be placed as a requirement or
# it causes a circuliar requirement loop
#            'openssl:--enable-ssl:--disable-ssl:for secure socket connections' )

# I wonder why cups 1.3.9 gained a requirement on popt
# since popt is such an old library?

    stable 1.4.5 1.4.4 1.4.3
    secure 1.4.5 1.4.4
#  require acl libcap libpng openslp popt tiff
   require acl libpng openslp popt tiff
  optional Linux-PAM --enable-pam     --disable-pam     for pluggable authentication
  optional dbus      --enable-dbus    --disable-dbus    for dbus
# optional gnutls    --enable-gnutls  --disable-gnutls  for SSL/TLS by gnutls
  optional heimdal   ''               ''                for kerberos 5
  optional openldap  --enable-ldap    --disable-ldap    for LDAP
# optional openssl   --enable-openssl --disable-openssl for SSL/TLS by openssl
# Evert reports that firefox crashes during printing if
# openssl is providing SSL/TLS for cups
   require gnutls
      opts --disable-openssl --enable-gnutls
  category printer
 attribute console
  homepage http://www.cups.org
      vurl http://www.cups.org/software.php
    source http://ftp.easysw.com/pub/ \
            ftp://ftp.funet.fi/pub/mirrors/ftp.easysw.com/pub/ \
            ftp://ftp.mpg.goe.ni.schule.de/pub/internet/printing/ \
            ftp://ftp.ntua.gr/pub/gnu/ \
            cups/${VERSION/*svn*/snapshots}/cups-$VERSION-source.tar.bz2
    source $SOURCEFORGE_URL cups/cups-drivers/0.3.6/cups-drivers-all-0.3.6.tar.gz
      opts --without-rcdir
   exclude /etc/cups/certs
   protect /etc/printcap
  eprovide lpr
  estimate 1600
      desc 'portable printing layer'
   
build(){

 check_for_smb_backend(){
  if spell_installed samba; then  
   echo "Setting smb backend for cups"
   mkdir -p                 $DESTDIR/usr/lib/cups/backend/
   ln  -s /usr/bin/smbspool $DESTDIR/usr/lib/cups/backend/smb
  fi
 }

# if spell_installed Linux-PAM; then OPTS+=' --enable-pam'; fi
# if spell_installed openssl;   then OPTS+=' --enable-ssl'; fi

 OPTS+=' --libdir=/usr/lib'
 case $HOSTTYPE in
  x86_64) sed -i 's:/lib/security/pam:/lib64/security/pam:' configure
          OPTS+=64  ;;
 esac

 ./configure              \
  --sysconfdir=/etc        \
  --localstatedir=/var     \
  --prefix=${PREFIX:-/usr} \
 $OPTS &&
 make  &&
 make install "BUILDROOT=$DESTDIR"
 cp    -vR  usr/* $DESTDIR/usr &&
 cp    -vR  var/* $DESTDIR/var &&
 cd         var/cups/conf      &&
 mkdir -p   $DESTDIR/etc/cups  &&
 cp    -v * $DESTDIR/etc/cups  &&
 check_for_smb_backend
}
