    VERSION=( 1.3.7 1.3.6 1.3.5 )
       SAFE=( 1.3.7 1.3.6 1.3.5 )
    IGNORE='svn\|b\|rc'
  CATEGORY='printer'
 ATTRIBUTE='console'
    SOURCE=( "cups/$VERSION/cups-$VERSION-source.tar.bz2"
             "cups/cups-drivers-all-0.3.6.tar.gz" )
  HOMEPAGE='http://www.cups.org'
      VURL='http://www.cups.org/software.php'
       URL=( "http://ftp.easysw.com/pub/
              ftp://ftp.funet.fi/pub/mirrors/ftp.easysw.com/pub/
              ftp://ftp.mpg.goe.ni.schule.de/pub/internet/printing/
              ftp://ftp.ntua.gr/pub/gnu/"
             "$SOURCEFORGE_URL" )
# espgs is needed but can't be placed as a requirement or
# it causes a circuliar requirement loop
       REQ=( 'acl libpng openslp tiff'
             'Linux-PAM:--enable-pam:--disable-pam:for pluggable authentication support'
             'dbus:--enable-dbus:--disable-dbus:for dbus support'
             'heimdal:::for kerberos 5 support'
             'openldap:--enable-ldap:--disable-ldap:for ldap support' )
#            'openssl:--enable-ssl:--disable-ssl:for secure socket connections' )
      OPTS='--without-rcdir'
   EXCLUDE='/etc/cups/certs'
   PROTECT='/etc/printcap'
  EPROVIDE='lpr'
  ESTIMATE='12000'
      DESC='cups provides a portable printing layer.'
   
build(){

 check_for_smb_backend(){
  if    spell_installed  samba;  then  
   echo "Setting smb backend for cups"
   if   ! [ -e                   /usr/lib/cups/backend/smb ]
   then  ln -s /usr/bin/smbspool /usr/lib/cups/backend/smb
   fi
  fi
 }

 fix_lib64(){
  move(){
   if   [  -f /usr/lib64/$1 ]
   then mv -v /usr/lib64/$1 /usr/lib/
   fi
  }

  if [ $HOSTTYPE == x86_64 ]; then return; fi
  move libcupsimage.so
  move libcupsimage.so.2
  move libcups.so
  move libcups.so.2
 }


 if spell_installed Linux-PAM; then OPTS+=' --enable-pam'; fi
 if spell_installed openssl;   then OPTS+=' --enable-ssl'; fi

 default_build          &&
 cp    -R usr/*  /usr   &&
 cp    -R var/*  /var   &&
 cd       var/cups/conf &&
 mkdir -p /etc/cups     &&
 cp    *  /etc/cups     &&
 check_for_smb_backend  &&
 fix_lib64
}
