# The website quit making releases a long time ago.
# However there appears to be something in cvs
#  VERSION=( "0.4.9-pre1" "0.4.8" "0.4.7" "0.4.6" "0.4.5" )
version_year_month  24
  CATEGORY="video"
 ATTRIBUTE="console"
    SOURCE="ffmpeg-$VERSION.tar"
       DIR="ffmpeg"
#    SOURCE="ffmpeg/ffmpeg-$VERSION.tar.gz"
#       URL="$SOURCEFORGE_URL"
REPOSITORY=( "cvs -d:pserver:anonymous:@mplayerhq.hu:/cvsroot/ffmpeg login"
              "cvs -d:pserver:anonymous:@mplayerhq.hu:/cvsroot/ffmpeg co -P ffmpeg"
              "cvs -d:pserver:anonymous:@mplayerhq.hu:/cvsroot/ffmpeg update -Pd ffmpeg" )
  HOMEPAGE="http://ffmpeg.sourceforge.net"
# a52 support broken in 0.4.9-pre1 ?
       REQ=( ""
             "SDL::--disable-ffplay:to build ffplay media player"
             "XviD:--enable-xvid::for XviD MPEG-4 codec support"
             "a52dec:--enable-a52 --enable-a52bin::for a52 support"
             "faac:--enable-faac:: for mpeg-2 and NBC/MPEG-4 decoding"
             "faad2:--enable-gpl --enable-faad --enable-faadbin::for freeware advanced audio decoder support"
             "gsm:--enable-libgsm::for gsm audio codec support"
             "imlib2::--disable-vhook:for video hooking support"
             "lame:--enable-mp3lame::to enable mp3 encoding via lame"
             "libvorbis:--enable-libogg --enable-vorbis::to decode ogg/vorbis streams"
             "libtheora:--enable-libogg --enable-theora::for theora video codec support"
             "nasm::--disable-mmx:for MMX support" )
#            ":--enable-pp::post processing support" )
      OPTS="--enable-shared  --enable-pthreads  --disable-opts  --disable-debug"
  ESTIMATE="435"
      DESC="ffmpeg is complete video and audio broadcasting solution
ffmpeg is a complete and free Internet live audio
and video broadcasting solution for Linux/Unix.
It also includes a digital VCR.
It can encode in real time in many formats including
MPEG1 audio and video, MPEG4, h263, ac3, asf, avi, real, mjpeg, and flash."


build()  {

export    CFLAGS="$( echo  $CFLAGS    |  sed  s/-funroll-loops// )"
export  CXXFLAGS="$( echo  $CXXFLAGS  |  sed  s/-funroll-loops// )"
export    CFLAGS="$( echo  $CFLAGS    |  sed  s/pentium-m/i686/ )"
export  CXXFLAGS="$( echo  $CXXFLAGS  |  sed  s/pentium-m/i686/ )"
export   LDFLAGS="$LDFLAGS -ldl"

if  !  grep      "flags"  <  /proc/cpuinfo  |
       grep  -q  "mmx"
then  OPTS="$OPTS  --disable-mmx"
fi

./configure           \
--prefix=/usr         \
$OPTS                 &&
sed -i "s:LDFLAGS=:LDFLAGS+=:"  config.mak &&
make                  &&
prepare_install       &&
make    install       &&
install  -m 0644  doc/ffserver.conf  /etc
}
