  progress reposit
# 2008-10-01 compiles but then causes problems with those that require
# 2008-10-01 unusable?
# 2008-10-02 unusable?
# 2008-10-22 unusable, compile error
# 2008-10-21 unusable, compile error
# 2008-09-01 unusable, compile error

# (August 21, 2008) The AAC decoder from FFmpeg Summer of Code 2006 has finally been cleaned up and is now in FFmpeg trunk.

# ffmpeg version 2008-08-01 is not compatible with x264 version  snapshot-20081001-2245

   reposit 2008-08-01 2008-05-31 2008-03-22 2008-01-13 2007-11-01 2007-06-10 2007-04-15 2007-03-28 2006-09-01

case $VERSION in
 2008-08-01) opts --disable-libx264 ;;
esac
   require subversion
# optional x264      --enable-libx264    ''              for x264 support
  optional SDL       ''               --disable-ffplay   to build ffplay media player
  optional XviD      --enable-libxvid   ''               for XviD MPEG-4 codec support
  optional a52dec    '--enable-liba52 --enable-liba52bin' '' for a52 support
  optional faac      --enable-libfaac    ''              for mpeg-2 and NBC/MPEG-4 decoding
  optional faad2     '--enable-gpl --enable-libfaad --enable-libfaadbin' '' for freeware advanced audio decoder support
  optional gsm       --enable-libgsm     ''              for gsm audio codec support
  optional imlib2    ''                  --disable-vhook for video hooking support
  optional lame      --enable-libmp3lame ''              to enable mp3 encoding via lame
  optional libtheora --enable-libtheora  ''              for theora video codec support
  optional libvorbis --enable-libvorbis  ''              to decode ogg/vorbis streams
  optional nasm      ''                  --disable-mmx   for MMX support
  category video
 attribute library
   disable sdelta
#     opts --enable-static=no
# ./configure --help says --enable-static=no works
# ./configure --enable-static=no is rejected by configure
    source ffmpeg-$VERSION.tar
       DIR=ffmpeg
# Note to self {$VERSION} is not a typo in this case.
REPOSITORY=( ""
             "svn co -r {$VERSION} svn://svn.mplayerhq.hu/ffmpeg/trunk ffmpeg"
             "svn up -r {$VERSION} svn://svn.mplayerhq.hu/ffmpeg/trunk" )
  homepage http://ffmpeg.mplayerhq.hu/
# homepage http://ffmpeg.sourceforge.net
#            ':--enable-pp::post processing support' )
##     opts --enable-shared  --enable-pthreads  --disable-opts  --disable-debug
#      opts --enable-pp --enable-gpl --enable-shared  --enable-pthreads  --disable-opts  --disable-debug
#      opts --enable-pp --enable-gpl --enable-shared  --enable-pthreads  --disable-debug
      opts --enable-postproc --enable-gpl --enable-shared  --enable-pthreads  --disable-debug
# --enable-pp is not supported
# --enable-static=no  is not supported
# libtheora support may not be implemented in svn version of ffmpeg.
# --enable-pp also requires --enable-gpl
    CFLAGS='-O3 -ffast-math'
   LDFLAGS='-Wl,-O1'
  estimate 1500
      desc 'ffmpeg is complete video and audio broadcasting solution
ffmpeg is a complete and free Internet live audio
and video broadcasting solution for Linux/Unix.
It also includes a digital VCR.
It can encode in real time in many formats including
MPEG1 audio and video, MPEG4, h263, ac3, asf, avi, real, mjpeg, and flash.'


build(){

export   CFLAGS="${CFLAGS//-funroll-loops/}"
export CXXFLAGS="${CXXFLAGS//-funroll-loops/}"
export   CFLAGS="${CFLAGS//pentium-m /i686 }"
export CXXFLAGS="${CXXFLAGS//pentium-m /i686 }"

export  LDFLAGS+=' -ldl'

if   ! grep flags < /proc/cpuinfo | grep -q mmx
then OPTS+=' --disable-mmx'
fi

./configure     \
--prefix=/usr   \
$OPTS           &&  sed -i 's:LDFLAGS=:LDFLAGS+=:' config.mak &&
make            &&
prepare_install &&
make    install &&
install -m 644 doc/ffserver.conf /etc
}
