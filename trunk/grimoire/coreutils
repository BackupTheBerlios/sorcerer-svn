   VERSION=( 6.9 6.7 6.6 6.4 6.3 )
  CATEGORY='utility'
 ATTRIBUTE='console solo'
    SOURCE="coreutils/coreutils-$VERSION.tar.bz2"
       URL="$GNU_URL"
# acl for access control lists and extended attribute support.
       REQ=( "acl"
             ":-static::make some programs static linked for faster script execution" )
  HOMEPAGE='http://www.gnu.org/software/coreutils'
   PROTECT="/bin/cat
            /bin/chmod
            /bin/cp
            /bin/date
            /bin/dd
            /bin/echo
            /bin/ls
            /bin/mkdir
            /bin/mv
            /bin/rm
            /bin/rmdir
            /bin/tail
            /bin/tee
            /bin/uname
            /usr/bin/basename
            /usr/bin/cut
            /usr/bin/dirname
            /usr/bin/du
            /usr/bin/install
            /usr/bin/kill
            /usr/bin/md5sum
            /usr/bin/sleep
            /usr/bin/sort
            /usr/bin/touch
            /usr/bin/tr
            /usr/bin/uniq
            /usr/bin/wc"
  ESTIMATE='2670'
disable reduce
      DESC="coreutils provides basic file, shell and text manipulation utilities.

coreutils provides:

chgrp           changes group ownership
chown           changes ownership
chmod           changes permissions
cp              copies
dd              copies and converts
df              shows filesystem disk usage.
dir             gives brief directory listing
dircolors       setup program for the color version of GNU ls
du              shows disk usage
install         copies and sets permissions
ln              creates links
ls              lists directory contents
mkdir           creates directories
mkfifo          creates FIFOs (named pipes)
mknod           creates special files
mv              renames
rm              removes (deletes)
rmdir           removes empty directories
shred           deletes a file securely
sync            synchronizes memory and disk
touch           changes filestamps
vdir            long directory listing (like ls -l)

basename	removes the path prefix from a given pathname 
chroot		changes the root directory 
date		prints the system date and time
dirname		removes the last level or filename from a pathname 
echo		prints a line of text 
env		displays/modifies the environment 
expr		evaluates expressions 
factor		prints prime factor 
false		returns an unsuccessful exit status 
groups		prints the groups the user belongs to 
hostname	prints or sets the machine name 
id		print real/effective/uid/gid
logname		prints current login name 
nice		modifies scheduling priority
nohup		lets a command keep running after logging out 
pathchk		checks file name portability 
pinky		lightweight 'finger' program; prints user information 
printenv	prints environment variables 
printf		formats and prints data 
pwd		prints the working (current) directory 
seq		prints numeric sequences 
sleep		suspends execution for a specified time 
stty		prints/changes terminal settings 
su		lets you adopt the ID of another user or superuser 
tee		sends output to multiple files 
test		evaluates an expression 
true		returns a successful exit status 
tty		prints terminal name 
uname		prints system information 
uptime		tells how long the system has been running 
users		prints current user names 
who		prints a list of all users currently logged in 
whoami		prints effective user ID 
yes		prints a string indefinitely

cat             concatenates and prints files on the standard output
cksum           checksum and count the bytes in a file
comm            compares two sorted files line by line
csplit          splits a file into sections determined by context lines
cut             remove sections from each line of files
expand          convert tabs to spaces
fmt             simple optimal text formatter
fold            wrap each input line to fit in specified width
head            output the first part of files
join            join lines of two files on a common field
md5sum          compute and check MD5 messsage digest
nl              number lines of files
od              dump files in octal and other formats
paste           merge lines of files
ptx             produce a permuted index of file contents
pr              convert text files for printing
sort            sort lines of text files
split           split a file into pieces
sum             checksum and count the blocks in a file
tac             concatenates and prints files in reverse
tail            outputs the last part of files
tr              translates or deletes characters
tsort           perform topological sort
unexpand        convert spaces to tabs
uniq            remove duplicate lines from a sorted file
wc              prints the number of bytes, words, and lines in files"


build()  {
place_files()  {
  echo  "Placing files"
  hash   -r
  mkdir  -p                   /bin
  mv     -f  /usr/bin/chgrp   /bin
  mv     -f  /usr/bin/chmod   /bin
  mv     -f  /usr/bin/chown   /bin
  mv     -f  /usr/bin/cp      /bin
  mv     -f  /usr/bin/chroot  /bin
  mv     -f  /usr/bin/dd      /bin
  mv     -f  /usr/bin/df      /bin
  mv     -f  /usr/bin/ln      /bin
  mv     -f  /usr/bin/ls      /bin
  mv     -f  /usr/bin/mkdir   /bin
  mv     -f  /usr/bin/mknod   /bin
  mv     -f  /usr/bin/rm      /bin
  mv     -f  /usr/bin/rmdir   /bin
  mv     -f  /usr/bin/sync    /bin
  mv     -f  /usr/bin/date    /bin
  mv     -f  /usr/bin/echo    /bin
  mv     -f  /usr/bin/false   /bin
  mv     -f  /usr/bin/groups  /bin
  mv     -f  /usr/bin/pwd     /bin
  mv     -f  /usr/bin/stty    /bin
  mv     -f  /usr/bin/tee     /bin
  mv     -f  /usr/bin/true    /bin
  mv     -f  /usr/bin/uname   /bin
  mv     -f  /usr/bin/cat     /bin
  mv     -f  /usr/bin/head    /bin
  mv     -f  /usr/bin/tail    /bin
  mv     -f  /usr/bin/mv      /bin
  hash   -r
}


static_linking()  {
# bash when invoked as /bin/sh or /bin/bash
# internally handles "[ echo test"
# Therefore, "[ test" are not statically linked.
# However, some scripts invoke the echo executable.
# So echo is statically linked.
# bash loadables exist for "basename cat cut dirname head tee"
# but not all scripts explicitly load them.

  if    echo  "$OPTS"  |
        grep  -q  "\-static"
  then
    cd   src
    rm   basename cat cut dirname  \
         echo head ls readlink rm  \
         sort stat tail tr uniq wc
    sed  -i  "s:$LDFLAGS:$LDFLAGS -static:"  Makefile
    cd   ..
    make
  fi
}

export  ac_cv_sys_xsi_stack_overflow_heuristic=no

case  $VERSION  in
  6.9)   grep  -r -l                          futimens  *  |
         xargs -r --max-lines=64  sed  -i  "s/futimens/gl_&/"  ;;
esac

./configure     \
--build=$BUILD  \
--prefix=/usr   &&
make            &&
prepare_install &&
hash   -r       &&
static_linking  &&
make    install &&
place_files     &&
hash -r
}

post_remove()  {
hash  -r
}


current()  {
  case  $VERSION  in
    6.9)  [  -f  /bin/chroot  ]  ;;
  esac
}
