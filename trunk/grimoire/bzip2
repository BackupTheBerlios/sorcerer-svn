with info    good 20130525
with info    last 20100920
with version stable 1.0.6
with role    archive
with trait   console library makej optimize solo
#with trait   console library optimize solo
with source  stable http://www.bzip.org/$VERSION/bzip2-$VERSION.tar.gz
with info    vurl http://www.bzip.org/downloads.html
with info    home http://www.bzip.org/
with info    docs http://www.bzip.org/docs.html
with protect /bin/bzip2
with info    cite 'patent free, high-quality data compressor
bzip2 has average compression ratio
average compression speed
and average decompression speed.'

build(){
 make_install(){
  mkdir -pvm 755                             "$DESTDIR"/$LIBDIR
  cp -va         libbz2.so.$VERSION          "$DESTDIR"/$LIBDIR
  ln -fs         libbz2.so.$VERSION          "$DESTDIR"/$LIBDIR/libbz2.so.1.0
  ln -fs         libbz2.so.$VERSION          "$DESTDIR"/$LIBDIR/libbz2.so
  mv    -v       "$DESTDIR"/usr/lib/libbz2.a "$DESTDIR"/$LIBDIR/
  mkdir -vpm 755                             "$DESTDIR"/bin
  mv    -v       "$DESTDIR"/usr/bin/bzip2    "$DESTDIR"/bin/
  rmdir          "$DESTDIR"/usr/lib
 }

 if   [ $HOSTTYPE == x86_64 ] &&
      ! echo "$CFLAGS $CXXFLAGS" | grep -q "\-m32"
 then LIBDIR=/lib64
 else LIBDIR=/lib
 fi

 export  CFLAGS+=' -fPIC'

 sed -i "s:ln \$(PREFIX):ln -f \$(PREFIX):" Makefile

 case $VERSION in
  1.0.6) sed -i 's: -shared : $(LDFLAGS) $(CFLAGS) -shared :' Makefile-libbz2_so ;;
 esac

 make                \
  "CFLAGS=$CFLAGS"   \
  "LDFLAGS=$LDFLAGS" \
  "PREFIX=/usr"      &&
 make install PREFIX="$DESTDIR"/usr &&
 make -f Makefile-libbz2_so \
  "CFLAGS=$CFLAGS"   \
  "LDFLAGS=$LDFLAGS" &&
 make_install
}
