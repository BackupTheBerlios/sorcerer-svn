# the problem with openvrml compilation
# most likely must be fixed in gtkglext

# /usr/lib64/libgtkglext-x11-1.0.so: undefined reference to `GTK_WIDGET_REALIZED'
# /usr/lib64/libgtkglext-x11-1.0.so: undefined reference to `GTK_WIDGET_TOPLEVEL'
# /usr/lib64/libgtkglext-x11-1.0.so: undefined reference to `GTK_WIDGET_NO_WINDOW'
# collect2: ld returned 1 exit status
# make[4]: *** [openvrml-xembed/openvrml-xembed] Error 1

   version stable 0.18.8 0.18.7 0.18.6 0.18.5
# case $VERSION in
#  0.18.7)
#  conflicts gtkglext
#       opts --disable-xembed ;;
# esac
   require MesaLib SDL boost curl gtkglext
  optional doxygen '' '--without-doxygen --disable-api-docs' for documentation generation
  optional firefox '' --disable-mozilla-plugin for mozilla openvrml plugin
      opts --disable-script-node-javascript --disable-script-node-java
  category graphic
 attribute gnome library makej multilib-fail solo
 attribute broke
    source $SOURCEFORGE_URL openvrml/openvrml/$VERSION/openvrml-$VERSION.tar.gz
    source $SOURCEFORGE_URL libpng/libpng12/1.2.44/libpng-1.2.44.tar.xz
      info last  20110421
      info home http://openvrml.sourceforge.net
      desc 'library and program for reading and displaying VRML97
openvrml is a C++ class library that allows applications
to read VRML97 .wrl files and view their geometries.
It is also working toward full ISO VRML97 Specification compliance.
While still in development, the codebase is quite stable and featureful.
lookat, a basic Glut VRML viewer is included.'


build(){
 echo "OPTS=[$OPTS]"

 cd libpng-1.2.44 &&
 ./configure --prefix=$PWD/install --enable-static=yes --enable-shared=no &&
 make install &&
 export  LDFLAGS+=" -L$PWD/install/lib" &&
 export   CFLAGS+=" -I$PWD/install/include" &&
 export CXXFLAGS+=" -I$PWD/install/include" &&
 cd .. &&

 local MOZ_VER MOZ_INC MOZ_LIB JDK_INC JDK_LIB

 MOZ_VER=$( installed_version $( get_provider firefox ) )

 MOZ_INC="-I/usr/include/firefox-$MOZ_VER -I/usr/include/firefox-$MOZ_VER/nspr"

 if   [[ $HOSTTYPE == x86_64 ]]
 then MOZ_LIB="-L/usr/lib64/firefox-$MOZ_VER"
 else MOZ_LIB="-L/usr/lib/firefox-$MOZ_VER"
 fi

 JDK_INC='-I/opt/jdk/include  -I/opt/jdk/include/linux'
 JDK_LIB='-L/opt/jdk/jre/lib/i386/server'

 # BST_INC='-I/usr/include/boost'
 # export BOOST_LIB_SUFFIX="-gcc43-mt"

 export   CFLAGS+=" $JDK_INC   $MOZ_INC  $BST_INC"
 export CXXFLAGS+=" $JDK_INC   $MOZ_INC  $BST_INC"
 export  LDFLAGS+=" $JDK_LIB   $MOZ_LIB"
#export  LDFLAGS+=" $JDK_LIB   $MOZ_LIB  -L/usr/X11R6/lib"

 #            --without-jdk           \
 #            --without-spidermonkey  \

 # sed  -i  's:boost_unit_test_framework:boost_unit_test_framework-gcc-mt:'  tests/Makefile*

 # LC_ALL=C grep -rl boost_thread * |
 # xargs -r --max-lines=64 sed -i "s:boost_thread:boost_thread-gcc43:g"
 #xargs -r --max-lines=64 sed -i "s:boost_thread:boost_thread-gcc43-mt:g"

 # LC_ALL=C grep -rl boost_filesystem-mt * |
 # xargs -r --max-lines=64 sed -i "s:boost_filesystem-mt:boost_filesystem-mt-gcc43:g"

 export   CFLAGS+=" -UGTK_DISABLE_DEPRECATED -UGDK_PIXBUF_DISABLE_DEPRECATED"
 export CXXFLAGS+=" -UGTK_DISABLE_DEPRECATED -UGDK_PIXBUF_DISABLE_DEPRECATED"
 default_build
}
