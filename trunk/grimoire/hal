#            'libselinux:--enable-selinux:--disable-selinux:for SELinux support'
# gnome-python needed for hal-device-manager but it creates a loop due to its
# dependence on gnome-vfs which requires hal
#             'gnome-python:::for hal-device-manager' 

# --disable-policy-kit is OK for now, read 
# http://www.mail-archive.com/desktop-devel-list@gnome.org/msg06861.html


    stable 0.5.14 0.5.13
   require PolicyKit hal-info dbus-glib pciutils perl--XML-Parser udev util-linux
# for fast_event
   require procps

  optional parted --enable-parted
# Does not seem to be able to properly detect and use libusb or libusb-compat
# optional libusb-compat
      opts --disable-gtk-doc
      opts --with-hwdata=/usr/share/
      opts --with-pid-file=/var/run/haldaemon.pid
      opts --enable-static=no
      opts --with-udev-prefix=/lib
      opts --with-eject=/bin/eject
      opts --enable-console-kit --enable-acl-management --enable-acpi-ibm --enable-acpi-toshiba --enable-umount-helper

#  require hal-info dbus-glib pciutils perl--XML-Parser udev
# libselinux 
# optional gtk-doc        --enable-gtk-doc --disable-gtk-doc for DocBook documentation
  category system
 attribute console
    source http://hal.freedesktop.org/releases/hal-$VERSION.tar.gz
case $VERSION in
 *-git) REPOSITORY=( ""
                     "git clone --depth 1 git://anongit.freedesktop.org/git/hal hal"
                     "git pull" ) ;;
     *) url http://hal.freedesktop.org/releases/
esac
  homepage http://www.freedesktop.org/wiki/Software/hal
 freshmeat halayer
  estimate 1000
      desc 'hardware abstraction layer
HAL (Hardware Abstraction Layer) is a specification
and an implementation of a hardware abstraction layer.
It encompasses a shared library for use in applications, a daemon,
a hotplug tool, command line tools, and a set of stock device info files.'

build(){
# It really does require a blkid newer than 1.41.5
# But what provides it?

#  0.5.12) sed -i 's:1\.43:1.41.5:' configure ;;
 case $VERSION in
  0.5.11) sed -i 's:"/usr/bin/udevinfo":"/sbin/udevadm","info":' hald/linux/{blockdev.c,coldplug.c} ;;
 esac

case $VERSION in
  *-git)  NOCONFIGURE=on ./autogen.sh  ;;
esac

mkdir    -pm 755 /var/empty
groupadd -K GID_MIN=256 -K GID_MAX=511    haldaemon                         2>/dev/null
useradd  -K UID_MIN=256 -K UID_MAX=511 -g haldaemon -d /var/empty haldaemon 2>/dev/null
default_build
}

post_install(){
default_post_install
/etc/init.d/dbus-daemon restart
/etc/init.d/hald restart
}

current(){
case $VERSION in
 0.5.14) grep -q renice /etc/init.d/hald ;;
esac
}
