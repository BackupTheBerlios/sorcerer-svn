    stable 2.4
  category development
 attribute console solo
    source ccache-$VERSION.tar.gz
    CFLAGS='-O3'
   LDFLAGS='-Wl,-O1'
       url http://samba.org/ftp/ccache/
  homepage http://ccache.samba.org
  estimate 20
      desc 'ccache is a C and C++ compiler wrapper to speed compilation.
ccache is a compiler cache.
It acts as a caching pre-processor to C/C++ compilers, 
using the -E compiler switch and a hash to detect when 
a compilation can be satisfied from cache.
This often results in a 5 to 10 times 
speedup in common compilations.'

build(){

 symlink_install(){
  cd /usr/libexec/ccache
  ln -sf ccache cc
  ln -sf ccache gcc
  ln -sf ccache c++
  ln -sf ccache g++
 }


mtime_patch(){
 local MOF="utime(output_file, NULL);"
 local MHA="utime(hashname, NULL);"
 sed -i  "s:$MOF:$MOF $MHA:"  ccache.c
}

export LDFLAGS+=" $OPTS"

sed -i 's:$(CFLAGS):$(CFLAGS) $(LDFLAGS):' Makefile.in

mtime_patch                  &&
./configure                  \
--build=$BUILD               \
--prefix=/usr/libexec/ccache \
--bindir=/usr/libexec/ccache \
--sysconfdir=/etc            \
--localstatedir=/var         \
--mandir=/usr/man            \
$OPTS                        &&
make                         &&
prepare_install              &&
mkdir -p /usr/libexec/ccache &&
make    install              &&
symlink_install
}
