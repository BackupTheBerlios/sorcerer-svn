    stable 3.0 2.4
  unstable 3.0pre1 3.0pre0
  category development
 attribute console solo
    source http://samba.org/ftp/ccache/ccache-$VERSION.tar.bz2
  homepage http://ccache.samba.org
    CFLAGS='-O3'
   LDFLAGS='-Wl,-O1 -static'
  estimate 100
      desc 'C and C++ compiler wrapper to speed compilation
ccache is a compiler cache.
It acts as a caching pre-processor to C/C++ compilers, 
using the -E compiler switch and a hash to detect when 
a compilation can be satisfied from cache.
This often results in a 5 to 10 times 
speedup in common compilations.'

build(){

 symlink_install(){
  cd /usr/libexec/ccache
  ln -sf ccache cc
  ln -sf ccache gcc
  ln -sf ccache c++
  ln -sf ccache g++
 }


mtime_patch2(){
 local MOF="utime(output_file, NULL);"
 local MHA="utime(hashname, NULL);"
 sed -i  "s:$MOF:$MOF $MHA:"  ccache.c
}

mtime_patch3(){
# Seems to update the mtime on the cached object file already
true
}

mtime_patch(){
 case $VERSION in
  2.4)  mtime_patch2 ;;
  3.0*) mtime_patch3 ;;
 esac
}

export LDFLAGS+=" $OPTS"

sed -i 's:$(CFLAGS):$(CFLAGS) $(LDFLAGS):' Makefile.in

mtime_patch                  &&
ac_cv_func_getpwuid=no       \
./configure                  \
--prefix=/usr/libexec/ccache \
--bindir=/usr/libexec/ccache \
--sysconfdir=/etc            \
--localstatedir=/var         \
--mandir=/usr/man            \
$OPTS                        &&
make                         &&
prepare_install              &&
mkdir -p /usr/libexec/ccache &&
make    install              &&
symlink_install
}
