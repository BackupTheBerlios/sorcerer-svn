   VERSION=( "4.0.7" "4.0.6" "4.0.5" "4.0.4.1" )
  CATEGORY="authentication"
 ATTRIBUTE="core console"
    SOURCE="shadow-$VERSION.tar.bz2"
       URL="ftp://ftp.pld.org.pl/software/shadow"
  HOMEPAGE="http://shadow.pld.org.pl"
       REQ=( "Linux-PAM" )
   EXCLUDE="/etc/group
            /etc/group-
            /etc/passwd
            /etc/passwd-
            /etc/shadow
            /etc/shadow-"
   PROTECT="/var/log/lastlog"
  ESTIMATE="296"
      DESC="shadow contains the shadow password file utilities.
shadow contains password file utilities necessary to convert
traditional V7 UNIX password files to the SVR4 shadow password format,
and additional tools to maintain password and group files
(that work with both shadow and non-shadow passwords)."



install_conf()  {

  cd       etc

  sed      -i  "s:#MD5_CRYPT_ENAB no:MD5_CRYPT_ENAB yes:"  \
                                      login.defs.linux
  install  -m 0644  -o root  -g root  login.defs.linux  /etc/login.defs
  install  -m 0644  -o root  -g root  login.access      /etc 
  install  -m 0644  -o root  -g root  limits            /etc
  mkdir    -p                                           /etc/defaults

  install  -m 0755  -o root  -g root  $SCRIPT_DIR/adduser  /usr/sbin
  install  -m 0755  -o root  -g root  $SCRIPT_DIR/deluser  /usr/sbin
  echo '* U1000'  >> /etc/limits
  echo 'sysadm -' >> /etc/limits
}

build() {

	case  $VERSION  in
		4.0.4.1)  sed  -i  "s:extern char \*malloc ();:#include <malloc.h>:"  libmisc/xmalloc.c  ;;
	esac


	./configure  --build=$BUILD        \
	--prefix=/usr                      \
	--sysconfdir=/etc                  \
	--localstatedir=/var               \
	--with-libpam                      \
	$OPTS                              &&
	make                               &&
	prepare_install                    &&
	make    install                    &&
	install_conf
}

post_install() {
	if    grep  -q   "^DIALUPS_CHECK_ENAB"                        /etc/login.defs
	then  sed   -i  "s:DIALUPS_CHECK_ENAB:# DIALUPS_CHECK_ENAB:"  /etc/login.defs
	fi
}

