# some of the system libraries commented out because they random crashes
# which ones I am not certain about.
# --with-system-jpeg --with-system-nspr --with-system-nss --enable-system-sqlite


# firefox 3.5.5 must be compiled and linked with it's own xulrunner instead of system installed?

# When glitz is enabled:
# make[5]: *** No rule to make target `../../../dist/lib/libmozglitz.a', needed by `libthebes.a'.  Stop.
# glitz support incomplete?
# In version 3.5 compiling with --enable-glitz made no obvious difference.

    stable 3.6 3.5.7 3.5.6 3.5.5 3.5.4 3.5.3 3.5.2 3.5.1 3.5 3.0.11 3.0.10
#  require GConf bzip2 nss startup-notification sqlite xulrunner zip
   require GConf bzip2 libnotify nss startup-notification sqlite zip
  optional gnome-vfs  '' --disable-gnomevfs for gnomevfs support
  optional libgnomeui '' --disable-gnomeui  for libgnomeui support
#   switch --enable-glitz --disable-glitz 'enable glitz for use with Cairo'
  category network/web
 attribute client solo x11
#   source http://ftp.mozilla.org/pub/mozilla.org/firefox/releases/$VERSION/source/firefox-$VERSION.source.tar.bz2
    source http://releases.mozilla.org/pub/mozilla.org/firefox/releases/$VERSION/source/firefox-$VERSION.source.tar.bz2
  homepage http://www.mozilla.com/en-US/firefox/firefox.html
#      opts --with-system-jpeg
      opts --with-system-zlib
      opts --with-system-bz2
      opts --enable-startup-notification
      opts --disable-static
      opts --enable-system-cairo
      opts --enable-system-lcms
      opts --enable-application=browser
#     opts --with-system-libxul
#     opts --with-libxul-sdk=/usr
#     opts --disable-libxul
#     opts --disable-xul
#      opts --with-system-nspr
#      opts --with-system-nss
      opts --enable-strip
      opts --enable-default-toolkit=cairo-gtk2
      opts --disable-mochitest
      opts --disable-tests
#      opts --enable-system-sqlite

## --with-system-png requires png with apng support and currently the patch does not apply
#     opts --with-system-png


# Enable official branding should be fine because we are not 
# distributing the builds. This option names the browser Firefox instead
# of Minefield but launches a EULA on the first start:
#      opts --enable-official-branding
#      opts --with-distribution-id='sorcerer'
# These two should be safe for Sorcerer
      opts --disable-updater
      opts --disable-installer

           #--with-system-png
           #--enable-cpp-rtti
#            'jdk:::for building the javaXPCOM components' )
# compilation with javaXPCOM component support is not working
  eprovide mozilla
  estimate 26000
      desc 'web brower based upon mozilla gecko HTML rendering engine'

build(){
export LDFLAGS+=" -Wl,-rpath,/usr/lib/firefox-$VERSION"

sed -i 's:/bin/pwd:pwd:g;s:/bin/ls:ls:g' build/unix/mozilla.in

./configure \
--prefix=/usr \
--sysconfdir=/etc \
--localstatedir=/var \
--enable-optimize="$CFLAGS" \
$OPTS           &&
make            &&
prepare_install &&
make    install &&
rm -fr                  /usr/lib/mozilla &&
ln -fs firefox-$VERSION /usr/lib/mozilla
}

post_install(){
 default_post_install
 RECAST="$( show_installed seamonkey-plugin )"
 if   [ -n "$RECAST" ]
 then echo "$RECAST" | pipe_queue "$CAST_QUEUE" com
 fi
 true
}
