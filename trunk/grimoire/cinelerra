#!/bin/sh
   VERSION=( "2.0" )
  CATEGORY="video-editor"
 ATTRIBUTE="x11 new"
    SOURCE="heroines/cinelerra-${VERSION}-src.tar.bz2"
       URL="$SOURCEFORGE_URL"
  HOMEPAGE="http://heroinewarrior.com/cinelerra.php3"
       REQ=("yasm alsa-lib libdv"
            "fontconfig:FONTCONFIG::for beautifull fonts"
            "esound:ESOUND::for playing multiple sounds at the same time"
#            "avifile:AVIFILE::for avi writing"
            ":OGL::enable opengl"
            ":V4L2::enable Video4Linux2"
#            "libdv:FIREWIRE::enable firewire"
           )
  ESTIMATE=""
      DESC="Cinelerra does primarily 3 main things: capturing, compositing, and editing audio and video with sample level accuracy. It's a seamless integration of audio, video, and still photos rarely experienced on a web server."


build() {
	(echo $OPTS |grep -q FONTCONFIG) && sed -i "s/HAVE_XFT := n/HAVE_XFT := y/" global_config
	(echo $OPTS |grep -q ESOUND) || sed -i "s/HAVE_ESOUND := y/HAVE_ESOUND := n/" global_config
#	(echo $OPTS |grep -q AVIFILE) && sed -i "s/HAVE_AVIFILE := n/HAVE_AVIFILE := y/" global_config
	(echo $OPTS |grep -q OGL) && sed -i "s/HAVE_GL := n/HAVE_GL := y/" global_config
	(echo $OPTS |grep -q V4L2) && sed -i "s/HAVE_V4L2 := n/HAVE_V4L2 := y/" global_config
	#(echo $OPTS |grep -q FIREWIRE) || sed -i "s/HAVE_FIREWIRE := y/HAVE_FIREWIRE := n/" global_config

#	(echo $OPTS |grep -q AVIFILE) && CFLAGS="$CFLAGS $(pkg-config --cflags avifile)"
 	sed -i 's:#include "bcnewfolder.inc":#include "bcnewfolder.h":' guicast/bcfilebox.h
	sed -i 's:#include "bcsubwindow.h":#include "bcsubwindow.h"\n#include "bcmenupopup.h":' guicast/bcpopupmenu.h



	#sed -i 's:#include "bcdelete.h":#include "bcdelete.inc":'  guicast/bcfilebox.h
	./configure --prefix=/usr &&
	make -S                   &&
	test -x cinelerra/$(uname -m)/cinelerra &&
	prepare_install           &&
	make install
}
