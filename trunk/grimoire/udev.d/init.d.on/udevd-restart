#!/bin/bash

### BEGIN INIT INFO
# Provides: udev
# Required-Start: udevd
# Default-Start: 1 2 3 4 5
# Short-Description: udevd-restart restarts udevd on real root filesystem.
# Description: udevd started in sysinit is unable to populate /dev
#	following the switch to the real root filesystem.
#	Therefore, restarting udevd is necessary.
### END INIT INFO

. /lib/lsb/init-functions

start(){
 run(){
  kill -s 15 $( /bin/pidof udevd ); sleep 0.1
  kill -s  9 $( /bin/pidof udevd ) 2>/dev/null
  /sbin/udevd --daemon
 }
 if   read < /proc/cmdline && [[ $REPLY =~ boot=IR ]]
 then log_success_msg "udevd does not require restart"
 elif log_warning_msg "udevd restarting"; run
 then log_success_msg "udevd restarted"
 else log_failure_msg "udevd failed to restart"
 fi
}
stop(){ :; }

parse "$@"
