    stable 2.4.4 2.4.3
    secure 2.4.4 2.4.3
   require libpcap
   switch CHAPMS=1    '' compile ppp with chapms support
   switch USE_CRYPT=1 '' compile ppp with chapms support
  category network/ppp
 attribute client server console
    source ftp://ftp.samba.org/pub/ppp/ppp-$VERSION.tar.gz
  homepage http://www.samba.org/ppp/
   protect /etc/ppp
 freshmeat pppd
  estimate 200
      desc 'ppp provides a server/client for point to point protocol.
ppp Daemon for Linux, Solaris 2, *BSD, SunOS 4,
Digital Unix, SVR4, NeXTStep, and Ultrix.
This allows Unix machines to connect to the
internet through dialup lines, using the
PPP protocol, as a PPP server or client.
Works with chat, dip, and diald, among (many) others.
Supports IP, TCP, UDP and (for Linux) IPX (Novell).'

build(){
 grep  -rl                        "net/bpf.h" * |
 xargs -r --max-lines=64 sed -i "s:net/bpf.h:pcap-bpf.h:"

 sed -i "s:pppusers:ppp:" pppd/Makefile.linux
 sed -i "s:-O2:$CFLAGS:"  pppd/plugins/radius/Makefile.linux
 sed -i 's:$(DESTDIR)/sbin:/sbin:' */Makefile.* \
               pppd/plugins/rp-pppoe/Makefile.linux

 sed -i 's:$(DESTDIR)/lib/pppd:/lib/pppd:' \
     pppd/plugins/Makefile.linux \
     pppd/plugins/rp-pppoe/Makefile.linux \
     pppd/plugins/radius/Makefile.linux \
     pppd/plugins/pppoatm/Makefile.linux

 sed -i 's:DESTDIR "/lib/pppd/":"/lib/pppd/":
         s:/usr/lib/pppd:/lib/pppd:' pppd/pathnames.h

## --sbindir not supported in ppp version 2.4.4
# --sbindir=/sbin      \

 ./configure          \
 --build=$BUILD       \
 --prefix=/usr        \
 --sysconfdir=/etc    \
 --localstatedir=/var &&
 make $OPTS           \
      "Copts=$CFLAGS" &&
 prepare_install      &&
 make    install $OPTS
}

post_build(){
 place_file(){
  [ -f $2 ] ||  cp $SCRIPT_DIR/$1 $2
 }

 mkdir -p /etc/ppp/{chat,peers}

 ln -f /etc/ppp/resolv.conf /etc/resolv.conf

 cp $SCRIPT_DIR/pon  /bin
 cp $SCRIPT_DIR/poff /bin

 place_file options /etc/ppp/options
 place_file peers   /etc/ppp/peers/isp
 place_file isp     /etc/ppp/chat/isp

 cat $SCRIPT_DIR/message

 chown -R root:ppp /etc/ppp
 chmod 600         /etc/ppp/*-secrets

 default_post_build
}

current(){
 case $VERSION in
  2.4.4) [ -f /sbin/pppd ] ;;
 esac
}
