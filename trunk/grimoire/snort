# http://www.snort.org/vrt/
# only way to obtain rules for current version of snort are:
# 1. subscribe and pay
# 2. register
# Do not expect this spell to improve
# until snort.org allows current rules to be downloaded
# as easily as a source tarball.

# No rules provided inside the 2.6.0.
# This is not good to go following installation.
# Needs some rules and configuration file editing.
# snort has a problem when casting with prelude enabled.
# It prompts for a password.
# This is incredibly bad.
# However, I do not have an immediate fix for it.
# software compilation should be non-interactive

    stable 2.8.4.1 2.8.4 2.8.3.2 2.8.3.1 2.8.3
  unstable 2.8.4.rc1 2.8.4.beta 2.8.3.rc1 2.8.3.beta
   require libpcap pcre
  optional libprelude --enable-prelude --disable-prelude for prelude support
  category network security
 attribute console
# 2.8.0.1 has an odd installation error
    source http://www.snort.org/dl/snort-$VERSION.tar.gz
      vurl http://www.snort.org/dl/
  homepage http://www.snort.org/
  estimate 1700
      desc 'snort is a lightweight network intrustion detection program.
snort is a lightweight network intrusion detection system,
capable of performing real-time traffic analysis and packet
logging on IP networks.
It can perform protocol analysis, content searching/matching
and can be used to detect a variety of attacks and probes,
such as buffer overflows, stealth port scans, CGI attacks,
SMB probes, OS fingerprinting attempts, and much more.
Snort uses a flexible rule based language to describe traffic
that it should collect or pass, and a modular detection engine.
Snort has a real-time alerting capability, with alert mechanisms
for syslog, a user specified file, a UNIX socket, or WinPopup
messages to Windows clients using Samba smbclient.'

build(){
 install_etc(){
  set   -x
  sed   -i     's:../rules:/etc/snort/rules/:
                s:/usr/local:/usr:' etc/snort.conf
  mkdir -p     {/etc,/var/log}/snort
  rm    -f     etc/Makefile*
  chown    600 etc/*
  cp           etc/* /etc/snort/
  set   +x
 }

 prelude_register(){
  if     [ -x /usr/bin/prelude-admin     ] &&
       ! [ -d /etc/prelude/profile/snort ]
  then prelude-admin register snort 'idmef:w admin:r' localhost --uid 0 --gid 0
  fi
 }

 sed -i 's:/etc/snort.conf:/etc/snort/snort.conf:' src/snort.c
 ./configure             \
 --build=$BUILD          \
 --prefix=/usr           \
 --sysconfdir=/etc/snort \
 --localstatedir=/var    \
 --enable-dynamicplugin  \
 $OPTS                   &&
 make                    &&
 prepare_install         &&
 make    install         &&
         install_etc
#     &&
# prelude_register
}
