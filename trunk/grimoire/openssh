   VERSION=( "4.3p2" "4.3p1" "4.2p1" "4.1p1" "4.0p1" "3.9p1" "3.8.1p1" "3.8p1" "3.7.1p2" )
      SAFE=( "4.3p2" "4.3p1" "4.2p1" )
  CATEGORY="encryption security file-transfer"
 ATTRIBUTE="client console server"
    SOURCE="openssh-$VERSION.tar.gz"
       URL="ftp://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.openbsd.org.ar/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.au.openbsd.org/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.it.net.au/mirrors/OpenBSD/OpenSSH/portable
            ftp://ftp.planetmirror.com/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.wiretapped.net/pub/OpenBSD/OpenSSH/portable
            ftp://gd.tuwien.ac.at/opsys/OpenBSD/OpenSSH/portable
            ftp://mingus.wu-wien.ac.at/pub/OpenBSD/OpenSSH/portable
            ftp://openbsd.rug.ac.be/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.ca.openbsd.org/pub/OpenBSD/OpenSSH/portable
            ftp://gulus.usherb.ca/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.shellhung.org/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.openbsd.cz/pub/OpenBSD/OpenSSH/portable
            ftp://sunsite.dk/mirrors/openssh/portable
            ftp://ftp.jaquet.dk/pub/openSSH/portable
            ftp://ftp.fi.debian.org/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.jyu.fi/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.bsdfr.org/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.club-internet.fr/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.de.openbsd.org/pub/unix/OpenBSD/OpenSSH/portable
            ftp://ftp.freenet.de/pub/ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable
            ftp://ftp-stud.fht-esslingen.de/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.leo.org/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.fh-wolfenbuettel.de/pub/os/openbsd/OpenSSH/portable
            ftp://filoktitis.noc.uoa.gr/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.duth.gr/pub/OpenBSD/OpenSSH/portable
            ftp://hal.csd.auth.gr/mirrors/OpenSSH/portable
            ftp://ftp.fsn.hu/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.esat.net/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.openbsd.it/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.volftp.mondadori.com/mirror/openbsd/OpenSSH/portable
            ftp://ftp.jp.openbsd.org/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.kddlabs.co.jp/OpenBSD/OpenSSH/portable
            ftp://ftp.netlab.is.tsukuba.ac.jp/pub/os/OpenBSD/OpenSSH/portable
            ftp://mirrors.unam.mx/pub/openssh/portable
            ftp://ftp.nl.uu.net/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.calyx.nl/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.nluug.nl/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.inet.no/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.uninett.no/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.sajinet.com.pe/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.eq.uc.pt/pub/software/unix/security/crypto/openssh/portable
            ftp://ftp.chg.ru/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.gamma.ru/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.radio-msu.net/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.openbsd.ru/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.snu.ac.kr/pub/BSD/OpenBSD/OpenSSH/portable
            ftp://ftp.rediris.es/mirror/OpenBSD/OpenSSH/portable
            ftp://ftp.stacken.kth.se/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.sunet.se/pub/OpenBSD/OpenSSH/portable
            ftp://sunsite.cnlab-switch.ch/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.kmitl.ac.th/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.plig.org/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.knowledge.com/pub/mirrors/OpenBSD/OpenSSH/portable
            ftp://gandalf.neark.org/pub/distributions/OpenBSD/OpenSSH/portable           
            ftp://ftp5.usa.openbsd.org/pub/OpenBSD/OpenSSH/portable
            ftp://ftp3.usa.openbsd.org/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.src.uchicago.edu/pub/OpenBSD/OpenSSH/portable
            ftp://rt.fm/pub/OpenBSD/OpenSSH/portable
            ftp://archive.progeny.com/OpenBSD/OpenSSH/portable
            ftp://mirrors.netnumina.com/openbsd/OpenSSH/portable
            ftp://ftp.groupbsd.org/pub/OpenBSD/OpenSSH/portable
            ftp://ftp.cse.buffalo.edu/pub/OpenBSD/OpenSSH/portable
            ftp://carroll.cac.psu.edu/pub/OpenBSD/OpenSSH/portable
            ftp://mirrors.rcn.net/pub/OpenBSD/OpenSSH/portable
            ftp://openbsd.secsup.org/pub/openbsd/OpenSSH/portable
            ftp://ftp.tux.org/bsd/openbsd/OpenSSH/portable
            ftp://mirror.cs.wisc.edu/pub/mirrors/OpenBSD/OpenSSH/portable"
  HOMEPAGE="http://www.openssh.com"
       REQ=( "openssl zlib"
             "Linux-PAM:::for pluggable authentication" )
#            "tcp_wrappers:--with-tcp-wrappers::for an optional method of controlling ssh access" )
#            "xinetd:::for running server"
   PROTECT="/etc/ssh"
  ESTIMATE="337"
      DESC="openssh is a client and server for encrypted remote logins and file transfers.
openssh is a Unix/Linux port of OpenBSD's excellent OpenSSH.
OpenSSH is a full implementation of the SSH1 protocol and
a 99% implementation of the SSH 2 protocol, including sftp
client and server support."

build() {

by()  {
  [      -f         $1  ]  &&
  grep   -q  "ssh"  $1
}

if  !  [  -f   $BOOT_ON_LOGS/openssh  ]  &&
    !  [  -f  $BOOT_OFF_LOGS/openssh  ]
then
  if    by  $XINETD_ON_LOGS/openssh
  then  echo  "sshd"  >  $BOOT_ON_LOGS/openssh
        echo "Starting sshd on boot since it was previously started by xinetd."
  elif  by  $XINETD_OFF_LOGS/openssh
  then  echo  "sshd"  >  $BOOT_OFF_LOGS/openssh
        echo  "Not starting sshd on boot since it was not previously started by xinetd."
  else  echo  "sshd"  >  $BOOT_ON_LOGS/openssh
        echo  "Starting sshd at boot since SA did not specify."
  fi
fi

rm  -f  {$XINETD_ON_LOGS,$XINETD_OFF_LOGS}/openssh


if    spell_installed  Linux-PAM  ||
      spell_installed  $(  get_provider  Linux-PAM  )
then  WITH_PAM="--with-pam"
fi

groupadd    sshd        2>/dev/null
useradd  -g sshd  sshd  2>/dev/null
mkdir    -p       /var/empty
chmod       755   /var/empty

./configure            \
--prefix=/usr          \
--sysconfdir=/etc/ssh  \
--with-md5-passwords   \
$WITH_PAM              \
$OPTS                  &&
make                   &&
prepare_install        &&
make    install
}


post_install()  {
  if    netstat  -tpl  |
        grep      ssh  |
        grep     -q  "xinetd"
  then
        bash     /etc/init.d/xinetd  try-restart
        bash     /etc/init.d/sshd          start
  fi
  default_post_install
}
