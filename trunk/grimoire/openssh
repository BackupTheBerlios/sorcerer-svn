   VERSION=( 5.0p1 4.9p1 4.7p1 4.6p1 )
      SAFE=( 5.0p1 4.9p1 )
  CATEGORY='network/security'
 ATTRIBUTE='client console server'
    SOURCE="openssh-$VERSION.tar.gz"
       URL='ftp://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.openbsd.org.ar/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.au.openbsd.org/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.it.net.au/mirrors/OpenBSD/OpenSSH/portable/
            ftp://ftp.planetmirror.com/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.wiretapped.net/pub/OpenBSD/OpenSSH/portable/
            ftp://gd.tuwien.ac.at/opsys/OpenBSD/OpenSSH/portable/
            ftp://mingus.wu-wien.ac.at/pub/OpenBSD/OpenSSH/portable/
            ftp://openbsd.rug.ac.be/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.ca.openbsd.org/pub/OpenBSD/OpenSSH/portable/
            ftp://gulus.usherb.ca/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.shellhung.org/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.openbsd.cz/pub/OpenBSD/OpenSSH/portable/
            ftp://sunsite.dk/mirrors/openssh/portable/
            ftp://ftp.jaquet.dk/pub/openSSH/portable/
            ftp://ftp.fi.debian.org/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.jyu.fi/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.bsdfr.org/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.club-internet.fr/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.de.openbsd.org/pub/unix/OpenBSD/OpenSSH/portable/
            ftp://ftp.freenet.de/pub/ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp-stud.fht-esslingen.de/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.leo.org/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.fh-wolfenbuettel.de/pub/os/openbsd/OpenSSH/portable/
            ftp://filoktitis.noc.uoa.gr/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.duth.gr/pub/OpenBSD/OpenSSH/portable/
            ftp://hal.csd.auth.gr/mirrors/OpenSSH/portable/
            ftp://ftp.fsn.hu/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.esat.net/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.openbsd.it/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.volftp.mondadori.com/mirror/openbsd/OpenSSH/portable/
            ftp://ftp.jp.openbsd.org/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.kddlabs.co.jp/OpenBSD/OpenSSH/portable/
            ftp://ftp.netlab.is.tsukuba.ac.jp/pub/os/OpenBSD/OpenSSH/portable/
            ftp://mirrors.unam.mx/pub/openssh/portable/
            ftp://ftp.nl.uu.net/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.calyx.nl/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.nluug.nl/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.inet.no/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.uninett.no/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.sajinet.com.pe/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.eq.uc.pt/pub/software/unix/security/crypto/openssh/portable/
            ftp://ftp.chg.ru/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.gamma.ru/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.radio-msu.net/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.openbsd.ru/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.snu.ac.kr/pub/BSD/OpenBSD/OpenSSH/portable/
            ftp://ftp.rediris.es/mirror/OpenBSD/OpenSSH/portable/
            ftp://ftp.stacken.kth.se/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.sunet.se/pub/OpenBSD/OpenSSH/portable/
            ftp://sunsite.cnlab-switch.ch/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.kmitl.ac.th/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.plig.org/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.knowledge.com/pub/mirrors/OpenBSD/OpenSSH/portable/
            ftp://gandalf.neark.org/pub/distributions/OpenBSD/OpenSSH/portable/
            ftp://ftp5.usa.openbsd.org/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp3.usa.openbsd.org/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.src.uchicago.edu/pub/OpenBSD/OpenSSH/portable/
            ftp://rt.fm/pub/OpenBSD/OpenSSH/portable/
            ftp://archive.progeny.com/OpenBSD/OpenSSH/portable/
            ftp://mirrors.netnumina.com/openbsd/OpenSSH/portable/
            ftp://ftp.groupbsd.org/pub/OpenBSD/OpenSSH/portable/
            ftp://ftp.cse.buffalo.edu/pub/OpenBSD/OpenSSH/portable/
            ftp://carroll.cac.psu.edu/pub/OpenBSD/OpenSSH/portable/
            ftp://mirrors.rcn.net/pub/OpenBSD/OpenSSH/portable/
            ftp://openbsd.secsup.org/pub/openbsd/OpenSSH/portable/
            ftp://ftp.tux.org/bsd/openbsd/OpenSSH/portable/
            ftp://mirror.cs.wisc.edu/pub/mirrors/OpenBSD/OpenSSH/portable/'
  HOMEPAGE='http://www.openssh.com/'
       REQ=( 'Linux-PAM init-functions libselinux openssl zlib'
             'tcp_wrappers:--with-tcp-wrappers::for an optional method of controlling ssh access' )
# Due to tcp_wrappers not supporting IPv6
# and requires a patch to compile
# and is a hack for use on boxes that lack firewalling support
# and is basically unchanged since 1997 from ftp://ftp.porcupine.org/pub/security/
# -r--r--r--  1 wietse  wheel   99438 Apr  8  1997 tcp_wrappers_7.6.tar.gz
# tcp_wrappers optional will be removed from openssh in 2009
   PROTECT='/etc/ssh'
   EXCLUDE='/etc/ssh/ssh_host_dsa_key
            /etc/ssh/ssh_host_dsa_key.pub
            /etc/ssh/ssh_host_key
            /etc/ssh/ssh_host_key.pub
            /etc/ssh/ssh_host_rsa_key
            /etc/ssh/ssh_host_rsa_key.pub
            /etc/ssh/sshd_config
            /var/empty'
  ESTIMATE='1000'
      DESC='openssh is a client and server for encrypted remote logins and file transfers.
openssh is a Unix/Linux port of the OpenBSD openssh.
openssh is a full implementation of the SSH1 protocol
and a 99% implementation of the SSH 2 protocol,
including sftp client and server support.'

build(){

mkdir    -pm 755 /var/empty
groupadd -K GID_MIN=256 -K GID_MAX=511    sshd                    2>/dev/null
useradd  -K UID_MIN=256 -K UID_MAX=511 -g sshd -d /var/empty sshd 2>/dev/null

if   spell_installed libselinux
then OPTS+=' --with-selinux'
fi

if   spell_installed Linux-PAM
then OPTS+=' --with-pam'
fi

move_sshd_conf(){
 if   [ -n "$( find /etc/ssh/sshd_config -type f -mmin -10 )" ]
 then mv            /etc/ssh/sshd_config \
                    /etc/ssh/sshd_config.default
 fi
}


./configure           \
--prefix=/usr         \
--sysconfdir=/etc/ssh \
--with-md5-passwords  \
$OPTS                 &&
make                  &&
prepare_install       &&
make    install
#       &&
#move_sshd_conf
}

current(){
 case $VERSION in
  5.0p1) [ -f /etc/init.d/ssh-keygen ] ;;
  4.7p1) ! grep -q SERV /etc/init.d/empty ;;
 esac
}
