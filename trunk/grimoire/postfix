   VERSION=( 2.5.2 2.5.1 2.5.0 )
    IGNORE='RC\|^1999\|^200[0-9]'
  CATEGORY='network/email'
 ATTRIBUTE='console server'
    SOURCE="official/postfix-$VERSION.tar.gz"
       URL="$POSTFIX_URL"
  HOMEPAGE='http://www.postfix.org'
       REQ=( 'db pcre'
             'openldap:::for ldap support'
             'Linux-PAM:::for pluggable authentication'
             'mysql:::for MySQL support'
             'openssl:::for postfix with TLS support' )             
   PROTECT='/etc/aliases'
  EPROVIDE='mail-transport-agent'
  ESTIMATE='1200'
      DESC='postfix is a MTA, mail transport agent.'
   
build(){
                VSM='mail_spool_directory = /var/spool/mail'
  sed  -i  "s:#$VSM:$VSM:"  conf/main.cf

mkdir    -p -m 1775 /var/spool/mail
groupadd -K GID_MIN=256 -K GID_MAX=511    mail                         2>/dev/null
useradd  -K UID_MIN=256 -K UID_MAX=511 -g mail -d /var/spool/mail mail 2>/dev/null
chown    mail:mail  /var/spool/mail

groupadd -K GID_MIN=256 -K GID_MAX=511    postdrop 2>/dev/null
useradd  -K UID_MIN=256 -K UID_MAX=511 -g postdrop -d /var/spool/mail postdrop 2>/dev/null
groupadd -K GID_MIN=256 -K GID_MAX=511    postfix 2>/dev/null
useradd  -K UID_MIN=256 -K UID_MAX=511 -g postfix -d /var/spool/mail postfix 2>/dev/null

 if   grep  -qx       openldap $OPT_ON_LOGS/postfix &&
      spell_installed openldap
 then AUXLIBS="-lldap -llber"
      CCARGS="-DHAS_LDAP"
 fi

 if   grep  -qx       Linux-PAM $OPT_ON_LOGS/postfix &&
      spell_installed Linux-PAM
 then AUXLIBS+=' -lpam -lpam_misc'
      CCARGS+=' -DHAS_PAM'
 fi

 if   grep  -qx       mysql $OPT_ON_LOGS/postfix &&
      spell_installed mysql
 then AUXLIBS+=' -L/usr/lib -lmysqlclient -lz -lm'
      CCARGS+=' -DHAS_MYSQL -I/usr/include/mysql'
 fi

 if   grep  -qx       openssl $OPT_ON_LOGS/postfix &&
      spell_installed openssl
 then AUXLIBS+=' -lssl -lcrypto'
      CCARGS+=' -DUSE_TLS'
 fi

 # fix for get man pages to install in /usr/man

 sed  -i  "s:/usr/local:/usr:" src/global/mail_params.h
 grep -lr "tail +" * | xargs --max-lines=32 sed -i "s:tail +:tail -n +:g"

 make  -f Makefile.init makefiles \
 "CC=gcc"                         \
 "AUXLIBS=$AUXLIBS"               \
 "CCARGS=$CCARGS"                 \
 "OPT=$CFLAGS"                    &&
 make                             &&
 prepare_install                  &&

 sh ./postfix-install    -non-interactive  &&
 ln -fs ../sbin/sendmail /usr/lib/sendmail &&
 ln -fs postfix/aliases  /etc/aliases
}
