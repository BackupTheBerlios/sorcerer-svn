#            'linuxdoc-tools:::for building HTML documentation' )
# linuxdoc-tools optional requirement creates problems on the I/R
# linuxdoc-tools requires openjade and openjade requires gcc-v3.4

    stable 1.15.1 1.12
   require automake flex init-functions libtool perl
# kbd source ignores --bindir=/bin
#     opts --bindir=/bin
  category font utility/keyboard
 attribute console
    source http://ftp.debian.org/debian/pool/main/k/kbd/kbd_$VERSION.orig.tar.gz
 conflicts console-tools console-data
  estimate 300
      desc 'keytable files and keyboard utilities
Configuration file is /etc/keymap.conf'

configure(){
 get(){
  menu_list(){ sed "1iask	$2
                    s:$:	$2:" < $SCRIPT_DIR/$3; }

  WHAT=$( dialog --stdout                        \
                 --timeout  ${PROMPT_DELAY:-120} \
                 --title "$2 Menu"               \
                 --default-item "$4"             \
                 --menu  ""  0 0 0               \
                 $( menu_list "$@" )
        )  &&
  if [ -n      "$WHAT" ]
  then echo "$1=$WHAT" >> $SPELL_CONFIG
  fi
 }

 if   [ -d /boot/isolinux ]
 then KEYMAP=ask
 fi

 if [ -z "$KEYMAP" ]; then get "KEYMAP" "Keymap" "keymaps.txt" "us"; fi
#if [ -z "$FONT"   ]; then get "FONT"   "Font"   "fonts.txt"   "default8x16"; fi
}


build(){
 rm  -f /etc/keymap.conf
 [   -n  "$KEYMAP" ] &&
 sed -i "s:KEYMAP=[^$]*$:KEYMAP=$KEYMAP:" $SCRIPT_DIR/init.d.on/loadkeys

 case $VERSION in
  1.12) sed -i "s:-O2:$CFLAGS:" openvt/Makefile src/Makefile.in ;;
 esac

 # Fix setfont when compiled with gcc4
 # patch -p1 < $SCRIPT_DIR/kbd-1.12-gcc4-fixes-1.patch

 aclocal -I  .             &&
 autoheader                &&
 libtoolize  --automake    &&
 automake    --add-missing &&
 autoconf                  &&
 ./configure --prefix=/usr &&
 make            &&
 prepare_install &&
 make    install &&
 mv /usr/bin/loadkeys /bin/
}
