# qemu version 0.9.1 can become unresponsive and can lock up.
# 0.10.0 lost support for --disable-gcc-check and --enable-alsa and 
# SDL became an elective?
# While running 0.12.1 tar segfaulted while decompressing linux kernel tarball.

# 1.4.0 failed compilation
# When successfully updating qemu also update the xen spell.

# pixman included in qemu has compile errors so use system installed

with info    last 20130521
with version   stable 1.5.0 1.4.1 1.3.1
with version unstable 1.5.0
with base    alsa-lib bluez curl gnutls libaio pixman zlib
with elect   SDL '' '--disable-sdl'
with elect   xen --enable-xen --disable-xen
with also    --audio-drv-list=alsa
case $VERSION in
 1.3.*)
with also    --audio-card-list=ac97,es1370,sb16,cs4231a,adlib,gus,hda ;;
 1.4.*)
with also    --audio-card-list=ac97,es1370,sb16,cs4231a,adlib,gus,hda ;;
esac
with also    --disable-werror
with role    development/emulator
with trait   makej optimize x11
with source    stable http://wiki.qemu.org/download/qemu-$VERSION.tar.bz2
with source  unstable http://wiki.qemu.org/download/qemu-$VERSION.tar.bz2
with info    vurl http://wiki.qemu.org/Download
with info    home http://wiki.qemu.org/Index.html
with info    docs http://wiki.qemu.org/Manual
with info    mail http://wiki.qemu.org/MailingLists
with info    cite 'computer emulator'
#with disable ccache

build(){
 grep  -rl                       '\-g -fno-strict-aliasing'  *  |
 xargs -r --max-lines=64 sed -i 's:-g -fno-strict-aliasing:-fno-strict-aliasing:'

 case $HOSTTYPE in
  x86_64) : ;;
       *) grep  -lr        '\-Wall -O2' * |
          xargs -r sed -i 's:-Wall -O2:-O2 -march=i586:' ;;
 esac

 unset  CFLAGS
 unset  CXXFLAGS

 ./configure   \
 --prefix=/usr \
 $OPTS &&
 make  &&
 make install DESTDIR="$DESTDIR"
}
