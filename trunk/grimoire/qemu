# qemu version 0.9.1 can become unresponsive and can lock up.
# 0.10.0 lost support for --disable-gcc-check and --enable-alsa and 
# SDL became optional?
# While running 0.12.1 tar segfaulted while decompressing linux kernel tarball.

   version stable 1.0.1 1.0 0.15.1 0.15.0 0.14.1 0.14.0 0.13.0
   require bluez curl gnutls libaio zlib
  optional SDL '' '--disable-sdl'
  optional alsa-lib
      opts --audio-drv-list=alsa
      opts --audio-card-list=ac97
  category development/emulator
 attribute makej optimize x11
    source http://wiki.qemu.org/download/qemu-$VERSION.tar.gz
#   source http://download.savannah.gnu.org/releases/qemu/qemu-$VERSION.tar.gz
      vurl http://wiki.qemu.org/Download
      info last 20120222
      info home http://wiki.qemu.org/Index.html
      info docs http://wiki.qemu.org/Manual
      info mail http://wiki.qemu.org/MailingLists
      desc 'computer emulator'
   disable ccache

build(){
 grep  -rl                       '\-g -fno-strict-aliasing'  *  |
 xargs -r --max-lines=64 sed -i 's:-g -fno-strict-aliasing:-fno-strict-aliasing:'

 case $HOSTTYPE in
  x86_64) : ;;
       *) grep  -lr        '\-Wall -O2' * |
          xargs -r sed -i 's:-Wall -O2:-O2 -march=i586:' ;;
 esac

 unset  CFLAGS
 unset  CXXFLAGS

 ./configure   \
 --prefix=/usr \
 $OPTS &&
 make  &&
 make install DESTDIR=$DESTDIR
}
