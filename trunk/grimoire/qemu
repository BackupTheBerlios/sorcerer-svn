# qemu version 0.9.1 can become unresponsive and can lock up.
# 0.10.0 lost support for --disable-gcc-check and --enable-alsa and 
# SDL became optional?

    stable 0.10.1 0.10.0 0.9.0
   require SDL bluez-libs gnutls
# optional SDL '' '--disable-sdl --disable-gfx-check'
      opts --audio-drv-list=alsa
      opts --audio-card-list=ac97

# What is mixemu midi emulation support?
#     opts --enable-mixemu    

#  require SDL
# optional alsa-lib --enable-alsa  '' for audio output through alsa drivers
#  switch          --enable-adlib '' for adlib and midi emulation support

  category development/emulator
 attribute x11
       url $GNU_URL
    source http://download.savannah.gnu.org/releases/qemu/qemu-$VERSION.tar.gz
#   source http://fabrice.bellard.free.fr/qemu/qemu-$VERSION.tar.gz
#     vurl http://fabrice.bellard.free.fr/qemu/download.html
# homepage http://fabrice.bellard.free.fr/qemu/
#     opts --disable-gcc-check
case $VERSION in
 0.9.1) use_gcc gcc-v3.4 ;;
 0.9.0) use_gcc gcc-v3.4 ;;
esac
  estimate 2000
      desc 'qemu is a computer emulator.'

disable ccache

build(){
 grep  -rl                       '\-g -fno-strict-aliasing'  *  |
 xargs -r --max-lines=64 sed -i 's:-g -fno-strict-aliasing:-fno-strict-aliasing:'

 case $HOSTTYPE in
  x86_64) : ;;
       *) grep  -lr        '\-Wall -O2' * |
          xargs -r sed -i 's:-Wall -O2:-O2 -march=i586:' ;;
 esac

 unset  CFLAGS
 unset  CXXFLAGS

 ./configure     \
 --prefix=/usr   \
 $OPTS           &&
 make            &&
 prepare_install &&
 make    install
}
