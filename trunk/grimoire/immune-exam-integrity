# Copyright Kyle Sallee 2011 through 2013
# All rights reserved.
# For use with the distribution sorcerer only!

# granted elective on immune-exam-dispel
# to ensure that obsolete spells are dispelled
# prior to checking digital signatures for files.
# This ensures proper re-casting of software that
# formerly shared files and should be recast.

version_year_week

# Spell deprecated in favor of integrating integrity scanning
# directly into sorcery utilities

with trait   broke deprecated
with info    last 20131025
with base    bash coreutils findutils sed sorcery
with base    curl gawk gcc grep make 
with elect   immune-exam-dispel
with role    immune-system
with trait   solo stale
with info    home http://sorcerer.silverice.org/
with info    cite 'file integrity protection

installed files are checked weekly
to ensure that file content is not corrupted.
Corrupted files are corrected by re-installation
of the software projects that provided the file'

# exam-integrity execution can not be moved out of post_install
# because not only does it find spells that require recasting
# but it adds them to the queue and creates event logs

build(){ :; }
post_install_old(){
 if   [  -n "$RESUME_LOGS" ] &&
      [  -f "$RESUME_LOGS/immune-exam-integrity"
 then rm -f "$RESUME_LOGS/immune-exam-integrity"
 fi

 bash "$SCRIPT_DIR"/exam-integrity
 default_post_install
}
