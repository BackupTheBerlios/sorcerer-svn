# 564 fails installation.

    stable 5731 573 572 571 570 564 563 562 561 560
  category development/assembler
 attribute console
#attribute broke
       url $SOURCEFORGE_URL
    source biew/biew-$VERSION.tar.bz2
  homepage http://biew.sourceforge.net
  estimate 100
      desc 'biew is a binary file viewer/editor/disassembler
biew (Binary vIEW) is a free, portable, advanced file viewer with a
built-in editor for binary, hexadecimal, and disassembler modes.
It contains a highlight PentiumIII/K7Athlon/Cyrix-M2 disassembler, 
full preview of MZ, NE, PE, LE, LX, DOS.SYS, NLM, ELF, a.out, 
arch, coff32, PharLap, and rdoff executable formats, a code guider,
and lot of other features.'


build(){
build_old(){
HC="$CFLAGS"

for  FLAG  in  $(  grep  "^flags"  /proc/cpuinfo  );  do
  case  $FLAG  in
         mmx)  HC="$HC -DHAVE_MMX"      ;;
      mmxext)  HC="$HC -DHAVE_MMX2"     ;;
         sse)  HC="$HC -DHAVE_SSE"      ;;
       3dnow)  HC="$HC -DHAVE_3DNOW"    ;;
    3dnowext)  HC="$HC -DHAVE_3DNOWEX"  ;;
      sseext)  HC="$HC -DHAVE_SSE2"     ;;
           *)  true                     ;;
  esac
done
echo  "HC=$HC"

sed  -i  "s/TARGET_OS=unix/TARGET_OS=linux/"             makefile    &&
# sed  -i  "s/TARGET_PLATFORM=i386/TARGET_PLATFORM=$BOX/"  makefile    &&
sed  -i  "s/HOST_CFLAGS=/HOST_CFLAGS=$HC/"               makefile    &&
sed  -i  "s:/usr/local:/usr:"  biewlib/sysdep/generic/unix/os_dep.c  &&

if  spell_installed  gpm  ||
    spell_held       gpm;
then  sed  -i  "s/USE_MOUSE=n/USE_MOUSE=y/"  makefile
fi  &&

case  $VERSION  in
  561)  sed  -i  "s,c_end:,c_end: ;,"  biewlib/sysdep/ia32/linux/keyboard.c  ;;
  562)  sed  -i  "s,c_end:,c_end: ;,"  biewlib/sysdep/ia32/linux/keyboard.c  ;;
esac

make                                          &&
prepare_install                               &&
gzip       doc/biew.1                         &&
cp         doc/biew.1.gz     /usr/man/man1    &&
cp         biew              /usr/bin         &&
mkdir  -p                    /usr/share/biew  &&
cp         bin_rc/skn/*.skn  /usr/share/biew  &&
cp     -R  bin_rc/xlt        /usr/share/biew  &&
cp         bin_rc/biew.hlp   /usr/share/biew  &&
cp     -R  hlp/*             /usr/share/biew
}

 # tested with version 564
 sed -i   '\,/xlt/russian,d'   makefile
 rm  -rf  bin_rc/xlt/russian/
 
 ./configure               \
  --sysconfdir=/etc        \
  --localstatedir=/var     \
  --prefix=${PREFIX:-/usr} \
 $OPTS           &&
 make            &&
 prepare_install &&
 mkdir -p /usr/share/biew/xlt &&
 make    install
#default_build
# mkdir -p /usr/share/biew/xlt
# was added because biew 570's makefile is missing it.
}
