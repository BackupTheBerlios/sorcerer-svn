# no configure switch to disable selinux support with fuse 2.6.3
# --disable-static causes compilation error with fuse 2.7.0

    stable 2.8.3 2.8.2 2.8.1 2.8.0
   require automake init-functions libtool
  category utility
 attribute library
    source $SOURCEFORGE_URL fuse/fuse-2.X/$VERSION/fuse-$VERSION.tar.gz
  homepage http://fuse.sourceforge.net
      opts --disable-kernel-module --with-pkgconfigdir=/usr/lib/pkgconfig --enable-static=no
  estimate 300
      desc 'file system in userspace program and kernel module
fuse is a simple interface for userspace programs
to export a virtual filesystem to the Linux kernel.
It also aims to provide a secure method for non privileged users
to create and mount their own filesystem implementations.
This spell installs the library only.
Install the fuse kernel module using linux.'

build(){
 mv_libs(){
  if   [  -f  /lib/libfuse.a ]
  then mv -v  /lib/lib{fuse,ulockmgr}.{a,la}   /usr/lib/
       ln -vs /lib/lib{fuse,ulockmgr}.so*      /usr/lib/
  elif [  -f  /lib64/libfuse.a  ]
  then mv -v  /lib64/lib{fuse,ulockmgr}.{a,la} /usr/lib64/
       ln -vs /lib64/lib{fuse,ulockmgr}.so*    /usr/lib64/
  fi

  if   [      -f /lib/pkgconfig/fuse.pc ]
  then mkdir  -vpm 0755                 /usr/lib/pkgconfig
       mv     -v /lib/pkgconfig/fuse.pc /usr/lib/pkgconfig/
       rm   -frv /lib/pkgconfig
  fi
 }

 if   [ $HOSTTYPE == x86_64 ]
 then LIBDIR=/lib64
 else LIBDIR=/lib
 fi

 case $VERSION in
  2.6*) sed -i "s:PRGNAME=.*:PRGNAME=\"\${0##*/}\":
                s:which \${FSTYPE}:hash \${FSTYPE}:" util/mount.fuse ;;
 esac

 ./configure          \
 --prefix=/usr        \
 --bindir=/bin        \
 --libdir=$LIBDIR     \
 --sysconfdir=/etc    \
 --localstatedir=/var \
 $OPTS                &&
 make                 &&
 prepare_install      &&
 make    install      &&
 mv_libs
}
