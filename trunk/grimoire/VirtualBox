# Use qemu-kvm instead.
# qemu-kvm is better.

# Version 4.1.8 compiles and installs
# however I have not created any init-scripts for it.
# Does anyone want to use VirtualBox instead of qemu?

# Version 4.1.14 4.1.12 4.1.10 fails compilation

   version   stable 4.1.8
   version unstable 4.1.14
   require Dev86 Python SDL acpica makeself pulseaudio
  optional curl
      opts --disable-hardening --disable-qt4 --disable-java --build-headless --disable-docs
  category development/emulator
 attribute x11
    source   stable http://download.virtualbox.org/virtualbox/$VERSION/VirtualBox-$VERSION.tar.bz2
    source unstable http://download.virtualbox.org/virtualbox/$VERSION/VirtualBox-$VERSION.tar.bz2
      info vurl http://www.virtualbox.org/wiki/Downloads/
      info last 20120428
      info home http://www.virtualbox.org/
      info docs http://www.virtualbox.org/wiki/Documentation
      desc 'a computer emulator'

build(){
 if   [[ $HOSTTYPE == x86_64 ]] && ! [[ $CFLAGS =~ -m32 ]]
 then export LDFLAGS+=" -L/lib64"
 else export LDFLAGS+=" -L/lib"
 fi

 sed -i 's:LIBX11=.*:LIBX11="-lXext -lX11":' configure

 ./configure $OPTS &&
 . ./env.sh      &&
 kmk         all &&
 cd out/*/release/bin/src &&
 make    install "DESTDIR=$DESTDIR" &&
 cd      ../../ &&
 mkdir -pvm 755 $DESTDIR/opt &&
 cp -av bin     $DESTDIR/opt/VirtualBox
}
