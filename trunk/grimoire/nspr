# 4.8.8 compiled, but patch required for evolution-data-server
# to recognize installed nspr

   version stable 4.8.7 4.8.6 4.8.4
#  version stable 4.8.9 4.8.8 4.8.7 4.8.6 4.8.4
      opts --disable-static
  category network/web
 attribute library makej multilib-dual
    source http://ftp.mozilla.org/pub/mozilla.org/nspr/releases/v$VERSION/src/nspr-$VERSION.tar.gz
    source http://www.linuxfromscratch.org/patches/blfs/svn/nspr-4.8.6-pkgconfig-1.patch
case $VERSION in
 4.8.6) source http://www.linuxfromscratch.org/patches/blfs/svn/nspr-4.8.6-pkgconfig-1.patch ;;
 4.8.4) source http://www.linuxfromscratch.org/patches/blfs/svn/nspr-4.8.3-pkgconfig-1.patch ;;
esac
      info last 20110506
      info home http://www.mozilla.org/projects/security/pki/nss/
      desc 'netscape portable runtime'

build(){
 if   [[ $HOSTTYPE == x86_64 ]] && ! [[ $CFLAGS =~ -m32 ]]
 then opts --enable-64bit
 fi
 export LDFLAGS+=" $CFLAGS"

# The patch is for pkgconfig support 
# However, why does it not apply automatically by cast?

# sed -i 's:$libdirs::' mozilla/nsprpub/config/nspr-config.in

 patch -p1 < ${SOURCE[1]}
 cd mozilla/nsprpub &&
 ./configure     \
  --prefix=/usr  \
  --with-mozilla \
 --with-pthreads \
 $OPTS &&
 make  &&
 make install    DESTDIR=$DESTDIR &&
 mkdir -vpm 755 $DESTDIR/usr/include &&
 cp -vLR dist/include/nspr $DESTDIR/usr/include
}
