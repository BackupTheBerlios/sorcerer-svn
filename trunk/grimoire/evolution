# requires ancient version of gnome-doc-utils
# configure: error: gnome-doc-utils >= 0.3.2 not found
# 2.32.1 and 2.32.0 errors with:
#   CC     libevolution_module_addressbook_la-e-book-shell-backend.lo
# e-book-shell-backend.c: In function ‘book_shell_backend_init_preferences’:
# e-book-shell-backend.c:326: error: ‘certificate_manager_config_new’ undeclared (first use in this function)
# e-book-shell-backend.c:326: error: (Each undeclared identifier is reported only once
# e-book-shell-backend.c:326: error: for each function it appears in.)
# make[3]: *** [libevolution_module_addressbook_la-e-book-shell-backend.lo] Error 1
# make[3]: Leaving directory `/usr/src/sorcery/evolution/evolution-2.32.1/modules/addressbook'

    stable 2.32.1 2.32.0 2.30.3
  unstable 2.91.6.1 2.91.5
   require evolution-data-server gnome-desktop gnome-doc-utils gstreamer gtkhtml gtkimageview libcanberra libnotify libunique psmisc
#  require evolution-data-server gnome-desktop gnome-doc-utils gstreamer gtkhtml gtkimageview libcanberra libnotify libpst libunique psmisc
  optional enchant
      opts --disable-nm
# libpst is currently not linking because the software author
# fails to properly detect when libboost-python-mt is installed
      opts --disable-pst-import
 DBVERSION='3.1.17'
  category network/email
 attribute client gnome
 attribute broke
    source $GNOME_URL sources/evolution/${VERSION:0:4}/evolution-$VERSION.tar.bz2
    source ftp://ftp.sleepycat.com/releases/db-$DBVERSION.tar.gz
  homepage http://www.novell.com/products/desktop/features/evolution.html
   provide email-client
  estimate 5300
      desc 'information management solution
evolution Ximian Evolution^(TM), is a personal
and workgroup information management solution.
The software seamlessly integrates email,
calendaring, meeting scheduling, contact management
and online task lists in a single application.'

build(){
 local PKG_CONFIG_PATH FV

 FV="$( installed_version firefox )"
 if   [ $FV ]
 then OPTS+=" --with-nss-libs=/usr/lib/firefox-devel-$FV/sdk/lib"
 else OPTS+=" --with-nss-libs=/usr/lib/mozilla"
 fi

 OPTS+=" --with-db3=$BUILD_DIR/evolution-db3"

 mkdir evolution-db3               &&
 cd db-$DBVERSION/build_unix       &&
 ../dist/configure                 \
 --prefix=$BUILD_DIR/evolution-db3 \
 --disable-dynamic &&
 make              &&
 make  install     &&

 cd  $BUILD_DIR    &&

 export PKG_CONFIG_PATH=/usr/share/pkgconfig
 export LDFLAGS+=' -L/usr/lib/mozilla -Wl,-rpath,/usr/lib/mozilla -Wl,-rpath-link,/usr/lib/mozilla'
 ./configure          \
 --prefix=/usr        \
 --sysconfdir=/etc    \
 --localstatedir=/var \
 --disable-gtk-doc    \
 $OPTS &&
 make  &&
 make install "DESTDIR=$DESTDIR"
}


# why is hicolor-icon-theme reinstalled after evolution?
post_install(){
 if   is_installed       hicolor-icon-theme
 then echo hicolor-icon-theme | pipe_queue $CAST_QUEUE com
 fi
}
