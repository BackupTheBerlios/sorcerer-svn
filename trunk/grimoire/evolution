# requires ancient version of gnome-doc-utils
# configure: error: gnome-doc-utils >= 0.3.2 not found
# 2.32.1 and 2.32.0 errors with:
#   CC     libevolution_module_addressbook_la-e-book-shell-backend.lo
# e-book-shell-backend.c: In function ‘book_shell_backend_init_preferences’:
# e-book-shell-backend.c:326: error: ‘certificate_manager_config_new’ undeclared (first use in this function)
# e-book-shell-backend.c:326: error: (Each undeclared identifier is reported only once
# e-book-shell-backend.c:326: error: for each function it appears in.)
# make[3]: *** [libevolution_module_addressbook_la-e-book-shell-backend.lo] Error 1
# make[3]: Leaving directory `/usr/src/sorcery/evolution/evolution-2.32.1/modules/addressbook'

   version   stable 3.2.3 3.2.2 3.2.1 3.2.0 3.0.3 3.0.1 3.0.0
   version unstable 3.4.0
   require evolution-data-server gnome-desktop gstreamer gtkhtml libcanberra libnotify libunique
  optional enchant
      opts --disable-nm
      opts --disable-smime
      opts --disable-pst-import
      opts --disable-image-inline
# until gtkimageview 2.0 release opts --disable-image-inline

# libpst is currently not linking because the software author
# fails to properly detect when libboost-python-mt is installed
 DBVERSION='3.1.17'
  category network/email
 attribute client gnome
 attribute broke
    source $GNOME_URL sources/evolution/${VERSION:0:3}/evolution-$VERSION.tar.xz
#   source ftp://ftp.sleepycat.com/releases/db-$DBVERSION.tar.gz
      info last 20120326
      info home http://www.novell.com/products/desktop/features/evolution.html
   provide email-client
      desc 'information management solution
evolution Ximian Evolution^(TM), is a personal
and workgroup information management solution.
The software seamlessly integrates email,
calendaring, meeting scheduling, contact management
and online task lists in a single application.'

build(){
 case $VERSION in
  3.2.3) sed -i '/-Werror-implicit-function-declaration/d;s:-Werror::' configure ;;
 esac

 sed -i 's:hardcode_into_libs=yes:hardcode_into_libs=no:' configure
 default_build
}

build_old(){
 local PKG_CONFIG_PATH FV

# export   CFLAGS+=" -UGTK_DISABLE_DEPRECATED -UGDK_PIXBUF_DISABLE_DEPRECATED"
# export CXXFLAGS+=" -UGTK_DISABLE_DEPRECATED -UGDK_PIXBUF_DISABLE_DEPRECATED"

# FV="$( installed_version firefox )"
# if   [ $FV ]
# then OPTS+=" --with-nss-libs=/usr/lib/firefox-devel-$FV/sdk/lib"
# else OPTS+=" --with-nss-libs=/usr/lib/mozilla"
# fi

# OPTS+=" --with-db3=$BUILD_DIR/evolution-db3"

# mkdir evolution-db3               &&
# cd db-$DBVERSION/build_unix       &&
# ../dist/configure                 \
# --prefix=$BUILD_DIR/evolution-db3 \
# --disable-dynamic &&
# make              &&
# make  install     &&
# cd  $BUILD_DIR    &&

# export PKG_CONFIG_PATH=/usr/share/pkgconfig

# if   [[ $HOSTTYPE == x86_64 ]] &&
#    ! [[ $CFLAGS   =~ -m32   ]]
# then export LDFLAGS+=' -L/usr/lib64/mozilla -Wl,-rpath,/usr/lib64/mozilla -Wl,-rpath-link,/usr/lib64/mozilla'
# else export LDFLAGS+=' -L/usr/lib/mozilla -Wl,-rpath,/usr/lib/mozilla -Wl,-rpath-link,/usr/lib/mozilla'
# fi

 ./configure          \
 --prefix=/usr        \
 --sysconfdir=/etc    \
 --localstatedir=/var \
 --disable-gtk-doc    \
 $OPTS &&
 make  &&
 make install "DESTDIR=$DESTDIR"
}


# why is hicolor-icon-theme reinstalled after evolution?
post_install(){
 if   is_installed hicolor-icon-theme
 then echo         hicolor-icon-theme | pipe_queue $CAST_QUEUE
 fi
}
