# requires ancient version of gnome-doc-utils
# configure: error: gnome-doc-utils >= 0.3.2 not found
    stable 2.32.1 2.32.0 2.30.3
  unstable 2.91.2 2.91.1
   require evolution-data-server gnome-desktop gnome-doc-utils gstreamer gtkhtml gtkimageview libcanberra libnotify libpst libunique psmisc
  optional enchant
      opts --disable-nm
# libpst is currently not linking because the software author
# fails to properly detect when libboost-python-mt is installed
      opts --disable-pst-import
 DBVERSION='3.1.17'
  category network/email
 attribute client gnome
 attribute broke
    source $GNOME_URL sources/evolution/${VERSION:0:4}/evolution-$VERSION.tar.bz2
    source ftp://ftp.sleepycat.com/releases/db-$DBVERSION.tar.gz
  homepage http://www.ximian.com/products/ximian_evolution
   provide email-client
  estimate 5300
      desc 'information management solution
evolution Ximian Evolution^(TM), is a personal
and workgroup information management solution.
The software seamlessly integrates email,
calendaring, meeting scheduling, contact management
and online task lists in a single application.'

build(){

FV="$( installed_version firefox )"
if   [ $FV ]
then OPTS+=" --with-nss-libs=/usr/lib/firefox-devel-$FV/sdk/lib"
else OPTS+=" --with-nss-libs=/usr/lib/mozilla"
fi

 OPTS+=" --with-db3=$BUILD_DIR/evolution-db3"

 mkdir evolution-db3               &&
 cd db-$DBVERSION/build_unix       &&
 ../dist/configure                 \
 --prefix=$BUILD_DIR/evolution-db3 \
 --disable-dynamic &&
 make              &&
 make  install     &&

 cd  $BUILD_DIR    &&

 export LDFLAGS+=' -L/usr/lib/mozilla -Wl,-rpath,/usr/lib/mozilla -Wl,-rpath-link,/usr/lib/mozilla'
 ./configure          \
 --prefix=/usr        \
 --sysconfdir=/etc    \
 --localstatedir=/var \
 --disable-gtk-doc    \
 $OPTS &&
 make  &&
 make install "DESTDIR=$DESTDIR"
}


# why is hicolor-icon-theme reinstalled after evolution?
post_install(){
 if   is_installed       hicolor-icon-theme
 then echo hicolor-icon-theme | pipe_queue $CAST_QUEUE com
 fi
}
