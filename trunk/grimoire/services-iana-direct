    stable "$( date -u +%Y-%m )"
  category network
 attribute client server
    source port-numbers
       url http://www.iana.org/assignments/
  homepage http://www.iana.org/
disable scavenge
   protect /etc/services
  estimate 5
  eprovide services
      desc 'services-iana-direct translates the port numbers assigned by IANA to /etc/services'

build(){

# port-numbers is seriously malformed.
# Adding a line feed after port-numbers is essential because it lacks one.
# It also contains ASCII characters > 0x7e which causes column to quit.
# It also has tabs where it should have spaces.
# It has carriage returns line feed pairslike DOS files.
# Those reasons are why many tr sanitation commands are required.

PN=$SOURCE_CACHE/$SPELL/$VERSION/port-numbers
LO=/etc/services.local
[-f   $PN ] && prepare_install &&
( cat $PN ; echo
  [ -f $LO ] &&
  cat  $LO ) |
tr   -d '\r'             |
tr      '\t'  ' '        |
tr   -s ' '              |
tr   -d '\177-\377'      |
grep    "/tcp\|/udp"     |
grep -v "^ \|Unassigned" |
sed  -r "s:([^ ]*) ([^ ]*):\1|\2|#:
         s:\|#$::" |
column  -s '|' -t  > services &&
install -vm 644 -b -S .old services /etc
}


current(){ [ /etc/services -nt /etc/services.local ]; }
