#   stable "$( date -u +%Y-%m )"
version_year_month 12
  category network
 attribute client server
    source http://www.iana.org/assignments/port-numbers
  homepage http://www.iana.org/
disable scavenge
   protect /etc/services
  eprovide services
      desc 'translates the port numbers assigned by IANA to /etc/services.d/IANA'

build(){

# port-numbers is seriously malformed.
# Adding a line feed after port-numbers is essential because it lacks one.
# It also contains ASCII characters > 0x7e which causes column to quit.
# It also has tabs where it should have spaces.
# It has carriage returns line feed pairslike DOS files.
# Those reasons are why many tr sanitation commands are required.

LO=/etc/services.local
[[ -s $SOURCE ]]
( cat $SOURCE ; echo )   |
tr   -d '\r'             |
tr      '\t'  ' '        |
tr   -s ' '              |
tr   -d '\177-\377'      |
grep    "/tcp\|/udp"     |
grep -v "^ \|Unassigned" |
sed  -r "s:([^ ]*) ([^ ]*):\1|\2|#:
         s:\|#$::" |
column  -s '|' -t  > $SCRIPT_DIR/services.d/IANA &&
prepare_install
}


current(){ [ -f /etc/services.d/IANA ]; }
