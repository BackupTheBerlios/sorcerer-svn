# The patch file sets the DESTDIR and configuration
# However, something may be wrong with it, because uqm is not tracking.

case $SPELL in
 uqm) 
with version stable 0.7.0
with trait   broke
with base    MesaLib SDL_image audiofile libmikmod libvorbis uqm-content
with elect   uqm-3domusic '' '' for excellent but large music files
with elect   uqm-remix    '' '' for remixed music instead of original music
with elect   uqm-voice    '' '' for excellent but large voice files
with source  $SOURCEFORGE_URL sc2/UQM/${VERSION:0:3}/uqm-$VERSION-source.tgz ;;
   *)
with trait   x11
 pre_build(){ :; } ;;
esac
with role    game
with trait   x11
with info    good 20120711
with info    last 20110704
with info    home http://sc2.sourceforge.net
with info    cite 'port of the 3DO version of the game StarControl 2'

build(){
 install_source(){
  mkdir -pvm 755 content
  echo |
 ./build.sh uqm depend  &&
 ./build.sh uqm         &&
 ./build.sh uqm install &&
  mkdir -pvm 755    $DESTDIR/usr/share/uqm/content &&
  echo "$VERSION" > $DESTDIR/usr/share/uqm/content/version
 }


 install_data(){
  CONTENT=${SOURCE}
  PACKAGE=$DESTDIR/usr/share/uqm/content/packages
  if [[ -n $CONTENT ]]; then
   set     -x &&
   mkdir   -p $PACKAGE &&
   install -vm 644 -o root -g root $CONTENT $PACKAGE &&
   set     +x
  else
   echo "$SOURCE not found"
   false
  fi
 }


 install_remix(){
  CONTENT1=${SOURCE[0]}
  CONTENT2=${SOURCE[1]}
  CONTENT3=${SOURCE[2]}
  PACKAGE=$DESTDIR/usr/share/uqm/content/packages/addons/uqmremix
  if   [[ -f $CONTENT1 ]] &&
       [[ -f $CONTENT2 ]] &&
       [[ -f $CONTENT3 ]]
  then
   set     -x          &&
   mkdir   -pvm 755 $PACKAGE &&
   install  -vm 644 -o root -g root $CONTENT1 $PACKAGE &&
   install  -vm 644 -o root -g root $CONTENT2 $PACKAGE &&
   install  -vm 644 -o root -g root $CONTENT3 $PACKAGE &&
   set     +x
  else
   echo "Not all remixes tarballs found."
   false
  fi
 }

 case $SPELL in
  uqm)       install_source ;;
  uqm-remix) install_remix  ;;
  *)         install_data   ;;
 esac
}
