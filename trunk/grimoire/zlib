# Version 1.2.3 compiled with gcc-core 4.4.3 using -O3 in CFLAGS
# produces a zlib library that causes firefox to segmentation fault
# when firefox starts.

# Version 1.2.5 has bugs that segfault /usr/bin/xsltproc
# Version 1.2.4 makes programs crash happy, especially firefox.
    stable 1.2.3
    secure 1.2.3
  category archive
 attribute library solo
    source http://www.zlib.net/ http://www.gzip.org/zlib/ zlib-$VERSION.tar.gz
  homepage http://www.zlib.net/
#   CFLAGS='-O3'
   LDFLAGS='-Wl,-O1'
  estimate 70
      desc 'legally unencumbered lossless data compression library
zlib is designed to be a free, general-purpose,
legally unencumbered -- that is, not covered by any patents
-- lossless data-compression library
for use on virtually any computer hardware and operating system.
The zlib data format is portable across platforms.'

build(){

 add_compat_syms(){
  if   [ -d $DESTDIR/lib64 ]; then
   mkdir -p $DESTDIR/usr/lib64
   for REPLY in $DESTDIR/lib64/*
   do ln -s ../../lib64/${REPLY##*/} $DESTDIR/usr/lib64/${REPLY##*/}
   done
  elif [ -d $DESTDIR/lib ]; then
   mkdir -p $DESTDIR/usr/lib
   for REPLY in $DESTDIR/lib/*
   do ln -s ../../lib/${REPLY##*/} $DESTDIR/usr/lib/${REPLY##*/}
  done
  fi
 }

 if   [[ $HOSTTYPE == x86_64 ]]
 then LIBDIR=/lib64
 else LIBDIR=/lib
 fi

 export    CFLAGS+=' -fPIC'
 export  CXXFLAGS+=' -fPIC'

 ./configure \
 --prefix=/usr \
 --shared &&
 make "CFLAGS=$CFLAGS" &&
 strip -s libz.so* &&
 make install prefix=$DESTDIR/usr exec_prefix=$DESTDIR &&
 add_compat_syms
}
