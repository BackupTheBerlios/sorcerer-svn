# 5.00-pre1 failed compilation
# 5.00-pre2 failed compilation

# syslinux version 4.05 compiled with gcc version 4.6.3 works
# however compiled with gcc version 4.7.1 makes extlinux fail at runtime

   version stable 4.05
   version pre    5.00-pre2
case $VERSION in
 4.05)
   use_gcc gcc-v4.5 ;;
esac
   require nasm md5crypt perl--Digest-SHA1
  optional mtools '' '' for creating msdos filesystems
  category administration/bootloader
 attribute console makej
    source stable $KERNEL_URL pub/linux/utils/boot/syslinux/syslinux-$VERSION.tar.xz
    source pre    $KERNEL_URL pub/linux/utils/boot/syslinux/Testing/${VERSION:0:4}/syslinux-$VERSION.tar.xz
      info good 20120710
      info last 20111209
      info home http://syslinux.zytor.com/wiki/index.php/The_Syslinux_Project
   protect /etc/extlinux/head
   protect /etc/extlinux/tail
  volatile /boot/extlinux/extlinux.conf
      desc 'bootloader for Linux and other operating systems
syslinux works on FAT
isolinux, also provided by isolinux, works on ISO9660 file systems.
extlinux, works on ext2, ext3, and ext4 file systems.

If booting using extlinux
then please use ms-sys
to install a bootable MBR.'

build(){
 install_menu(){
  mkdir -pvm 700 $DESTDIR/boot/extlinux
  cp     -av     $DESTDIR/{usr/share/syslinux/*menu.c32,boot/extlinux/}
 }

 configs_install(){
  mkdir   -pvm 700 $DESTDIR/{boot,etc/extlinux,usr/sbin}
  install  -vm 600 $SCRIPT_DIR/head     $DESTDIR/etc/extlinux/
  install  -vm 600 $SCRIPT_DIR/tail     $DESTDIR/etc/extlinux/
  install  -vm 700 $SCRIPT_DIR/extlinux $DESTDIR/usr/sbin/
 }

 case $VERSION in
  5.*) unset LDFLAGS ;;
  4.*) unset LDFLAGS ;;
 esac

 sed -i '/INSTALL_AUX_OPT/d
         s:win32/syslinux.exe::' Makefile

 rm -f diag/geodsp/mk-lba-img
 make &&
 rm -f extlinux/extlinux &&
 make install INSTALLROOT=$DESTDIR DESTDIR=$DESTDIR &&
 install_menu &&
 configs_install
}

current(){
 case $VERSION in
  4.04) [ -f /boot/extlinux/menu.c32 ] &&
        [ -f /etc/extlinux/head      ] &&
        grep -q INCLUDE /etc/extlinux/head ;;
 esac
}
