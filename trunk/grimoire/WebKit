# Even with --disable-gtk-doc WebKit still requires gtk-doc to be installed.

# r112169 r112011 r111990 r110587 r109673 r108509 r107164 r106139 failed to compile

# version 1.9.4 failed to compile
# version 1.9.5 requires developmental version of libsoup
# version 1.9.6 not tested but expected to have same problem as 1.9.5 :)

# webkit2gtk might not be used until gnome 3.8.0

   version   stable 1.9.6 1.9.3 1.9.2 1.9.1
   version unstable 1.9.92
case $VERSION in
 1.9.6)
      opts --disable-webkit2 ;;
esac
   require Imaging enchant geoclue gst-plugins-base-0.10 gtk+ gtk-doc libsoup
      opts --disable-gtk-doc --disable-glibtest
      opts --with-gtk=3.0 --enable-introspection
case $VERSION in
# 1.9.6)
#      opts --with-accelerated-compositing=no --disable-webgl ;;
 1.9.3)
      opts --with-accelerated-compositing=no --disable-webgl ;;
 1.9.2)
      opts --with-accelerated-compositing=no --disable-webgl ;;
 1.9.1)
      opts --with-accelerated-compositing=no --disable-webgl ;;
 1.8.1)
      opts --with-accelerated-compositing=no --disable-webgl ;;
 1.8.0)
      opts --with-accelerated-compositing=no --disable-webgl ;;
esac

#     opts --enable-geolocation
# switch --enable-3D-transforms        --disable-3D-transforms                "enable support for 3D transforms default=no"
# switch --enable-channel-messaging    --disable-channel-messaging            "enable HTML5 channel messaging support default=no"
# switch --enable-javascript-debugger  --disable-javascript-debugger          "enable JavaScript debugger/profiler support default=yes"
# switch --enable-offline-web-applications --disable-offline-web-applications "enable HTML5 offline web applications supporti default=yes"
# switch --enable-dom-storage          --disable-dom-storage                  "enable HTML5 client-side session and persistent storage support default=yes"
# switch --enable-icon-database        --disable-icon-database                "enable icon database default=yes"
# switch --enable-geolocation          --disable-geolocation                  "enable support for geolocation default=no"
# switch --enable-svg                  --disable-svg                          "enable support for SVG default=yes"
# switch --enable-wml                  --disable-wml                          "enable support for WML default=no"
# switch --enable-svg-animation        --disable-svg-animation                "enable support for SVG animation (experimental) default=yes"
# switch --enable-filters              --disable-filters                      "enable support for filters (experimental) default=no"
# switch --enable-svg-fonts            --disable-svg-fonts                    "enable support for SVG fonts (experimental) default=yes"
# switch --enable-svg-foreign-object   --disable-svg-foreign-object           "enable support for SVG foreign objects (experimental) default=yes"
# switch --enable-svg-as-image         --disable-svg-as-image                 "enable SVG as Image support (experimental) default=yes"
# switch --enable-coverage             --disable-coverage                     "enable code coverage support default=no"
# switch --enable-fast-malloc          --disable-fast-malloc                  "enable optimized memory allocator default=yes, default=no for debug builds"
# switch --enable-jit                  --disable-jit                          "Enable JIT compilation default=yes"
# switch --enable-xpath                --disable-xpath                        "enable support for XPath default=yes"

#  optional libxslt          --enable-xslt     --disable-xslt     "enable support for XSLT default=yes"
## optional gtk-doc          --enable-gtk-doc  --disable-gtk-doc  "use gtk-doc to build documentation [default=no]"
#  optional sqlite           --enable-database --disable-database "enable HTML5 client-side database storage support default=yes"
#  optional gst-plugins-base --enable-video    --disable-video    "enable HTML5 video support default=yes"

  category network/web
 attribute library makej optimize x11
#attribute multilib-concurrent multilib-dual

    source   stable http://www.webkitgtk.org/releases/webkit-$VERSION.tar.xz
    source unstable http://www.webkitgtk.org/releases/webkit-$VERSION.tar.xz
      info last 20120724
      info home http://www.webkitgtk.org/
      info home http://webkit.org/
      info docs http://trac.webkit.org/wiki
      info vurl "http://www.webkitgtk.org/?page=download"
      desc "open source web browser engine
WebKit is also the name of the Mac OS X system framework
version of the engine that's used by Safari, Dashboard, Mail,
and many other OS X applications.
WebKit's HTML and JavaScript code began as a branch of the KHTML
and KJS libraries from KDE.
This website is also the home of S60's S60 WebKit development."

build(){
 if   [ -f autogen.sh ]
 then sh ./autogen.sh
 fi

# linking fails due to too many command line arugments passed to /bin/sh
# when using ccache to compile version 1.9.6
# case $VERSION in
#  1.9.6) export      PATH="${PATH/\/usr\/libexec\/ccache:/}"
#         export   CFLAGS+=' -I$PWD/Source/WebKit2/UIProcess/API/gtk'
#         export CXXFLAGS+=' -I$PWD/Source/WebKit2/UIProcess/API/gtk' ;;
# esac

 sed -i 's:hardcode_into_libs=yes:hardcode_into_libs=no:' configure
 rm -f CMakeLists.txt
 if ! default_build; then
  export PATH="${PATH/\/usr\/libexec\/ccache:/}"
  make V=1 &&
  make install "DESTDIR=$DESTDIR"
 fi
}
