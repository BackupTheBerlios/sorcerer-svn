# Starting with gtk+ version 2.14.1 gtk+ may have a recursive
# requirement with gail

    stable 2.18.5 2.18.4 2.18.3 2.18.2 2.18.1 2.18.0
  unstable 2.19.2 2.19.1
   require atk jasper libXcomposite libXcursor libXdamage libXinerama libXrandr pango tiff
  optional cups '' '' for optional cups print backend
      opts --disable-gtk-doc --with-xinput=yes
  category graphic/library
 attribute library gnome
       url $GNOME_URL
    source sources/gtk+/${VERSION:0:4}/gtk+-$VERSION.tar.bz2
  homepage http://www.gtk.org
# Xinput is needed for tablets and other extended input devices 
      opts --with-xinput=yes
# Can not add cups optional requirement which exists at this time
# To avoid circuliar requirement loop with cups dbus gtk+
# dbus's optional requirement on gtk+ was dropped
  estimate 5000
   protect /etc/gtk-2.0/gtk.immodules
 freshmeat gtk
      desc 'toolkit for creating GUIs'

build(){
# I created this alternate build on 20090831 because the update
# involving libxcb which removed libxcb-xlib.so.0 became a problem
# since running gtk-query-immodules-2.0 as part of the default install
# of gtk+ can fail due to input modules provided by uim and scim
# having not yet been recompiled since they require gtk+
# and yet having references to now undefined symbols.
# Using DESTDIR to compile gtk+ omits the execution of
# gtk-query-immodules-2.0 and gdk-pixbuf-query-loaders which are used to create files
# /etc/gtk-2.0/gtk.immodules and /etc/gtk-2.0/gdk-pixbuf.loaders, respectively.
# Separate spells with the same names as the programs
# now exist in order to create those files.

 sed -i 's:demos tests::' Makefile.in

 local  DD=$PWD/.install
 mkdir $DD

 ./configure          \
 --prefix=/usr        \
 --sysconfdir=/etc    \
 --localstatedir=/var \
 $OPTS &&
 make install DESTDIR=$DD     && prepare_install &&
 cp -av               $DD/* / &&
 echo gdk-pixbuf-query-loaders | pipe_queue $CAST_QUEUE com &&
 echo gtk-query-immodules-2.0  | pipe_queue $CAST_QUEUE com


build_old(){

 build_older(){
  # using default_build now.
  # if installed with DESTDIR instead then
  # use gtk-query-immodules-2.0  to generate /etc/gtk-2.0/gtk.immodules
  # and gdk-pixbuf-query-loaders to generate /etc/gtk-2.0/gdk-pixbuf.loaders
  default_build
 }

 uncustomize(){
  if   [  -d  /etc.sav/gtk-2.0 ]
  then rm -fr /etc.sav/gtk-2.0
  fi
 }

sed -i 's:demos tests::' Makefile.in

 ./configure          \
 --prefix=/usr        \
 --sysconfdir=/etc    \
 --localstatedir=/var \
 $OPTS                &&
 make                 &&
 prepare_install      && uncustomize &&
 make    install
}
}
