# multilib-fail because perl is also multilib-fail
# ln: failed to create symbolic link `libpgtypes.so': File exists
# Might not always succeed with makej

   version stable 9.1.3 9.1.2 9.1.1 9.1.0 9.0.4
   require ncurses readline zlib
  optional perl      --with-perl    '' build Perl interface and PL/Perl
  optional Python    --with-python  '' build Python interface module
  optional tk        --with-tcl     '' build Tcl and Tk interfaces allows PgAccess
  optional openssl   --with-openssl '' build with OpenSSL support
  optional Linux-PAM --with-pam     '' for PAM support
  optional libxml2   --with-libxml  '' build with XML support
  optional libxslt   --with-libxslt '' use XSLT support when building contrib/xml2
      opts --disable-rpath --enable-integer-datetimes --with-nls 
      opts --enable-shared --disable-static
  category db
 attribute console library
#attribute makej
    source $POSTGRESQL_URL source/v$VERSION/postgresql-$VERSION.tar.bz2
      info last 20120227
      info home http://www.postgresql.org

#             ':--with-CXX::build C++ modules (libpq++)'
#             ':--with-multibyte::enable multibyte character support'
#             ':--enable-odbc::build the ODBC driver package'
#             'j2sdk:--with-java::build JDBC interface and Java tools'
 freshmeat pgsql
      desc 'Object-Relational DBMS
It supports almost all SQL constructs, including subselects,
trasactions and user defined types and functions.'

build(){
 if   [[ $HOSTTYPE == x86_64 ]] && [[ $CFLAGS =~ -m32 ]]
 then OPTS="${OPTS/--with-perl/}"; OPTS+=" --without-perl"
 fi

 export   CFLAGS="${CFLAGS//-ffast-math/}"
 export CXXFLAGS="${CXXFLAGS//-ffast-math/}"
 ./configure \
  --sysconfdir=/etc \
  --localstatedir=/var \
  --prefix=/usr\
 $OPTS      &&
 make       &&
 cd contrib &&
 make       &&
 cd -       &&
 make install DESTDIR=$DESTDIR && cd contrib &&
 make install DESTDIR=$DESTDIR &&
 rm -f $DESTDIR/usr/lib{,64}/*.a
}
