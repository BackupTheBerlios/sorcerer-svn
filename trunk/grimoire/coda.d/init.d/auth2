#!/bin/bash

### BEGIN INIT INFO
# Default-Mode: 510
# Required-Start: $network
# Required-Stop:  $network
# Default-Start: 2 3 4 5
# Default-Stop: 0 1 6
# Short-Description: auth2 provides the coda authentication server.
### END INIT INFO

. /lib/lsb/init-functions

only start stop restart status
pid_file /vice/auth2/pid
server /usr/sbin/auth2
name auth2

start(){
 run(){
  local VH SCM
  if   [ -f      /vice/hostname ] && [ -f       /vice/db/scm ] &&
       read VH < /vice/hostname   && read SCM < /vice/db/scm   &&
       [  "$VH" == "$SCM" ]
  then  unset  OPTS
  else  OPTS='-chk'
  fi
  start_daemon -b -p "$PIDF" $SERV $OPTS
 }

 if   log_warning_msg "$NAME starting"; run
 then log_success_msg "$NAME started"
 else log_failure_msg "$NAME not started"; status
 fi
}
