   version stable 0.40 0.39 0.37 0.36 0.34 0.33 0.32 0.31 0.30
   require dmidecode linux-kernel
  category kernel
 attribute linux-26-module
    source $SOURCEFORGE_URL tpctl/tp_smapi/$VERSION/tp_smapi-$VERSION.tgz
  homepage http://tpctl.sourceforge.net/
      desc 'IBM ThinkPad SMAPI Driver
The tp_smapi kernel module exposes some features
of the ThinkPad SMAPI functionality via a sysfs interface.

Do not compile HDAPS in kernel, this spell provides hdaps.ko'

build(){
LVER=$( installed_version $( get_provider linux-kernel ) )
if   [[ -z $LVER ]]
then        LVER=$( uname -r )
fi

sed -i 's:sudo ::g' Makefile
sed -i "s:/lib/modules/:$DESTDIR/lib/modules/:" Makefile
make KVER=$LVER &&
make KVER=$LVER HDAPS=1 install
}
