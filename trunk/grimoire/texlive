# XFree86 -> Linux-PAM -> teTeX -> teTex,src -> x11
# recursive requirement loop.
# Altered Linux-PAM to no longer optionally require teTeX

# when updating this check to see if it obliterates /usr/bin/man with a directory.

# Requirement on X perhaps unavodiable since texlive requires silgraphite
# and silgraphite requires pango


   version stable 20110705 20100722 20091107
 conflicts teTeX
   require freetype gd libpaper libpng poppler silgraphite t1lib zlib
#  require TECkit freetype gd libpaper libpng poppler silgraphite t1lib zlib
# TECkit is broke and not compiling

#  require TECkit freetype freetype-v1.3 gd libpaper libpng poppler silgraphite t1lib zlib

# optional clisp --enable-xindy --disable-xindy
      opts --disable-xindy
##     opts --enable-static=no --disable-dialog --with-system-freetype --with-system-freetype2 --with-system-t1lib --with-system-libpng --with-system-zlib --with-pic --with-system-xpdf --disable-native-texlive-build --with-freetype-includes=/usr/include/freetype --with-system-gd --with-system-teckit --with-system-graphite --with-teckit-includes=/usr/include/teckit --infodir=/usr/share/info --mandir=/usr/share/man --docdir=/usr/share/doc
#      opts --enable-static=no --disable-dialog --with-system-freetype --with-system-freetype2 --with-system-t1lib --with-system-libpng --with-system-zlib --with-pic --disable-native-texlive-build --with-freetype-includes=/usr/include/freetype --with-system-gd --with-system-teckit --with-system-graphite --with-teckit-includes=/usr/include/teckit --infodir=/usr/share/info --mandir=/usr/share/man --docdir=/usr/share/doc
       opts --enable-static=no --disable-dialog --with-system-freetype2 --with-system-t1lib --with-system-libpng --with-system-zlib --with-pic --disable-native-texlive-build --with-system-gd --with-system-graphite --infodir=/usr/share/info --mandir=/usr/share/man --docdir=/usr/share/doc

## the source disregarded the --datadoortdir and --datadir commands
# --datarootdir=/usr/share --datadir=/usr/share

  category documentation
 attribute console makej
    source ftp://tug.org/historic/systems/texlive/${VERSION:0:4}/texlive-$VERSION-source.tar.xz
      info last  20110705
      info home http://www.tug.org/texlive/
      desc 'TeX system with programs, macros, and fonts'

build(){
 export PATH="${PATH/\/usr\/libexec\/ccache:/}"
 default_build
}

# build(){
#  case $HOSTTYPE in
#   x86_64) export LDFLAGS+=' -L/usr/lib64' ;;
#  esac
#  default_build
# }


build_still_broke(){ 
build_broke(){
 fixes2009(){
  sed -i 's:$CLISP_LIB/clisp-link:/usr/bin/clisp-link:g' \
   utils/xindy/configure
 }

 case $VERSION in
  20091107) fixes2009 ;;
 esac

 default_build
}

cd clisp-2.48 &&
# ./configure $clisp_builddir --with-dynamic-ffi --ignore-absence-of-libsigsegv &&

./configure --with-dynamic-ffi --ignore-absence-of-libsigsegv &&
cd src             &&
./makemake         \
--prefix=/usr      \
--with-dynamic-ffi \
--ignore-absence-of-libsigsegv \
$OPTS > Makefile   &&
make config.lisp   &&
make &&
cd ../.. &&
OPTS+=" --with-clisp=$PWD/clisp-2.48"
default_build
}


post_install(){
default_post_install
echo mktexlsr | pipe_queue $CAST_QUEUE
}
