# Notes about problems and solutions.
# if jackd can not be started by qjackctl
# re-configure it to begin without real-time priority.

# If .xsession-errors  has errors about io-slave protocol file not being found
# then as the user:
# $ rm -f ~/.kde/share/config/ksycoca
# $ rm -r /var/tmp/kdecache-$USERNAME/ksyscoca
# $ kbuildsycoca4

# The missing icon pictures for Home Trash and so forth
# is because they are leftover from KDE 3.x in ~/Desktop
# Simply remove them.

[  -z  $VERSION  ] &&
   VERSION=( 4.0.0 3.5.8 )
  CATEGORY='profile'
 ATTRIBUTE='kde'
  HOMEPAGE='http://www.kde.org'
       URL="$KDE_URL"
       REQ=( 'kdeartwork kdebase kdebase-runtime kdebase-workspace'
             'kdeaccessibility:::for enhanced usability'
             'kdebindings:::for DCOP and kdejava bindings'
             'kdeadmin:::for system administration programs'
             'kdeedu:::for educational programs'
             'kdegames:::for games'
             'kdegraphics:::for image viewing programs'
             'kdenetwork:::for networking utilities'
             'kdemultimedia:::for audio/visual programs'
             'kdesdk:::for applications and tools used by KDE developers'
             'kdetoys:::for amusing programs'
             'kdewebdev:::for web page/site development tools'
             'kdevelop:::for creating and development of software projects' )
      OPTS='-DCMAKE_INSTALL_PREFIX:PATH=/usr -DCMAKE_BUILD_TYPE=Release'
  ESTIMATE='5'
      DESC='kde provides the K desktop environment.
It combines ease of use, contemporary
functionality and outstanding graphical design.
KDE is a completely new desktop, incorporating
a large suite of applications.
While KDE includes a window manager, file manager,
panel, control center and many other components
that one would expect to be part of a contemporary
desktop environment, the true strength of this
exceptional environment lies in the
interoperability of its components.'

kde_build()  {
SCX=1
while  [     -n                                 "${SOURCE[$SCX]}"  ]
do     patch -p0 < $SOURCE_CACHE/$SPELL/$VERSION/${SOURCE[$SCX]##*/}
       (( SCX++ ))
done

# ppanula: tested with kde 3.5.1, OK
# sed -i "s:CFLAGS=\"-O2 \$CFLAGS\":CFLAGS=\"${CFLAGS}\":
#         s:CXXFLAGS=\"-O2 \$CXXFLAGS\":CXXFLAGS=\"${CXXFLAGS}\":" configure

#  ./configure          \
#  --prefix=/usr        \
#  --sysconfdir=/etc    \
#  --localstatedir=/var \
#  --with-xinerama      \
#  --disable-debug      \
#  --enable-final       \
#  $OPTS                &&
#  make                 &&
#  prepare_install      &&
#  make    install

#export PATH="/usr/bin/qt4:$PATH"
 mkdir build     &&
 cd    build     &&
 cmake $OPTS ..  &&
 make            &&
 prepare_install &&
 make    install
}

old_bindings_build(){
 cd       dcoppython/lib
 unexpand pydcop.py   > pydcop.py.new
 mv       pydcop.py.new pydcop.py
 cd -
 kde_build
}

build(){
#  kdebindings) bindings_build ;;
 case $SPELL in
  kde) default_build ;;
    *) kde_build ;;
 esac
}

case $SPELL in
       kde) : ;;
 kde-l10n*) unset  REQ
            CATEGORY='documentation/i18n'
            SOURCE="stable/${VERSION}/src/kde-l10n/$SPELL-$VERSION.tar.bz2"
            DESC="$SPELL provides translated KDE messages." ;;
 kde-i18n*) unset  REQ
            CATEGORY='documentation/i18n'
            SOURCE="stable/${VERSION}/src/kde-i18n/$SPELL-$VERSION.tar.bz2"
            DESC="$SPELL provides translated KDE messages." ;;
         *) unset  REQ
            SOURCE="stable/${VERSION}/src/$SPELL-$VERSION.tar.bz2"
          # SOURCE="stable/${VERSION:0:3}/src/$SPELL-$VERSION.tar.bz2";;
esac
