if declare -F desc >/dev/null; then
 # code to create temporary forward compatibility
 with(){ local r=$1; shift; $r "$@"; }
 trait(){ attribute "$@"; }
 role(){ category "$@"; }
 volatile(){ vary "$@"; } 
fi

with version   stable delegate-20121102-0 delegate-20121025-0 delegate-20121024-0
with role    utility
with trait   archive_off solo sorcery
with info    last 20121102
with info    home http://sorcerer.silverice.org/
with source    stable http://sorcerer.silverice.org/download/sorcery/sorcery-$VERSION.tar.xz
with source  unstable http://sorcerer.silverice.org/download/sorcery/sorcery-$VERSION.tar.xz

# Should /var/cache and /var/spool be excluded?
# They used to be but that caused missing directories for cups

with exclude /dev
with exclude /etc/sorcery/local.config
with exclude /home
with exclude /proc
with exclude /root
with exclude /tmp
with exclude /usr/src/sorcery
with exclude /var/lock
with exclude /var/log/sorcery/snap
with exclude /var/run
with exclude /var/state
with exclude /var/tmp
with exclude "$EVENT_LOGS"
with vary    /etc/sorcery/config
with vary    /etc/init.d/
with vary    /usr/man/
with vary    /usr/share/man/
with vary    /usr/doc/
with vary    /usr/share/doc/
with vary    /usr/share/gtk-doc/
with vary    /usr/share/locale/
with vary    /usr/info/
with vary    /usr/share/info/
with vary    /usr/share/icons/
with vary    /var/cache/
with vary    /var/lib/
with vary    /var/spool/
with vary    /var/log/sorcery/
with vary    /lib/modules/.*/modules\.d
with vary    /lib/udev/dev/
with protect     /lib64/.link/
with protect /usr/lib64/.link/
with protect       /lib/.link/
with protect   /usr/lib/.link/
with protect /etc/sorcery/config
with protect /usr/libexec/sorcery/functions
with protect /usr/libexec/sorcery/oust
with protect /usr/libexec/sorcery/post
with protect /usr/libexec/sorcery/reap
with protect /usr/libexec/sorcery/rush
with protect /usr/libexec/sorcery/save
with protect /usr/libexec/sorcery/till
with protect /usr/sbin/oust
with protect /usr/sbin/post
with protect /usr/sbin/reap
with protect /usr/sbin/rush
with protect /usr/sbin/save
with protect /usr/sbin/till
with protect /var/cache
with protect /var/spool
with config  /etc/
with info    cite 'sorcery contains source management tools.
augur   - provides detailed information about the box
cast    - installs spells
dispel  - removes installed spells
leech   - downloads sources for spells
sorcery - menu driven source manager'

build(){ DESTDIR=$DESTDIR ./install $VERSION; }

post_install(){

 discard_old_index(){
  merge_grimoires
  generate_index   
  . /etc/sorcery/config
  run_details
 }

 discard_old_index
 pkill -u root wand &>/dev/null
 if   ! [ -f "$VERSION_LOGS/immune-exam-transition" ]
 then touch    "$MOIL_QUEUE/immune-exam-transition"
 fi
 default_post_install
}
