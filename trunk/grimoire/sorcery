   VERSION=( implosion-20080510-0 implosion-20080509-1 implosion-20080508-1 implosion-20080506-0 implosion-20080505-0 implosion-20080504-0 implosion-20080430-1 implosion-20080421-1 implosion-20080420-0 implosion-20080418-0 implosion-20080417-4 implosion-20080415-0 implosion-20080410-0 )
  CATEGORY='utility'
 ATTRIBUTE='archive_off solo sorcery'
    SOURCE="sorcery-$VERSION.tar.bz2"
  HOMEPAGE='http://sorcerer.silverice.org/'
       URL='http://sorcerer.silverice.org/download/sorcery/'
       REQ=( 'bash bzip2 curl dialog diffutils file findutils gcc grep grimoire gzip init-scripts less make mktemp p7zip patch procps rpmunpack sorcery-clean sorcery-sentinel tar which'
             'ccache:::for faster compilation when updating installed software'
             'sdelta3:::for downloading tiny source tarball patches'
             'sorcery-alien:::for monthly tracking of installed alien files'
             'sorcery-backup:::for monthly filesystem backup'
             'sorcery-bgz:::for background compression of tarballs'
             'sorcery-bootblaze:::for faster booting and login'
             'sorcery-defrag:::for monthly file defragment'
             'sorcery-immune:::for an immune system'
             'sorcery-md5sum:::for weekly md5sum check of installed files' )
   EXCLUDE='/etc/sorcery/local.config
            /home
            /proc
            /root
            /tmp
            /usr/src/sorcery
            /var/cache
            /var/lock
            /var/run
            /var/spool
            /var/state
            /var/tmp'
   PROTECT='/dev
            /etc/sorcery/config
            /etc/sorcery/dialogrc
            /etc/sorcery/log/history
            /etc/sorcery/log/snap
            /usr/libexec/sorcery/augur
            /usr/libexec/sorcery/cast
            /usr/libexec/sorcery/dispel
            /usr/libexec/sorcery/leech
            /usr/libexec/sorcery/share
            /usr/libexec/sorcery/sorcery
            /usr/sbin/augur
            /usr/sbin/cast
            /usr/sbin/dispel
            /usr/sbin/leech
            /usr/sbin/sorcery'
  ESTIMATE='20'
      DESC='sorcery contains source management tools.
augur   - provides detailed information about the box
cast    - installs spells
dispel  - removes installed spells
leech   - downloads sources for spells
sorcery - menu driven source manager'

build(){
 [  -x   install ] &&
 prepare_install   &&
 ./install $VERSION
}


post_install(){

 missing_init-script(){
  find  $VERSION_LOGS -type f -printf '%f\n' |
  while read
  do    [ -d $GRIMOIRE/$REPLY.d/init.d.on ] &&
        find $GRIMOIRE/$REPLY.d/init.d.on -type f -printf '%f\n'
  done  |
  while read
  do    [ -f /etc/init.d/$REPLY ] || echo "$REPLY"
  done  |
  while read
  do    find $GRIMOIRE/*.d/init.d.on/$REPLY -type f
  done  |
  sed   "s:$GRIMOIRE/::;s:\.d/.*::" |
  pipe_queue $CAST_QUEUE com
 }

 missing_la_logs(){

  la_of(){
   sed 's/: libtool library file$//p;d' $ID_LOGS/$1 |
   xargs -r --max-lines=2048 sed 's/#.*//' |
   tr "'" '\n' | tr '=' '\n' | tr ' ' '\n' |
   sed '\,^/,p;d' |
   while read; do [ -d "$REPLY" ] || echo "$REPLY"; done |
   sort -u
  }

  export LC_ALL=C IFS="$STANDARDS_IFS"
  [ -d               /etc/sorcery/log/la ] ||
  mkdir -p           /etc/sorcery/log/la
  show_installed |
  while read SPELL; do
   if ! [ -f         /etc/sorcery/log/la/$SPELL ]; then
    la_of "$SPELL" > /etc/sorcery/log/la/$SPELL
    echo            "/etc/sorcery/log/la/$SPELL" >> $INSTALL_LOGS/$SPELL
   fi
  done
 }

 move_ldd_logs(){
  [ -d /etc/sorcery/log/elf ] && return
  mv           /etc/sorcery/log/ldd /etc/sorcery/log/elf
  grep  -lr  '^/etc/sorcery/log/ldd' $INSTALL_LOGS | xargs -r --max-lines=2048 \
  sed   -i 's:^/etc/sorcery/log/ldd:/etc/sorcery/log/elf:'
 }


 [  -f  $PROVIDE_LOGS/poppler ] &&
 rm -f  $PROVIDE_LOGS/poppler
 chmod 700 ${LOG_DIR:-/etc/sorcery/log} /etc/init.d
 missing_init-script
 missing_la_logs
 move_ldd_logs
 default_post_install
}
