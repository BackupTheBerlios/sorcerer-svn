# 5.9.x is developmental version
# http://www.cpan.org/src/README.html#no_latest
# Can they be any more confusing about what how the
# latest release is or is not stable?

# perl should NOT use a single file shared by perl and modules
# for storing a catalog of available modules!
#   exclude /usr/lib/perl5/$VERSION/i586-linux-thread-multi/perllocal.pod
#   exclude /usr/lib/perl5/$VERSION/i686-linux-thread-multi/perllocal.pod
#   exclude /usr/lib/perl5/$VERSION/x86_64-linux-thread-multi/perllocal.pod

# is 5.12.0 ready?

    stable 5.12.1 5.12.0 5.10.1 5.10.0 5.8.8
    secure 5.10.0
  unstable 5.13.0 5.11.5
  optional gdbm '' '' for database support
  optional db   '' '' for database support
 conflicts perl--File-Spec
  category development/interpreter
 attribute console
    source http://www.cpan.org/src/perl-$VERSION.tar.gz
  homepage http://www.perl.org/
  estimate 10000
      desc 'perl is the practical extraction and reporting language by Larry Wall.
perl is a high-level, general-purpose programming language.
It is optimized for scanning arbitrary
text files and system administration.
It has built-in extended regular expression
matching and replacement, a dataflow mechanism
to improve security with setuid scripts and is
extendable via modules that can interface to C libraries.'

build(){

 export CFLAGS+=' -fPIC'

 if   echo "$CFLAGS" | grep -q "march=i586"
 then       SETARCH="-Darchname=i586-linux"
 else unset SETARCH
 fi

 unset LANG LC_CTYPE

 #  gcc 4.2.1 ouputs command-line instead of command line
 case  $VERSION  in
  5.8.8)
   if   gcc  --version | grep -q '4\.2\.[12]'
   then grep -rl '<command line>' * | xargs -r \
        sed  -i  's:ommand line:ommand-line:'
   fi ;;
 esac

# Even with UCLIBC_HAS_THREADS=y
# perl says when compiling with uClibc:
#     The recommended value for $d_getlogin_r_proto on this machine was "define"!
#     The recommended value for $d_readdir64_r_proto on this machine was "define"!

 case $MACHTYPE in
  *-uclibc) unset THREADS ;;
         *) THREADS='-Dusethreads' ;;
 esac

# could add -s : silent mode, only echoes questions and essential information.

 sed -i 's:-Wl,-rpath,$shrpdir::' Configure

 ./Configure \
 -Dprefix=/usr -d -e $THREADS \
 -A define:libpth="/lib64 /lib /usr/lib64 /usr/lib" \
 $SETARCH
 make  "OPTIMIZE=$CFLAGS" &&
 prepare_install &&
 make    install
}


post_install(){
 # unlock_cast
 ( show_installed perl-module
   echo           perl--XML-Parser
 ) | pipe_queue "$CAST_QUEUE" com
 true
}
