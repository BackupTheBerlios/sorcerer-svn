# 9.04_src_all segmentation faults when run.

   version stable 9.20.1 9.13
   require gcc-g++
  category archive
 attribute console makej
    source $SOURCEFORGE_URL p7zip/p7zip/$VERSION/p7zip_${VERSION}_src_all.tar.bz2
      info last  20110421
  homepage http://p7zip.sourceforge.net
     CFLAGS='-O3'
   CXXFLAGS='-O3'
    LDFLAGS='-Wl,-s -Wl,-O1'
#   LDFLAGS='-Wl,-s -Wl,-O1 -static'
#  protect /bin/7za
      desc 'command line high compression ratio archiver
p7zip provides aproximately 15% better compression than bzip2.
Compression speed is about 400% slower than bzip2.
Decompression speed is about the same as gzip.'

# When compiling -O3 using uClibc 7za segfaults when run.
# uncertain if LDFLAGS are being used.

#if [ -f $INSTALL_LOGS/gcc-uClibc ]; then
# use_gcc gcc-uClibc
#   CFLAGS='-Os'
# CXXFLAGS='-Os'
#  LDFLAGS='-Wl,-O1'
#fi

build(){
 make all 7z OPTFLAGS="$CXXFLAGS" &&
 rm -f bin/7za   &&
 make all OPTFLAGS="$CXXFLAGS" &&
 make    install DEST_HOME=$DESTDIR/usr &&
 sed -i "s:$DESTDIR::" $DESTDIR/usr/bin/7z{,a}
}

current(){
 case $VERSION in
  9.13) ! grep -q destdir /usr/bin/7za ;;
 esac
}
