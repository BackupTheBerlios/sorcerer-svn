# 9.04_src_all segmentation faults when run.

    stable 9.04 4.65 4.61 4.58 4.57 4.55
  category archive
 attribute console
       url $SOURCEFORGE_URL
    source p7zip/p7zip/$VERSION/p7zip_${VERSION}_src_all.tar.bz2
  homepage http://p7zip.sourceforge.net
     CFLAGS='-O3'
   CXXFLAGS='-O3'
    LDFLAGS='-Wl,-s -Wl,-O1'
#   LDFLAGS='-Wl,-s -Wl,-O1 -static'
#  protect /bin/7za
  estimate 320
      desc 'command line high compression ratio archiver
p7zip provides aproximately 15% better compression than bzip2.
Compression speed is about 400% slower than bzip2.
Decompression speed is about the same as gzip.'

# When compiling -O3 using uClibc 7za segfaults when run.
# uncertain if LDFLAGS are being used.

#if [ -f $INSTALL_LOGS/gcc-uClibc ]; then
# use_gcc gcc-uClibc
#   CFLAGS='-Os'
# CXXFLAGS='-Os'
#  LDFLAGS='-Wl,-O1'
#fi

build(){

sed -i 's:/usr/local:/usr:' makefile
make all 7z OPTFLAGS="$CXXFLAGS" &&
rm -f bin/7za   &&
#ake all OPTFLAGS="$CXXFLAGS -static" &&
make all OPTFLAGS="$CXXFLAGS" &&
prepare_install &&
make    install
# &&
#rm -f /usr/bin/7za &&
#mv    /usr/lib/p7zip/7za /bin/
}
