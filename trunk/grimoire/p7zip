    stable 4.65_src_all 4.61_src_all 4.58_src_all 4.57_src_all 4.55_src_all
  category archive
 attribute console
       url $SOURCEFORGE_URL
    source p7zip/p7zip_$VERSION.tar.bz2
  homepage http://p7zip.sourceforge.net
     CFLAGS='-O3'
   CXXFLAGS='-O3'
    LDFLAGS='-Wl,-O1 -static'
   protect /bin/7za
  estimate 320
      desc 'p7zip is a command line high compression ratio archiver.
p7zip provides aproximately 15% better compression than bzip2.
Compression speed is about 400% slower than bzip2.
Decompression speed is about the same as gzip.'

# When compiling -O3 using uClibc 7za segfaults when run.
# uncertain if LDFLAGS are being used.
if [ -f $INSTALL_LOGS/gcc-uClibc ]; then
 use_gcc gcc-uClibc
   CFLAGS='-Os'
 CXXFLAGS='-Os'
  LDFLAGS='-Wl,-O1'
fi


build(){
  # export LDFLAGS+=' -static -lstdc++ -dynamic'
  # no easy way to only statically link libstdc++ ?

 make OPTFLAGS="$CXXFLAGS" all &&
#make OPTFLAGS="$CXXFLAGS" CC=${CC:-/usr/bin/cc} CXX=${CXX:-/usr/bin/g++} all &&
 prepare_install &&
       ./install.sh /bin /usr/lib/p7zip /usr/man /usr/share/p7zip &&

 if   [ -f /usr/lib/p7zip/7za ]
 then mv   /usr/lib/p7zip/7za       /bin
      mv   /usr/lib/p7zip/7zCon.sfx /bin
 fi
}
