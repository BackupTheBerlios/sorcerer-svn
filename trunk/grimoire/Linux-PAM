case $MACHTYPE in
 *-uclibc)
    stable 1.0.4 1.0.1 ;;
 *) stable 1.1.1 1.1.0 1.0.4 1.0.1 ;;
esac

#  require libselinux
  optional cracklib   ''             --disable-cracklib for password checking library
  optional db         --enable-db=db --enable-db=no     for userdb support
  optional libprelude ''             --disable-prelude  for prelude support
  category security/authentication
 attribute library solo
      vurl ftp://ftp.kernel.org/pub/linux/libs/pam/library/
    source $KERNEL_URL pub/linux/libs/pam/library/Linux-PAM-$VERSION.tar.bz2
  homepage http://www.kernel.org/pub/linux/libs/pam

# /lib and /lib64 reserved for ELFs required for booting box
# not necessarily ELFs required for login and authentication.
      opts --enable-read-both-confs

# If the root filesystem can not be mounted
# login must be possible from the initramfs
  case $HOSTTYPE in
    x86_64) opts --libdir=/lib64 --enable-securedir=/lib64/security ;;
         *) opts --libdir=/lib   --enable-securedir=/lib/security   ;;
  esac
   protect /etc/security
 freshmeat linux-pam
  estimate 2800
      desc 'Linux-PAM provides a flexibile authentication mechanism.

For additional Linux-PAM modules
that are not provided with Linux-PAM
please see:
http://www.kernel.org/pub/linux/libs/pam/modules.html'


pre_build(){
 mkdir    -pm 755 /var/empty
 groupadd -K GID_MIN=256 -K GID_MAX=511    auth                    2>/dev/null
 useradd  -K UID_MIN=256 -K UID_MAX=511 -g auth -d /var/empty auth 2>/dev/null
 default_pre_build
}

build(){
 adjust_unix_chkpwd(){
  chown root:auth /sbin/unix_chkpwd
  chmod 2755      /sbin/unix_chkpwd
 }

 case $MACHTYPE in
  *-uclibc) patch -p1 < $SCRIPT_DIR/Linux-PAM-1.0.4-uclibc.patch ;;
 esac

 case $MACHTYPE in
  *-uclibc) export LDFLAGS+=' -lintl ' ;;
 esac

 export HAVE_SGML2LATEX=no
 sed -i 's: doc examples::g' Makefile.in

 sed -i '1i#define HAVE_DBM' modules/pam_userdb/pam_userdb.c
 default_build &&
 adjust_unix_chkpwd
}


post_install(){
 default_post_install
          get_provider pam_ldap |
 pipe     show_installed        |
 LC_ALL=C sort | uniq -d        |
          pipe_queue $CAST_QUEUE com
}
