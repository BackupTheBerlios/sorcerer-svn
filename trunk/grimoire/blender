   VERSION=( "2.45" "2.44" "2.43" "2.41" "2.40" "2.37a" "2.37" "2.36" )
# Configuring library blender_creator
# Configuring program blender
# scons: done reading SConscript files.
# scons: Building targets ...
# Compiling ==> 'buildinfo.c'
# Linking program ==> 'blender'
# /usr/src/sorcery/blender/build/linux2/lib/libbf_soundsystem.a(SND_OpenALDevice.o): 
# In function `SND_OpenALDevice::LoadSample(STR_String const&, void*, int)':
# SND_OpenALDevice.cpp:(.text+0x495): undefined reference to `alutLoadWAVMemory'
# SND_OpenALDevice.cpp:(.text+0x527): undefined reference to `alutUnloadWAV'
# SND_OpenALDevice.cpp:(.text+0x5c4): undefined reference to `alutLoadWAVFile'
# collect2: ld returned 1 exit status
# scons: *** [/usr/src/sorcery/blender/build/linux2/bin/blender] Error 1
# scons: building terminated because of errors.

  CATEGORY="graphic/editor video/editor"
# ATTRIBUTE="new x11"
ATTRIBUTE="new x11 broken"
    SOURCE="blender-$VERSION.tar.gz"
       URL="http://download.blender.org/source/"
  HOMEPAGE="http://www.blender3d.org"
	#to fix ogg and vorbis are really required if compiled in
#       REQ="Python alsa-lib freetype jpeg libvorbis mozilla freealut"
        REQ="Python alsa-lib freealut freetype jpeg libvorbis mozilla scons"
#       REQ="Python alsa-lib freetype jpeg libvorbis mozilla scons"
# CONFLICTS="openal freealut"
# Requirement list incomplete while blender is broken.
case  $VERSION  in
  2.45)  USE_GCC="gcc-v3.4"  ;;
  2.41)  USE_GCC="gcc-v3.4"  ;;
esac
 FRESHMEAT="blender"
  ESTIMATE="3821"
      DESC="blender is a 3d modeling environement
Blender is a fully integrated 3D graphics creation suite allowing
modeling, animation, rendering, post-production, real-time interactive
3D, and game creation and playback with cross-platform compatibility."


build()  {
export  LDFLAGS+=" -lalut"
scons            &&
prepare_install  &&
scons   install
}



build_old() {

create_config() {
                                  PVER="$( installed_version Python )"
echo "export NAN_PYTHON_VERSION=${PVER:0:3}"
echo "export OS=linux"
echo "export LDFLAGS+= -lopenal -lasound -logg -lGL -lGLU -L/usr/X11R6/lib"
}

binstall() {
cp obj/linux*/bin/blender /usr/bin
cp obj/linux*/bin/blenderplayer /usr/bin
#cp obj/linux*/bin/Blender3DPlugin.so /usr/lib/mozilla-${augur version mozilla}/plugins
#cp obj/linux*/bin/npBlender3DPlugin.so /usr/lib/mozilla-${augur version mozilla}/plugins
}


# sed  -i  "s:alutLoadWAVMemory((signed char*:alutLoadWAVMemory((ALbyte*:"  \
# intern/SoundSystem/openal/SND_OpenALDevice.cpp
# sed  -i  "s:ALbyte\*\*:ALbyte*:"  \
# intern/SoundSystem/openal/SND_OpenALDevice.cpp


# export    CFLAGS="-I/usr/include/python2.4 $CFLAGS"
# export  CXXFLAGS="-I/usr/include/python2.4 $CXXFLAGS"

grep  -rl  "\-O2" * |  xargs --max-lines 16  sed  -i  "s:-O2:$CFLAGS:"

cd $BUILD_DIR &&
create_config > user-def.mk &&
sed -i "s:BINTARGETS += blenderstatic::g" source/Makefile &&
make &&
prepare_install &&
binstall
}
