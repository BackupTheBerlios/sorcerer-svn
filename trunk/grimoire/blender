#  VERSION=( "2.42a" "2.42" "2.41" "2.40" "2.37a" "2.37" "2.36" )
# 2.42 failed compilation check
# 2.42a has problem compiling with OpenEXR 1.2.2
   VERSION=( "2.41" "2.40" "2.37a" "2.37" "2.36" )
  CATEGORY="graphic/editor video/editor"
 ATTRIBUTE="new x11"
    SOURCE="blender-$VERSION.tar.gz"
       URL="http://download.blender.org/source/"
  HOMEPAGE="http://www.blender3d.org"
	#to fix ogg and vorbis are really required if compiled in
       REQ="Python alsa-lib freetype jpeg libogg libvorbis mozilla freealut x11"
 FRESHMEAT="blender"
  ESTIMATE="3821"
      DESC="blender is a 3d modeling environement
Blender is a fully integrated 3D graphics creation suite allowing
modeling, animation, rendering, post-production, real-time interactive
3D, and game creation and playback with cross-platform compatibility."

build() {

create_config() {
                                  PVER="$( installed_version Python )"
echo "export NAN_PYTHON_VERSION=${PVER:0:3}"
echo "export OS=linux"
echo "export LDFLAGS+= -lopenal -lasound -logg -lGL -lGLU -L/usr/X11R6/lib"
}

binstall() {
cp obj/linux*/bin/blender /usr/bin
cp obj/linux*/bin/blenderplayer /usr/bin
#cp obj/linux*/bin/Blender3DPlugin.so /usr/lib/mozilla-${augur version mozilla}/plugins
#cp obj/linux*/bin/npBlender3DPlugin.so /usr/lib/mozilla-${augur version mozilla}/plugins
}


# sed  -i  "s:alutLoadWAVMemory((signed char*:alutLoadWAVMemory((ALbyte*:"  \
# intern/SoundSystem/openal/SND_OpenALDevice.cpp
# sed  -i  "s:ALbyte\*\*:ALbyte*:"  \
# intern/SoundSystem/openal/SND_OpenALDevice.cpp


# export    CFLAGS="-I/usr/include/python2.4 $CFLAGS"
# export  CXXFLAGS="-I/usr/include/python2.4 $CXXFLAGS"

grep  -rl  "\-O2" * |  xargs -l16  sed  -i  "s:-O2:$CFLAGS:"

cd $BUILD_DIR &&
create_config > user-def.mk &&
sed -i "s:BINTARGETS += blenderstatic::g" source/Makefile &&
make &&
prepare_install &&
binstall
}
