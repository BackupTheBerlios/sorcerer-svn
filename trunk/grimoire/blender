   VERSION=( "2.45" "2.44" "2.43" "2.41" "2.40" "2.37a" "2.37" "2.36" )
# 2.44 may have optional on ffmpeg

# From 2.45:
# ====> make all in intern/SoundSystem/openal
# g++ -c -DUSE_SUMO_SOLID -pipe -fPIC -funsigned-char -fno-strict-aliasing -DNDEBUG -Os -march=pentium3 -msse -Wall -Wno-reorder -DMOZ_NOT_NET -I/usr/include     -I/usr/src/sorcery/blender/blender-2.45/../lib/linux-glibc2.6.1-i386/string/include     -I/usr/src/sorcery/blender/blender-2.45/../lib/linux-glibc2.6.1-i386/moto/include -I../intern -I.. -I. -I../sdl SND_OpenALDevice.cpp -o /usr/src/sorcery/blender/blender-2.45/obj/linux-glibc2.6.1-i386/intern/OpenALSoundSystem/SND_OpenALDevice.o
# In file included from SND_OpenALDevice.cpp:53:
# /usr/include/AL/alc.h:190: error: '<anonymous>' has incomplete type
# /usr/include/AL/alc.h:190: error: invalid use of 'ALCvoid'
# /usr/include/AL/alc.h:251: error: '<anonymous>' has incomplete type
# /usr/include/AL/alc.h:251: error: invalid use of 'ALCvoid'

  CATEGORY="graphic/editor video/editor"
ATTRIBUTE="new x11 broken"
    SOURCE="blender-$VERSION.tar.gz"
       URL="http://download.blender.org/source/"
  HOMEPAGE="http://www.blender3d.org"
	#to fix ogg and vorbis are really required if compiled in
#       REQ="Python alsa-lib freetype jpeg libvorbis mozilla freealut"
       REQ="Python alsa-lib freetype jpeg libvorbis mozilla freealut"
# Requirement list incomplete while blender is broken.
case  $VERSION  in
  2.41)  USE_GCC="gcc-v3.4"  ;;
esac
 FRESHMEAT="blender"
  ESTIMATE="3821"
      DESC="blender is a 3d modeling environement
Blender is a fully integrated 3D graphics creation suite allowing
modeling, animation, rendering, post-production, real-time interactive
3D, and game creation and playback with cross-platform compatibility."

build() {

create_config() {
                                  PVER="$( installed_version Python )"
echo "export NAN_PYTHON_VERSION=${PVER:0:3}"
echo "export OS=linux"
echo "export LDFLAGS+= -lopenal -lasound -logg -lGL -lGLU -L/usr/X11R6/lib"
}

binstall() {
cp obj/linux*/bin/blender /usr/bin
cp obj/linux*/bin/blenderplayer /usr/bin
#cp obj/linux*/bin/Blender3DPlugin.so /usr/lib/mozilla-${augur version mozilla}/plugins
#cp obj/linux*/bin/npBlender3DPlugin.so /usr/lib/mozilla-${augur version mozilla}/plugins
}


# sed  -i  "s:alutLoadWAVMemory((signed char*:alutLoadWAVMemory((ALbyte*:"  \
# intern/SoundSystem/openal/SND_OpenALDevice.cpp
# sed  -i  "s:ALbyte\*\*:ALbyte*:"  \
# intern/SoundSystem/openal/SND_OpenALDevice.cpp


# export    CFLAGS="-I/usr/include/python2.4 $CFLAGS"
# export  CXXFLAGS="-I/usr/include/python2.4 $CXXFLAGS"

grep  -rl  "\-O2" * |  xargs -l16  sed  -i  "s:-O2:$CFLAGS:"

cd $BUILD_DIR &&
create_config > user-def.mk &&
sed -i "s:BINTARGETS += blenderstatic::g" source/Makefile &&
make &&
prepare_install &&
binstall
}
