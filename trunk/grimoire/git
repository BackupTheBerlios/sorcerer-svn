# manual page for git-clone suggests a requirement on rsync

with version   stable 1.8.1.1 1.8.1 1.8.0.3
with role    development
with trait   console makej
with info    home http://git-scm.com/
with info    docs http://git-scm.com/documentation

if [ $SPELL == git ]; then
with base    curl rsync
with source    stable http://git-core.googlecode.com/files/git-$VERSION.tar.gz
with source  unstable http://git-core.googlecode.com/files/git-$VERSION.tar.gz
with elect   tk --with-tcltk --without-tcltk for gitk
with elect   git-htmldocs ''       '' to install documentation in HTML format
with elect   git-manpages ''       '' to install git man pages
#with elect   web-server   --gitweb '' to install gitweb
with info    last 20130117
with info    home http://git-scm.com/
#with info vurl http://git-scm.com/download
with info    vurl http://code.google.com/p/git-core/downloads/list
with info    cite 'distributed revision control system
with an unusually rich command set that provides both
high-level operations and full access to internals.'

fi

build(){
 install_gitweb(){
  install -vm 755 -d                     $DESTDIR/usr/share/gitweb
  install -vm 644 $BUILD_DIR/gitweb/git* $DESTDIR/usr/share/gitweb
 }

 install_bc(){
  cd contrib/completion
  install -vm 755 -d                  $DESTDIR/etc/bash_completion.d
  install -vm 755 git-completion.bash $DESTDIR/etc/bash_completion.d/git
  cd ../..
 }

 install_contrib_hooks(){
  install -vm 755 -d                $DESTDIR/usr/share/git-core/contrib/hooks &&
  install -vm 755  contrib/hooks/*  $DESTDIR/usr/share/git-core/contrib/hooks
 }

 grep -q '^sysconfdir'                config.mak.in ||
 sed  -i '10isysconfdir=@sysconfdir@' config.mak.in

 if   echo $OPTS | grep -q gitweb
 then IG=install_gitweb; unset OPTS
 else IG=:
 fi

 autoconf      &&
 default_build &&
 install_contrib_hooks &&
 install_bc    &&
 $IG
}
