# requires revision for qt GUI
# only acquires gcc-g++ when creating qt GUI

   version stable 0.7.3 0.7.2 0.7.1 0.7.0
   require dbus ncurses openssl readline
# optional qt-everywhere-opensource '' '' for GUI
  category network/security network/wireless
 attribute console
    source http://hostap.epitest.fi/releases/wpa_supplicant-$VERSION.tar.gz
      info home http://hostap.epitest.fi/wpa_supplicant
      desc 'WPA/WPA2 supplicant
wpa_supplicant supports WPA and WPA2 (IEEE 802.11i/RSN).
It is suitable for both desktop/laptop
computers and embedded systems.
Supplicant is the IEEE 802.1X/WPA
component that is used in the client stations.
It implements key negotiation with a WPA
Authenticator and it controls the roaming and
IEEE 802.11 authentication/association of the wlan driver.
wpa_supplicant is designed to be a daemon program
that runs in the background and acts as the backend
component controlling the wireless connection.
It supports separate frontend programs and a text-based
frontend (wpa_cli) is included with wpa_supplicant.'

build(){
 create_config(){
  cat > .config << EOF
CONFIG_DRIVER_HOSTAP=y
CONFIG_DRIVER_ATMEL=y
CONFIG_DRIVER_IPW=y
CONFIG_DRIVER_RALINK=y
CONFIG_DRIVER_WEXT=y
CONFIG_DRIVER_WIRED=y
CONFIG_IEEE8021X_EAPOL=y
CONFIG_EAP_MD5=y
CONFIG_EAP_MSCHAPV2=y
CONFIG_EAP_TLS=y
CONFIG_EAP_PEAP=y
CONFIG_EAP_TTLS=y
CONFIG_EAP_GTC=y
CONFIG_EAP_OTP=y
CONFIG_EAP_LEAP=y
CONFIG_PKCS12=y
CONFIG_SMARTCARD=y
CONFIG_CTRL_IFACE=y
CONFIG_READLINE=y
CONFIG_BACKEND=file
CONFIG_PEERKEY=y
CONFIG_IEEE80211W=y
CONFIG_TLS=openssl
CONFIG_CTRL_IFACE_DBUS=y
EOF
 }

 install_examples(){
  mv *.service *.conf examples
  mv                  examples doc
 }

 install_man(){
  for i in doc/docbook/*.[0-9]; do
   mkdir   -p           $DESTDIR/usr/share/man/man${i##*.}
   install -v -m 644 $i $DESTDIR/usr/share/man/man${i##*.}
  done
 }

 install_wpa_gui(){
  if            [ -f wpa_gui-qt4/wpa_gui ];  then
   mkdir -p $DESTDIR/usr/bin
   install -vm 755 wpa_gui-qt4/wpa_gui $DESTDIR/usr/bin
  fi
 }

 install_wpa_files(){
  install -dv $DESTDIR/etc/wpa_supplicant
  install -dv $DESTDIR/etc/dbus-1/system.d/
  install -vm 644 dbus-wpa_supplicant.conf $DESTDIR/etc/dbus-1/system.d/wpa_supplicant.conf  
  install_wpa_gui
  install_examples
  install_man	
 }

 make_gui(){
  make wpa_gui-qt4
  true
 }

#export QTDIR=/usr
 sed -i 's:/usr/local:/:' wpa_supplicant/Makefile
 export  LDFLAGS+=' -L/lib -L/lib64'
 cd  wpa_supplicant &&
 create_config &&
 make &&
#make_gui &&
 make install DESTDIR=$DESTDIR &&
 install_wpa_files
}
