# libofx 0.9.0 and 0.8.3 no longer compile
# they are missing time_t time(time_t *t);
# And /usr/include/time.h no longer appears to provide the above function.
# Very strange.

# Version 0.9.0 compiled fine.
# However, aqbanking version 2.3.2 requires libofx version 0.8.3

   version stable 0.9.5 0.9.4 0.9.2 0.9.1 0.9.0
   require OpenSP curl libxml++
      opts --enable-static=no
  category utility/finance
 attribute library
 attribute broke
    source $SOURCEFORGE_URL libofx/libofx/$VERSION/libofx-$VERSION.tar.gz
      info last 20120116
      info home http://libofx.sourceforge.net
      desc 'library for Open Financial eXchange specification
libofx is a generic library to allow financial software to
easily support the Open Financial eXchange specification.
Two utilities are currently included with LibOFX: ofxdump and ofxtoqif.
ofxdump writes to stdout, in human readable form,
everything the library understands about a particular OFX response file.
ofxtoqif is an OFX response to the
QIF (Quicken Interchange Format) file converter.
Much OFX information is lost since the QIF file
format is very primitive, but ofx2qif should allow
importation of bank statements in any software that
support QIF until said software supports the library directly.
LibOFX was implemented from the full OFX 1.6
spec and comes with a developers manual.'

build(){
 case $VERSION in
  0.9.[0-1])
   sed -i '1i#include <ctime>
           1i#include <cstdlib>
           1i#include <cstring>' lib/ofx_utilities.cpp
   sed -i '1i#include <cstdlib>' lib/ofx_container_transaction.cpp
   sed -i '1i#include <cstring>' lib/ofx_request.cpp
   sed -i '1i#include <cstdlib>' lib/ofx_request_accountinfo.cpp
   sed -i '1i#include <cstdlib>' lib/ofx_request_statement.cpp
   sed -i '1i#include <cstring>
           1i#include <cstdlib>' ofxdump/ofxdump.cpp
  ;;
  0.8.3) sed -i 's/std::time/time/;1i#include <stdlib.h>' lib/ofx_utilities.cpp ;;
#        sed -i 's/time(&temptime);/std::time(\&temptime);/' lib/ofx_utilities.cpp ;;
 esac
 sed -i 's:-L$OPENSPLIBPATH::' configure
 default_build
}
