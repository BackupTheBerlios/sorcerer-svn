# Where is this hosted now?
# freshmeat does not know.
# Uncertain if modified build() is DESTDIR compliant

    stable 1.0.13 1.0.12
  category audio/codec audio/library
 attribute library
 attribute multilib-fail
#attribute broke
#    source http://kbs.cs.tu-berlin.de/~jutta/gsm/gsm-$VERSION.tar.gz
#  homepage http://kbs.cs.tu-berlin.de/~jutta/toast.html
     source http://www.quut.com/gsm/gsm-$VERSION.tar.gz
   homepage http://www.quut.com/gsm/
  estimate 100
      desc 'audio codec library'

build(){

 install_libs(){
  ld --whole-archive -shared -o $DESTDIR/usr/lib/libgsm.so.1 $DESTDIR/usr/lib/libgsm.a
  ln -s libgsm.so.1 $DESTDIR/usr/lib/libgsm.so
 }

 install_headers(){
  chmod 755 inc
  chmod 644 inc/*
  mkdir -p            $DESTDIR/usr/include
  cp    -av inc       $DESTDIR/usr/include/gsm
  ln    -s  gsm/gsm.h $DESTDIR/usr/include/gsm.h
 }

 sed -i "s:^\(CCFLAGS.*\):\1 -fPIC:" Makefile

 make &&
 mkdir -p $DESTDIR/usr/{bin,include,lib} &&
 make install INSTALL_ROOT=$DESTDIR/usr &&
      install_headers &&
      install_libs    &&
 if   [[ $HOSTTYPE == x86_64   ]]; then
  if  [[ $CFLAGS   =~ -m32     ]]; then mv $DESTDIR/usr/lib{,32}
                                   else mv $DESTDIR/usr/lib{,64}
   if [[ -d $DESTDIR/usr/lib32 ]]; then mv $DESTDIR/usr/lib{32,}; fi
  fi
 fi
}
