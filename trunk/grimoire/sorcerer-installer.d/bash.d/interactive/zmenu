wait_for_prc(){
        running(){ ps -C prc --no-headers -o fname | grep -q prc; }
 if     running; then
  while running; do sleep 1; done
  read -n 1 -t 60 -p "Wait 60 seconds or press space to continue"
 fi
}

ir_menu(){
 show_menu(){
  dialog --backtitle "Sorcerer Install/Rescue" --title "Task Menu" --stdout \
         --ok-label Select --cancel-label Shell --item-help --menu "$HELP" 0 0 0 \
  Dialog   "Tutorial" \
           "Dialog skill is a must have" \
  Sentient "Automatic installation of KDE + firefox + xorg" \
           "Few questions asked and installs Sorcerer Sentient to a block device" \
  Sorcerer "Menu driven installation" \
           "Install Sorcerer Modern Magic for experienced SAs"
 }

 while REPLY=$( show_menu ); do
  case $REPLY in
   Dialog)   /sbin/dt ;;
   Sentient) /sbin/sinstall Sentient ;;
   Sorcerer) /sbin/sinstall ;;
  esac
 done
}

if read < /proc/cmdline; [[ $REPLY =~ boot=IR ]]; then
 if   (( UID == 0 )) && ! pgrep sinstall >/dev/null
 then wait_for_prc; ir_menu
 else unset ir_menu wait_for_prc sentient_menu
 fi
fi
