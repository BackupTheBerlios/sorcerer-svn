# This will download during compilation acquire avformat from subversions repository.
# (--disable-mmx might be necessary on 64bit)

# qimage and SDL support required for use of mlt with kdenlive

   version stable 0.7.4 0.7.2 0.7.0 0.6.2 0.6.0
   require SDL_image ffmpeg libexif qt-everywhere-opensource subversion
  optional libdv          '' '--disable-dv'
  optional frei0r-plugins '' '--disable-frei0r'
  optional gtk+           '' '--disable-gtk2'
  optional jackit
  optional libquicktime
  optional libsamplerate
  optional sox            '' '--disable-sox'
  optional libvorbis      '' '--disable-vorbis'
  optional xine-lib       '' '--disable-xine'
#      opts --enable-gpl --swig-languages=all --avformat-svn --avformat-swscale --qimage-libdir=/opt/kde4/lib --qimage-includedir=/opt/kde4/include
      opts --enable-gpl --avformat-swscale 
      opts --qimage-includedir=/opt/kde4/include --qimage-libdir=/opt/kde4/lib
      opts    --kde-includedir=/opt/kde4/include    --kde-libdir=/opt/kde4/lib
  category video
 attribute library makej multilib-dual setarch
    source $SOURCEFORGE_URL mlt/mlt/mlt-$VERSION.tar.gz
#   source $SOURCEFORGE_URL mlt/mlt/$VERSION/mlt-$VERSION.tar.gz
      info last 20110722
  homepage http://www.mltframework.org/twiki/bin/view/MLT/
    CFLAGS='-O2 -ffast-math'
   LDFLAGS='-Wl,-O1'
      desc 'media loving toolkit'

build(){
 local PKG_CONFIG_PATH

# if    [[ $HOSTTYPE == x86_64 ]]; then
#  if   [[ $CFLAGS =~ -m32 ]]
#  then PKG_CONFIG_PATH=/opt/kde4/i686/lib/pkgconfig; LDFLAGS+=' -Wl,-rpath-link,/opt/kde4/i686/lib'
#  else PKG_CONFIG_PATH=/opt/kde4/lib64/pkgconfig;    LDFLAGS+=' -Wl,-rpath-link,/opt/kde4/lib64'; OPTS+=' --libdir=/usr/lib64'
#  fi
# else  PKG_CONFIG_PATH=/opt/kde4/lib64/pkgconfig;    LDFLAGS+=' -Wl,-rpath-link,/opt/kde4/lib'
# fi

 if    [[ $HOSTTYPE == x86_64 ]]; then
  if   [[ $CFLAGS =~ -m32 ]]
  then PKG_CONFIG_PATH=/opt/kde4/i686/lib/pkgconfig; LDFLAGS+=' -Wl,-rpath,/opt/kde4/i686/lib'
  else PKG_CONFIG_PATH=/opt/kde4/lib64/pkgconfig;    LDFLAGS+=' -Wl,-rpath,/opt/kde4/lib64'; OPTS+=' --libdir=/usr/lib64'
  fi
 else  PKG_CONFIG_PATH=/opt/kde4/lib64/pkgconfig;    LDFLAGS+=' -Wl,-rpath,/opt/kde4/lib'
 fi

 export PKG_CONFIG_PATH LDFLAGS

 if   grep -qr "/libvdpau.so$" $INSTALL_LOGS
 then opts --avformat-vdpau
 fi

 default_build
}
