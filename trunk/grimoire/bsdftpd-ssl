   VERSION=( "1.1.0" "1.0.2" )
  CATEGORY="network/ftp"
 ATTRIBUTE="server console broken"
# May want to interact during build()
    SOURCE="bsdftpd-ssl-$VERSION.tar.gz"
       URL="http://bsdftpd-ssl.sc.ru/files/bsdftpd-ssl/"
  HOMEPAGE="http://bsdftpd-ssl.sc.ru/"
  EPROVIDE="ftpd"
       REQ=( "byacc openssl ncurses"
             "Linux-PAM::NOPAM:for pluggable authnetication"
             "heimdal:Kerberos:for kerberos support"
             "tcp_wrappers:::for controlling access to ftpd daemon through tcp_wrappers"
             "xinetd:::for running server" )
  ESTIMATE="92"
      DESC="bsdftpd-ssl provides a secure ftp server
BSDftpd-ssl is a TLS/SSL-enhanced FTP server.
It is based on FreeBSD's ftpd,
so it is supposed to be a stable and
secure solution for authorized user access.
The TLS/SSL enhancement allows RFC2228
\"FTP Security Extensions\"-compliant TLS/SSL
support for both control and data connections.
This feature requires special clients that are also available.
Both server and clients are fully compatible with
standard FTP protocol (for example, FTP server can
support TLS/SSL-aware and standard clients simultaneously)."


build() {

compile_and_install() {
  grep   -qx   "tcp_wrappers"           $OPT_ON_LOGS/bsdftpd-ssl  ||
  sed    -i    "/wrap/d;/WRAP/d"        ftpd/Makefile.*
  sed    -i    "s:-Wall -O2::"          ftp*/Makefile*
  grep   -lr              "/usr/local"     *  |
  xargs  -l64  sed  -i  "s:/usr/local::"

  case  $VERSION  in
    1.1.0)  sed  -i  "s:cmdtab\[\]:*cmdtab:"  ftp/{cmdtab.c,extern.h}  ;;
  esac

  ./config.sh      \
    `uname` $OPTS  \
    noncursesdir   &&
  make             &&
  prepare_install  &&
  make    install
}

  if  !  [  -f  /etc/ssl/certs/ftpd.pem  ];  then
    cert/cert-dummy.sh
    mv   cert-dummy.pem  /etc/ssl/certs/ftpd.pem
  fi

  activate_voyeur
  compile_and_install
}
