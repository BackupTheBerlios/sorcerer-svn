    stable 1.6.3
  category utility/editor utility/spreadsheet graphic/editor
 attribute kde3
  homepage http://www.koffice.org
       url $KDE_URL

if [ $SPELL == koffice-v3 ]; then
   require kdebase-v3 libart_lgpl-v2.3.17 libpaper
  optional ImageMagick         ''                    ''              for image conversion support
  optional Python              --with-pythondir=/usr ''              for Python support
  optional aspell              ''                    ''              for spell checking 
  optional koffice-l10n        ''                    ''              for internationalization support
  optional lcms                ''                    ''              for Krita support
  optional libwpd              ''                    ''              for reading word perfect documents
  optional libexif             ''                    ''              to enable JPEG format in krita
  optional mysql               --enable-mysql        --disable-mysql for mysql support in Kexi
  optional nas                 ''                    ''              for network audio support
  optional poppler-qt-x11-free ''                    ''              to import pdf files into krita
  optional postgresql          --enable-pgsql        --disable-pgsql for postgresql support in Kexi
  optional ruby                ''                    ''              for ruby scripting support
  optional wv2                 ''                    ''              to build MS word filter

    source stable/koffice-$VERSION/src/koffice-$VERSION.tar.bz2
case $VERSION in
 1.6.3) source security_patches/koffice-1.6.3-xpdf2-CVE-2007-4352-5392-5393.diff
        use_gcc gcc-v4.2 ;;
esac
fi

# koffice 1.6.2 gained sqlite as mandatory requirement?
      opts --prefix=/opt/kde3 --with-qt-dir=/opt/kde3 --disable-debug --enable-final

# ImageMagick filter deprecated
#             'ImageMagick:::for image conversion support'
# koffice wants GraphicsMagick instead of ImageMagick now
#             'GraphicsMagick:::for image conversion support'
# GraphicsMagick is supposed to replace ImageMagick in koffice
# for additional graphic input filters, but
# GraphicsMagick has not made a release in a much longer time
# than ImageMagick and GraphicsMagic has a compile error.
# Therefore, staying with ImageMagick
 conflicts koffice
  estimate 20000
      desc 'koffice-v3 is an integrated office suite.
KOffice currently includes KWord, KSpread, KPresenter, KChart,
Krayon, KIllustrator, KFormula, Kugar, Kexi, Krita and Kivio.
koffioce-v3 requires an absurd amount of time to compile.'

case ${SPELL:10} in
 -*l10n-*)
  require kdelibs-v3
  source stable/koffice-$VERSION/src/koffice-l10n/${SPELL/-v3/}-${VERSION:0:5}.tar.bz2
  CATEGORY="$CATEGORY documentation/l10n"
  eprovide koffice-l10n
  estimate 118 ;;
esac

build(){
 case $VERSION in
  1.6.3) grep -rl "\<iostream.h\>" * | xargs -r --max-lines=64 \
         sed  -i "s:<iostream.h>:<iostream>\nusing namespace std;:" ;;
 esac
 case $VERSION in
  1.6.3) patch -p0 < $SOURCE_CACHE/koffice/1.6.3/${SOURCE[1]##*/} ;;
 esac
 default_build
}
