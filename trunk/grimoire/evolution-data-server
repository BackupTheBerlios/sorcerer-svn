# openldap support required for communicating with exchange servers
# 2.32.0 failed compilation
# during ia32 multilib compilation:
# checking for iconv in -liconv... no
# checking for iconv... yes
# checking for gnu_get_libc_version... yes
# checking if iconv() handles UTF-8... no
# configure: error: You need to install a working iconv implementation, such as ftp://ftp.gnu.org/pub/gnu/libiconv

# evolution-data-server might be doing something incorrect to test.

# version 3.0.2 failed compilation
# version 3.2.0 failed compilation
# version 3.1.92 failed compilation.
# version 3.2.0 is refusing to compile multilib
# version 3.4.0 fails to compile

with version   stable 3.6.2 3.6.1 3.6.0
with version unstable 3.7.1
case $VERSION in
 3.4.0)
with also    --enable-introspection=no ;;
esac
with base    gcr gnome-online-accounts libgdata libgweather libical nss nspr
with also    --with-openldap=yes --disable-gtk-doc
#with elect   gtk-doc --enable-gtk-doc --disable-gtk-doc
with role    network/email
with trait   gnome library makej multilib-concurrent
with source    stable $GNOME_URL sources/evolution-data-server/${VERSION:0:3}/evolution-data-server-$VERSION.tar.xz
with source  unstable $GNOME_URL sources/evolution-data-server/${VERSION:0:3}/evolution-data-server-$VERSION.tar.xz
with info    last 20121112
with info    home http://gnome.org/projects/evolution/stable.shtml
with info    cite 'libraries needed by evolution'

build(){

build_old(){
 # export pkg-config info instead of using configure switch --with-nspr-includes
 # export   CFLAGS+=" $( pkg-config --cflags nspr )"
 # export CXXFLAGS+=" $( pkg-config --cflags nspr )"
 #export  LDFLAGS+=" $( pkg-config --libs   nspr )"

 export   CFLAGS+=" -UGTK_DISABLE_DEPRECATED -UGDK_PIXBUF_DISABLE_DEPRECATED"
 export CXXFLAGS+=" -UGTK_DISABLE_DEPRECATED -UGDK_PIXBUF_DISABLE_DEPRECATED"

 sed -i 's:-L$libdb_prefix/lib::' configure
 default_build
}

# Waiting for gnome authors to fix version 3.4.0 release

 case $VERSION in
# 3.4.0) aclocal; automake -acf; libtoolize -cf; autoreconf -fi
#        sed -i 's:$(LTLIBRARIES) $(PROGRAMS) $(DATA):$(LTLIBRARIES) $(DATA):' addressbook/libedata-book/Makefile.in ;;
  3.2.0) export LDFLAGS+=' -lsqlite3' ;;
 esac

# hardcode_into_libs is required in order to compile evolution-data-server version 3.4.0
# sed -i 's:hardcode_into_libs=yes:hardcode_into_libs=no:' configure
 sed -i 's:-L$libdb_prefix/lib::' configure
 default_build
}
